{"ast":null,"code":"import _extends from \"@babel/runtime/helpers/esm/extends\";\nimport { FiasFields } from \"../../types\";\nimport { abbreviations } from \"../../constants/abbreviations\";\nimport { FiasLogger } from \"../../logger/FiasLogger\";\nimport { fetch } from \"../../../../lib/net/fetch\";\nimport { FiasAPIResultFactory } from \"../FiasAPIResultFactory\";\nexport var FiasAPI = function FiasAPI(baseUrl, version, fetchFn) {\n  var _this = this;\n\n  if (baseUrl === void 0) {\n    baseUrl = '';\n  }\n\n  if (fetchFn === void 0) {\n    fetchFn = fetch;\n  }\n\n  this.baseUrl = baseUrl;\n  this.version = version;\n  this.fetchFn = fetchFn;\n  this.regionsPromise = null;\n\n  this.verify = function (address) {\n    var query = {\n      directParent: true,\n      search: false\n    };\n    return _this.send(\"verify?\" + FiasAPI.createQuery(query), {\n      method: 'POST',\n      headers: {\n        Accept: 'application/json',\n        'Content-Type': 'application/json'\n      },\n      body: JSON.stringify([address.convertForVerification()])\n    }).then(function (_ref) {\n      var success = _ref.success,\n          data = _ref.data,\n          error = _ref.error;\n\n      if (success && data) {\n        var _ref2 = data[0] || {},\n            _ref2$address = _ref2.address,\n            verifiedAddress = _ref2$address === void 0 ? {} : _ref2$address,\n            _ref2$isValid = _ref2.isValid,\n            isValid = _ref2$isValid === void 0 ? false : _ref2$isValid,\n            invalidLevel = _ref2.invalidLevel;\n\n        return FiasAPIResultFactory.success(_extends({\n          address: verifiedAddress,\n          isValid: isValid\n        }, invalidLevel ? {\n          invalidLevel: invalidLevel.toLowerCase()\n        } : {}));\n      } else {\n        return FiasAPIResultFactory.fail(error && error.message);\n      }\n    });\n  };\n\n  this.search = function (_ref3) {\n    var fiasId = _ref3.fiasId,\n        searchText = _ref3.searchText,\n        field = _ref3.field,\n        parentFiasId = _ref3.parentFiasId,\n        limit = _ref3.limit,\n        fullAddress = _ref3.fullAddress,\n        directParent = _ref3.directParent;\n    var query = {\n      prefix: searchText,\n      actual: true,\n      parentFiasId: parentFiasId,\n      limit: limit,\n      fullAddress: fullAddress,\n      directParent: directParent,\n      version: _this.version\n    };\n    var emptyResult = {\n      success: true,\n      status: 200,\n      data: []\n    };\n\n    if (fiasId) {\n      return _this.resolveFiasId(fiasId);\n    }\n\n    if (searchText) {\n      if (!field) {\n        var text = FiasAPI.trimSearchText(searchText);\n\n        if (text) {\n          return _this.resolveAddress(text, limit);\n        }\n      } else {\n        switch (field) {\n          case FiasFields.region:\n            return _this.searchRegions(searchText);\n\n          case FiasFields.house:\n            return _this.searchHouse(query);\n\n          case FiasFields.stead:\n            return _this.searchStead(query);\n\n          case FiasFields.room:\n            return _this.searchRoom(query);\n\n          default:\n            return _this.searchAddressObject(_extends({}, query, {\n              levels: [field]\n            }));\n        }\n      }\n    }\n\n    return Promise.resolve(emptyResult);\n  };\n\n  this.searchCountry = function (query) {\n    return _this.send(\"countries?\" + FiasAPI.createQuery(query));\n  };\n\n  this.send = function (path, params) {\n    if (params === void 0) {\n      params = {};\n    }\n\n    var resultPromise = _this.baseUrl ? _this.fetchFn(\"\" + _this.baseUrl + path, _extends({\n      method: 'GET'\n    }, params)).then(function (result) {\n      return result.ok ? result.json().then(function (data) {\n        return FiasAPIResultFactory.success(data);\n      }) : Promise.reject(new Error(FiasLogger.warnings.fetchError));\n    }) : Promise.reject(new Error(FiasLogger.warnings.noBaseUrl));\n    return resultPromise[\"catch\"](function (_ref4) {\n      var message = _ref4.message;\n      FiasLogger.log(message);\n      return FiasAPIResultFactory.fail(message);\n    });\n  };\n\n  this.resolveFiasId = function (fiasId) {\n    return _this.send(\"addresses/structural/\" + fiasId).then(function (result) {\n      var success = result.success,\n          data = result.data,\n          error = result.error;\n\n      if (success && data) {\n        return FiasAPIResultFactory.success([data]);\n      } else {\n        return FiasAPIResultFactory.fail(error && error.message);\n      }\n    });\n  };\n\n  this.searchAddressObject = function (query) {\n    return _this.send(\"addresses?\" + FiasAPI.createQuery(query));\n  };\n\n  this.resolveAddress = function (address, limit, level) {\n    if (level === void 0) {\n      level = FiasFields.house;\n    }\n\n    return _this.send(\"addresses/resolve?\" + FiasAPI.createQuery({\n      address: address,\n      limit: limit,\n      level: level\n    }));\n  };\n\n  this.searchStead = function (query) {\n    return _this.send(\"steads?\" + FiasAPI.createQuery(query)).then(function (result) {\n      var success = result.success,\n          data = result.data,\n          error = result.error;\n\n      if (success && data) {\n        return FiasAPIResultFactory.success(data.map(function (stead) {\n          return {\n            stead: stead\n          };\n        }));\n      } else {\n        return FiasAPIResultFactory.fail(error && error.message);\n      }\n    });\n  };\n\n  this.searchHouse = function (query) {\n    return _this.send(\"houses?\" + FiasAPI.createQuery(query)).then(function (result) {\n      var success = result.success,\n          data = result.data,\n          error = result.error;\n\n      if (success && data) {\n        return FiasAPIResultFactory.success(data.map(function (house) {\n          return {\n            house: house\n          };\n        }));\n      } else {\n        return FiasAPIResultFactory.fail(error && error.message);\n      }\n    });\n  };\n\n  this.searchRoom = function (query) {\n    return _this.send(\"rooms?\" + FiasAPI.createQuery(query)).then(function (result) {\n      var success = result.success,\n          data = result.data,\n          error = result.error;\n\n      if (success && data) {\n        return FiasAPIResultFactory.success(data.map(function (room) {\n          return {\n            room: room\n          };\n        }));\n      } else {\n        return FiasAPIResultFactory.fail(error && error.message);\n      }\n    });\n  };\n\n  this.searchRegions = function (searchText) {\n    if (!_this.regionsPromise) {\n      _this.regionsPromise = _this.send('addresses/regions');\n    }\n\n    if (!searchText) {\n      return _this.regionsPromise;\n    }\n\n    var isStartsWithSearchText = function isStartsWithSearchText(str) {\n      return str && str.toLowerCase().includes(searchText.toLowerCase());\n    };\n\n    return _this.regionsPromise.then(function (result) {\n      var success = result.success,\n          data = result.data;\n\n      if (success && data) {\n        return FiasAPIResultFactory.success(data.filter(function (address) {\n          var _ref5 = address.region,\n              name = _ref5.name,\n              _ref5$code = _ref5.code,\n              code = _ref5$code === void 0 ? '' : _ref5$code;\n          return isStartsWithSearchText(name) || isStartsWithSearchText(code);\n        }));\n      }\n\n      return result;\n    });\n  };\n};\nFiasAPI.searchStopWords = Object.keys(abbreviations).reduce(function (words, abbr) {\n  return _extends({}, words, {}, abbreviations[abbr].split(' ').reduce(function (abbrWords, word) {\n    var _extends2;\n\n    return _extends({}, abbrWords, (_extends2 = {}, _extends2[word.toLowerCase()] = true, _extends2));\n  }, {}));\n}, {});\n\nFiasAPI.createQuery = function (query) {\n  var params = [];\n\n  for (var _key in query) {\n    if (Object.prototype.hasOwnProperty.call(query, _key)) {\n      var param = query[_key];\n\n      if (param !== undefined) {\n        if (_key === 'levels' && Array.isArray(param)) {\n          for (var _iterator = param, _isArray = Array.isArray(_iterator), _i = 0, _iterator = _isArray ? _iterator : _iterator[Symbol.iterator]();;) {\n            var _ref6;\n\n            if (_isArray) {\n              if (_i >= _iterator.length) break;\n              _ref6 = _iterator[_i++];\n            } else {\n              _i = _iterator.next();\n              if (_i.done) break;\n              _ref6 = _i.value;\n            }\n\n            var level = _ref6;\n            params.push(\"level[]=\" + encodeURIComponent(level));\n          }\n        } else {\n          params.push(_key + \"=\" + encodeURIComponent(\"\" + param));\n        }\n      }\n    }\n  }\n\n  return params.join('&');\n};\n\nFiasAPI.trimSearchText = function (searchText) {\n  return searchText.toLowerCase().replace(/югра/g, '').replace(/(строение|сооружение|литера)\\s[а-я\\w]+/g, '').replace(/\\s-\\s/g, ' ').replace(/[,]/g, '').replace(/\\s[\\s]*/g, ' ').split(' ').filter(function (word) {\n    return !FiasAPI.searchStopWords[word];\n  }).slice(0, 6).join(' ');\n};","map":{"version":3,"sources":["C:/Users/ravka/Desktop/react-typescript-task/node_modules/@skbkontur/react-ui/components/Fias/api/FiasAPI/FiasAPI.js"],"names":["_extends","FiasFields","abbreviations","FiasLogger","fetch","FiasAPIResultFactory","FiasAPI","baseUrl","version","fetchFn","_this","regionsPromise","verify","address","query","directParent","search","send","createQuery","method","headers","Accept","body","JSON","stringify","convertForVerification","then","_ref","success","data","error","_ref2","_ref2$address","verifiedAddress","_ref2$isValid","isValid","invalidLevel","toLowerCase","fail","message","_ref3","fiasId","searchText","field","parentFiasId","limit","fullAddress","prefix","actual","emptyResult","status","resolveFiasId","text","trimSearchText","resolveAddress","region","searchRegions","house","searchHouse","stead","searchStead","room","searchRoom","searchAddressObject","levels","Promise","resolve","searchCountry","path","params","resultPromise","result","ok","json","reject","Error","warnings","fetchError","noBaseUrl","_ref4","log","level","map","isStartsWithSearchText","str","includes","filter","_ref5","name","_ref5$code","code","searchStopWords","Object","keys","reduce","words","abbr","split","abbrWords","word","_extends2","_key","prototype","hasOwnProperty","call","param","undefined","Array","isArray","_iterator","_isArray","_i","Symbol","iterator","_ref6","length","next","done","value","push","encodeURIComponent","join","replace","slice"],"mappings":"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","sourcesContent":["import _extends from \"@babel/runtime/helpers/esm/extends\";\nimport { FiasFields } from \"../../types\";\nimport { abbreviations } from \"../../constants/abbreviations\";\nimport { FiasLogger } from \"../../logger/FiasLogger\";\nimport { fetch } from \"../../../../lib/net/fetch\";\nimport { FiasAPIResultFactory } from \"../FiasAPIResultFactory\";\nexport var FiasAPI = function FiasAPI(baseUrl, version, fetchFn) {\n  var _this = this;\n\n  if (baseUrl === void 0) {\n    baseUrl = '';\n  }\n\n  if (fetchFn === void 0) {\n    fetchFn = fetch;\n  }\n\n  this.baseUrl = baseUrl;\n  this.version = version;\n  this.fetchFn = fetchFn;\n  this.regionsPromise = null;\n\n  this.verify = function (address) {\n    var query = {\n      directParent: true,\n      search: false\n    };\n    return _this.send(\"verify?\" + FiasAPI.createQuery(query), {\n      method: 'POST',\n      headers: {\n        Accept: 'application/json',\n        'Content-Type': 'application/json'\n      },\n      body: JSON.stringify([address.convertForVerification()])\n    }).then(function (_ref) {\n      var success = _ref.success,\n          data = _ref.data,\n          error = _ref.error;\n\n      if (success && data) {\n        var _ref2 = data[0] || {},\n            _ref2$address = _ref2.address,\n            verifiedAddress = _ref2$address === void 0 ? {} : _ref2$address,\n            _ref2$isValid = _ref2.isValid,\n            isValid = _ref2$isValid === void 0 ? false : _ref2$isValid,\n            invalidLevel = _ref2.invalidLevel;\n\n        return FiasAPIResultFactory.success(_extends({\n          address: verifiedAddress,\n          isValid: isValid\n        }, invalidLevel ? {\n          invalidLevel: invalidLevel.toLowerCase()\n        } : {}));\n      } else {\n        return FiasAPIResultFactory.fail(error && error.message);\n      }\n    });\n  };\n\n  this.search = function (_ref3) {\n    var fiasId = _ref3.fiasId,\n        searchText = _ref3.searchText,\n        field = _ref3.field,\n        parentFiasId = _ref3.parentFiasId,\n        limit = _ref3.limit,\n        fullAddress = _ref3.fullAddress,\n        directParent = _ref3.directParent;\n    var query = {\n      prefix: searchText,\n      actual: true,\n      parentFiasId: parentFiasId,\n      limit: limit,\n      fullAddress: fullAddress,\n      directParent: directParent,\n      version: _this.version\n    };\n    var emptyResult = {\n      success: true,\n      status: 200,\n      data: []\n    };\n\n    if (fiasId) {\n      return _this.resolveFiasId(fiasId);\n    }\n\n    if (searchText) {\n      if (!field) {\n        var text = FiasAPI.trimSearchText(searchText);\n\n        if (text) {\n          return _this.resolveAddress(text, limit);\n        }\n      } else {\n        switch (field) {\n          case FiasFields.region:\n            return _this.searchRegions(searchText);\n\n          case FiasFields.house:\n            return _this.searchHouse(query);\n\n          case FiasFields.stead:\n            return _this.searchStead(query);\n\n          case FiasFields.room:\n            return _this.searchRoom(query);\n\n          default:\n            return _this.searchAddressObject(_extends({}, query, {\n              levels: [field]\n            }));\n        }\n      }\n    }\n\n    return Promise.resolve(emptyResult);\n  };\n\n  this.searchCountry = function (query) {\n    return _this.send(\"countries?\" + FiasAPI.createQuery(query));\n  };\n\n  this.send = function (path, params) {\n    if (params === void 0) {\n      params = {};\n    }\n\n    var resultPromise = _this.baseUrl ? _this.fetchFn(\"\" + _this.baseUrl + path, _extends({\n      method: 'GET'\n    }, params)).then(function (result) {\n      return result.ok ? result.json().then(function (data) {\n        return FiasAPIResultFactory.success(data);\n      }) : Promise.reject(new Error(FiasLogger.warnings.fetchError));\n    }) : Promise.reject(new Error(FiasLogger.warnings.noBaseUrl));\n    return resultPromise[\"catch\"](function (_ref4) {\n      var message = _ref4.message;\n      FiasLogger.log(message);\n      return FiasAPIResultFactory.fail(message);\n    });\n  };\n\n  this.resolveFiasId = function (fiasId) {\n    return _this.send(\"addresses/structural/\" + fiasId).then(function (result) {\n      var success = result.success,\n          data = result.data,\n          error = result.error;\n\n      if (success && data) {\n        return FiasAPIResultFactory.success([data]);\n      } else {\n        return FiasAPIResultFactory.fail(error && error.message);\n      }\n    });\n  };\n\n  this.searchAddressObject = function (query) {\n    return _this.send(\"addresses?\" + FiasAPI.createQuery(query));\n  };\n\n  this.resolveAddress = function (address, limit, level) {\n    if (level === void 0) {\n      level = FiasFields.house;\n    }\n\n    return _this.send(\"addresses/resolve?\" + FiasAPI.createQuery({\n      address: address,\n      limit: limit,\n      level: level\n    }));\n  };\n\n  this.searchStead = function (query) {\n    return _this.send(\"steads?\" + FiasAPI.createQuery(query)).then(function (result) {\n      var success = result.success,\n          data = result.data,\n          error = result.error;\n\n      if (success && data) {\n        return FiasAPIResultFactory.success(data.map(function (stead) {\n          return {\n            stead: stead\n          };\n        }));\n      } else {\n        return FiasAPIResultFactory.fail(error && error.message);\n      }\n    });\n  };\n\n  this.searchHouse = function (query) {\n    return _this.send(\"houses?\" + FiasAPI.createQuery(query)).then(function (result) {\n      var success = result.success,\n          data = result.data,\n          error = result.error;\n\n      if (success && data) {\n        return FiasAPIResultFactory.success(data.map(function (house) {\n          return {\n            house: house\n          };\n        }));\n      } else {\n        return FiasAPIResultFactory.fail(error && error.message);\n      }\n    });\n  };\n\n  this.searchRoom = function (query) {\n    return _this.send(\"rooms?\" + FiasAPI.createQuery(query)).then(function (result) {\n      var success = result.success,\n          data = result.data,\n          error = result.error;\n\n      if (success && data) {\n        return FiasAPIResultFactory.success(data.map(function (room) {\n          return {\n            room: room\n          };\n        }));\n      } else {\n        return FiasAPIResultFactory.fail(error && error.message);\n      }\n    });\n  };\n\n  this.searchRegions = function (searchText) {\n    if (!_this.regionsPromise) {\n      _this.regionsPromise = _this.send('addresses/regions');\n    }\n\n    if (!searchText) {\n      return _this.regionsPromise;\n    }\n\n    var isStartsWithSearchText = function isStartsWithSearchText(str) {\n      return str && str.toLowerCase().includes(searchText.toLowerCase());\n    };\n\n    return _this.regionsPromise.then(function (result) {\n      var success = result.success,\n          data = result.data;\n\n      if (success && data) {\n        return FiasAPIResultFactory.success(data.filter(function (address) {\n          var _ref5 = address.region,\n              name = _ref5.name,\n              _ref5$code = _ref5.code,\n              code = _ref5$code === void 0 ? '' : _ref5$code;\n          return isStartsWithSearchText(name) || isStartsWithSearchText(code);\n        }));\n      }\n\n      return result;\n    });\n  };\n};\nFiasAPI.searchStopWords = Object.keys(abbreviations).reduce(function (words, abbr) {\n  return _extends({}, words, {}, abbreviations[abbr].split(' ').reduce(function (abbrWords, word) {\n    var _extends2;\n\n    return _extends({}, abbrWords, (_extends2 = {}, _extends2[word.toLowerCase()] = true, _extends2));\n  }, {}));\n}, {});\n\nFiasAPI.createQuery = function (query) {\n  var params = [];\n\n  for (var _key in query) {\n    if (Object.prototype.hasOwnProperty.call(query, _key)) {\n      var param = query[_key];\n\n      if (param !== undefined) {\n        if (_key === 'levels' && Array.isArray(param)) {\n          for (var _iterator = param, _isArray = Array.isArray(_iterator), _i = 0, _iterator = _isArray ? _iterator : _iterator[Symbol.iterator]();;) {\n            var _ref6;\n\n            if (_isArray) {\n              if (_i >= _iterator.length) break;\n              _ref6 = _iterator[_i++];\n            } else {\n              _i = _iterator.next();\n              if (_i.done) break;\n              _ref6 = _i.value;\n            }\n\n            var level = _ref6;\n            params.push(\"level[]=\" + encodeURIComponent(level));\n          }\n        } else {\n          params.push(_key + \"=\" + encodeURIComponent(\"\" + param));\n        }\n      }\n    }\n  }\n\n  return params.join('&');\n};\n\nFiasAPI.trimSearchText = function (searchText) {\n  return searchText.toLowerCase().replace(/югра/g, '').replace(/(строение|сооружение|литера)\\s[а-я\\w]+/g, '').replace(/\\s-\\s/g, ' ').replace(/[,]/g, '').replace(/\\s[\\s]*/g, ' ').split(' ').filter(function (word) {\n    return !FiasAPI.searchStopWords[word];\n  }).slice(0, 6).join(' ');\n};"]},"metadata":{},"sourceType":"module"}