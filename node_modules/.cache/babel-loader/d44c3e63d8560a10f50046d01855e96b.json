{"ast":null,"code":"import _extends from \"@babel/runtime/helpers/esm/extends\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _createClass from \"@babel/runtime/helpers/esm/createClass\";\nimport _inheritsLoose from \"@babel/runtime/helpers/esm/inheritsLoose\";\n\nvar _dec, _class, _class2, _temp;\n\nimport React from 'react';\nimport { Gapped } from \"../../../Gapped\";\nimport { Button } from \"../../../Button\";\nimport { locale } from \"../../../../lib/locale/decorators\";\nimport { FiasLocaleHelper } from \"../../locale\";\nimport { FiasExtraFields, FiasFields, FiasFormValidation } from \"../../types\";\nimport { FiasAddressElement } from \"../../models/FiasAddressElement\";\nimport { Tooltip } from \"../../../Tooltip\";\nimport { Input } from \"../../../Input\";\nimport { FiasSearch } from \"../../FiasSearch/FiasSearch\";\nimport { Textarea } from \"../../../Textarea\";\nimport { FiasAddress } from \"../../models/FiasAddress\";\nimport { FiasCountrySelector } from \"../FiasCountrySelector\";\nimport { jsStyles } from \"../FiasForm.styles\";\nimport { FiasComboBox } from \"../FiasComboBox\";\nexport var FiasForm = (_dec = locale('Fias', FiasLocaleHelper), _dec(_class = (_temp = _class2 = /*#__PURE__*/function (_React$Component) {\n  _inheritsLoose(FiasForm, _React$Component);\n\n  function FiasForm(_props) {\n    var _this;\n\n    _this = _React$Component.call(this, _props) || this;\n    _this.state = {\n      address: _this.props.address\n    };\n    _this.locale = void 0;\n    _this.fields = void 0;\n    _this.lastVerifyPromise = null;\n    _this.submit = /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.next = 2;\n              return _this.lastVerifyPromise;\n\n            case 2:\n              return _context.abrupt(\"return\", _this.state.address);\n\n            case 3:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    _this.getCommonFieldProps = function (field) {\n      var address = _this.state.address;\n      var validationLevel = _this.props.validationLevel;\n      return {\n        error: address.hasError(field) && validationLevel === FiasFormValidation.Error,\n        warning: address.hasError(field) && validationLevel === FiasFormValidation.Warning,\n        placeholder: _this.locale[field + \"Placeholder\"]\n      };\n    };\n\n    _this.renderFields = function (fields) {\n      var fieldsSettings = _this.props.fieldsSettings;\n      return fields.map(function (field) {\n        var control = _this.fields[field];\n        var settings = fieldsSettings[field];\n\n        if (control && Boolean(settings && settings.visible)) {\n          var meta = control.meta,\n              render = control.render;\n          var label = _this.locale[field + \"Label\"];\n          return control && React.createElement(FiasForm.Field, {\n            label: label,\n            key: field\n          }, React.createElement(Tooltip, {\n            pos: 'right middle',\n            render: meta.tooltip\n          }, render()));\n        }\n      });\n    };\n\n    _this.renderAddressComboBox = function (field, width) {\n      if (width === void 0) {\n        width = '100%';\n      }\n\n      var comboboxField = _this.fields[field];\n\n      if (comboboxField && FiasForm.isComboboxMeta(comboboxField.meta)) {\n        var address = _this.state.address;\n        var _comboboxField$meta = comboboxField.meta,\n            props = _comboboxField$meta.props,\n            createRef = _comboboxField$meta.createRef;\n\n        var commonProps = _this.getCommonFieldProps(field);\n\n        return React.createElement(FiasComboBox, _extends({}, commonProps, props, {\n          value: address,\n          width: width,\n          drawArrow: false,\n          searchOnFocus: false,\n          limit: _this.props.limit,\n          ref: createRef\n        }));\n      }\n    };\n\n    _this.renderPostalCodeInput = function () {\n      var inputField = _this.fields[FiasExtraFields.postalcode];\n\n      if (inputField && FiasForm.isInputMeta(inputField.meta)) {\n        var address = _this.state.address;\n        var _inputField$meta = inputField.meta,\n            props = _inputField$meta.props,\n            createRef = _inputField$meta.createRef;\n\n        var commonProps = _this.getCommonFieldProps(FiasExtraFields.postalcode);\n\n        var value = address.postalCode;\n        return React.createElement(Input, _extends({}, commonProps, props, {\n          value: value,\n          width: 130,\n          ref: createRef\n        }));\n      }\n    };\n\n    _this.createAddressComboboxMeta = function (field) {\n      return {\n        ref: null,\n        props: _this.createAddressComboBoxProps(field),\n        tooltip: _this.createAddressComboBoxTooltip(field),\n        createRef: function createRef(ref) {\n          var comboboxField = _this.fields[field];\n\n          if (comboboxField) {\n            comboboxField.meta.ref = ref;\n          }\n        }\n      };\n    };\n\n    _this.createPostalCodeInputMeta = function () {\n      return {\n        ref: null,\n        props: _this.createPostalCodeInputProps(),\n        tooltip: function tooltip() {\n          return _this.createPostalCodeTooltip();\n        },\n        createRef: function createRef(ref) {\n          var inputField = _this.fields[FiasExtraFields.postalcode];\n\n          if (inputField) {\n            inputField.meta.ref = ref;\n          }\n        }\n      };\n    };\n\n    _this.createAddressComboBoxProps = function (field) {\n      var getItems = /*#__PURE__*/function () {\n        var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(searchText) {\n          return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n            while (1) {\n              switch (_context2.prev = _context2.next) {\n                case 0:\n                  return _context2.abrupt(\"return\", _this.createItemsSource(searchText, field));\n\n                case 1:\n                case \"end\":\n                  return _context2.stop();\n              }\n            }\n          }, _callee2);\n        }));\n\n        return function getItems(_x) {\n          return _ref2.apply(this, arguments);\n        };\n      }();\n\n      var onValueChange = function onValueChange(value) {\n        var address = _this.state.address;\n\n        var newFields = _extends({}, address.fields, {}, value.fields); // get rid of undefineds\n\n\n        var addressField;\n\n        for (addressField in newFields) {\n          if (!newFields[addressField]) {\n            delete newFields[addressField];\n          }\n        }\n\n        _this.handleAddressChange(FiasAddress.createFromAddress(address, {\n          fields: newFields\n        }), _this.validate);\n      };\n\n      var onInputValueChange = function onInputValueChange() {\n        _this.resetAddressErrors();\n      };\n\n      var onUnexpectedInput = function onUnexpectedInput(query) {\n        var _extends2;\n\n        var address = _this.state.address;\n\n        var newFields = _extends({}, address.fields, (_extends2 = {}, _extends2[field] = query ? new FiasAddressElement(field, query) : undefined, _extends2));\n\n        return FiasAddress.createFromAddress(address, {\n          fields: newFields\n        });\n      };\n\n      var renderItem = function renderItem(address) {\n        var element = address.fields[field];\n\n        if (!element) {\n          return '';\n        }\n\n        if (field === FiasFields.region && element.data) {\n          var regionCode = element.data.code.substr(0, 2);\n          return regionCode + \" \" + element.getText();\n        }\n\n        var diffAddress = new FiasAddress({\n          fields: _this.state.address.getDiffFields(address, _this.props.fieldsSettings)\n        });\n        var hasParentFields = Boolean(diffAddress.getClosestParentFiasId(field));\n        return hasParentFields ? diffAddress.getText() : element.getText(element.isTypeMatchField(field));\n      };\n\n      var renderValue = function renderValue(address) {\n        var element = address.fields[field];\n        return element && element.getText(element.isTypeMatchField(field));\n      };\n\n      var renderNotFound = function renderNotFound() {\n        var address = _this.state.address;\n        var messages = [_this.locale[field + \"NotFound\"] || _this.locale.addressNotFound];\n\n        if (address.isAllowedToFill(field)) {\n          if (address.hasOnlyIndirectParent(field)) {\n            messages.push(_this.locale.addressFillParentOrSearch);\n          }\n        } else {\n          messages = _this.locale[field + \"FillBefore\"] ? [_this.locale[field + \"FillBefore\"]] : messages;\n        }\n\n        return React.createElement(\"div\", null, messages.map(function (message, i, m) {\n          return React.createElement(\"div\", {\n            key: i\n          }, message + (m[i + 1] ? '.' : ''));\n        }));\n      };\n\n      var valueToString = function valueToString(address) {\n        var element = address.fields[field];\n        return element ? element.name : '';\n      };\n\n      var itemToValue = valueToString;\n      return {\n        getItems: getItems,\n        onValueChange: onValueChange,\n        onInputValueChange: onInputValueChange,\n        onUnexpectedInput: onUnexpectedInput,\n        renderItem: renderItem,\n        renderValue: renderValue,\n        itemToValue: itemToValue,\n        valueToString: valueToString,\n        renderNotFound: renderNotFound\n      };\n    };\n\n    _this.createItemsSource = /*#__PURE__*/function () {\n      var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3(searchText, field) {\n        var address, limit, options;\n        return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                address = _this.state.address;\n                limit = _this.props.limit || FiasForm.defaultProps.limit;\n\n                if (!address.isAllowedToFill(field)) {\n                  _context3.next = 5;\n                  break;\n                }\n\n                options = {\n                  searchText: searchText,\n                  field: field,\n                  parentFiasId: address.getClosestParentFiasId(field),\n                  fullAddress: address.isAllowedToSearchFullAddress(field),\n                  directParent: !address.isAllowedToSearchThroughChildrenOfDirectParent(field, _this.props.fieldsSettings),\n                  limit: limit + 1 // +1 to detect if there are more items\n\n                };\n                return _context3.abrupt(\"return\", _this.props.api.search(options).then(function (result) {\n                  var success = result.success,\n                      data = result.data,\n                      error = result.error;\n                  return success && data ? Promise.resolve(data.map(function (item) {\n                    return FiasAddress.createFromResponse(item);\n                  })) : Promise.reject(error);\n                }));\n\n              case 5:\n                return _context3.abrupt(\"return\", Promise.resolve([]));\n\n              case 6:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3);\n      }));\n\n      return function (_x2, _x3) {\n        return _ref3.apply(this, arguments);\n      };\n    }();\n\n    _this.getFieldTooltipContent = function (field) {\n      var address = _this.state.address;\n      var validationLevel = _this.props.validationLevel;\n\n      if (validationLevel !== FiasFormValidation.None && address.hasError(field)) {\n        return address.getError(field);\n      }\n\n      return null;\n    };\n\n    _this.createAddressComboBoxTooltip = function (field) {\n      return function () {\n        var tooltipContent = _this.getFieldTooltipContent(field);\n\n        var comboboxField = _this.fields[field];\n\n        if (comboboxField && FiasForm.isComboboxMeta(comboboxField.meta)) {\n          var combobox = comboboxField.meta.ref;\n          var hasItems = combobox ? combobox.hasItems : false;\n          return tooltipContent !== null && hasItems ? _this.locale.addressSelectItemFromList : tooltipContent;\n        }\n\n        return tooltipContent;\n      };\n    };\n\n    _this.createPostalCodeTooltip = function () {\n      var tooltipContent = _this.getFieldTooltipContent(FiasExtraFields.postalcode);\n\n      var replacePostalCode = function replacePostalCode() {\n        var address = _this.state.address;\n\n        var additionalFields = _extends({}, address.additionalFields);\n\n        delete additionalFields[FiasExtraFields.postalcode];\n\n        _this.handleAddressChange(FiasAddress.createFromAddress(address, {\n          additionalFields: additionalFields\n        }));\n      };\n\n      return tooltipContent && React.createElement(\"div\", null, React.createElement(\"span\", null, tooltipContent), _this.state.address.isPostalCodeAltered && React.createElement(\"div\", null, React.createElement(Button, {\n        onClick: replacePostalCode,\n        use: \"link\"\n      }, _this.locale.postalcodeReplace)));\n    };\n\n    _this.verify = function () {\n      var address = _this.state.address;\n      var api = _this.props.api;\n      return api.verify(address).then(function (result) {\n        var success = result.success,\n            data = result.data;\n\n        if (success && data) {\n          return FiasAddress.verify(address, data);\n        }\n\n        return FiasAddress.removeFiasData(address);\n      });\n    };\n\n    _this.handleCountryChange = function (country) {\n      _this.handleAddressChange(FiasAddress.createFromAddress(_this.state.address, {\n        country: country\n      }));\n    };\n\n    _this.handleForeignAddressChange = function (value) {\n      _this.handleAddressChange(FiasAddress.createFromAddress(_this.state.address, {\n        foreignAddress: value\n      }));\n    };\n\n    _this.handleAddressChange = function (address, callback) {\n      _this.setState({\n        address: FiasAddress.createFromAddress(address, {\n          fields: FiasAddress.filterVisibleFields(address.fields, _this.props.fieldsSettings)\n        })\n      }, callback);\n    };\n\n    _this.handleSearchChange = function (address) {\n      _this.handleAddressChange(address);\n    };\n\n    _this.resetAddressErrors = function () {\n      var address = _this.state.address;\n\n      if (address.hasErrors) {\n        _this.setState({\n          address: FiasAddress.createFromAddress(address, {\n            errors: {}\n          })\n        });\n      }\n    };\n\n    _this.fields = FiasAddress.ALL_FIELDS.reduce(function (fields, field) {\n      var _extends3, _extends4;\n\n      switch (field) {\n        case FiasFields.region:\n        case FiasFields.district:\n        case FiasFields.city:\n        case FiasFields.intracityarea:\n        case FiasFields.settlement:\n        case FiasFields.planningstructure:\n        case FiasFields.street:\n        case FiasFields.stead:\n        case FiasFields.house:\n        case FiasFields.room:\n          return _extends({}, fields, (_extends3 = {}, _extends3[field] = {\n            meta: _this.createAddressComboboxMeta(field),\n            render: function render() {\n              return _this.renderAddressComboBox(field);\n            }\n          }, _extends3));\n\n        case FiasExtraFields.postalcode:\n          return _extends({}, fields, (_extends4 = {}, _extends4[field] = {\n            meta: _this.createPostalCodeInputMeta(),\n            render: function render() {\n              return _this.renderPostalCodeInput();\n            }\n          }, _extends4));\n\n        default:\n          return fields;\n      }\n    }, {});\n    return _this;\n  }\n\n  var _proto = FiasForm.prototype;\n\n  _proto.componentDidMount = function componentDidMount() {\n    this.validate();\n  };\n\n  _proto.render = function render() {\n    var address = this.state.address;\n    var _this$props = this.props,\n        api = _this$props.api,\n        limit = _this$props.limit,\n        countrySelector = _this$props.countrySelector;\n    return React.createElement(\"div\", null, React.createElement(Gapped, {\n      vertical: true\n    }, countrySelector && React.createElement(FiasForm.Field, {\n      label: this.locale.countryLabel\n    }, React.createElement(FiasCountrySelector, {\n      api: api,\n      country: address.country,\n      onValueChange: this.handleCountryChange,\n      limit: limit\n    })), this.props.search && React.createElement(FiasForm.Field, null, React.createElement(FiasSearch, {\n      api: api,\n      address: address,\n      onValueChange: this.handleSearchChange,\n      limit: limit,\n      placeholder: this.locale.searchPlaceholder\n    })), this.isForeignForm ? React.createElement(Gapped, {\n      vertical: true\n    }, React.createElement(FiasForm.Field, {\n      label: this.locale.foreignAddressLabel\n    }, React.createElement(Textarea, {\n      value: address.foreignAddress,\n      onValueChange: this.handleForeignAddressChange,\n      placeholder: this.locale.foreignAddressPlaceholder,\n      width: \"100%\",\n      resize: \"none\"\n    })), this.renderFields([FiasExtraFields.postalcode])) : this.renderFields(FiasAddress.ALL_FIELDS)));\n  };\n\n  _proto.createPostalCodeInputProps = function createPostalCodeInputProps() {\n    var _this2 = this;\n\n    return {\n      onValueChange: function onValueChange(value) {\n        var _extends5;\n\n        var address = _this2.state.address;\n\n        var newAdditionalFields = _extends({}, address.additionalFields, (_extends5 = {}, _extends5[FiasExtraFields.postalcode] = value, _extends5));\n\n        _this2.handleAddressChange(FiasAddress.createFromAddress(address, {\n          additionalFields: newAdditionalFields\n        }));\n      }\n    };\n  };\n\n  _proto.validate = function validate() {\n    var _this3 = this;\n\n    var verifyPromise = this.lastVerifyPromise = this.verify();\n    verifyPromise.then(function (verifiedAddress) {\n      if (verifyPromise === _this3.lastVerifyPromise) {\n        _this3.setState({\n          address: FiasAddress.validate(verifiedAddress, _this3.locale)\n        });\n      }\n    });\n  };\n\n  _createClass(FiasForm, [{\n    key: \"isForeignForm\",\n    get: function get() {\n      var address = this.state.address;\n      var countrySelector = this.props.countrySelector;\n      return address.isForeign || Boolean(countrySelector) && !address.country;\n    }\n  }]);\n\n  return FiasForm;\n}(React.Component), _class2.__KONTUR_REACT_UI__ = 'FiasForm', _class2.defaultProps = {\n  validationLevel: 'Error',\n  limit: 5,\n  fieldsSettings: {},\n  countrySelector: false\n}, _class2.Field = function (_ref4) {\n  var label = _ref4.label,\n      children = _ref4.children;\n  return React.createElement(\"div\", {\n    className: jsStyles.row()\n  }, label && React.createElement(\"div\", {\n    className: jsStyles.label()\n  }, label), React.createElement(\"div\", {\n    className: jsStyles.field()\n  }, children));\n}, _class2.isComboboxMeta = function (meta) {\n  var props = meta.props;\n  return Object.prototype.hasOwnProperty.call(props, 'onUnexpectedInput') && Object.prototype.hasOwnProperty.call(props, 'getItems');\n}, _class2.isInputMeta = function (meta) {\n  var props = meta.props;\n  return !FiasForm.isComboboxMeta(meta) && Object.prototype.hasOwnProperty.call(props, 'onValueChange');\n}, _temp)) || _class);","map":{"version":3,"sources":["C:/Users/ravka/Desktop/react-typescript-task/node_modules/@skbkontur/react-ui/components/Fias/Form/FiasForm/FiasForm.js"],"names":["_extends","_regeneratorRuntime","_asyncToGenerator","_createClass","_inheritsLoose","_dec","_class","_class2","_temp","React","Gapped","Button","locale","FiasLocaleHelper","FiasExtraFields","FiasFields","FiasFormValidation","FiasAddressElement","Tooltip","Input","FiasSearch","Textarea","FiasAddress","FiasCountrySelector","jsStyles","FiasComboBox","FiasForm","_React$Component","_props","_this","call","state","address","props","fields","lastVerifyPromise","submit","mark","_callee","wrap","_callee$","_context","prev","next","abrupt","stop","getCommonFieldProps","field","validationLevel","error","hasError","Error","warning","Warning","placeholder","renderFields","fieldsSettings","map","control","settings","Boolean","visible","meta","render","label","createElement","Field","key","pos","tooltip","renderAddressComboBox","width","comboboxField","isComboboxMeta","_comboboxField$meta","createRef","commonProps","value","drawArrow","searchOnFocus","limit","ref","renderPostalCodeInput","inputField","postalcode","isInputMeta","_inputField$meta","postalCode","createAddressComboboxMeta","createAddressComboBoxProps","createAddressComboBoxTooltip","createPostalCodeInputMeta","createPostalCodeInputProps","createPostalCodeTooltip","getItems","_ref2","_callee2","searchText","_callee2$","_context2","createItemsSource","_x","apply","arguments","onValueChange","newFields","addressField","handleAddressChange","createFromAddress","validate","onInputValueChange","resetAddressErrors","onUnexpectedInput","query","_extends2","undefined","renderItem","element","region","data","regionCode","code","substr","getText","diffAddress","getDiffFields","hasParentFields","getClosestParentFiasId","isTypeMatchField","renderValue","renderNotFound","messages","addressNotFound","isAllowedToFill","hasOnlyIndirectParent","push","addressFillParentOrSearch","message","i","m","valueToString","name","itemToValue","_ref3","_callee3","options","_callee3$","_context3","defaultProps","parentFiasId","fullAddress","isAllowedToSearchFullAddress","directParent","isAllowedToSearchThroughChildrenOfDirectParent","api","search","then","result","success","Promise","resolve","item","createFromResponse","reject","_x2","_x3","getFieldTooltipContent","None","getError","tooltipContent","combobox","hasItems","addressSelectItemFromList","replacePostalCode","additionalFields","isPostalCodeAltered","onClick","use","postalcodeReplace","verify","removeFiasData","handleCountryChange","country","handleForeignAddressChange","foreignAddress","callback","setState","filterVisibleFields","handleSearchChange","hasErrors","errors","ALL_FIELDS","reduce","_extends3","_extends4","district","city","intracityarea","settlement","planningstructure","street","stead","house","room","_proto","prototype","componentDidMount","_this$props","countrySelector","vertical","countryLabel","searchPlaceholder","isForeignForm","foreignAddressLabel","foreignAddressPlaceholder","resize","_this2","_extends5","newAdditionalFields","_this3","verifyPromise","verifiedAddress","get","isForeign","Component","__KONTUR_REACT_UI__","_ref4","children","className","row","Object","hasOwnProperty"],"mappings":"AAAA,OAAOA,QAAP,MAAqB,oCAArB;AACA,OAAOC,mBAAP,MAAgC,4BAAhC;AACA,OAAOC,iBAAP,MAA8B,6CAA9B;AACA,OAAOC,YAAP,MAAyB,wCAAzB;AACA,OAAOC,cAAP,MAA2B,0CAA3B;;AAEA,IAAIC,IAAJ,EAAUC,MAAV,EAAkBC,OAAlB,EAA2BC,KAA3B;;AAEA,OAAOC,KAAP,MAAkB,OAAlB;AACA,SAASC,MAAT,QAAuB,iBAAvB;AACA,SAASC,MAAT,QAAuB,iBAAvB;AACA,SAASC,MAAT,QAAuB,mCAAvB;AACA,SAASC,gBAAT,QAAiC,cAAjC;AACA,SAASC,eAAT,EAA0BC,UAA1B,EAAsCC,kBAAtC,QAAgE,aAAhE;AACA,SAASC,kBAAT,QAAmC,iCAAnC;AACA,SAASC,OAAT,QAAwB,kBAAxB;AACA,SAASC,KAAT,QAAsB,gBAAtB;AACA,SAASC,UAAT,QAA2B,6BAA3B;AACA,SAASC,QAAT,QAAyB,mBAAzB;AACA,SAASC,WAAT,QAA4B,0BAA5B;AACA,SAASC,mBAAT,QAAoC,wBAApC;AACA,SAASC,QAAT,QAAyB,oBAAzB;AACA,SAASC,YAAT,QAA6B,iBAA7B;AACA,OAAO,IAAIC,QAAQ,IAAIrB,IAAI,GAAGO,MAAM,CAAC,MAAD,EAASC,gBAAT,CAAb,EAAyCR,IAAI,CAACC,MAAM,IAAIE,KAAK,GAAGD,OAAO,GAC9F,aACA,UAAUoB,gBAAV,EAA4B;AAC1BvB,EAAAA,cAAc,CAACsB,QAAD,EAAWC,gBAAX,CAAd;;AAEA,WAASD,QAAT,CAAkBE,MAAlB,EAA0B;AACxB,QAAIC,KAAJ;;AAEAA,IAAAA,KAAK,GAAGF,gBAAgB,CAACG,IAAjB,CAAsB,IAAtB,EAA4BF,MAA5B,KAAuC,IAA/C;AACAC,IAAAA,KAAK,CAACE,KAAN,GAAc;AACZC,MAAAA,OAAO,EAAEH,KAAK,CAACI,KAAN,CAAYD;AADT,KAAd;AAGAH,IAAAA,KAAK,CAACjB,MAAN,GAAe,KAAK,CAApB;AACAiB,IAAAA,KAAK,CAACK,MAAN,GAAe,KAAK,CAApB;AACAL,IAAAA,KAAK,CAACM,iBAAN,GAA0B,IAA1B;AACAN,IAAAA,KAAK,CAACO,MAAN,GACA,aACAlC,iBAAiB,EACjB,aACAD,mBAAmB,CAACoC,IAApB,CAAyB,SAASC,OAAT,GAAmB;AAC1C,aAAOrC,mBAAmB,CAACsC,IAApB,CAAyB,SAASC,QAAT,CAAkBC,QAAlB,EAA4B;AAC1D,eAAO,CAAP,EAAU;AACR,kBAAQA,QAAQ,CAACC,IAAT,GAAgBD,QAAQ,CAACE,IAAjC;AACE,iBAAK,CAAL;AACEF,cAAAA,QAAQ,CAACE,IAAT,GAAgB,CAAhB;AACA,qBAAOd,KAAK,CAACM,iBAAb;;AAEF,iBAAK,CAAL;AACE,qBAAOM,QAAQ,CAACG,MAAT,CAAgB,QAAhB,EAA0Bf,KAAK,CAACE,KAAN,CAAYC,OAAtC,CAAP;;AAEF,iBAAK,CAAL;AACA,iBAAK,KAAL;AACE,qBAAOS,QAAQ,CAACI,IAAT,EAAP;AAVJ;AAYD;AACF,OAfM,EAeJP,OAfI,CAAP;AAgBD,KAjBD,CAFiB,CAFjB;;AAuBAT,IAAAA,KAAK,CAACiB,mBAAN,GAA4B,UAAUC,KAAV,EAAiB;AAC3C,UAAIf,OAAO,GAAGH,KAAK,CAACE,KAAN,CAAYC,OAA1B;AACA,UAAIgB,eAAe,GAAGnB,KAAK,CAACI,KAAN,CAAYe,eAAlC;AACA,aAAO;AACLC,QAAAA,KAAK,EAAEjB,OAAO,CAACkB,QAAR,CAAiBH,KAAjB,KAA2BC,eAAe,KAAKhC,kBAAkB,CAACmC,KADpE;AAELC,QAAAA,OAAO,EAAEpB,OAAO,CAACkB,QAAR,CAAiBH,KAAjB,KAA2BC,eAAe,KAAKhC,kBAAkB,CAACqC,OAFtE;AAGLC,QAAAA,WAAW,EAAEzB,KAAK,CAACjB,MAAN,CAAamC,KAAK,GAAG,aAArB;AAHR,OAAP;AAKD,KARD;;AAUAlB,IAAAA,KAAK,CAAC0B,YAAN,GAAqB,UAAUrB,MAAV,EAAkB;AACrC,UAAIsB,cAAc,GAAG3B,KAAK,CAACI,KAAN,CAAYuB,cAAjC;AACA,aAAOtB,MAAM,CAACuB,GAAP,CAAW,UAAUV,KAAV,EAAiB;AACjC,YAAIW,OAAO,GAAG7B,KAAK,CAACK,MAAN,CAAaa,KAAb,CAAd;AACA,YAAIY,QAAQ,GAAGH,cAAc,CAACT,KAAD,CAA7B;;AAEA,YAAIW,OAAO,IAAIE,OAAO,CAACD,QAAQ,IAAIA,QAAQ,CAACE,OAAtB,CAAtB,EAAsD;AACpD,cAAIC,IAAI,GAAGJ,OAAO,CAACI,IAAnB;AAAA,cACIC,MAAM,GAAGL,OAAO,CAACK,MADrB;AAEA,cAAIC,KAAK,GAAGnC,KAAK,CAACjB,MAAN,CAAamC,KAAK,GAAG,OAArB,CAAZ;AACA,iBAAOW,OAAO,IAAIjD,KAAK,CAACwD,aAAN,CAAoBvC,QAAQ,CAACwC,KAA7B,EAAoC;AACpDF,YAAAA,KAAK,EAAEA,KAD6C;AAEpDG,YAAAA,GAAG,EAAEpB;AAF+C,WAApC,EAGftC,KAAK,CAACwD,aAAN,CAAoB/C,OAApB,EAA6B;AAC9BkD,YAAAA,GAAG,EAAE,cADyB;AAE9BL,YAAAA,MAAM,EAAED,IAAI,CAACO;AAFiB,WAA7B,EAGAN,MAAM,EAHN,CAHe,CAAlB;AAOD;AACF,OAhBM,CAAP;AAiBD,KAnBD;;AAqBAlC,IAAAA,KAAK,CAACyC,qBAAN,GAA8B,UAAUvB,KAAV,EAAiBwB,KAAjB,EAAwB;AACpD,UAAIA,KAAK,KAAK,KAAK,CAAnB,EAAsB;AACpBA,QAAAA,KAAK,GAAG,MAAR;AACD;;AAED,UAAIC,aAAa,GAAG3C,KAAK,CAACK,MAAN,CAAaa,KAAb,CAApB;;AAEA,UAAIyB,aAAa,IAAI9C,QAAQ,CAAC+C,cAAT,CAAwBD,aAAa,CAACV,IAAtC,CAArB,EAAkE;AAChE,YAAI9B,OAAO,GAAGH,KAAK,CAACE,KAAN,CAAYC,OAA1B;AACA,YAAI0C,mBAAmB,GAAGF,aAAa,CAACV,IAAxC;AAAA,YACI7B,KAAK,GAAGyC,mBAAmB,CAACzC,KADhC;AAAA,YAEI0C,SAAS,GAAGD,mBAAmB,CAACC,SAFpC;;AAIA,YAAIC,WAAW,GAAG/C,KAAK,CAACiB,mBAAN,CAA0BC,KAA1B,CAAlB;;AAEA,eAAOtC,KAAK,CAACwD,aAAN,CAAoBxC,YAApB,EAAkCzB,QAAQ,CAAC,EAAD,EAAK4E,WAAL,EAAkB3C,KAAlB,EAAyB;AACxE4C,UAAAA,KAAK,EAAE7C,OADiE;AAExEuC,UAAAA,KAAK,EAAEA,KAFiE;AAGxEO,UAAAA,SAAS,EAAE,KAH6D;AAIxEC,UAAAA,aAAa,EAAE,KAJyD;AAKxEC,UAAAA,KAAK,EAAEnD,KAAK,CAACI,KAAN,CAAY+C,KALqD;AAMxEC,UAAAA,GAAG,EAAEN;AANmE,SAAzB,CAA1C,CAAP;AAQD;AACF,KAxBD;;AA0BA9C,IAAAA,KAAK,CAACqD,qBAAN,GAA8B,YAAY;AACxC,UAAIC,UAAU,GAAGtD,KAAK,CAACK,MAAN,CAAapB,eAAe,CAACsE,UAA7B,CAAjB;;AAEA,UAAID,UAAU,IAAIzD,QAAQ,CAAC2D,WAAT,CAAqBF,UAAU,CAACrB,IAAhC,CAAlB,EAAyD;AACvD,YAAI9B,OAAO,GAAGH,KAAK,CAACE,KAAN,CAAYC,OAA1B;AACA,YAAIsD,gBAAgB,GAAGH,UAAU,CAACrB,IAAlC;AAAA,YACI7B,KAAK,GAAGqD,gBAAgB,CAACrD,KAD7B;AAAA,YAEI0C,SAAS,GAAGW,gBAAgB,CAACX,SAFjC;;AAIA,YAAIC,WAAW,GAAG/C,KAAK,CAACiB,mBAAN,CAA0BhC,eAAe,CAACsE,UAA1C,CAAlB;;AAEA,YAAIP,KAAK,GAAG7C,OAAO,CAACuD,UAApB;AACA,eAAO9E,KAAK,CAACwD,aAAN,CAAoB9C,KAApB,EAA2BnB,QAAQ,CAAC,EAAD,EAAK4E,WAAL,EAAkB3C,KAAlB,EAAyB;AACjE4C,UAAAA,KAAK,EAAEA,KAD0D;AAEjEN,UAAAA,KAAK,EAAE,GAF0D;AAGjEU,UAAAA,GAAG,EAAEN;AAH4D,SAAzB,CAAnC,CAAP;AAKD;AACF,KAlBD;;AAoBA9C,IAAAA,KAAK,CAAC2D,yBAAN,GAAkC,UAAUzC,KAAV,EAAiB;AACjD,aAAO;AACLkC,QAAAA,GAAG,EAAE,IADA;AAELhD,QAAAA,KAAK,EAAEJ,KAAK,CAAC4D,0BAAN,CAAiC1C,KAAjC,CAFF;AAGLsB,QAAAA,OAAO,EAAExC,KAAK,CAAC6D,4BAAN,CAAmC3C,KAAnC,CAHJ;AAIL4B,QAAAA,SAAS,EAAE,SAASA,SAAT,CAAmBM,GAAnB,EAAwB;AACjC,cAAIT,aAAa,GAAG3C,KAAK,CAACK,MAAN,CAAaa,KAAb,CAApB;;AAEA,cAAIyB,aAAJ,EAAmB;AACjBA,YAAAA,aAAa,CAACV,IAAd,CAAmBmB,GAAnB,GAAyBA,GAAzB;AACD;AACF;AAVI,OAAP;AAYD,KAbD;;AAeApD,IAAAA,KAAK,CAAC8D,yBAAN,GAAkC,YAAY;AAC5C,aAAO;AACLV,QAAAA,GAAG,EAAE,IADA;AAELhD,QAAAA,KAAK,EAAEJ,KAAK,CAAC+D,0BAAN,EAFF;AAGLvB,QAAAA,OAAO,EAAE,SAASA,OAAT,GAAmB;AAC1B,iBAAOxC,KAAK,CAACgE,uBAAN,EAAP;AACD,SALI;AAMLlB,QAAAA,SAAS,EAAE,SAASA,SAAT,CAAmBM,GAAnB,EAAwB;AACjC,cAAIE,UAAU,GAAGtD,KAAK,CAACK,MAAN,CAAapB,eAAe,CAACsE,UAA7B,CAAjB;;AAEA,cAAID,UAAJ,EAAgB;AACdA,YAAAA,UAAU,CAACrB,IAAX,CAAgBmB,GAAhB,GAAsBA,GAAtB;AACD;AACF;AAZI,OAAP;AAcD,KAfD;;AAiBApD,IAAAA,KAAK,CAAC4D,0BAAN,GAAmC,UAAU1C,KAAV,EAAiB;AAClD,UAAI+C,QAAQ,GACZ,aACA,YAAY;AACV,YAAIC,KAAK,GAAG7F,iBAAiB,EAC7B,aACAD,mBAAmB,CAACoC,IAApB,CAAyB,SAAS2D,QAAT,CAAkBC,UAAlB,EAA8B;AACrD,iBAAOhG,mBAAmB,CAACsC,IAApB,CAAyB,SAAS2D,SAAT,CAAmBC,SAAnB,EAA8B;AAC5D,mBAAO,CAAP,EAAU;AACR,sBAAQA,SAAS,CAACzD,IAAV,GAAiByD,SAAS,CAACxD,IAAnC;AACE,qBAAK,CAAL;AACE,yBAAOwD,SAAS,CAACvD,MAAV,CAAiB,QAAjB,EAA2Bf,KAAK,CAACuE,iBAAN,CAAwBH,UAAxB,EAAoClD,KAApC,CAA3B,CAAP;;AAEF,qBAAK,CAAL;AACA,qBAAK,KAAL;AACE,yBAAOoD,SAAS,CAACtD,IAAV,EAAP;AANJ;AAQD;AACF,WAXM,EAWJmD,QAXI,CAAP;AAYD,SAbD,CAF6B,CAA7B;;AAiBA,eAAO,SAASF,QAAT,CAAkBO,EAAlB,EAAsB;AAC3B,iBAAON,KAAK,CAACO,KAAN,CAAY,IAAZ,EAAkBC,SAAlB,CAAP;AACD,SAFD;AAGD,OArBD,EAFA;;AAyBA,UAAIC,aAAa,GAAG,SAASA,aAAT,CAAuB3B,KAAvB,EAA8B;AAChD,YAAI7C,OAAO,GAAGH,KAAK,CAACE,KAAN,CAAYC,OAA1B;;AAEA,YAAIyE,SAAS,GAAGzG,QAAQ,CAAC,EAAD,EAAKgC,OAAO,CAACE,MAAb,EAAqB,EAArB,EAAyB2C,KAAK,CAAC3C,MAA/B,CAAxB,CAHgD,CAGgB;;;AAGhE,YAAIwE,YAAJ;;AAEA,aAAKA,YAAL,IAAqBD,SAArB,EAAgC;AAC9B,cAAI,CAACA,SAAS,CAACC,YAAD,CAAd,EAA8B;AAC5B,mBAAOD,SAAS,CAACC,YAAD,CAAhB;AACD;AACF;;AAED7E,QAAAA,KAAK,CAAC8E,mBAAN,CAA0BrF,WAAW,CAACsF,iBAAZ,CAA8B5E,OAA9B,EAAuC;AAC/DE,UAAAA,MAAM,EAAEuE;AADuD,SAAvC,CAA1B,EAEI5E,KAAK,CAACgF,QAFV;AAGD,OAjBD;;AAmBA,UAAIC,kBAAkB,GAAG,SAASA,kBAAT,GAA8B;AACrDjF,QAAAA,KAAK,CAACkF,kBAAN;AACD,OAFD;;AAIA,UAAIC,iBAAiB,GAAG,SAASA,iBAAT,CAA2BC,KAA3B,EAAkC;AACxD,YAAIC,SAAJ;;AAEA,YAAIlF,OAAO,GAAGH,KAAK,CAACE,KAAN,CAAYC,OAA1B;;AAEA,YAAIyE,SAAS,GAAGzG,QAAQ,CAAC,EAAD,EAAKgC,OAAO,CAACE,MAAb,GAAsBgF,SAAS,GAAG,EAAZ,EAAgBA,SAAS,CAACnE,KAAD,CAAT,GAAmBkE,KAAK,GAAG,IAAIhG,kBAAJ,CAAuB8B,KAAvB,EAA8BkE,KAA9B,CAAH,GAA0CE,SAAlF,EAA6FD,SAAnH,EAAxB;;AAEA,eAAO5F,WAAW,CAACsF,iBAAZ,CAA8B5E,OAA9B,EAAuC;AAC5CE,UAAAA,MAAM,EAAEuE;AADoC,SAAvC,CAAP;AAGD,OAVD;;AAYA,UAAIW,UAAU,GAAG,SAASA,UAAT,CAAoBpF,OAApB,EAA6B;AAC5C,YAAIqF,OAAO,GAAGrF,OAAO,CAACE,MAAR,CAAea,KAAf,CAAd;;AAEA,YAAI,CAACsE,OAAL,EAAc;AACZ,iBAAO,EAAP;AACD;;AAED,YAAItE,KAAK,KAAKhC,UAAU,CAACuG,MAArB,IAA+BD,OAAO,CAACE,IAA3C,EAAiD;AAC/C,cAAIC,UAAU,GAAGH,OAAO,CAACE,IAAR,CAAaE,IAAb,CAAkBC,MAAlB,CAAyB,CAAzB,EAA4B,CAA5B,CAAjB;AACA,iBAAOF,UAAU,GAAG,GAAb,GAAmBH,OAAO,CAACM,OAAR,EAA1B;AACD;;AAED,YAAIC,WAAW,GAAG,IAAItG,WAAJ,CAAgB;AAChCY,UAAAA,MAAM,EAAEL,KAAK,CAACE,KAAN,CAAYC,OAAZ,CAAoB6F,aAApB,CAAkC7F,OAAlC,EAA2CH,KAAK,CAACI,KAAN,CAAYuB,cAAvD;AADwB,SAAhB,CAAlB;AAGA,YAAIsE,eAAe,GAAGlE,OAAO,CAACgE,WAAW,CAACG,sBAAZ,CAAmChF,KAAnC,CAAD,CAA7B;AACA,eAAO+E,eAAe,GAAGF,WAAW,CAACD,OAAZ,EAAH,GAA2BN,OAAO,CAACM,OAAR,CAAgBN,OAAO,CAACW,gBAAR,CAAyBjF,KAAzB,CAAhB,CAAjD;AACD,OAjBD;;AAmBA,UAAIkF,WAAW,GAAG,SAASA,WAAT,CAAqBjG,OAArB,EAA8B;AAC9C,YAAIqF,OAAO,GAAGrF,OAAO,CAACE,MAAR,CAAea,KAAf,CAAd;AACA,eAAOsE,OAAO,IAAIA,OAAO,CAACM,OAAR,CAAgBN,OAAO,CAACW,gBAAR,CAAyBjF,KAAzB,CAAhB,CAAlB;AACD,OAHD;;AAKA,UAAImF,cAAc,GAAG,SAASA,cAAT,GAA0B;AAC7C,YAAIlG,OAAO,GAAGH,KAAK,CAACE,KAAN,CAAYC,OAA1B;AACA,YAAImG,QAAQ,GAAG,CAACtG,KAAK,CAACjB,MAAN,CAAamC,KAAK,GAAG,UAArB,KAAoClB,KAAK,CAACjB,MAAN,CAAawH,eAAlD,CAAf;;AAEA,YAAIpG,OAAO,CAACqG,eAAR,CAAwBtF,KAAxB,CAAJ,EAAoC;AAClC,cAAIf,OAAO,CAACsG,qBAAR,CAA8BvF,KAA9B,CAAJ,EAA0C;AACxCoF,YAAAA,QAAQ,CAACI,IAAT,CAAc1G,KAAK,CAACjB,MAAN,CAAa4H,yBAA3B;AACD;AACF,SAJD,MAIO;AACLL,UAAAA,QAAQ,GAAGtG,KAAK,CAACjB,MAAN,CAAamC,KAAK,GAAG,YAArB,IAAqC,CAAClB,KAAK,CAACjB,MAAN,CAAamC,KAAK,GAAG,YAArB,CAAD,CAArC,GAA4EoF,QAAvF;AACD;;AAED,eAAO1H,KAAK,CAACwD,aAAN,CAAoB,KAApB,EAA2B,IAA3B,EAAiCkE,QAAQ,CAAC1E,GAAT,CAAa,UAAUgF,OAAV,EAAmBC,CAAnB,EAAsBC,CAAtB,EAAyB;AAC5E,iBAAOlI,KAAK,CAACwD,aAAN,CAAoB,KAApB,EAA2B;AAChCE,YAAAA,GAAG,EAAEuE;AAD2B,WAA3B,EAEJD,OAAO,IAAIE,CAAC,CAACD,CAAC,GAAG,CAAL,CAAD,GAAW,GAAX,GAAiB,EAArB,CAFH,CAAP;AAGD,SAJuC,CAAjC,CAAP;AAKD,OAjBD;;AAmBA,UAAIE,aAAa,GAAG,SAASA,aAAT,CAAuB5G,OAAvB,EAAgC;AAClD,YAAIqF,OAAO,GAAGrF,OAAO,CAACE,MAAR,CAAea,KAAf,CAAd;AACA,eAAOsE,OAAO,GAAGA,OAAO,CAACwB,IAAX,GAAkB,EAAhC;AACD,OAHD;;AAKA,UAAIC,WAAW,GAAGF,aAAlB;AACA,aAAO;AACL9C,QAAAA,QAAQ,EAAEA,QADL;AAELU,QAAAA,aAAa,EAAEA,aAFV;AAGLM,QAAAA,kBAAkB,EAAEA,kBAHf;AAILE,QAAAA,iBAAiB,EAAEA,iBAJd;AAKLI,QAAAA,UAAU,EAAEA,UALP;AAMLa,QAAAA,WAAW,EAAEA,WANR;AAOLa,QAAAA,WAAW,EAAEA,WAPR;AAQLF,QAAAA,aAAa,EAAEA,aARV;AASLV,QAAAA,cAAc,EAAEA;AATX,OAAP;AAWD,KAzHD;;AA2HArG,IAAAA,KAAK,CAACuE,iBAAN,GACA,aACA,YAAY;AACV,UAAI2C,KAAK,GAAG7I,iBAAiB,EAC7B,aACAD,mBAAmB,CAACoC,IAApB,CAAyB,SAAS2G,QAAT,CAAkB/C,UAAlB,EAA8BlD,KAA9B,EAAqC;AAC5D,YAAIf,OAAJ,EAAagD,KAAb,EAAoBiE,OAApB;AACA,eAAOhJ,mBAAmB,CAACsC,IAApB,CAAyB,SAAS2G,SAAT,CAAmBC,SAAnB,EAA8B;AAC5D,iBAAO,CAAP,EAAU;AACR,oBAAQA,SAAS,CAACzG,IAAV,GAAiByG,SAAS,CAACxG,IAAnC;AACE,mBAAK,CAAL;AACEX,gBAAAA,OAAO,GAAGH,KAAK,CAACE,KAAN,CAAYC,OAAtB;AACAgD,gBAAAA,KAAK,GAAGnD,KAAK,CAACI,KAAN,CAAY+C,KAAZ,IAAqBtD,QAAQ,CAAC0H,YAAT,CAAsBpE,KAAnD;;AAEA,oBAAI,CAAChD,OAAO,CAACqG,eAAR,CAAwBtF,KAAxB,CAAL,EAAqC;AACnCoG,kBAAAA,SAAS,CAACxG,IAAV,GAAiB,CAAjB;AACA;AACD;;AAEDsG,gBAAAA,OAAO,GAAG;AACRhD,kBAAAA,UAAU,EAAEA,UADJ;AAERlD,kBAAAA,KAAK,EAAEA,KAFC;AAGRsG,kBAAAA,YAAY,EAAErH,OAAO,CAAC+F,sBAAR,CAA+BhF,KAA/B,CAHN;AAIRuG,kBAAAA,WAAW,EAAEtH,OAAO,CAACuH,4BAAR,CAAqCxG,KAArC,CAJL;AAKRyG,kBAAAA,YAAY,EAAE,CAACxH,OAAO,CAACyH,8CAAR,CAAuD1G,KAAvD,EAA8DlB,KAAK,CAACI,KAAN,CAAYuB,cAA1E,CALP;AAMRwB,kBAAAA,KAAK,EAAEA,KAAK,GAAG,CANP,CAMS;;AANT,iBAAV;AASA,uBAAOmE,SAAS,CAACvG,MAAV,CAAiB,QAAjB,EAA2Bf,KAAK,CAACI,KAAN,CAAYyH,GAAZ,CAAgBC,MAAhB,CAAuBV,OAAvB,EAAgCW,IAAhC,CAAqC,UAAUC,MAAV,EAAkB;AACvF,sBAAIC,OAAO,GAAGD,MAAM,CAACC,OAArB;AAAA,sBACIvC,IAAI,GAAGsC,MAAM,CAACtC,IADlB;AAAA,sBAEItE,KAAK,GAAG4G,MAAM,CAAC5G,KAFnB;AAGA,yBAAO6G,OAAO,IAAIvC,IAAX,GAAkBwC,OAAO,CAACC,OAAR,CAAgBzC,IAAI,CAAC9D,GAAL,CAAS,UAAUwG,IAAV,EAAgB;AAChE,2BAAO3I,WAAW,CAAC4I,kBAAZ,CAA+BD,IAA/B,CAAP;AACD,mBAFwC,CAAhB,CAAlB,GAEDF,OAAO,CAACI,MAAR,CAAelH,KAAf,CAFN;AAGD,iBAPiC,CAA3B,CAAP;;AASF,mBAAK,CAAL;AACE,uBAAOkG,SAAS,CAACvG,MAAV,CAAiB,QAAjB,EAA2BmH,OAAO,CAACC,OAAR,CAAgB,EAAhB,CAA3B,CAAP;;AAEF,mBAAK,CAAL;AACA,mBAAK,KAAL;AACE,uBAAOb,SAAS,CAACtG,IAAV,EAAP;AAjCJ;AAmCD;AACF,SAtCM,EAsCJmG,QAtCI,CAAP;AAuCD,OAzCD,CAF6B,CAA7B;;AA6CA,aAAO,UAAUoB,GAAV,EAAeC,GAAf,EAAoB;AACzB,eAAOtB,KAAK,CAACzC,KAAN,CAAY,IAAZ,EAAkBC,SAAlB,CAAP;AACD,OAFD;AAGD,KAjDD,EAFA;;AAqDA1E,IAAAA,KAAK,CAACyI,sBAAN,GAA+B,UAAUvH,KAAV,EAAiB;AAC9C,UAAIf,OAAO,GAAGH,KAAK,CAACE,KAAN,CAAYC,OAA1B;AACA,UAAIgB,eAAe,GAAGnB,KAAK,CAACI,KAAN,CAAYe,eAAlC;;AAEA,UAAIA,eAAe,KAAKhC,kBAAkB,CAACuJ,IAAvC,IAA+CvI,OAAO,CAACkB,QAAR,CAAiBH,KAAjB,CAAnD,EAA4E;AAC1E,eAAOf,OAAO,CAACwI,QAAR,CAAiBzH,KAAjB,CAAP;AACD;;AAED,aAAO,IAAP;AACD,KATD;;AAWAlB,IAAAA,KAAK,CAAC6D,4BAAN,GAAqC,UAAU3C,KAAV,EAAiB;AACpD,aAAO,YAAY;AACjB,YAAI0H,cAAc,GAAG5I,KAAK,CAACyI,sBAAN,CAA6BvH,KAA7B,CAArB;;AAEA,YAAIyB,aAAa,GAAG3C,KAAK,CAACK,MAAN,CAAaa,KAAb,CAApB;;AAEA,YAAIyB,aAAa,IAAI9C,QAAQ,CAAC+C,cAAT,CAAwBD,aAAa,CAACV,IAAtC,CAArB,EAAkE;AAChE,cAAI4G,QAAQ,GAAGlG,aAAa,CAACV,IAAd,CAAmBmB,GAAlC;AACA,cAAI0F,QAAQ,GAAGD,QAAQ,GAAGA,QAAQ,CAACC,QAAZ,GAAuB,KAA9C;AACA,iBAAOF,cAAc,KAAK,IAAnB,IAA2BE,QAA3B,GAAsC9I,KAAK,CAACjB,MAAN,CAAagK,yBAAnD,GAA+EH,cAAtF;AACD;;AAED,eAAOA,cAAP;AACD,OAZD;AAaD,KAdD;;AAgBA5I,IAAAA,KAAK,CAACgE,uBAAN,GAAgC,YAAY;AAC1C,UAAI4E,cAAc,GAAG5I,KAAK,CAACyI,sBAAN,CAA6BxJ,eAAe,CAACsE,UAA7C,CAArB;;AAEA,UAAIyF,iBAAiB,GAAG,SAASA,iBAAT,GAA6B;AACnD,YAAI7I,OAAO,GAAGH,KAAK,CAACE,KAAN,CAAYC,OAA1B;;AAEA,YAAI8I,gBAAgB,GAAG9K,QAAQ,CAAC,EAAD,EAAKgC,OAAO,CAAC8I,gBAAb,CAA/B;;AAEA,eAAOA,gBAAgB,CAAChK,eAAe,CAACsE,UAAjB,CAAvB;;AAEAvD,QAAAA,KAAK,CAAC8E,mBAAN,CAA0BrF,WAAW,CAACsF,iBAAZ,CAA8B5E,OAA9B,EAAuC;AAC/D8I,UAAAA,gBAAgB,EAAEA;AAD6C,SAAvC,CAA1B;AAGD,OAVD;;AAYA,aAAOL,cAAc,IAAIhK,KAAK,CAACwD,aAAN,CAAoB,KAApB,EAA2B,IAA3B,EAAiCxD,KAAK,CAACwD,aAAN,CAAoB,MAApB,EAA4B,IAA5B,EAAkCwG,cAAlC,CAAjC,EAAoF5I,KAAK,CAACE,KAAN,CAAYC,OAAZ,CAAoB+I,mBAApB,IAA2CtK,KAAK,CAACwD,aAAN,CAAoB,KAApB,EAA2B,IAA3B,EAAiCxD,KAAK,CAACwD,aAAN,CAAoBtD,MAApB,EAA4B;AACnNqK,QAAAA,OAAO,EAAEH,iBAD0M;AAEnNI,QAAAA,GAAG,EAAE;AAF8M,OAA5B,EAGtLpJ,KAAK,CAACjB,MAAN,CAAasK,iBAHyK,CAAjC,CAA/H,CAAzB;AAID,KAnBD;;AAqBArJ,IAAAA,KAAK,CAACsJ,MAAN,GAAe,YAAY;AACzB,UAAInJ,OAAO,GAAGH,KAAK,CAACE,KAAN,CAAYC,OAA1B;AACA,UAAI0H,GAAG,GAAG7H,KAAK,CAACI,KAAN,CAAYyH,GAAtB;AACA,aAAOA,GAAG,CAACyB,MAAJ,CAAWnJ,OAAX,EAAoB4H,IAApB,CAAyB,UAAUC,MAAV,EAAkB;AAChD,YAAIC,OAAO,GAAGD,MAAM,CAACC,OAArB;AAAA,YACIvC,IAAI,GAAGsC,MAAM,CAACtC,IADlB;;AAGA,YAAIuC,OAAO,IAAIvC,IAAf,EAAqB;AACnB,iBAAOjG,WAAW,CAAC6J,MAAZ,CAAmBnJ,OAAnB,EAA4BuF,IAA5B,CAAP;AACD;;AAED,eAAOjG,WAAW,CAAC8J,cAAZ,CAA2BpJ,OAA3B,CAAP;AACD,OATM,CAAP;AAUD,KAbD;;AAeAH,IAAAA,KAAK,CAACwJ,mBAAN,GAA4B,UAAUC,OAAV,EAAmB;AAC7CzJ,MAAAA,KAAK,CAAC8E,mBAAN,CAA0BrF,WAAW,CAACsF,iBAAZ,CAA8B/E,KAAK,CAACE,KAAN,CAAYC,OAA1C,EAAmD;AAC3EsJ,QAAAA,OAAO,EAAEA;AADkE,OAAnD,CAA1B;AAGD,KAJD;;AAMAzJ,IAAAA,KAAK,CAAC0J,0BAAN,GAAmC,UAAU1G,KAAV,EAAiB;AAClDhD,MAAAA,KAAK,CAAC8E,mBAAN,CAA0BrF,WAAW,CAACsF,iBAAZ,CAA8B/E,KAAK,CAACE,KAAN,CAAYC,OAA1C,EAAmD;AAC3EwJ,QAAAA,cAAc,EAAE3G;AAD2D,OAAnD,CAA1B;AAGD,KAJD;;AAMAhD,IAAAA,KAAK,CAAC8E,mBAAN,GAA4B,UAAU3E,OAAV,EAAmByJ,QAAnB,EAA6B;AACvD5J,MAAAA,KAAK,CAAC6J,QAAN,CAAe;AACb1J,QAAAA,OAAO,EAAEV,WAAW,CAACsF,iBAAZ,CAA8B5E,OAA9B,EAAuC;AAC9CE,UAAAA,MAAM,EAAEZ,WAAW,CAACqK,mBAAZ,CAAgC3J,OAAO,CAACE,MAAxC,EAAgDL,KAAK,CAACI,KAAN,CAAYuB,cAA5D;AADsC,SAAvC;AADI,OAAf,EAIGiI,QAJH;AAKD,KAND;;AAQA5J,IAAAA,KAAK,CAAC+J,kBAAN,GAA2B,UAAU5J,OAAV,EAAmB;AAC5CH,MAAAA,KAAK,CAAC8E,mBAAN,CAA0B3E,OAA1B;AACD,KAFD;;AAIAH,IAAAA,KAAK,CAACkF,kBAAN,GAA2B,YAAY;AACrC,UAAI/E,OAAO,GAAGH,KAAK,CAACE,KAAN,CAAYC,OAA1B;;AAEA,UAAIA,OAAO,CAAC6J,SAAZ,EAAuB;AACrBhK,QAAAA,KAAK,CAAC6J,QAAN,CAAe;AACb1J,UAAAA,OAAO,EAAEV,WAAW,CAACsF,iBAAZ,CAA8B5E,OAA9B,EAAuC;AAC9C8J,YAAAA,MAAM,EAAE;AADsC,WAAvC;AADI,SAAf;AAKD;AACF,KAVD;;AAYAjK,IAAAA,KAAK,CAACK,MAAN,GAAeZ,WAAW,CAACyK,UAAZ,CAAuBC,MAAvB,CAA8B,UAAU9J,MAAV,EAAkBa,KAAlB,EAAyB;AACpE,UAAIkJ,SAAJ,EAAeC,SAAf;;AAEA,cAAQnJ,KAAR;AACE,aAAKhC,UAAU,CAACuG,MAAhB;AACA,aAAKvG,UAAU,CAACoL,QAAhB;AACA,aAAKpL,UAAU,CAACqL,IAAhB;AACA,aAAKrL,UAAU,CAACsL,aAAhB;AACA,aAAKtL,UAAU,CAACuL,UAAhB;AACA,aAAKvL,UAAU,CAACwL,iBAAhB;AACA,aAAKxL,UAAU,CAACyL,MAAhB;AACA,aAAKzL,UAAU,CAAC0L,KAAhB;AACA,aAAK1L,UAAU,CAAC2L,KAAhB;AACA,aAAK3L,UAAU,CAAC4L,IAAhB;AACE,iBAAO3M,QAAQ,CAAC,EAAD,EAAKkC,MAAL,GAAc+J,SAAS,GAAG,EAAZ,EAAgBA,SAAS,CAAClJ,KAAD,CAAT,GAAmB;AAC9De,YAAAA,IAAI,EAAEjC,KAAK,CAAC2D,yBAAN,CAAgCzC,KAAhC,CADwD;AAE9DgB,YAAAA,MAAM,EAAE,SAASA,MAAT,GAAkB;AACxB,qBAAOlC,KAAK,CAACyC,qBAAN,CAA4BvB,KAA5B,CAAP;AACD;AAJ6D,WAAnC,EAK1BkJ,SALY,EAAf;;AAOF,aAAKnL,eAAe,CAACsE,UAArB;AACE,iBAAOpF,QAAQ,CAAC,EAAD,EAAKkC,MAAL,GAAcgK,SAAS,GAAG,EAAZ,EAAgBA,SAAS,CAACnJ,KAAD,CAAT,GAAmB;AAC9De,YAAAA,IAAI,EAAEjC,KAAK,CAAC8D,yBAAN,EADwD;AAE9D5B,YAAAA,MAAM,EAAE,SAASA,MAAT,GAAkB;AACxB,qBAAOlC,KAAK,CAACqD,qBAAN,EAAP;AACD;AAJ6D,WAAnC,EAK1BgH,SALY,EAAf;;AAOF;AACE,iBAAOhK,MAAP;AA3BJ;AA6BD,KAhCc,EAgCZ,EAhCY,CAAf;AAiCA,WAAOL,KAAP;AACD;;AAED,MAAI+K,MAAM,GAAGlL,QAAQ,CAACmL,SAAtB;;AAEAD,EAAAA,MAAM,CAACE,iBAAP,GAA2B,SAASA,iBAAT,GAA6B;AACtD,SAAKjG,QAAL;AACD,GAFD;;AAIA+F,EAAAA,MAAM,CAAC7I,MAAP,GAAgB,SAASA,MAAT,GAAkB;AAChC,QAAI/B,OAAO,GAAG,KAAKD,KAAL,CAAWC,OAAzB;AACA,QAAI+K,WAAW,GAAG,KAAK9K,KAAvB;AAAA,QACIyH,GAAG,GAAGqD,WAAW,CAACrD,GADtB;AAAA,QAEI1E,KAAK,GAAG+H,WAAW,CAAC/H,KAFxB;AAAA,QAGIgI,eAAe,GAAGD,WAAW,CAACC,eAHlC;AAIA,WAAOvM,KAAK,CAACwD,aAAN,CAAoB,KAApB,EAA2B,IAA3B,EAAiCxD,KAAK,CAACwD,aAAN,CAAoBvD,MAApB,EAA4B;AAClEuM,MAAAA,QAAQ,EAAE;AADwD,KAA5B,EAErCD,eAAe,IAAIvM,KAAK,CAACwD,aAAN,CAAoBvC,QAAQ,CAACwC,KAA7B,EAAoC;AACxDF,MAAAA,KAAK,EAAE,KAAKpD,MAAL,CAAYsM;AADqC,KAApC,EAEnBzM,KAAK,CAACwD,aAAN,CAAoB1C,mBAApB,EAAyC;AAC1CmI,MAAAA,GAAG,EAAEA,GADqC;AAE1C4B,MAAAA,OAAO,EAAEtJ,OAAO,CAACsJ,OAFyB;AAG1C9E,MAAAA,aAAa,EAAE,KAAK6E,mBAHsB;AAI1CrG,MAAAA,KAAK,EAAEA;AAJmC,KAAzC,CAFmB,CAFkB,EASnC,KAAK/C,KAAL,CAAW0H,MAAX,IAAqBlJ,KAAK,CAACwD,aAAN,CAAoBvC,QAAQ,CAACwC,KAA7B,EAAoC,IAApC,EAA0CzD,KAAK,CAACwD,aAAN,CAAoB7C,UAApB,EAAgC;AAClGsI,MAAAA,GAAG,EAAEA,GAD6F;AAElG1H,MAAAA,OAAO,EAAEA,OAFyF;AAGlGwE,MAAAA,aAAa,EAAE,KAAKoF,kBAH8E;AAIlG5G,MAAAA,KAAK,EAAEA,KAJ2F;AAKlG1B,MAAAA,WAAW,EAAE,KAAK1C,MAAL,CAAYuM;AALyE,KAAhC,CAA1C,CATc,EAenC,KAAKC,aAAL,GAAqB3M,KAAK,CAACwD,aAAN,CAAoBvD,MAApB,EAA4B;AACpDuM,MAAAA,QAAQ,EAAE;AAD0C,KAA5B,EAEvBxM,KAAK,CAACwD,aAAN,CAAoBvC,QAAQ,CAACwC,KAA7B,EAAoC;AACrCF,MAAAA,KAAK,EAAE,KAAKpD,MAAL,CAAYyM;AADkB,KAApC,EAEA5M,KAAK,CAACwD,aAAN,CAAoB5C,QAApB,EAA8B;AAC/BwD,MAAAA,KAAK,EAAE7C,OAAO,CAACwJ,cADgB;AAE/BhF,MAAAA,aAAa,EAAE,KAAK+E,0BAFW;AAG/BjI,MAAAA,WAAW,EAAE,KAAK1C,MAAL,CAAY0M,yBAHM;AAI/B/I,MAAAA,KAAK,EAAE,MAJwB;AAK/BgJ,MAAAA,MAAM,EAAE;AALuB,KAA9B,CAFA,CAFuB,EAUrB,KAAKhK,YAAL,CAAkB,CAACzC,eAAe,CAACsE,UAAjB,CAAlB,CAVqB,CAArB,GAUmD,KAAK7B,YAAL,CAAkBjC,WAAW,CAACyK,UAA9B,CAzBhB,CAAjC,CAAP;AA0BD,GAhCD;;AAkCAa,EAAAA,MAAM,CAAChH,0BAAP,GAAoC,SAASA,0BAAT,GAAsC;AACxE,QAAI4H,MAAM,GAAG,IAAb;;AAEA,WAAO;AACLhH,MAAAA,aAAa,EAAE,SAASA,aAAT,CAAuB3B,KAAvB,EAA8B;AAC3C,YAAI4I,SAAJ;;AAEA,YAAIzL,OAAO,GAAGwL,MAAM,CAACzL,KAAP,CAAaC,OAA3B;;AAEA,YAAI0L,mBAAmB,GAAG1N,QAAQ,CAAC,EAAD,EAAKgC,OAAO,CAAC8I,gBAAb,GAAgC2C,SAAS,GAAG,EAAZ,EAAgBA,SAAS,CAAC3M,eAAe,CAACsE,UAAjB,CAAT,GAAwCP,KAAxD,EAA+D4I,SAA/F,EAAlC;;AAEAD,QAAAA,MAAM,CAAC7G,mBAAP,CAA2BrF,WAAW,CAACsF,iBAAZ,CAA8B5E,OAA9B,EAAuC;AAChE8I,UAAAA,gBAAgB,EAAE4C;AAD8C,SAAvC,CAA3B;AAGD;AAXI,KAAP;AAaD,GAhBD;;AAkBAd,EAAAA,MAAM,CAAC/F,QAAP,GAAkB,SAASA,QAAT,GAAoB;AACpC,QAAI8G,MAAM,GAAG,IAAb;;AAEA,QAAIC,aAAa,GAAG,KAAKzL,iBAAL,GAAyB,KAAKgJ,MAAL,EAA7C;AACAyC,IAAAA,aAAa,CAAChE,IAAd,CAAmB,UAAUiE,eAAV,EAA2B;AAC5C,UAAID,aAAa,KAAKD,MAAM,CAACxL,iBAA7B,EAAgD;AAC9CwL,QAAAA,MAAM,CAACjC,QAAP,CAAgB;AACd1J,UAAAA,OAAO,EAAEV,WAAW,CAACuF,QAAZ,CAAqBgH,eAArB,EAAsCF,MAAM,CAAC/M,MAA7C;AADK,SAAhB;AAGD;AACF,KAND;AAOD,GAXD;;AAaAT,EAAAA,YAAY,CAACuB,QAAD,EAAW,CAAC;AACtByC,IAAAA,GAAG,EAAE,eADiB;AAEtB2J,IAAAA,GAAG,EAAE,SAASA,GAAT,GAAe;AAClB,UAAI9L,OAAO,GAAG,KAAKD,KAAL,CAAWC,OAAzB;AACA,UAAIgL,eAAe,GAAG,KAAK/K,KAAL,CAAW+K,eAAjC;AACA,aAAOhL,OAAO,CAAC+L,SAAR,IAAqBnK,OAAO,CAACoJ,eAAD,CAAP,IAA4B,CAAChL,OAAO,CAACsJ,OAAjE;AACD;AANqB,GAAD,CAAX,CAAZ;;AASA,SAAO5J,QAAP;AACD,CAzhBD,CAyhBEjB,KAAK,CAACuN,SAzhBR,CAF+E,EA2hB3DzN,OAAO,CAAC0N,mBAAR,GAA8B,UA3hB6B,EA2hBjB1N,OAAO,CAAC6I,YAAR,GAAuB;AACnFpG,EAAAA,eAAe,EAAE,OADkE;AAEnFgC,EAAAA,KAAK,EAAE,CAF4E;AAGnFxB,EAAAA,cAAc,EAAE,EAHmE;AAInFwJ,EAAAA,eAAe,EAAE;AAJkE,CA3hBN,EAgiB5EzM,OAAO,CAAC2D,KAAR,GAAgB,UAAUgK,KAAV,EAAiB;AAClC,MAAIlK,KAAK,GAAGkK,KAAK,CAAClK,KAAlB;AAAA,MACImK,QAAQ,GAAGD,KAAK,CAACC,QADrB;AAEA,SAAO1N,KAAK,CAACwD,aAAN,CAAoB,KAApB,EAA2B;AAChCmK,IAAAA,SAAS,EAAE5M,QAAQ,CAAC6M,GAAT;AADqB,GAA3B,EAEJrK,KAAK,IAAIvD,KAAK,CAACwD,aAAN,CAAoB,KAApB,EAA2B;AACrCmK,IAAAA,SAAS,EAAE5M,QAAQ,CAACwC,KAAT;AAD0B,GAA3B,EAETA,KAFS,CAFL,EAIIvD,KAAK,CAACwD,aAAN,CAAoB,KAApB,EAA2B;AACpCmK,IAAAA,SAAS,EAAE5M,QAAQ,CAACuB,KAAT;AADyB,GAA3B,EAERoL,QAFQ,CAJJ,CAAP;AAOD,CA1iB8E,EA0iB5E5N,OAAO,CAACkE,cAAR,GAAyB,UAAUX,IAAV,EAAgB;AAC1C,MAAI7B,KAAK,GAAG6B,IAAI,CAAC7B,KAAjB;AACA,SAAOqM,MAAM,CAACzB,SAAP,CAAiB0B,cAAjB,CAAgCzM,IAAhC,CAAqCG,KAArC,EAA4C,mBAA5C,KAAoEqM,MAAM,CAACzB,SAAP,CAAiB0B,cAAjB,CAAgCzM,IAAhC,CAAqCG,KAArC,EAA4C,UAA5C,CAA3E;AACD,CA7iB8E,EA6iB5E1B,OAAO,CAAC8E,WAAR,GAAsB,UAAUvB,IAAV,EAAgB;AACvC,MAAI7B,KAAK,GAAG6B,IAAI,CAAC7B,KAAjB;AACA,SAAO,CAACP,QAAQ,CAAC+C,cAAT,CAAwBX,IAAxB,CAAD,IAAkCwK,MAAM,CAACzB,SAAP,CAAiB0B,cAAjB,CAAgCzM,IAAhC,CAAqCG,KAArC,EAA4C,eAA5C,CAAzC;AACD,CAhjB8E,EAgjB5EzB,KAhjBwE,CAAP,CAAJ,IAgjBlDF,MAhjBK,CAAZ","sourcesContent":["import _extends from \"@babel/runtime/helpers/esm/extends\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _createClass from \"@babel/runtime/helpers/esm/createClass\";\nimport _inheritsLoose from \"@babel/runtime/helpers/esm/inheritsLoose\";\n\nvar _dec, _class, _class2, _temp;\n\nimport React from 'react';\nimport { Gapped } from \"../../../Gapped\";\nimport { Button } from \"../../../Button\";\nimport { locale } from \"../../../../lib/locale/decorators\";\nimport { FiasLocaleHelper } from \"../../locale\";\nimport { FiasExtraFields, FiasFields, FiasFormValidation } from \"../../types\";\nimport { FiasAddressElement } from \"../../models/FiasAddressElement\";\nimport { Tooltip } from \"../../../Tooltip\";\nimport { Input } from \"../../../Input\";\nimport { FiasSearch } from \"../../FiasSearch/FiasSearch\";\nimport { Textarea } from \"../../../Textarea\";\nimport { FiasAddress } from \"../../models/FiasAddress\";\nimport { FiasCountrySelector } from \"../FiasCountrySelector\";\nimport { jsStyles } from \"../FiasForm.styles\";\nimport { FiasComboBox } from \"../FiasComboBox\";\nexport var FiasForm = (_dec = locale('Fias', FiasLocaleHelper), _dec(_class = (_temp = _class2 =\n/*#__PURE__*/\nfunction (_React$Component) {\n  _inheritsLoose(FiasForm, _React$Component);\n\n  function FiasForm(_props) {\n    var _this;\n\n    _this = _React$Component.call(this, _props) || this;\n    _this.state = {\n      address: _this.props.address\n    };\n    _this.locale = void 0;\n    _this.fields = void 0;\n    _this.lastVerifyPromise = null;\n    _this.submit =\n    /*#__PURE__*/\n    _asyncToGenerator(\n    /*#__PURE__*/\n    _regeneratorRuntime.mark(function _callee() {\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.next = 2;\n              return _this.lastVerifyPromise;\n\n            case 2:\n              return _context.abrupt(\"return\", _this.state.address);\n\n            case 3:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    _this.getCommonFieldProps = function (field) {\n      var address = _this.state.address;\n      var validationLevel = _this.props.validationLevel;\n      return {\n        error: address.hasError(field) && validationLevel === FiasFormValidation.Error,\n        warning: address.hasError(field) && validationLevel === FiasFormValidation.Warning,\n        placeholder: _this.locale[field + \"Placeholder\"]\n      };\n    };\n\n    _this.renderFields = function (fields) {\n      var fieldsSettings = _this.props.fieldsSettings;\n      return fields.map(function (field) {\n        var control = _this.fields[field];\n        var settings = fieldsSettings[field];\n\n        if (control && Boolean(settings && settings.visible)) {\n          var meta = control.meta,\n              render = control.render;\n          var label = _this.locale[field + \"Label\"];\n          return control && React.createElement(FiasForm.Field, {\n            label: label,\n            key: field\n          }, React.createElement(Tooltip, {\n            pos: 'right middle',\n            render: meta.tooltip\n          }, render()));\n        }\n      });\n    };\n\n    _this.renderAddressComboBox = function (field, width) {\n      if (width === void 0) {\n        width = '100%';\n      }\n\n      var comboboxField = _this.fields[field];\n\n      if (comboboxField && FiasForm.isComboboxMeta(comboboxField.meta)) {\n        var address = _this.state.address;\n        var _comboboxField$meta = comboboxField.meta,\n            props = _comboboxField$meta.props,\n            createRef = _comboboxField$meta.createRef;\n\n        var commonProps = _this.getCommonFieldProps(field);\n\n        return React.createElement(FiasComboBox, _extends({}, commonProps, props, {\n          value: address,\n          width: width,\n          drawArrow: false,\n          searchOnFocus: false,\n          limit: _this.props.limit,\n          ref: createRef\n        }));\n      }\n    };\n\n    _this.renderPostalCodeInput = function () {\n      var inputField = _this.fields[FiasExtraFields.postalcode];\n\n      if (inputField && FiasForm.isInputMeta(inputField.meta)) {\n        var address = _this.state.address;\n        var _inputField$meta = inputField.meta,\n            props = _inputField$meta.props,\n            createRef = _inputField$meta.createRef;\n\n        var commonProps = _this.getCommonFieldProps(FiasExtraFields.postalcode);\n\n        var value = address.postalCode;\n        return React.createElement(Input, _extends({}, commonProps, props, {\n          value: value,\n          width: 130,\n          ref: createRef\n        }));\n      }\n    };\n\n    _this.createAddressComboboxMeta = function (field) {\n      return {\n        ref: null,\n        props: _this.createAddressComboBoxProps(field),\n        tooltip: _this.createAddressComboBoxTooltip(field),\n        createRef: function createRef(ref) {\n          var comboboxField = _this.fields[field];\n\n          if (comboboxField) {\n            comboboxField.meta.ref = ref;\n          }\n        }\n      };\n    };\n\n    _this.createPostalCodeInputMeta = function () {\n      return {\n        ref: null,\n        props: _this.createPostalCodeInputProps(),\n        tooltip: function tooltip() {\n          return _this.createPostalCodeTooltip();\n        },\n        createRef: function createRef(ref) {\n          var inputField = _this.fields[FiasExtraFields.postalcode];\n\n          if (inputField) {\n            inputField.meta.ref = ref;\n          }\n        }\n      };\n    };\n\n    _this.createAddressComboBoxProps = function (field) {\n      var getItems =\n      /*#__PURE__*/\n      function () {\n        var _ref2 = _asyncToGenerator(\n        /*#__PURE__*/\n        _regeneratorRuntime.mark(function _callee2(searchText) {\n          return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n            while (1) {\n              switch (_context2.prev = _context2.next) {\n                case 0:\n                  return _context2.abrupt(\"return\", _this.createItemsSource(searchText, field));\n\n                case 1:\n                case \"end\":\n                  return _context2.stop();\n              }\n            }\n          }, _callee2);\n        }));\n\n        return function getItems(_x) {\n          return _ref2.apply(this, arguments);\n        };\n      }();\n\n      var onValueChange = function onValueChange(value) {\n        var address = _this.state.address;\n\n        var newFields = _extends({}, address.fields, {}, value.fields); // get rid of undefineds\n\n\n        var addressField;\n\n        for (addressField in newFields) {\n          if (!newFields[addressField]) {\n            delete newFields[addressField];\n          }\n        }\n\n        _this.handleAddressChange(FiasAddress.createFromAddress(address, {\n          fields: newFields\n        }), _this.validate);\n      };\n\n      var onInputValueChange = function onInputValueChange() {\n        _this.resetAddressErrors();\n      };\n\n      var onUnexpectedInput = function onUnexpectedInput(query) {\n        var _extends2;\n\n        var address = _this.state.address;\n\n        var newFields = _extends({}, address.fields, (_extends2 = {}, _extends2[field] = query ? new FiasAddressElement(field, query) : undefined, _extends2));\n\n        return FiasAddress.createFromAddress(address, {\n          fields: newFields\n        });\n      };\n\n      var renderItem = function renderItem(address) {\n        var element = address.fields[field];\n\n        if (!element) {\n          return '';\n        }\n\n        if (field === FiasFields.region && element.data) {\n          var regionCode = element.data.code.substr(0, 2);\n          return regionCode + \" \" + element.getText();\n        }\n\n        var diffAddress = new FiasAddress({\n          fields: _this.state.address.getDiffFields(address, _this.props.fieldsSettings)\n        });\n        var hasParentFields = Boolean(diffAddress.getClosestParentFiasId(field));\n        return hasParentFields ? diffAddress.getText() : element.getText(element.isTypeMatchField(field));\n      };\n\n      var renderValue = function renderValue(address) {\n        var element = address.fields[field];\n        return element && element.getText(element.isTypeMatchField(field));\n      };\n\n      var renderNotFound = function renderNotFound() {\n        var address = _this.state.address;\n        var messages = [_this.locale[field + \"NotFound\"] || _this.locale.addressNotFound];\n\n        if (address.isAllowedToFill(field)) {\n          if (address.hasOnlyIndirectParent(field)) {\n            messages.push(_this.locale.addressFillParentOrSearch);\n          }\n        } else {\n          messages = _this.locale[field + \"FillBefore\"] ? [_this.locale[field + \"FillBefore\"]] : messages;\n        }\n\n        return React.createElement(\"div\", null, messages.map(function (message, i, m) {\n          return React.createElement(\"div\", {\n            key: i\n          }, message + (m[i + 1] ? '.' : ''));\n        }));\n      };\n\n      var valueToString = function valueToString(address) {\n        var element = address.fields[field];\n        return element ? element.name : '';\n      };\n\n      var itemToValue = valueToString;\n      return {\n        getItems: getItems,\n        onValueChange: onValueChange,\n        onInputValueChange: onInputValueChange,\n        onUnexpectedInput: onUnexpectedInput,\n        renderItem: renderItem,\n        renderValue: renderValue,\n        itemToValue: itemToValue,\n        valueToString: valueToString,\n        renderNotFound: renderNotFound\n      };\n    };\n\n    _this.createItemsSource =\n    /*#__PURE__*/\n    function () {\n      var _ref3 = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee3(searchText, field) {\n        var address, limit, options;\n        return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                address = _this.state.address;\n                limit = _this.props.limit || FiasForm.defaultProps.limit;\n\n                if (!address.isAllowedToFill(field)) {\n                  _context3.next = 5;\n                  break;\n                }\n\n                options = {\n                  searchText: searchText,\n                  field: field,\n                  parentFiasId: address.getClosestParentFiasId(field),\n                  fullAddress: address.isAllowedToSearchFullAddress(field),\n                  directParent: !address.isAllowedToSearchThroughChildrenOfDirectParent(field, _this.props.fieldsSettings),\n                  limit: limit + 1 // +1 to detect if there are more items\n\n                };\n                return _context3.abrupt(\"return\", _this.props.api.search(options).then(function (result) {\n                  var success = result.success,\n                      data = result.data,\n                      error = result.error;\n                  return success && data ? Promise.resolve(data.map(function (item) {\n                    return FiasAddress.createFromResponse(item);\n                  })) : Promise.reject(error);\n                }));\n\n              case 5:\n                return _context3.abrupt(\"return\", Promise.resolve([]));\n\n              case 6:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3);\n      }));\n\n      return function (_x2, _x3) {\n        return _ref3.apply(this, arguments);\n      };\n    }();\n\n    _this.getFieldTooltipContent = function (field) {\n      var address = _this.state.address;\n      var validationLevel = _this.props.validationLevel;\n\n      if (validationLevel !== FiasFormValidation.None && address.hasError(field)) {\n        return address.getError(field);\n      }\n\n      return null;\n    };\n\n    _this.createAddressComboBoxTooltip = function (field) {\n      return function () {\n        var tooltipContent = _this.getFieldTooltipContent(field);\n\n        var comboboxField = _this.fields[field];\n\n        if (comboboxField && FiasForm.isComboboxMeta(comboboxField.meta)) {\n          var combobox = comboboxField.meta.ref;\n          var hasItems = combobox ? combobox.hasItems : false;\n          return tooltipContent !== null && hasItems ? _this.locale.addressSelectItemFromList : tooltipContent;\n        }\n\n        return tooltipContent;\n      };\n    };\n\n    _this.createPostalCodeTooltip = function () {\n      var tooltipContent = _this.getFieldTooltipContent(FiasExtraFields.postalcode);\n\n      var replacePostalCode = function replacePostalCode() {\n        var address = _this.state.address;\n\n        var additionalFields = _extends({}, address.additionalFields);\n\n        delete additionalFields[FiasExtraFields.postalcode];\n\n        _this.handleAddressChange(FiasAddress.createFromAddress(address, {\n          additionalFields: additionalFields\n        }));\n      };\n\n      return tooltipContent && React.createElement(\"div\", null, React.createElement(\"span\", null, tooltipContent), _this.state.address.isPostalCodeAltered && React.createElement(\"div\", null, React.createElement(Button, {\n        onClick: replacePostalCode,\n        use: \"link\"\n      }, _this.locale.postalcodeReplace)));\n    };\n\n    _this.verify = function () {\n      var address = _this.state.address;\n      var api = _this.props.api;\n      return api.verify(address).then(function (result) {\n        var success = result.success,\n            data = result.data;\n\n        if (success && data) {\n          return FiasAddress.verify(address, data);\n        }\n\n        return FiasAddress.removeFiasData(address);\n      });\n    };\n\n    _this.handleCountryChange = function (country) {\n      _this.handleAddressChange(FiasAddress.createFromAddress(_this.state.address, {\n        country: country\n      }));\n    };\n\n    _this.handleForeignAddressChange = function (value) {\n      _this.handleAddressChange(FiasAddress.createFromAddress(_this.state.address, {\n        foreignAddress: value\n      }));\n    };\n\n    _this.handleAddressChange = function (address, callback) {\n      _this.setState({\n        address: FiasAddress.createFromAddress(address, {\n          fields: FiasAddress.filterVisibleFields(address.fields, _this.props.fieldsSettings)\n        })\n      }, callback);\n    };\n\n    _this.handleSearchChange = function (address) {\n      _this.handleAddressChange(address);\n    };\n\n    _this.resetAddressErrors = function () {\n      var address = _this.state.address;\n\n      if (address.hasErrors) {\n        _this.setState({\n          address: FiasAddress.createFromAddress(address, {\n            errors: {}\n          })\n        });\n      }\n    };\n\n    _this.fields = FiasAddress.ALL_FIELDS.reduce(function (fields, field) {\n      var _extends3, _extends4;\n\n      switch (field) {\n        case FiasFields.region:\n        case FiasFields.district:\n        case FiasFields.city:\n        case FiasFields.intracityarea:\n        case FiasFields.settlement:\n        case FiasFields.planningstructure:\n        case FiasFields.street:\n        case FiasFields.stead:\n        case FiasFields.house:\n        case FiasFields.room:\n          return _extends({}, fields, (_extends3 = {}, _extends3[field] = {\n            meta: _this.createAddressComboboxMeta(field),\n            render: function render() {\n              return _this.renderAddressComboBox(field);\n            }\n          }, _extends3));\n\n        case FiasExtraFields.postalcode:\n          return _extends({}, fields, (_extends4 = {}, _extends4[field] = {\n            meta: _this.createPostalCodeInputMeta(),\n            render: function render() {\n              return _this.renderPostalCodeInput();\n            }\n          }, _extends4));\n\n        default:\n          return fields;\n      }\n    }, {});\n    return _this;\n  }\n\n  var _proto = FiasForm.prototype;\n\n  _proto.componentDidMount = function componentDidMount() {\n    this.validate();\n  };\n\n  _proto.render = function render() {\n    var address = this.state.address;\n    var _this$props = this.props,\n        api = _this$props.api,\n        limit = _this$props.limit,\n        countrySelector = _this$props.countrySelector;\n    return React.createElement(\"div\", null, React.createElement(Gapped, {\n      vertical: true\n    }, countrySelector && React.createElement(FiasForm.Field, {\n      label: this.locale.countryLabel\n    }, React.createElement(FiasCountrySelector, {\n      api: api,\n      country: address.country,\n      onValueChange: this.handleCountryChange,\n      limit: limit\n    })), this.props.search && React.createElement(FiasForm.Field, null, React.createElement(FiasSearch, {\n      api: api,\n      address: address,\n      onValueChange: this.handleSearchChange,\n      limit: limit,\n      placeholder: this.locale.searchPlaceholder\n    })), this.isForeignForm ? React.createElement(Gapped, {\n      vertical: true\n    }, React.createElement(FiasForm.Field, {\n      label: this.locale.foreignAddressLabel\n    }, React.createElement(Textarea, {\n      value: address.foreignAddress,\n      onValueChange: this.handleForeignAddressChange,\n      placeholder: this.locale.foreignAddressPlaceholder,\n      width: \"100%\",\n      resize: \"none\"\n    })), this.renderFields([FiasExtraFields.postalcode])) : this.renderFields(FiasAddress.ALL_FIELDS)));\n  };\n\n  _proto.createPostalCodeInputProps = function createPostalCodeInputProps() {\n    var _this2 = this;\n\n    return {\n      onValueChange: function onValueChange(value) {\n        var _extends5;\n\n        var address = _this2.state.address;\n\n        var newAdditionalFields = _extends({}, address.additionalFields, (_extends5 = {}, _extends5[FiasExtraFields.postalcode] = value, _extends5));\n\n        _this2.handleAddressChange(FiasAddress.createFromAddress(address, {\n          additionalFields: newAdditionalFields\n        }));\n      }\n    };\n  };\n\n  _proto.validate = function validate() {\n    var _this3 = this;\n\n    var verifyPromise = this.lastVerifyPromise = this.verify();\n    verifyPromise.then(function (verifiedAddress) {\n      if (verifyPromise === _this3.lastVerifyPromise) {\n        _this3.setState({\n          address: FiasAddress.validate(verifiedAddress, _this3.locale)\n        });\n      }\n    });\n  };\n\n  _createClass(FiasForm, [{\n    key: \"isForeignForm\",\n    get: function get() {\n      var address = this.state.address;\n      var countrySelector = this.props.countrySelector;\n      return address.isForeign || Boolean(countrySelector) && !address.country;\n    }\n  }]);\n\n  return FiasForm;\n}(React.Component), _class2.__KONTUR_REACT_UI__ = 'FiasForm', _class2.defaultProps = {\n  validationLevel: 'Error',\n  limit: 5,\n  fieldsSettings: {},\n  countrySelector: false\n}, _class2.Field = function (_ref4) {\n  var label = _ref4.label,\n      children = _ref4.children;\n  return React.createElement(\"div\", {\n    className: jsStyles.row()\n  }, label && React.createElement(\"div\", {\n    className: jsStyles.label()\n  }, label), React.createElement(\"div\", {\n    className: jsStyles.field()\n  }, children));\n}, _class2.isComboboxMeta = function (meta) {\n  var props = meta.props;\n  return Object.prototype.hasOwnProperty.call(props, 'onUnexpectedInput') && Object.prototype.hasOwnProperty.call(props, 'getItems');\n}, _class2.isInputMeta = function (meta) {\n  var props = meta.props;\n  return !FiasForm.isComboboxMeta(meta) && Object.prototype.hasOwnProperty.call(props, 'onValueChange');\n}, _temp)) || _class);"]},"metadata":{},"sourceType":"module"}