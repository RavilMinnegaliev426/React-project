{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _extends from \"@babel/runtime/helpers/esm/extends\";\nimport _createClass from \"@babel/runtime/helpers/esm/createClass\";\nimport isEqual from 'lodash.isequal';\nimport { FiasFields, FiasExtraFields } from \"../../types\";\nimport { FiasAddressElement } from \"../FiasAddressElement\";\nimport { FiasData } from \"../FiasData\";\nexport var FiasAddress = /*#__PURE__*/function () {\n  // TODO: Hide invisible fields without removing them.\n  // (removing can break the verification)\n  function FiasAddress(_temp) {\n    var _this = this;\n\n    var _ref = _temp === void 0 ? {} : _temp,\n        _fields = _ref.fields,\n        additionalFields = _ref.additionalFields,\n        errors = _ref.errors,\n        _country = _ref.country,\n        _foreignAddress = _ref.foreignAddress;\n\n    this.fields = void 0;\n    this.additionalFields = void 0;\n    this.errors = void 0;\n    this.country = void 0;\n    this.foreignAddress = void 0;\n\n    this.getAddressErrors = function () {\n      return _extends({}, _this.errors);\n    };\n\n    this.getText = function (minField, skipTypes, connector) {\n      if (skipTypes === void 0) {\n        skipTypes = false;\n      }\n\n      if (connector === void 0) {\n        connector = ', ';\n      }\n\n      if (_this.isEmpty) {\n        return '';\n      }\n\n      var getElementText = function getElementText(element) {\n        return element ? element.getText(skipTypes) : '';\n      };\n\n      var fields = minField ? FiasAddress.getParentFields(minField) : FiasAddress.MAIN_FIELDS;\n      return fields.map(function (field) {\n        return getElementText(_this.fields[field]);\n      }).filter(Boolean).join(connector);\n    };\n\n    this.getFullText = function (withPostalCode) {\n      if (withPostalCode === void 0) {\n        withPostalCode = false;\n      }\n\n      var substrings = [];\n\n      if (withPostalCode) {\n        substrings.push(_this.postalCode);\n      }\n\n      if (_this.country) {\n        substrings.push(_this.country.fullName);\n      }\n\n      substrings.push(_this.isForeign ? _this.foreignAddress : _this.getText());\n      return substrings.filter(Boolean).join(', ');\n    };\n\n    this.isAllowedToFill = function (field) {\n      var _this$fields = _this.fields,\n          region = _this$fields.region,\n          city = _this$fields.city,\n          settlement = _this$fields.settlement,\n          house = _this$fields.house;\n      var hasCityOrSettlement = city || settlement || region && region.isFederalCity;\n\n      if (!hasCityOrSettlement && (field === FiasFields.street || field === FiasFields.stead || field === FiasFields.house) || !house && field === FiasFields.room) {\n        return false;\n      }\n\n      return true;\n    };\n\n    this.isAllowedToSearchFullAddress = function (field) {\n      return FiasAddress.FULL_ADDRESS_SEARCH_FIELDS.includes(field);\n    };\n\n    this.isAllowedToSearchThroughChildrenOfDirectParent = function (field, fieldsSettings) {\n      if (fieldsSettings) {\n        for (var _iterator = FiasAddress.getParentFields(field), _isArray = Array.isArray(_iterator), _i = 0, _iterator = _isArray ? _iterator : _iterator[Symbol.iterator]();;) {\n          var _ref2;\n\n          if (_isArray) {\n            if (_i >= _iterator.length) break;\n            _ref2 = _iterator[_i++];\n          } else {\n            _i = _iterator.next();\n            if (_i.done) break;\n            _ref2 = _i.value;\n          }\n\n          var parentField = _ref2;\n\n          if (!FiasAddress.isFieldVisible(parentField, fieldsSettings)) {\n            return false;\n          }\n        }\n      }\n\n      return FiasAddress.NOT_ONLY_DIRECT_PARENT_SEARCH_FIELDS.includes(field);\n    };\n\n    this.hasOnlyIndirectParent = function (field) {\n      if (field) {\n        var parents = FiasAddress.getParentFields(field);\n\n        if (parents.length > 1) {\n          var directParent = _this.fields[parents.pop()];\n\n          return !directParent && parents.some(function (parent) {\n            return Boolean(_this.fields[parent]);\n          });\n        }\n      }\n\n      return false;\n    };\n\n    this.getClosestParentFiasId = function (field) {\n      if (!_this.isEmpty) {\n        var parents = FiasAddress.getParentFields(field).slice().reverse();\n\n        for (var _iterator2 = parents, _isArray2 = Array.isArray(_iterator2), _i2 = 0, _iterator2 = _isArray2 ? _iterator2 : _iterator2[Symbol.iterator]();;) {\n          var _ref3;\n\n          if (_isArray2) {\n            if (_i2 >= _iterator2.length) break;\n            _ref3 = _iterator2[_i2++];\n          } else {\n            _i2 = _iterator2.next();\n            if (_i2.done) break;\n            _ref3 = _i2.value;\n          }\n\n          var parentField = _ref3;\n          var parent = _this.fields[parentField];\n\n          if (parent) {\n            return parent.fiasId;\n          }\n        }\n      }\n    };\n\n    this.getFiasId = function () {\n      if (!_this.isEmpty) {\n        var fields = FiasAddress.MAIN_FIELDS.slice().reverse();\n\n        for (var _iterator3 = fields, _isArray3 = Array.isArray(_iterator3), _i3 = 0, _iterator3 = _isArray3 ? _iterator3 : _iterator3[Symbol.iterator]();;) {\n          var _ref4;\n\n          if (_isArray3) {\n            if (_i3 >= _iterator3.length) break;\n            _ref4 = _iterator3[_i3++];\n          } else {\n            _i3 = _iterator3.next();\n            if (_i3.done) break;\n            _ref4 = _i3.value;\n          }\n\n          var field = _ref4;\n          var element = _this.fields[field];\n\n          if (element && element.fiasId) {\n            return element.fiasId;\n          }\n        }\n      }\n\n      return '';\n    };\n\n    this.getParent = function (field) {\n      if (_this.fields[field]) {\n        var parents = FiasAddress.getParentFields(field).filter(function (f) {\n          return Boolean(_this.fields[f]);\n        });\n        var closest = parents.pop();\n\n        if (closest) {\n          return _this.fields[closest];\n        }\n      }\n    };\n\n    this.verifyConsistency = function () {\n      var verifiedFields = _extends({}, _this.fields);\n\n      for (var _iterator4 = FiasAddress.MAIN_FIELDS, _isArray4 = Array.isArray(_iterator4), _i4 = 0, _iterator4 = _isArray4 ? _iterator4 : _iterator4[Symbol.iterator]();;) {\n        var _ref5;\n\n        if (_isArray4) {\n          if (_i4 >= _iterator4.length) break;\n          _ref5 = _iterator4[_i4++];\n        } else {\n          _i4 = _iterator4.next();\n          if (_i4.done) break;\n          _ref5 = _i4.value;\n        }\n\n        var field = _ref5;\n        var element = _this.fields[field];\n\n        if (element) {\n          if (element.data) {\n            var expectedParentFiasId = element.data.parentFiasId;\n\n            var parent = _this.getParent(field);\n\n            if (!parent || parent.fiasId === expectedParentFiasId) {\n              verifiedFields[field] = element;\n              continue;\n            }\n          }\n\n          return {\n            address: FiasAddress.fieldsToResponse(verifiedFields),\n            isValid: false,\n            invalidLevel: field\n          };\n        }\n      }\n\n      return {\n        address: FiasAddress.fieldsToResponse(verifiedFields),\n        isValid: true\n      };\n    };\n\n    this.getFiasPostalCode = function () {\n      if (!_this.isEmpty) {\n        var fields = FiasAddress.MAIN_FIELDS.slice().reverse();\n\n        for (var _iterator5 = fields, _isArray5 = Array.isArray(_iterator5), _i5 = 0, _iterator5 = _isArray5 ? _iterator5 : _iterator5[Symbol.iterator]();;) {\n          var _ref6;\n\n          if (_isArray5) {\n            if (_i5 >= _iterator5.length) break;\n            _ref6 = _iterator5[_i5++];\n          } else {\n            _i5 = _iterator5.next();\n            if (_i5.done) break;\n            _ref6 = _i5.value;\n          }\n\n          var field = _ref6;\n          var element = _this.fields[field];\n\n          if (element && element.data && element.data.postalCode) {\n            return element.data.postalCode;\n          }\n        }\n      }\n\n      return '';\n    };\n\n    this.getAddressValue = function () {\n      var fields = Object.keys(_this.fields);\n      return fields.reduce(function (value, field) {\n        var _extends2;\n\n        var element = _this.fields[field];\n\n        if (!element) {\n          return value;\n        }\n\n        var name = element.name,\n            fiasData = element.fiasData;\n        return _extends({}, value, (_extends2 = {}, _extends2[field] = _extends({\n          name: name\n        }, fiasData ? {\n          data: fiasData\n        } : {}), _extends2));\n      }, {});\n    };\n\n    this.getValue = function (withPostalCode) {\n      if (withPostalCode === void 0) {\n        withPostalCode = false;\n      }\n\n      var country = _this.country,\n          foreignAddress = _this.foreignAddress;\n      return _extends({\n        address: _this.getAddressValue(),\n        addressString: _this.getFullText(withPostalCode),\n        addressErrors: _this.getAddressErrors(),\n        fiasId: _this.getFiasId(),\n        postalCode: _this.postalCode\n      }, country ? {\n        country: country\n      } : {}, {}, _this.isForeign ? {\n        foreignAddress: foreignAddress\n      } : {});\n    };\n\n    this.convertForVerification = function () {\n      return FiasAddress.VERIFIABLE_FIELDS.reduce(function (value, field) {\n        var _extends3;\n\n        var element = _this.fields[field];\n\n        if (!element) {\n          return value;\n        }\n\n        return _extends({}, value, (_extends3 = {}, _extends3[field] = _extends({}, element.verifiableData), _extends3));\n      }, {});\n    };\n\n    this.getDiffFields = function (address, fieldsSettings) {\n      var fields = fieldsSettings ? FiasAddress.filterVisibleFields(address.fields, fieldsSettings) : _extends({}, address.fields);\n\n      for (var _iterator6 = FiasAddress.MAIN_FIELDS, _isArray6 = Array.isArray(_iterator6), _i6 = 0, _iterator6 = _isArray6 ? _iterator6 : _iterator6[Symbol.iterator]();;) {\n        var _ref7;\n\n        if (_isArray6) {\n          if (_i6 >= _iterator6.length) break;\n          _ref7 = _iterator6[_i6++];\n        } else {\n          _i6 = _iterator6.next();\n          if (_i6.done) break;\n          _ref7 = _i6.value;\n        }\n\n        var field = _ref7;\n        var element = fields[field];\n\n        if (element) {\n          if (element.isEqualTo(_this.fields[field])) {\n            delete fields[field];\n          } else {\n            break;\n          }\n        }\n      }\n\n      return fields;\n    };\n\n    this.fields = _fields || {};\n    this.additionalFields = additionalFields || {};\n    this.errors = errors || {};\n    this.country = _country;\n    this.foreignAddress = _foreignAddress || '';\n  }\n\n  var _proto = FiasAddress.prototype;\n\n  _proto.hasError = function hasError(field) {\n    return Object.prototype.hasOwnProperty.call(this.errors, field);\n  };\n\n  _proto.getError = function getError(field) {\n    return this.errors[field];\n  };\n\n  _createClass(FiasAddress, [{\n    key: \"isForeign\",\n    get: function get() {\n      return Boolean(this.country && !FiasAddress.IS_RUSSIA(this.country));\n    }\n  }, {\n    key: \"isEmpty\",\n    get: function get() {\n      var _this2 = this;\n\n      return !FiasAddress.MAIN_FIELDS.some(function (field) {\n        return Object.prototype.hasOwnProperty.call(_this2.fields, field);\n      });\n    }\n  }, {\n    key: \"hasErrors\",\n    get: function get() {\n      return Object.keys(this.errors).length > 0;\n    }\n  }, {\n    key: \"postalCode\",\n    get: function get() {\n      var value = this.additionalFields[FiasExtraFields.postalcode];\n      return typeof value === 'string' ? value : this.getFiasPostalCode();\n    }\n  }, {\n    key: \"isPostalCodeValid\",\n    get: function get() {\n      var rusFormat = /^[\\d]{6}$/;\n      var foreignFormat = /^[\\w.\\-\\s]*$/;\n      return (!this.country || this.isForeign ? foreignFormat : rusFormat).test(this.postalCode);\n    }\n  }, {\n    key: \"isPostalCodeAltered\",\n    get: function get() {\n      var fiasPostalCode = this.getFiasPostalCode();\n      return Boolean(fiasPostalCode) && this.postalCode !== fiasPostalCode;\n    }\n  }]);\n\n  return FiasAddress;\n}();\nFiasAddress.MAIN_FIELDS = [FiasFields.region, FiasFields.district, FiasFields.city, FiasFields.intracityarea, FiasFields.settlement, FiasFields.planningstructure, FiasFields.street, FiasFields.stead, FiasFields.house, FiasFields.room];\nFiasAddress.ADDITIONAL_FIELDS = [FiasExtraFields.postalcode];\nFiasAddress.ALL_FIELDS = [].concat(FiasAddress.MAIN_FIELDS, FiasAddress.ADDITIONAL_FIELDS);\nFiasAddress.VERIFIABLE_FIELDS = [FiasFields.region, FiasFields.district, FiasFields.city, FiasFields.intracityarea, FiasFields.settlement, FiasFields.planningstructure, FiasFields.street];\nFiasAddress.FULL_ADDRESS_SEARCH_FIELDS = [FiasFields.district, FiasFields.city, FiasFields.intracityarea, FiasFields.settlement, FiasFields.planningstructure, FiasFields.street];\nFiasAddress.NOT_ONLY_DIRECT_PARENT_SEARCH_FIELDS = [FiasFields.district, FiasFields.city, FiasFields.intracityarea, FiasFields.settlement, FiasFields.planningstructure, FiasFields.street];\n\nFiasAddress.IS_RUSSIA = function (country) {\n  return isEqual(country, {\n    shortName: 'Россия',\n    fullName: 'Российская Федерация',\n    code: '643'\n  });\n};\n\nFiasAddress.responseToFields = function (response) {\n  var fields = {};\n\n  if (response) {\n    FiasAddress.MAIN_FIELDS.forEach(function (field) {\n      var fiasObject = response[field];\n\n      if (fiasObject) {\n        var data = new FiasData(fiasObject);\n        fields[field] = new FiasAddressElement(field, data.name, data);\n      }\n    });\n  }\n\n  return fields;\n};\n\nFiasAddress.fieldsToResponse = function (fields) {\n  var response = {};\n\n  if (fields) {\n    FiasAddress.MAIN_FIELDS.forEach(function (field) {\n      var element = fields[field];\n\n      if (element && element.fiasData) {\n        response[field] = element.fiasData;\n      }\n    });\n  }\n\n  return response;\n};\n\nFiasAddress.createFromResponse = function (response, additionalFields, country) {\n  return new FiasAddress({\n    fields: FiasAddress.responseToFields(response),\n    additionalFields: additionalFields,\n    country: country\n  });\n};\n\nFiasAddress.createFromAddressValue = function (addressValue, additionalFields, country) {\n  var fields = {};\n\n  if (addressValue) {\n    FiasAddress.MAIN_FIELDS.forEach(function (field) {\n      var addressField = addressValue[field];\n\n      if (addressField) {\n        var name = addressField.name,\n            data = addressField.data;\n        fields[field] = new FiasAddressElement(field, name, data && new FiasData(data));\n      }\n    });\n  }\n\n  return new FiasAddress({\n    fields: fields,\n    additionalFields: additionalFields,\n    country: country\n  });\n};\n\nFiasAddress.createFromAddress = function (address, options) {\n  var fields = address.fields,\n      additionalFields = address.additionalFields,\n      errors = address.errors,\n      country = address.country,\n      foreignAddress = address.foreignAddress;\n  return new FiasAddress(_extends({\n    fields: fields,\n    additionalFields: additionalFields,\n    errors: errors,\n    country: country,\n    foreignAddress: foreignAddress\n  }, options));\n};\n\nFiasAddress.validate = function (address, locale) {\n  var fields = address.fields;\n  var errors = {};\n\n  for (var _iterator7 = FiasAddress.MAIN_FIELDS, _isArray7 = Array.isArray(_iterator7), _i7 = 0, _iterator7 = _isArray7 ? _iterator7 : _iterator7[Symbol.iterator]();;) {\n    var _ref8;\n\n    if (_isArray7) {\n      if (_i7 >= _iterator7.length) break;\n      _ref8 = _iterator7[_i7++];\n    } else {\n      _i7 = _iterator7.next();\n      if (_i7.done) break;\n      _ref8 = _i7.value;\n    }\n\n    var field = _ref8;\n    var element = fields[field];\n    var error = '';\n\n    if (element) {\n      if (!element.data) {\n        error = locale.addressNotVerified;\n      }\n\n      if (!address.isAllowedToFill(field)) {\n        error = locale[field + \"FillBefore\"];\n      }\n\n      if (error) {\n        errors[field] = error;\n        break;\n      }\n    }\n  }\n\n  if (Object.keys(errors).length === 0) {\n    if (address.postalCode && !address.isPostalCodeValid) {\n      errors[FiasExtraFields.postalcode] = locale.postalcodeNotValid;\n    } else if (address.isPostalCodeAltered) {\n      errors[FiasExtraFields.postalcode] = locale.postalcodeNotFound;\n    }\n  }\n\n  return FiasAddress.createFromAddress(address, {\n    errors: errors\n  });\n};\n\nFiasAddress.verify = function (address, response) {\n  if (address.isEmpty) {\n    return address;\n  }\n\n  var addressResponse = response.address,\n      invalidLevel = response.invalidLevel;\n  var verifiedAddress = FiasAddress.createFromAddress(address, {\n    fields: _extends({}, address.fields, {}, FiasAddress.responseToFields(addressResponse))\n  });\n  var invalidField = invalidLevel || verifiedAddress.verifyConsistency().invalidLevel;\n\n  if (invalidField) {\n    return FiasAddress.removeFiasData(verifiedAddress, [invalidField].concat(FiasAddress.getChildFields(invalidField)));\n  }\n\n  return verifiedAddress;\n};\n\nFiasAddress.filterVisibleFields = function (fields, fieldsSettings) {\n  var filteredFields = {};\n  var field;\n\n  for (field in fields) {\n    if (FiasAddress.isFieldVisible(field, fieldsSettings)) {\n      filteredFields[field] = fields[field];\n    }\n  }\n\n  return filteredFields;\n};\n\nFiasAddress.isFieldVisible = function (field, fieldsSettings) {\n  var settings = fieldsSettings[field];\n  return Boolean(settings && settings.visible);\n};\n\nFiasAddress.getParentFields = function (field) {\n  var index = FiasAddress.MAIN_FIELDS.indexOf(field);\n  return index > -1 ? FiasAddress.MAIN_FIELDS.slice(0, index) : [];\n};\n\nFiasAddress.getChildFields = function (field) {\n  var index = FiasAddress.MAIN_FIELDS.indexOf(field);\n  return index > -1 ? FiasAddress.MAIN_FIELDS.slice(index + 1) : [];\n};\n\nFiasAddress.removeFiasData = function (address, fields) {\n  if (fields === void 0) {\n    fields = FiasAddress.MAIN_FIELDS;\n  }\n\n  var addressFields = _extends({}, address.fields);\n\n  for (var _iterator8 = fields, _isArray8 = Array.isArray(_iterator8), _i8 = 0, _iterator8 = _isArray8 ? _iterator8 : _iterator8[Symbol.iterator]();;) {\n    var _ref9;\n\n    if (_isArray8) {\n      if (_i8 >= _iterator8.length) break;\n      _ref9 = _iterator8[_i8++];\n    } else {\n      _i8 = _iterator8.next();\n      if (_i8.done) break;\n      _ref9 = _i8.value;\n    }\n\n    var field = _ref9;\n    var element = addressFields[field];\n\n    if (element) {\n      element.removeData();\n    }\n  }\n\n  return FiasAddress.createFromAddress(address, {\n    fields: addressFields\n  });\n};\n\nFiasAddress.getAddress = /*#__PURE__*/function () {\n  var _ref10 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(api, value, fieldsSettings) {\n    var address, addressString, fiasId, postalCode, country, foreignAddress, additionalFields, searchOptions, _additionalFields, addressValue, _ref11, success, data, addressResponse;\n\n    return _regeneratorRuntime.wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            if (value) {\n              _context.next = 2;\n              break;\n            }\n\n            return _context.abrupt(\"return\", new FiasAddress());\n\n          case 2:\n            address = value.address, addressString = value.addressString, fiasId = value.fiasId, postalCode = value.postalCode, country = value.country, foreignAddress = value.foreignAddress;\n            additionalFields = {};\n            searchOptions = {};\n\n            if (postalCode) {\n              additionalFields[FiasExtraFields.postalcode] = postalCode;\n            }\n\n            if (!(country && !FiasAddress.IS_RUSSIA(country))) {\n              _context.next = 8;\n              break;\n            }\n\n            return _context.abrupt(\"return\", new FiasAddress({\n              country: country,\n              foreignAddress: foreignAddress,\n              additionalFields: (_additionalFields = {}, _additionalFields[FiasExtraFields.postalcode] = postalCode, _additionalFields)\n            }));\n\n          case 8:\n            if (!address) {\n              _context.next = 11;\n              break;\n            }\n\n            addressValue = fieldsSettings ? FiasAddress.filterVisibleFields(address, fieldsSettings) : address;\n            return _context.abrupt(\"return\", FiasAddress.createFromAddressValue(addressValue, additionalFields, country));\n\n          case 11:\n            if (fiasId) {\n              searchOptions = {\n                fiasId: fiasId\n              };\n            }\n\n            if (addressString) {\n              searchOptions = {\n                searchText: addressString,\n                limit: 1\n              };\n            }\n\n            if (!api) {\n              _context.next = 22;\n              break;\n            }\n\n            _context.next = 16;\n            return api.search(searchOptions);\n\n          case 16:\n            _ref11 = _context.sent;\n            success = _ref11.success;\n            data = _ref11.data;\n\n            if (!(success && data && data.length)) {\n              _context.next = 22;\n              break;\n            }\n\n            addressResponse = fieldsSettings ? FiasAddress.filterVisibleFields(data[0], fieldsSettings) : data[0];\n            return _context.abrupt(\"return\", FiasAddress.createFromResponse(addressResponse, additionalFields, country));\n\n          case 22:\n            return _context.abrupt(\"return\", new FiasAddress({\n              country: country\n            }));\n\n          case 23:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee);\n  }));\n\n  return function (_x, _x2, _x3) {\n    return _ref10.apply(this, arguments);\n  };\n}();","map":{"version":3,"sources":["C:/Users/ravka/Desktop/react-typescript-task/node_modules/@skbkontur/react-ui/components/Fias/models/FiasAddress/FiasAddress.js"],"names":["_regeneratorRuntime","_asyncToGenerator","_extends","_createClass","isEqual","FiasFields","FiasExtraFields","FiasAddressElement","FiasData","FiasAddress","_temp","_this","_ref","_fields","fields","additionalFields","errors","_country","country","_foreignAddress","foreignAddress","getAddressErrors","getText","minField","skipTypes","connector","isEmpty","getElementText","element","getParentFields","MAIN_FIELDS","map","field","filter","Boolean","join","getFullText","withPostalCode","substrings","push","postalCode","fullName","isForeign","isAllowedToFill","_this$fields","region","city","settlement","house","hasCityOrSettlement","isFederalCity","street","stead","room","isAllowedToSearchFullAddress","FULL_ADDRESS_SEARCH_FIELDS","includes","isAllowedToSearchThroughChildrenOfDirectParent","fieldsSettings","_iterator","_isArray","Array","isArray","_i","Symbol","iterator","_ref2","length","next","done","value","parentField","isFieldVisible","NOT_ONLY_DIRECT_PARENT_SEARCH_FIELDS","hasOnlyIndirectParent","parents","directParent","pop","some","parent","getClosestParentFiasId","slice","reverse","_iterator2","_isArray2","_i2","_ref3","fiasId","getFiasId","_iterator3","_isArray3","_i3","_ref4","getParent","f","closest","verifyConsistency","verifiedFields","_iterator4","_isArray4","_i4","_ref5","data","expectedParentFiasId","parentFiasId","address","fieldsToResponse","isValid","invalidLevel","getFiasPostalCode","_iterator5","_isArray5","_i5","_ref6","getAddressValue","Object","keys","reduce","_extends2","name","fiasData","getValue","addressString","addressErrors","convertForVerification","VERIFIABLE_FIELDS","_extends3","verifiableData","getDiffFields","filterVisibleFields","_iterator6","_isArray6","_i6","_ref7","isEqualTo","_proto","prototype","hasError","hasOwnProperty","call","getError","key","get","IS_RUSSIA","_this2","postalcode","rusFormat","foreignFormat","test","fiasPostalCode","district","intracityarea","planningstructure","ADDITIONAL_FIELDS","ALL_FIELDS","concat","shortName","code","responseToFields","response","forEach","fiasObject","createFromResponse","createFromAddressValue","addressValue","addressField","createFromAddress","options","validate","locale","_iterator7","_isArray7","_i7","_ref8","error","addressNotVerified","isPostalCodeValid","postalcodeNotValid","isPostalCodeAltered","postalcodeNotFound","verify","addressResponse","verifiedAddress","invalidField","removeFiasData","getChildFields","filteredFields","settings","visible","index","indexOf","addressFields","_iterator8","_isArray8","_i8","_ref9","removeData","getAddress","_ref10","mark","_callee","api","searchOptions","_additionalFields","_ref11","success","wrap","_callee$","_context","prev","abrupt","searchText","limit","search","sent","stop","_x","_x2","_x3","apply","arguments"],"mappings":"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","sourcesContent":["import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _extends from \"@babel/runtime/helpers/esm/extends\";\nimport _createClass from \"@babel/runtime/helpers/esm/createClass\";\nimport isEqual from 'lodash.isequal';\nimport { FiasFields, FiasExtraFields } from \"../../types\";\nimport { FiasAddressElement } from \"../FiasAddressElement\";\nimport { FiasData } from \"../FiasData\";\nexport var FiasAddress =\n/*#__PURE__*/\nfunction () {\n  // TODO: Hide invisible fields without removing them.\n  // (removing can break the verification)\n  function FiasAddress(_temp) {\n    var _this = this;\n\n    var _ref = _temp === void 0 ? {} : _temp,\n        _fields = _ref.fields,\n        additionalFields = _ref.additionalFields,\n        errors = _ref.errors,\n        _country = _ref.country,\n        _foreignAddress = _ref.foreignAddress;\n\n    this.fields = void 0;\n    this.additionalFields = void 0;\n    this.errors = void 0;\n    this.country = void 0;\n    this.foreignAddress = void 0;\n\n    this.getAddressErrors = function () {\n      return _extends({}, _this.errors);\n    };\n\n    this.getText = function (minField, skipTypes, connector) {\n      if (skipTypes === void 0) {\n        skipTypes = false;\n      }\n\n      if (connector === void 0) {\n        connector = ', ';\n      }\n\n      if (_this.isEmpty) {\n        return '';\n      }\n\n      var getElementText = function getElementText(element) {\n        return element ? element.getText(skipTypes) : '';\n      };\n\n      var fields = minField ? FiasAddress.getParentFields(minField) : FiasAddress.MAIN_FIELDS;\n      return fields.map(function (field) {\n        return getElementText(_this.fields[field]);\n      }).filter(Boolean).join(connector);\n    };\n\n    this.getFullText = function (withPostalCode) {\n      if (withPostalCode === void 0) {\n        withPostalCode = false;\n      }\n\n      var substrings = [];\n\n      if (withPostalCode) {\n        substrings.push(_this.postalCode);\n      }\n\n      if (_this.country) {\n        substrings.push(_this.country.fullName);\n      }\n\n      substrings.push(_this.isForeign ? _this.foreignAddress : _this.getText());\n      return substrings.filter(Boolean).join(', ');\n    };\n\n    this.isAllowedToFill = function (field) {\n      var _this$fields = _this.fields,\n          region = _this$fields.region,\n          city = _this$fields.city,\n          settlement = _this$fields.settlement,\n          house = _this$fields.house;\n      var hasCityOrSettlement = city || settlement || region && region.isFederalCity;\n\n      if (!hasCityOrSettlement && (field === FiasFields.street || field === FiasFields.stead || field === FiasFields.house) || !house && field === FiasFields.room) {\n        return false;\n      }\n\n      return true;\n    };\n\n    this.isAllowedToSearchFullAddress = function (field) {\n      return FiasAddress.FULL_ADDRESS_SEARCH_FIELDS.includes(field);\n    };\n\n    this.isAllowedToSearchThroughChildrenOfDirectParent = function (field, fieldsSettings) {\n      if (fieldsSettings) {\n        for (var _iterator = FiasAddress.getParentFields(field), _isArray = Array.isArray(_iterator), _i = 0, _iterator = _isArray ? _iterator : _iterator[Symbol.iterator]();;) {\n          var _ref2;\n\n          if (_isArray) {\n            if (_i >= _iterator.length) break;\n            _ref2 = _iterator[_i++];\n          } else {\n            _i = _iterator.next();\n            if (_i.done) break;\n            _ref2 = _i.value;\n          }\n\n          var parentField = _ref2;\n\n          if (!FiasAddress.isFieldVisible(parentField, fieldsSettings)) {\n            return false;\n          }\n        }\n      }\n\n      return FiasAddress.NOT_ONLY_DIRECT_PARENT_SEARCH_FIELDS.includes(field);\n    };\n\n    this.hasOnlyIndirectParent = function (field) {\n      if (field) {\n        var parents = FiasAddress.getParentFields(field);\n\n        if (parents.length > 1) {\n          var directParent = _this.fields[parents.pop()];\n\n          return !directParent && parents.some(function (parent) {\n            return Boolean(_this.fields[parent]);\n          });\n        }\n      }\n\n      return false;\n    };\n\n    this.getClosestParentFiasId = function (field) {\n      if (!_this.isEmpty) {\n        var parents = FiasAddress.getParentFields(field).slice().reverse();\n\n        for (var _iterator2 = parents, _isArray2 = Array.isArray(_iterator2), _i2 = 0, _iterator2 = _isArray2 ? _iterator2 : _iterator2[Symbol.iterator]();;) {\n          var _ref3;\n\n          if (_isArray2) {\n            if (_i2 >= _iterator2.length) break;\n            _ref3 = _iterator2[_i2++];\n          } else {\n            _i2 = _iterator2.next();\n            if (_i2.done) break;\n            _ref3 = _i2.value;\n          }\n\n          var parentField = _ref3;\n          var parent = _this.fields[parentField];\n\n          if (parent) {\n            return parent.fiasId;\n          }\n        }\n      }\n    };\n\n    this.getFiasId = function () {\n      if (!_this.isEmpty) {\n        var fields = FiasAddress.MAIN_FIELDS.slice().reverse();\n\n        for (var _iterator3 = fields, _isArray3 = Array.isArray(_iterator3), _i3 = 0, _iterator3 = _isArray3 ? _iterator3 : _iterator3[Symbol.iterator]();;) {\n          var _ref4;\n\n          if (_isArray3) {\n            if (_i3 >= _iterator3.length) break;\n            _ref4 = _iterator3[_i3++];\n          } else {\n            _i3 = _iterator3.next();\n            if (_i3.done) break;\n            _ref4 = _i3.value;\n          }\n\n          var field = _ref4;\n          var element = _this.fields[field];\n\n          if (element && element.fiasId) {\n            return element.fiasId;\n          }\n        }\n      }\n\n      return '';\n    };\n\n    this.getParent = function (field) {\n      if (_this.fields[field]) {\n        var parents = FiasAddress.getParentFields(field).filter(function (f) {\n          return Boolean(_this.fields[f]);\n        });\n        var closest = parents.pop();\n\n        if (closest) {\n          return _this.fields[closest];\n        }\n      }\n    };\n\n    this.verifyConsistency = function () {\n      var verifiedFields = _extends({}, _this.fields);\n\n      for (var _iterator4 = FiasAddress.MAIN_FIELDS, _isArray4 = Array.isArray(_iterator4), _i4 = 0, _iterator4 = _isArray4 ? _iterator4 : _iterator4[Symbol.iterator]();;) {\n        var _ref5;\n\n        if (_isArray4) {\n          if (_i4 >= _iterator4.length) break;\n          _ref5 = _iterator4[_i4++];\n        } else {\n          _i4 = _iterator4.next();\n          if (_i4.done) break;\n          _ref5 = _i4.value;\n        }\n\n        var field = _ref5;\n        var element = _this.fields[field];\n\n        if (element) {\n          if (element.data) {\n            var expectedParentFiasId = element.data.parentFiasId;\n\n            var parent = _this.getParent(field);\n\n            if (!parent || parent.fiasId === expectedParentFiasId) {\n              verifiedFields[field] = element;\n              continue;\n            }\n          }\n\n          return {\n            address: FiasAddress.fieldsToResponse(verifiedFields),\n            isValid: false,\n            invalidLevel: field\n          };\n        }\n      }\n\n      return {\n        address: FiasAddress.fieldsToResponse(verifiedFields),\n        isValid: true\n      };\n    };\n\n    this.getFiasPostalCode = function () {\n      if (!_this.isEmpty) {\n        var fields = FiasAddress.MAIN_FIELDS.slice().reverse();\n\n        for (var _iterator5 = fields, _isArray5 = Array.isArray(_iterator5), _i5 = 0, _iterator5 = _isArray5 ? _iterator5 : _iterator5[Symbol.iterator]();;) {\n          var _ref6;\n\n          if (_isArray5) {\n            if (_i5 >= _iterator5.length) break;\n            _ref6 = _iterator5[_i5++];\n          } else {\n            _i5 = _iterator5.next();\n            if (_i5.done) break;\n            _ref6 = _i5.value;\n          }\n\n          var field = _ref6;\n          var element = _this.fields[field];\n\n          if (element && element.data && element.data.postalCode) {\n            return element.data.postalCode;\n          }\n        }\n      }\n\n      return '';\n    };\n\n    this.getAddressValue = function () {\n      var fields = Object.keys(_this.fields);\n      return fields.reduce(function (value, field) {\n        var _extends2;\n\n        var element = _this.fields[field];\n\n        if (!element) {\n          return value;\n        }\n\n        var name = element.name,\n            fiasData = element.fiasData;\n        return _extends({}, value, (_extends2 = {}, _extends2[field] = _extends({\n          name: name\n        }, fiasData ? {\n          data: fiasData\n        } : {}), _extends2));\n      }, {});\n    };\n\n    this.getValue = function (withPostalCode) {\n      if (withPostalCode === void 0) {\n        withPostalCode = false;\n      }\n\n      var country = _this.country,\n          foreignAddress = _this.foreignAddress;\n      return _extends({\n        address: _this.getAddressValue(),\n        addressString: _this.getFullText(withPostalCode),\n        addressErrors: _this.getAddressErrors(),\n        fiasId: _this.getFiasId(),\n        postalCode: _this.postalCode\n      }, country ? {\n        country: country\n      } : {}, {}, _this.isForeign ? {\n        foreignAddress: foreignAddress\n      } : {});\n    };\n\n    this.convertForVerification = function () {\n      return FiasAddress.VERIFIABLE_FIELDS.reduce(function (value, field) {\n        var _extends3;\n\n        var element = _this.fields[field];\n\n        if (!element) {\n          return value;\n        }\n\n        return _extends({}, value, (_extends3 = {}, _extends3[field] = _extends({}, element.verifiableData), _extends3));\n      }, {});\n    };\n\n    this.getDiffFields = function (address, fieldsSettings) {\n      var fields = fieldsSettings ? FiasAddress.filterVisibleFields(address.fields, fieldsSettings) : _extends({}, address.fields);\n\n      for (var _iterator6 = FiasAddress.MAIN_FIELDS, _isArray6 = Array.isArray(_iterator6), _i6 = 0, _iterator6 = _isArray6 ? _iterator6 : _iterator6[Symbol.iterator]();;) {\n        var _ref7;\n\n        if (_isArray6) {\n          if (_i6 >= _iterator6.length) break;\n          _ref7 = _iterator6[_i6++];\n        } else {\n          _i6 = _iterator6.next();\n          if (_i6.done) break;\n          _ref7 = _i6.value;\n        }\n\n        var field = _ref7;\n        var element = fields[field];\n\n        if (element) {\n          if (element.isEqualTo(_this.fields[field])) {\n            delete fields[field];\n          } else {\n            break;\n          }\n        }\n      }\n\n      return fields;\n    };\n\n    this.fields = _fields || {};\n    this.additionalFields = additionalFields || {};\n    this.errors = errors || {};\n    this.country = _country;\n    this.foreignAddress = _foreignAddress || '';\n  }\n\n  var _proto = FiasAddress.prototype;\n\n  _proto.hasError = function hasError(field) {\n    return Object.prototype.hasOwnProperty.call(this.errors, field);\n  };\n\n  _proto.getError = function getError(field) {\n    return this.errors[field];\n  };\n\n  _createClass(FiasAddress, [{\n    key: \"isForeign\",\n    get: function get() {\n      return Boolean(this.country && !FiasAddress.IS_RUSSIA(this.country));\n    }\n  }, {\n    key: \"isEmpty\",\n    get: function get() {\n      var _this2 = this;\n\n      return !FiasAddress.MAIN_FIELDS.some(function (field) {\n        return Object.prototype.hasOwnProperty.call(_this2.fields, field);\n      });\n    }\n  }, {\n    key: \"hasErrors\",\n    get: function get() {\n      return Object.keys(this.errors).length > 0;\n    }\n  }, {\n    key: \"postalCode\",\n    get: function get() {\n      var value = this.additionalFields[FiasExtraFields.postalcode];\n      return typeof value === 'string' ? value : this.getFiasPostalCode();\n    }\n  }, {\n    key: \"isPostalCodeValid\",\n    get: function get() {\n      var rusFormat = /^[\\d]{6}$/;\n      var foreignFormat = /^[\\w.\\-\\s]*$/;\n      return (!this.country || this.isForeign ? foreignFormat : rusFormat).test(this.postalCode);\n    }\n  }, {\n    key: \"isPostalCodeAltered\",\n    get: function get() {\n      var fiasPostalCode = this.getFiasPostalCode();\n      return Boolean(fiasPostalCode) && this.postalCode !== fiasPostalCode;\n    }\n  }]);\n\n  return FiasAddress;\n}();\nFiasAddress.MAIN_FIELDS = [FiasFields.region, FiasFields.district, FiasFields.city, FiasFields.intracityarea, FiasFields.settlement, FiasFields.planningstructure, FiasFields.street, FiasFields.stead, FiasFields.house, FiasFields.room];\nFiasAddress.ADDITIONAL_FIELDS = [FiasExtraFields.postalcode];\nFiasAddress.ALL_FIELDS = [].concat(FiasAddress.MAIN_FIELDS, FiasAddress.ADDITIONAL_FIELDS);\nFiasAddress.VERIFIABLE_FIELDS = [FiasFields.region, FiasFields.district, FiasFields.city, FiasFields.intracityarea, FiasFields.settlement, FiasFields.planningstructure, FiasFields.street];\nFiasAddress.FULL_ADDRESS_SEARCH_FIELDS = [FiasFields.district, FiasFields.city, FiasFields.intracityarea, FiasFields.settlement, FiasFields.planningstructure, FiasFields.street];\nFiasAddress.NOT_ONLY_DIRECT_PARENT_SEARCH_FIELDS = [FiasFields.district, FiasFields.city, FiasFields.intracityarea, FiasFields.settlement, FiasFields.planningstructure, FiasFields.street];\n\nFiasAddress.IS_RUSSIA = function (country) {\n  return isEqual(country, {\n    shortName: 'Россия',\n    fullName: 'Российская Федерация',\n    code: '643'\n  });\n};\n\nFiasAddress.responseToFields = function (response) {\n  var fields = {};\n\n  if (response) {\n    FiasAddress.MAIN_FIELDS.forEach(function (field) {\n      var fiasObject = response[field];\n\n      if (fiasObject) {\n        var data = new FiasData(fiasObject);\n        fields[field] = new FiasAddressElement(field, data.name, data);\n      }\n    });\n  }\n\n  return fields;\n};\n\nFiasAddress.fieldsToResponse = function (fields) {\n  var response = {};\n\n  if (fields) {\n    FiasAddress.MAIN_FIELDS.forEach(function (field) {\n      var element = fields[field];\n\n      if (element && element.fiasData) {\n        response[field] = element.fiasData;\n      }\n    });\n  }\n\n  return response;\n};\n\nFiasAddress.createFromResponse = function (response, additionalFields, country) {\n  return new FiasAddress({\n    fields: FiasAddress.responseToFields(response),\n    additionalFields: additionalFields,\n    country: country\n  });\n};\n\nFiasAddress.createFromAddressValue = function (addressValue, additionalFields, country) {\n  var fields = {};\n\n  if (addressValue) {\n    FiasAddress.MAIN_FIELDS.forEach(function (field) {\n      var addressField = addressValue[field];\n\n      if (addressField) {\n        var name = addressField.name,\n            data = addressField.data;\n        fields[field] = new FiasAddressElement(field, name, data && new FiasData(data));\n      }\n    });\n  }\n\n  return new FiasAddress({\n    fields: fields,\n    additionalFields: additionalFields,\n    country: country\n  });\n};\n\nFiasAddress.createFromAddress = function (address, options) {\n  var fields = address.fields,\n      additionalFields = address.additionalFields,\n      errors = address.errors,\n      country = address.country,\n      foreignAddress = address.foreignAddress;\n  return new FiasAddress(_extends({\n    fields: fields,\n    additionalFields: additionalFields,\n    errors: errors,\n    country: country,\n    foreignAddress: foreignAddress\n  }, options));\n};\n\nFiasAddress.validate = function (address, locale) {\n  var fields = address.fields;\n  var errors = {};\n\n  for (var _iterator7 = FiasAddress.MAIN_FIELDS, _isArray7 = Array.isArray(_iterator7), _i7 = 0, _iterator7 = _isArray7 ? _iterator7 : _iterator7[Symbol.iterator]();;) {\n    var _ref8;\n\n    if (_isArray7) {\n      if (_i7 >= _iterator7.length) break;\n      _ref8 = _iterator7[_i7++];\n    } else {\n      _i7 = _iterator7.next();\n      if (_i7.done) break;\n      _ref8 = _i7.value;\n    }\n\n    var field = _ref8;\n    var element = fields[field];\n    var error = '';\n\n    if (element) {\n      if (!element.data) {\n        error = locale.addressNotVerified;\n      }\n\n      if (!address.isAllowedToFill(field)) {\n        error = locale[field + \"FillBefore\"];\n      }\n\n      if (error) {\n        errors[field] = error;\n        break;\n      }\n    }\n  }\n\n  if (Object.keys(errors).length === 0) {\n    if (address.postalCode && !address.isPostalCodeValid) {\n      errors[FiasExtraFields.postalcode] = locale.postalcodeNotValid;\n    } else if (address.isPostalCodeAltered) {\n      errors[FiasExtraFields.postalcode] = locale.postalcodeNotFound;\n    }\n  }\n\n  return FiasAddress.createFromAddress(address, {\n    errors: errors\n  });\n};\n\nFiasAddress.verify = function (address, response) {\n  if (address.isEmpty) {\n    return address;\n  }\n\n  var addressResponse = response.address,\n      invalidLevel = response.invalidLevel;\n  var verifiedAddress = FiasAddress.createFromAddress(address, {\n    fields: _extends({}, address.fields, {}, FiasAddress.responseToFields(addressResponse))\n  });\n  var invalidField = invalidLevel || verifiedAddress.verifyConsistency().invalidLevel;\n\n  if (invalidField) {\n    return FiasAddress.removeFiasData(verifiedAddress, [invalidField].concat(FiasAddress.getChildFields(invalidField)));\n  }\n\n  return verifiedAddress;\n};\n\nFiasAddress.filterVisibleFields = function (fields, fieldsSettings) {\n  var filteredFields = {};\n  var field;\n\n  for (field in fields) {\n    if (FiasAddress.isFieldVisible(field, fieldsSettings)) {\n      filteredFields[field] = fields[field];\n    }\n  }\n\n  return filteredFields;\n};\n\nFiasAddress.isFieldVisible = function (field, fieldsSettings) {\n  var settings = fieldsSettings[field];\n  return Boolean(settings && settings.visible);\n};\n\nFiasAddress.getParentFields = function (field) {\n  var index = FiasAddress.MAIN_FIELDS.indexOf(field);\n  return index > -1 ? FiasAddress.MAIN_FIELDS.slice(0, index) : [];\n};\n\nFiasAddress.getChildFields = function (field) {\n  var index = FiasAddress.MAIN_FIELDS.indexOf(field);\n  return index > -1 ? FiasAddress.MAIN_FIELDS.slice(index + 1) : [];\n};\n\nFiasAddress.removeFiasData = function (address, fields) {\n  if (fields === void 0) {\n    fields = FiasAddress.MAIN_FIELDS;\n  }\n\n  var addressFields = _extends({}, address.fields);\n\n  for (var _iterator8 = fields, _isArray8 = Array.isArray(_iterator8), _i8 = 0, _iterator8 = _isArray8 ? _iterator8 : _iterator8[Symbol.iterator]();;) {\n    var _ref9;\n\n    if (_isArray8) {\n      if (_i8 >= _iterator8.length) break;\n      _ref9 = _iterator8[_i8++];\n    } else {\n      _i8 = _iterator8.next();\n      if (_i8.done) break;\n      _ref9 = _i8.value;\n    }\n\n    var field = _ref9;\n    var element = addressFields[field];\n\n    if (element) {\n      element.removeData();\n    }\n  }\n\n  return FiasAddress.createFromAddress(address, {\n    fields: addressFields\n  });\n};\n\nFiasAddress.getAddress =\n/*#__PURE__*/\nfunction () {\n  var _ref10 = _asyncToGenerator(\n  /*#__PURE__*/\n  _regeneratorRuntime.mark(function _callee(api, value, fieldsSettings) {\n    var address, addressString, fiasId, postalCode, country, foreignAddress, additionalFields, searchOptions, _additionalFields, addressValue, _ref11, success, data, addressResponse;\n\n    return _regeneratorRuntime.wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            if (value) {\n              _context.next = 2;\n              break;\n            }\n\n            return _context.abrupt(\"return\", new FiasAddress());\n\n          case 2:\n            address = value.address, addressString = value.addressString, fiasId = value.fiasId, postalCode = value.postalCode, country = value.country, foreignAddress = value.foreignAddress;\n            additionalFields = {};\n            searchOptions = {};\n\n            if (postalCode) {\n              additionalFields[FiasExtraFields.postalcode] = postalCode;\n            }\n\n            if (!(country && !FiasAddress.IS_RUSSIA(country))) {\n              _context.next = 8;\n              break;\n            }\n\n            return _context.abrupt(\"return\", new FiasAddress({\n              country: country,\n              foreignAddress: foreignAddress,\n              additionalFields: (_additionalFields = {}, _additionalFields[FiasExtraFields.postalcode] = postalCode, _additionalFields)\n            }));\n\n          case 8:\n            if (!address) {\n              _context.next = 11;\n              break;\n            }\n\n            addressValue = fieldsSettings ? FiasAddress.filterVisibleFields(address, fieldsSettings) : address;\n            return _context.abrupt(\"return\", FiasAddress.createFromAddressValue(addressValue, additionalFields, country));\n\n          case 11:\n            if (fiasId) {\n              searchOptions = {\n                fiasId: fiasId\n              };\n            }\n\n            if (addressString) {\n              searchOptions = {\n                searchText: addressString,\n                limit: 1\n              };\n            }\n\n            if (!api) {\n              _context.next = 22;\n              break;\n            }\n\n            _context.next = 16;\n            return api.search(searchOptions);\n\n          case 16:\n            _ref11 = _context.sent;\n            success = _ref11.success;\n            data = _ref11.data;\n\n            if (!(success && data && data.length)) {\n              _context.next = 22;\n              break;\n            }\n\n            addressResponse = fieldsSettings ? FiasAddress.filterVisibleFields(data[0], fieldsSettings) : data[0];\n            return _context.abrupt(\"return\", FiasAddress.createFromResponse(addressResponse, additionalFields, country));\n\n          case 22:\n            return _context.abrupt(\"return\", new FiasAddress({\n              country: country\n            }));\n\n          case 23:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee);\n  }));\n\n  return function (_x, _x2, _x3) {\n    return _ref10.apply(this, arguments);\n  };\n}();"]},"metadata":{},"sourceType":"module"}