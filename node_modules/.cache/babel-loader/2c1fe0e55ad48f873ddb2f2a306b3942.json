{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _createClass from \"@babel/runtime/helpers/esm/createClass\";\nimport _inheritsLoose from \"@babel/runtime/helpers/esm/inheritsLoose\";\n\nvar _dec, _class, _class2, _temp;\n\nimport React from 'react';\nimport { findDOMNode } from 'react-dom';\nimport isEqual from 'lodash.isequal';\nimport cn from 'classnames';\nimport { isKeyArrowHorizontal, isKeyArrowLeft, isKeyArrowRight, isKeyArrowUp, isKeyArrowVertical, isKeyBackspace, isKeyDelete, isKeyEnter, isKeyEscape, isShortcutSelectAll } from \"../../../lib/events/keyboard/identifiers\";\nimport * as LayoutEvents from \"../../../lib/LayoutEvents\";\nimport { Token } from \"../../Token\";\nimport { emptyHandler } from \"../../../lib/utils\";\nimport { ThemeContext } from \"../../../lib/theming/ThemeContext\";\nimport { locale } from \"../../../lib/locale/decorators\";\nimport { MenuItem } from \"../../MenuItem/MenuItem\";\nimport { TokenInputLocaleHelper } from \"../locale\";\nimport { jsStyles } from \"../TokenInput.styles\";\nimport { tokenInputReducer } from \"../TokenInputReducer\";\nimport { TokenInputMenu } from \"../TokenInputMenu\";\nimport { TextWidthHelper } from \"../TextWidthHelper\";\nexport var TokenInputType;\n\n(function (TokenInputType) {\n  TokenInputType[TokenInputType[\"WithReference\"] = 0] = \"WithReference\";\n  TokenInputType[TokenInputType[\"WithoutReference\"] = 1] = \"WithoutReference\";\n  TokenInputType[TokenInputType[\"Combined\"] = 2] = \"Combined\";\n})(TokenInputType || (TokenInputType = {}));\n\nexport var DefaultState = {\n  inputValue: '',\n  autocompleteItems: undefined,\n  activeTokens: [],\n  inFocus: false,\n  loading: false,\n  preventBlur: false,\n  inputValueWidth: 20\n};\n\nvar defaultToKey = function defaultToKey(item) {\n  return item.toString();\n};\n\nvar identity = function identity(item) {\n  return item;\n};\n\nvar defaultRenderToken = function defaultRenderToken(item, _ref) {\n  var isActive = _ref.isActive,\n      onClick = _ref.onClick,\n      onRemove = _ref.onRemove,\n      disabled = _ref.disabled;\n  return React.createElement(Token, {\n    key: item.toString(),\n    isActive: isActive,\n    onClick: onClick,\n    onRemove: onRemove,\n    disabled: disabled\n  }, item);\n};\n\nexport var TokenInput = (_dec = locale('TokenInput', TokenInputLocaleHelper), _dec(_class = (_temp = _class2 = /*#__PURE__*/function (_React$PureComponent) {\n  _inheritsLoose(TokenInput, _React$PureComponent);\n\n  function TokenInput() {\n    var _this;\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _React$PureComponent.call.apply(_React$PureComponent, [this].concat(args)) || this;\n    _this.state = DefaultState;\n    _this.locale = void 0;\n    _this.theme = void 0;\n    _this.input = null;\n    _this.tokensInputMenu = null;\n    _this.textHelper = null;\n    _this.wrapper = null;\n\n    _this.hasValueInItems = function (items, value) {\n      if (typeof value === 'string') {\n        return items.includes(value);\n      } // todo: как то не очень\n\n\n      return items.some(function (item) {\n        return isEqual(item, value);\n      });\n    };\n\n    _this.inputRef = function (node) {\n      return _this.input = node;\n    };\n\n    _this.tokensInputMenuRef = function (node) {\n      return _this.tokensInputMenu = node;\n    };\n\n    _this.textHelperRef = function (node) {\n      return _this.textHelper = node;\n    };\n\n    _this.wrapperRef = function (node) {\n      return _this.wrapper = node;\n    };\n\n    _this.dispatch = function (action, cb) {\n      _this.setState(function (prevState) {\n        return tokenInputReducer(prevState, action);\n      }, cb);\n    };\n\n    _this.handleInputFocus = function (event) {\n      _this.dispatch({\n        type: 'SET_FOCUS_IN'\n      });\n\n      if (_this.props.onFocus) {\n        _this.props.onFocus(event);\n      }\n    };\n\n    _this.handleInputBlur = function (event) {\n      if (_this.isBlurToMenu(event) || _this.state.preventBlur) {\n        event.preventDefault(); // первый focus нужен для предотвращения/уменьшения моргания в других браузерах\n\n        _this.input.focus(); // в firefox не работает без второго focus\n\n\n        process.nextTick(function () {\n          return _this.input.focus();\n        });\n\n        _this.dispatch({\n          type: 'SET_PREVENT_BLUR',\n          payload: false\n        });\n      } else {\n        _this.dispatch({\n          type: 'BLUR'\n        });\n      }\n\n      if (_this.props.onBlur) {\n        _this.props.onBlur(event);\n      }\n    };\n\n    _this.isBlurToMenu = function (event) {\n      if (_this.menuRef) {\n        var menu = findDOMNode(_this.menuRef);\n        var relatedTarget = event.relatedTarget || document.activeElement;\n\n        if (menu && menu.contains(relatedTarget)) {\n          return true;\n        }\n      }\n\n      return false;\n    };\n\n    _this.handleWrapperMouseDown = function (event) {\n      _this.dispatch({\n        type: 'SET_PREVENT_BLUR',\n        payload: true\n      });\n\n      var target = event.target;\n\n      var isClickOnToken = target && _this.wrapper.contains(target) && target !== _this.wrapper && target !== _this.input;\n\n      if (!isClickOnToken) {\n        _this.dispatch({\n          type: 'REMOVE_ALL_ACTIVE_TOKENS'\n        });\n      }\n    };\n\n    _this.handleWrapperMouseUp = function () {\n      _this.dispatch({\n        type: 'SET_PREVENT_BLUR',\n        payload: false\n      });\n    };\n\n    _this.handleCopy = function (event) {\n      if (!_this.state.inFocus || _this.state.activeTokens.length === 0 || _this.isCursorVisible) {\n        return;\n      }\n\n      event.preventDefault(); // упорядочивание токенов по индексу\n\n      var tokens = _this.state.activeTokens.map(function (token) {\n        return _this.props.selectedItems.indexOf(token);\n      }).sort().map(function (index) {\n        return _this.props.selectedItems[index];\n      }).map(function (item) {\n        return _this.props.valueToString(item);\n      });\n\n      event.clipboardData.setData('text/plain', tokens.join(_this.delimiters[0]));\n    };\n\n    _this.handleInputPaste = function (event) {\n      if (_this.type === TokenInputType.WithReference || !event.clipboardData) {\n        return;\n      }\n\n      var paste = event.clipboardData.getData('text');\n      var delimiters = _this.delimiters;\n\n      if (delimiters.some(function (delimiter) {\n        return paste.includes(delimiter);\n      })) {\n        event.preventDefault();\n        event.stopPropagation();\n\n        for (var _iterator = delimiters, _isArray = Array.isArray(_iterator), _i = 0, _iterator = _isArray ? _iterator : _iterator[Symbol.iterator]();;) {\n          var _ref2;\n\n          if (_isArray) {\n            if (_i >= _iterator.length) break;\n            _ref2 = _iterator[_i++];\n          } else {\n            _i = _iterator.next();\n            if (_i.done) break;\n            _ref2 = _i.value;\n          }\n\n          var delimiter = _ref2;\n          paste = paste.split(delimiter).join(delimiters[0]);\n        }\n\n        var tokens = paste.split(delimiters[0]);\n\n        var _items = tokens.map(function (token) {\n          return _this.props.valueToItem(token);\n        }).filter(function (item) {\n          return !_this.hasValueInItems(_this.props.selectedItems, item);\n        });\n\n        var newItems = _this.props.selectedItems.concat(_items);\n\n        _this.props.onValueChange(newItems);\n      }\n    };\n\n    _this.tryGetItems = /*#__PURE__*/function () {\n      var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(query) {\n        var autocompleteItems, autocompleteItemsUnique;\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                if (query === void 0) {\n                  query = '';\n                }\n\n                if (!(_this.props.getItems && (_this.state.inputValue !== '' || !_this.props.hideMenuIfEmptyInputValue))) {\n                  _context.next = 9;\n                  break;\n                }\n\n                _this.dispatch({\n                  type: 'SET_LOADING',\n                  payload: true\n                });\n\n                _context.next = 5;\n                return _this.props.getItems(query);\n\n              case 5:\n                autocompleteItems = _context.sent;\n\n                _this.dispatch({\n                  type: 'SET_LOADING',\n                  payload: false\n                });\n\n                autocompleteItemsUnique = autocompleteItems.filter(function (item) {\n                  return !_this.hasValueInItems(_this.props.selectedItems, item);\n                });\n\n                if (query === '' || _this.state.inputValue !== '') {\n                  _this.dispatch({\n                    type: 'SET_AUTOCOMPLETE_ITEMS',\n                    payload: autocompleteItemsUnique\n                  }, function () {\n                    LayoutEvents.emit();\n\n                    _this.highlightMenuItem();\n                  });\n                }\n\n              case 9:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee);\n      }));\n\n      return function (_x) {\n        return _ref3.apply(this, arguments);\n      };\n    }();\n\n    _this.handleKeyDown = function (event) {\n      if (_this.isCursorVisible) {\n        _this.handleInputKeyDown(event);\n      } else {\n        _this.handleWrapperKeyDown(event);\n      }\n    };\n\n    _this.handleInputKeyDown = function (e) {\n      e.stopPropagation();\n\n      if (_this.type !== TokenInputType.WithReference && (isKeyEnter(e) || _this.delimiters.includes(e.key))) {\n        e.preventDefault();\n        var newValue = _this.state.inputValue;\n\n        if (newValue !== '') {\n          _this.handleAddItem();\n        }\n      }\n\n      switch (true) {\n        case isKeyEnter(e):\n          if (_this.menuRef) {\n            _this.menuRef.enter(e);\n          }\n\n          break;\n\n        case isKeyArrowVertical(e):\n          e.preventDefault();\n\n          if (_this.menuRef) {\n            if (isKeyArrowUp(e)) {\n              _this.menuRef.up();\n            } else {\n              _this.menuRef.down();\n            }\n          }\n\n          break;\n\n        case isKeyEscape(e):\n          _this.input.blur();\n\n          break;\n\n        case isKeyBackspace(e):\n          _this.moveFocusToLastToken();\n\n          break;\n\n        case isKeyArrowLeft(e):\n          if (_this.input.selectionStart === 0) {\n            _this.moveFocusToLastToken();\n          }\n\n          break;\n      }\n    };\n\n    _this.focusInput = function () {\n      process.nextTick(function () {\n        return _this.input.focus();\n      });\n    };\n\n    _this.handleWrapperKeyDown = function (e) {\n      switch (true) {\n        case isKeyBackspace(e):\n        case isKeyDelete(e):\n          {\n            var itemsNew = _this.props.selectedItems.filter(function (item) {\n              return !_this.hasValueInItems(_this.state.activeTokens, item);\n            });\n\n            _this.props.onValueChange(itemsNew);\n\n            _this.dispatch({\n              type: 'REMOVE_ALL_ACTIVE_TOKENS'\n            }, function () {\n              LayoutEvents.emit();\n\n              _this.input.focus();\n            });\n\n            break;\n          }\n\n        case isKeyArrowHorizontal(e):\n          _this.handleWrapperArrows(e);\n\n          break;\n\n        case isKeyEscape(e):\n          _this.wrapper.blur();\n\n          break;\n\n        case isShortcutSelectAll(e):\n          e.preventDefault();\n\n          _this.dispatch({\n            type: 'SET_ACTIVE_TOKENS',\n            payload: _this.props.selectedItems\n          });\n\n          break;\n      }\n    };\n\n    _this.handleWrapperArrows = function (e) {\n      e.preventDefault();\n      var activeTokens = _this.state.activeTokens;\n\n      var activeItemIndex = _this.props.selectedItems.indexOf(activeTokens[0]);\n\n      var newItemIndex = activeItemIndex + (isKeyArrowLeft(e) ? -1 : +1);\n      var isLeftEdge = activeItemIndex === 0 && isKeyArrowLeft(e);\n      var isRightEdge = activeItemIndex === _this.props.selectedItems.length - 1 && isKeyArrowRight(e);\n\n      if (!e.shiftKey && activeTokens.length === 1) {\n        _this.handleWrapperArrowsWithoutShift(isLeftEdge, isRightEdge, newItemIndex);\n      } else {\n        _this.handleWrapperArrowsWithShift(isLeftEdge, isRightEdge, newItemIndex);\n      }\n    };\n\n    _this.handleWrapperArrowsWithoutShift = function (isLeftEdge, isRightEdge, newItemIndex) {\n      if (isRightEdge) {\n        _this.dispatch({\n          type: 'REMOVE_ALL_ACTIVE_TOKENS'\n        }, function () {\n          return _this.input.focus();\n        });\n      } else if (!isLeftEdge) {\n        _this.dispatch({\n          type: 'SET_ACTIVE_TOKENS',\n          payload: [_this.props.selectedItems[newItemIndex]]\n        });\n      }\n    };\n\n    _this.handleWrapperArrowsWithShift = function (isLeftEdge, isRightEdge, newItemIndex) {\n      if (!isLeftEdge && !isRightEdge) {\n        var itemNew = _this.props.selectedItems[newItemIndex];\n        var itemsNew = [itemNew].concat(_this.state.activeTokens.filter(function (item) {\n          return !isEqual(item, itemNew);\n        }));\n\n        _this.dispatch({\n          type: 'SET_ACTIVE_TOKENS',\n          payload: itemsNew\n        });\n      }\n    };\n\n    _this.handleValueChange = function (item) {\n      if (_this.hasValueInItems(_this.props.selectedItems, item)) {\n        return;\n      }\n\n      var newItems = _this.props.selectedItems.concat([item]);\n\n      _this.props.onValueChange(newItems);\n\n      _this.dispatch({\n        type: 'CLEAR_INPUT'\n      });\n\n      _this.tryGetItems();\n    };\n\n    _this.handleAddItem = function () {\n      var item = _this.state.inputValue;\n\n      var value = _this.props.valueToItem(item);\n\n      if (_this.hasValueInItems(_this.props.selectedItems, value)) {\n        return;\n      }\n\n      var newItems = _this.props.selectedItems.concat([value]);\n\n      _this.props.onValueChange(newItems);\n\n      _this.dispatch({\n        type: 'CLEAR_INPUT'\n      });\n\n      _this.tryGetItems();\n    };\n\n    _this.handleRemoveToken = function (item) {\n      _this.props.onValueChange(_this.props.selectedItems.filter(function (_) {\n        return !isEqual(_, item);\n      }));\n\n      var filteredActiveTokens = _this.state.activeTokens.filter(function (_) {\n        return !isEqual(_, item);\n      });\n\n      _this.dispatch({\n        type: 'SET_ACTIVE_TOKENS',\n        payload: filteredActiveTokens\n      });\n\n      if (filteredActiveTokens.length === 0) {\n        _this.focusInput();\n      }\n\n      _this.tryGetItems();\n    };\n\n    _this.handleTokenClick = function (event, itemNew) {\n      var items = _this.state.activeTokens;\n\n      if (event.ctrlKey) {\n        var newItems = _this.hasValueInItems(_this.state.activeTokens, itemNew) ? items.filter(function (item) {\n          return !isEqual(item, itemNew);\n        }) : [].concat(items, [itemNew]);\n\n        _this.dispatch({\n          type: 'SET_ACTIVE_TOKENS',\n          payload: newItems\n        });\n      } else {\n        _this.dispatch({\n          type: 'SET_ACTIVE_TOKENS',\n          payload: [itemNew]\n        });\n      }\n\n      _this.focusInput();\n    };\n\n    _this.handleChangeInputValue = function (event) {\n      var query = event.target.value.trimLeft();\n\n      if (query.endsWith(' ')) {\n        query = query.trimRight() + ' ';\n      }\n\n      if (_this.state.inputValue !== '' && query === '') {\n        _this.dispatch({\n          type: 'SET_AUTOCOMPLETE_ITEMS',\n          payload: undefined\n        });\n      }\n\n      _this.dispatch({\n        type: 'UPDATE_QUERY',\n        payload: query\n      }, function () {\n        _this.tryGetItems(query);\n      });\n\n      if (_this.props.onInputValueChange) {\n        _this.props.onInputValueChange(query);\n      }\n    };\n\n    _this.highlightMenuItem = function () {\n      if (_this.menuRef && _this.state.autocompleteItems && _this.state.autocompleteItems.length > 0 && _this.type !== TokenInputType.Combined) {\n        _this.menuRef.highlightItem(0);\n      }\n    };\n\n    _this.renderTokenFields = function () {\n      return _this.props.selectedItems.map(_this.renderToken);\n    };\n\n    _this.renderToken = function (item) {\n      var _this$props = _this.props,\n          _this$props$renderTok = _this$props.renderToken,\n          renderToken = _this$props$renderTok === void 0 ? defaultRenderToken : _this$props$renderTok,\n          disabled = _this$props.disabled;\n\n      var isActive = _this.state.activeTokens.includes(item); // TODO useCallback\n\n\n      var handleIconClick = function handleIconClick(event) {\n        event.stopPropagation();\n\n        _this.handleRemoveToken(item);\n      }; // TODO useCallback\n\n\n      var handleTokenClick = function handleTokenClick(event) {\n        event.stopPropagation();\n\n        _this.handleTokenClick(event, item);\n      };\n\n      return renderToken(item, {\n        isActive: isActive,\n        onClick: handleTokenClick,\n        onRemove: handleIconClick,\n        disabled: disabled\n      });\n    };\n\n    _this.renderAddButton = function (value) {\n      if (value === void 0) {\n        value = _this.state.inputValue;\n      }\n\n      if (!_this.showAddItemHint) {\n        return;\n      }\n\n      if (_this.props.renderAddButton) {\n        return _this.props.renderAddButton(value, _this.handleAddItem);\n      }\n\n      var _this$locale = _this.locale,\n          addButtonComment = _this$locale.addButtonComment,\n          addButtonTitle = _this$locale.addButtonTitle;\n      return React.createElement(MenuItem, {\n        onClick: _this.handleAddItem,\n        comment: addButtonComment,\n        key: \"renderAddButton\"\n      }, addButtonTitle, \" \", value);\n    };\n\n    return _this;\n  }\n\n  var _proto = TokenInput.prototype;\n\n  _proto.componentDidMount = function componentDidMount() {\n    this.updateInputTextWidth();\n    document.addEventListener('copy', this.handleCopy);\n\n    if (this.props.autoFocus) {\n      this.focusInput();\n    }\n  };\n\n  _proto.componentDidUpdate = function componentDidUpdate(prevProps, prevState) {\n    if (prevState.inputValue !== this.state.inputValue) {\n      this.updateInputTextWidth();\n    }\n\n    if (prevState.activeTokens.length === 0 && this.state.activeTokens.length > 0) {\n      this.dispatch({\n        type: 'SET_AUTOCOMPLETE_ITEMS',\n        payload: undefined\n      });\n    }\n\n    if (prevProps.selectedItems.length !== this.props.selectedItems.length) {\n      LayoutEvents.emit();\n    }\n\n    if (!this.isCursorVisibleForState(prevState) && this.isCursorVisible) {\n      this.tryGetItems(this.state.inputValue);\n    }\n  };\n\n  _proto.componentWillUnmount = function componentWillUnmount() {\n    document.removeEventListener('copy', this.handleCopy);\n  };\n\n  _proto.render = function render() {\n    var _this2 = this;\n\n    return React.createElement(ThemeContext.Consumer, null, function (theme) {\n      _this2.theme = theme;\n      return _this2.renderMain();\n    });\n  };\n\n  _proto.renderMain = function renderMain() {\n    var _cn, _cn2;\n\n    if (this.type !== TokenInputType.WithoutReference && !this.props.getItems) {\n      throw Error('Missed getItems for type ' + this.type);\n    }\n\n    var _this$props2 = this.props,\n        selectedItems = _this$props2.selectedItems,\n        width = _this$props2.width,\n        maxMenuHeight = _this$props2.maxMenuHeight,\n        error = _this$props2.error,\n        warning = _this$props2.warning,\n        disabled = _this$props2.disabled,\n        placeholder = _this$props2.placeholder,\n        renderItem = _this$props2.renderItem,\n        renderNotFound = _this$props2.renderNotFound,\n        hideMenuIfEmptyInputValue = _this$props2.hideMenuIfEmptyInputValue,\n        onMouseEnter = _this$props2.onMouseEnter,\n        onMouseLeave = _this$props2.onMouseLeave;\n    var _this$state = this.state,\n        activeTokens = _this$state.activeTokens,\n        inFocus = _this$state.inFocus,\n        inputValueWidth = _this$state.inputValueWidth,\n        inputValue = _this$state.inputValue,\n        autocompleteItems = _this$state.autocompleteItems,\n        loading = _this$state.loading;\n    var showMenu = this.type !== TokenInputType.WithoutReference && this.isCursorVisible && activeTokens.length === 0 && (inputValue !== '' || !hideMenuIfEmptyInputValue);\n    var inputInlineStyles = {\n      // вычисляем ширину чтобы input автоматически перенёсся на следующую строку при необходимости\n      width: Math.max(50, inputValueWidth + 7),\n      // input растягивается на всю ширину чтобы placeholder не обрезался\n      flex: selectedItems && selectedItems.length === 0 ? 1 : undefined,\n      // в ie не работает, но альтернативный способ --- дать tabindex для label --- предположительно ещё сложнее\n      caretColor: this.isCursorVisible ? undefined : 'transparent'\n    };\n    var theme = this.theme;\n    var labelClassName = cn(jsStyles.label(theme), (_cn = {}, _cn[jsStyles.labelFocused(theme)] = !!inFocus, _cn[jsStyles.error(theme)] = !!error, _cn[jsStyles.warning(theme)] = !!warning, _cn[jsStyles.labelDisabled(theme)] = !!disabled, _cn));\n    var inputClassName = cn(jsStyles.input(theme), (_cn2 = {}, _cn2[jsStyles.inputDisabled(theme)] = !!disabled, _cn2));\n    return React.createElement(\"div\", {\n      onMouseEnter: onMouseEnter,\n      onMouseLeave: onMouseLeave\n    }, React.createElement(TextWidthHelper, {\n      ref: this.textHelperRef,\n      text: inputValue\n    }), React.createElement(\"label\", {\n      ref: this.wrapperRef,\n      style: {\n        width: width\n      },\n      className: labelClassName,\n      onMouseDown: this.handleWrapperMouseDown,\n      onMouseUp: this.handleWrapperMouseUp\n    }, this.renderTokenFields(), React.createElement(\"input\", {\n      type: \"text\",\n      ref: this.inputRef,\n      value: inputValue,\n      style: inputInlineStyles,\n      autoComplete: \"off\",\n      spellCheck: false,\n      disabled: disabled,\n      className: inputClassName,\n      placeholder: selectedItems.length > 0 ? undefined : placeholder,\n      onFocus: this.handleInputFocus,\n      onBlur: this.handleInputBlur,\n      onChange: this.handleChangeInputValue,\n      onKeyDown: this.handleKeyDown,\n      onPaste: this.handleInputPaste\n    }), showMenu && React.createElement(TokenInputMenu, {\n      ref: this.tokensInputMenuRef,\n      items: autocompleteItems,\n      loading: loading,\n      opened: showMenu,\n      maxMenuHeight: maxMenuHeight,\n      anchorElement: this.input,\n      renderNotFound: renderNotFound,\n      renderItem: renderItem,\n      onValueChange: this.handleValueChange,\n      renderAddButton: this.renderAddButton\n    })));\n  }\n  /**\r\n   * Сбрасывает введенное пользователем значение\r\n   * @public\r\n   */\n  ;\n\n  _proto.reset = function reset() {\n    this.dispatch({\n      type: 'RESET'\n    });\n  };\n\n  _proto.isCursorVisibleForState = function isCursorVisibleForState(state) {\n    return state.inFocus && (state.inputValue !== '' || state.activeTokens.length === 0);\n  };\n\n  _proto.updateInputTextWidth = function updateInputTextWidth() {\n    if (this.textHelper) {\n      var inputValueWidth = this.textHelper.getTextWidth();\n      this.dispatch({\n        type: 'SET_INPUT_VALUE_WIDTH',\n        payload: inputValueWidth\n      }, LayoutEvents.emit);\n    }\n  };\n\n  _proto.moveFocusToLastToken = function moveFocusToLastToken() {\n    var items = this.props.selectedItems;\n\n    if (this.state.inputValue === '' && items && items.length > 0) {\n      this.dispatch({\n        type: 'SET_ACTIVE_TOKENS',\n        payload: items.slice(-1)\n      });\n    }\n  };\n\n  _createClass(TokenInput, [{\n    key: \"showAddItemHint\",\n    get: function get() {\n      var items = this.state.autocompleteItems;\n      var value = this.props.valueToItem(this.state.inputValue);\n\n      if (items && this.hasValueInItems(items, value)) {\n        return false;\n      }\n\n      var selectedItems = this.props.selectedItems;\n\n      if (selectedItems && this.hasValueInItems(selectedItems, value)) {\n        return false;\n      }\n\n      if (this.type === TokenInputType.Combined && this.state.inputValue !== '') {\n        return true;\n      }\n    }\n  }, {\n    key: \"type\",\n    get: function get() {\n      return this.props.type ? this.props.type : TokenInputType.WithReference;\n    }\n  }, {\n    key: \"delimiters\",\n    get: function get() {\n      return this.props.delimiters ? this.props.delimiters : [','];\n    }\n  }, {\n    key: \"menuRef\",\n    get: function get() {\n      return this.tokensInputMenu && this.tokensInputMenu.getMenuRef();\n    }\n  }, {\n    key: \"isCursorVisible\",\n    get: function get() {\n      return this.isCursorVisibleForState(this.state);\n    }\n  }]);\n\n  return TokenInput;\n}(React.PureComponent), _class2.__KONTUR_REACT_UI__ = 'TokenInput', _class2.defaultProps = {\n  selectedItems: [],\n  renderItem: identity,\n  renderValue: identity,\n  valueToString: identity,\n  valueToItem: function valueToItem(item) {\n    return item;\n  },\n  toKey: defaultToKey,\n  onValueChange: function onValueChange() {\n    return void 0;\n  },\n  width: 250,\n  onBlur: emptyHandler,\n  onFocus: emptyHandler,\n  onMouseEnter: emptyHandler,\n  onMouseLeave: emptyHandler\n}, _temp)) || _class);","map":{"version":3,"sources":["C:/Users/ravka/Desktop/react-typescript-task/node_modules/@skbkontur/react-ui/components/TokenInput/TokenInput/TokenInput.js"],"names":["_regeneratorRuntime","_asyncToGenerator","_createClass","_inheritsLoose","_dec","_class","_class2","_temp","React","findDOMNode","isEqual","cn","isKeyArrowHorizontal","isKeyArrowLeft","isKeyArrowRight","isKeyArrowUp","isKeyArrowVertical","isKeyBackspace","isKeyDelete","isKeyEnter","isKeyEscape","isShortcutSelectAll","LayoutEvents","Token","emptyHandler","ThemeContext","locale","MenuItem","TokenInputLocaleHelper","jsStyles","tokenInputReducer","TokenInputMenu","TextWidthHelper","TokenInputType","DefaultState","inputValue","autocompleteItems","undefined","activeTokens","inFocus","loading","preventBlur","inputValueWidth","defaultToKey","item","toString","identity","defaultRenderToken","_ref","isActive","onClick","onRemove","disabled","createElement","key","TokenInput","_React$PureComponent","_this","_len","arguments","length","args","Array","_key","call","apply","concat","state","theme","input","tokensInputMenu","textHelper","wrapper","hasValueInItems","items","value","includes","some","inputRef","node","tokensInputMenuRef","textHelperRef","wrapperRef","dispatch","action","cb","setState","prevState","handleInputFocus","event","type","props","onFocus","handleInputBlur","isBlurToMenu","preventDefault","focus","process","nextTick","payload","onBlur","menuRef","menu","relatedTarget","document","activeElement","contains","handleWrapperMouseDown","target","isClickOnToken","handleWrapperMouseUp","handleCopy","isCursorVisible","tokens","map","token","selectedItems","indexOf","sort","index","valueToString","clipboardData","setData","join","delimiters","handleInputPaste","WithReference","paste","getData","delimiter","stopPropagation","_iterator","_isArray","isArray","_i","Symbol","iterator","_ref2","next","done","split","_items","valueToItem","filter","newItems","onValueChange","tryGetItems","_ref3","mark","_callee","query","autocompleteItemsUnique","wrap","_callee$","_context","prev","getItems","hideMenuIfEmptyInputValue","sent","emit","highlightMenuItem","stop","_x","handleKeyDown","handleInputKeyDown","handleWrapperKeyDown","e","newValue","handleAddItem","enter","up","down","blur","moveFocusToLastToken","selectionStart","focusInput","itemsNew","handleWrapperArrows","activeItemIndex","newItemIndex","isLeftEdge","isRightEdge","shiftKey","handleWrapperArrowsWithoutShift","handleWrapperArrowsWithShift","itemNew","handleValueChange","handleRemoveToken","_","filteredActiveTokens","handleTokenClick","ctrlKey","handleChangeInputValue","trimLeft","endsWith","trimRight","onInputValueChange","Combined","highlightItem","renderTokenFields","renderToken","_this$props","_this$props$renderTok","handleIconClick","renderAddButton","showAddItemHint","_this$locale","addButtonComment","addButtonTitle","comment","_proto","prototype","componentDidMount","updateInputTextWidth","addEventListener","autoFocus","componentDidUpdate","prevProps","isCursorVisibleForState","componentWillUnmount","removeEventListener","render","_this2","Consumer","renderMain","_cn","_cn2","WithoutReference","Error","_this$props2","width","maxMenuHeight","error","warning","placeholder","renderItem","renderNotFound","onMouseEnter","onMouseLeave","_this$state","showMenu","inputInlineStyles","Math","max","flex","caretColor","labelClassName","label","labelFocused","labelDisabled","inputClassName","inputDisabled","ref","text","style","className","onMouseDown","onMouseUp","autoComplete","spellCheck","onChange","onKeyDown","onPaste","opened","anchorElement","reset","getTextWidth","slice","get","getMenuRef","PureComponent","__KONTUR_REACT_UI__","defaultProps","renderValue","toKey"],"mappings":"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","sourcesContent":["import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _createClass from \"@babel/runtime/helpers/esm/createClass\";\nimport _inheritsLoose from \"@babel/runtime/helpers/esm/inheritsLoose\";\n\nvar _dec, _class, _class2, _temp;\n\nimport React from 'react';\nimport { findDOMNode } from 'react-dom';\nimport isEqual from 'lodash.isequal';\nimport cn from 'classnames';\nimport { isKeyArrowHorizontal, isKeyArrowLeft, isKeyArrowRight, isKeyArrowUp, isKeyArrowVertical, isKeyBackspace, isKeyDelete, isKeyEnter, isKeyEscape, isShortcutSelectAll } from \"../../../lib/events/keyboard/identifiers\";\nimport * as LayoutEvents from \"../../../lib/LayoutEvents\";\nimport { Token } from \"../../Token\";\nimport { emptyHandler } from \"../../../lib/utils\";\nimport { ThemeContext } from \"../../../lib/theming/ThemeContext\";\nimport { locale } from \"../../../lib/locale/decorators\";\nimport { MenuItem } from \"../../MenuItem/MenuItem\";\nimport { TokenInputLocaleHelper } from \"../locale\";\nimport { jsStyles } from \"../TokenInput.styles\";\nimport { tokenInputReducer } from \"../TokenInputReducer\";\nimport { TokenInputMenu } from \"../TokenInputMenu\";\nimport { TextWidthHelper } from \"../TextWidthHelper\";\nexport var TokenInputType;\n\n(function (TokenInputType) {\n  TokenInputType[TokenInputType[\"WithReference\"] = 0] = \"WithReference\";\n  TokenInputType[TokenInputType[\"WithoutReference\"] = 1] = \"WithoutReference\";\n  TokenInputType[TokenInputType[\"Combined\"] = 2] = \"Combined\";\n})(TokenInputType || (TokenInputType = {}));\n\nexport var DefaultState = {\n  inputValue: '',\n  autocompleteItems: undefined,\n  activeTokens: [],\n  inFocus: false,\n  loading: false,\n  preventBlur: false,\n  inputValueWidth: 20\n};\n\nvar defaultToKey = function defaultToKey(item) {\n  return item.toString();\n};\n\nvar identity = function identity(item) {\n  return item;\n};\n\nvar defaultRenderToken = function defaultRenderToken(item, _ref) {\n  var isActive = _ref.isActive,\n      onClick = _ref.onClick,\n      onRemove = _ref.onRemove,\n      disabled = _ref.disabled;\n  return React.createElement(Token, {\n    key: item.toString(),\n    isActive: isActive,\n    onClick: onClick,\n    onRemove: onRemove,\n    disabled: disabled\n  }, item);\n};\n\nexport var TokenInput = (_dec = locale('TokenInput', TokenInputLocaleHelper), _dec(_class = (_temp = _class2 =\n/*#__PURE__*/\nfunction (_React$PureComponent) {\n  _inheritsLoose(TokenInput, _React$PureComponent);\n\n  function TokenInput() {\n    var _this;\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _React$PureComponent.call.apply(_React$PureComponent, [this].concat(args)) || this;\n    _this.state = DefaultState;\n    _this.locale = void 0;\n    _this.theme = void 0;\n    _this.input = null;\n    _this.tokensInputMenu = null;\n    _this.textHelper = null;\n    _this.wrapper = null;\n\n    _this.hasValueInItems = function (items, value) {\n      if (typeof value === 'string') {\n        return items.includes(value);\n      } // todo: как то не очень\n\n\n      return items.some(function (item) {\n        return isEqual(item, value);\n      });\n    };\n\n    _this.inputRef = function (node) {\n      return _this.input = node;\n    };\n\n    _this.tokensInputMenuRef = function (node) {\n      return _this.tokensInputMenu = node;\n    };\n\n    _this.textHelperRef = function (node) {\n      return _this.textHelper = node;\n    };\n\n    _this.wrapperRef = function (node) {\n      return _this.wrapper = node;\n    };\n\n    _this.dispatch = function (action, cb) {\n      _this.setState(function (prevState) {\n        return tokenInputReducer(prevState, action);\n      }, cb);\n    };\n\n    _this.handleInputFocus = function (event) {\n      _this.dispatch({\n        type: 'SET_FOCUS_IN'\n      });\n\n      if (_this.props.onFocus) {\n        _this.props.onFocus(event);\n      }\n    };\n\n    _this.handleInputBlur = function (event) {\n      if (_this.isBlurToMenu(event) || _this.state.preventBlur) {\n        event.preventDefault(); // первый focus нужен для предотвращения/уменьшения моргания в других браузерах\n\n        _this.input.focus(); // в firefox не работает без второго focus\n\n\n        process.nextTick(function () {\n          return _this.input.focus();\n        });\n\n        _this.dispatch({\n          type: 'SET_PREVENT_BLUR',\n          payload: false\n        });\n      } else {\n        _this.dispatch({\n          type: 'BLUR'\n        });\n      }\n\n      if (_this.props.onBlur) {\n        _this.props.onBlur(event);\n      }\n    };\n\n    _this.isBlurToMenu = function (event) {\n      if (_this.menuRef) {\n        var menu = findDOMNode(_this.menuRef);\n        var relatedTarget = event.relatedTarget || document.activeElement;\n\n        if (menu && menu.contains(relatedTarget)) {\n          return true;\n        }\n      }\n\n      return false;\n    };\n\n    _this.handleWrapperMouseDown = function (event) {\n      _this.dispatch({\n        type: 'SET_PREVENT_BLUR',\n        payload: true\n      });\n\n      var target = event.target;\n\n      var isClickOnToken = target && _this.wrapper.contains(target) && target !== _this.wrapper && target !== _this.input;\n\n      if (!isClickOnToken) {\n        _this.dispatch({\n          type: 'REMOVE_ALL_ACTIVE_TOKENS'\n        });\n      }\n    };\n\n    _this.handleWrapperMouseUp = function () {\n      _this.dispatch({\n        type: 'SET_PREVENT_BLUR',\n        payload: false\n      });\n    };\n\n    _this.handleCopy = function (event) {\n      if (!_this.state.inFocus || _this.state.activeTokens.length === 0 || _this.isCursorVisible) {\n        return;\n      }\n\n      event.preventDefault(); // упорядочивание токенов по индексу\n\n      var tokens = _this.state.activeTokens.map(function (token) {\n        return _this.props.selectedItems.indexOf(token);\n      }).sort().map(function (index) {\n        return _this.props.selectedItems[index];\n      }).map(function (item) {\n        return _this.props.valueToString(item);\n      });\n\n      event.clipboardData.setData('text/plain', tokens.join(_this.delimiters[0]));\n    };\n\n    _this.handleInputPaste = function (event) {\n      if (_this.type === TokenInputType.WithReference || !event.clipboardData) {\n        return;\n      }\n\n      var paste = event.clipboardData.getData('text');\n      var delimiters = _this.delimiters;\n\n      if (delimiters.some(function (delimiter) {\n        return paste.includes(delimiter);\n      })) {\n        event.preventDefault();\n        event.stopPropagation();\n\n        for (var _iterator = delimiters, _isArray = Array.isArray(_iterator), _i = 0, _iterator = _isArray ? _iterator : _iterator[Symbol.iterator]();;) {\n          var _ref2;\n\n          if (_isArray) {\n            if (_i >= _iterator.length) break;\n            _ref2 = _iterator[_i++];\n          } else {\n            _i = _iterator.next();\n            if (_i.done) break;\n            _ref2 = _i.value;\n          }\n\n          var delimiter = _ref2;\n          paste = paste.split(delimiter).join(delimiters[0]);\n        }\n\n        var tokens = paste.split(delimiters[0]);\n\n        var _items = tokens.map(function (token) {\n          return _this.props.valueToItem(token);\n        }).filter(function (item) {\n          return !_this.hasValueInItems(_this.props.selectedItems, item);\n        });\n\n        var newItems = _this.props.selectedItems.concat(_items);\n\n        _this.props.onValueChange(newItems);\n      }\n    };\n\n    _this.tryGetItems =\n    /*#__PURE__*/\n    function () {\n      var _ref3 = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee(query) {\n        var autocompleteItems, autocompleteItemsUnique;\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                if (query === void 0) {\n                  query = '';\n                }\n\n                if (!(_this.props.getItems && (_this.state.inputValue !== '' || !_this.props.hideMenuIfEmptyInputValue))) {\n                  _context.next = 9;\n                  break;\n                }\n\n                _this.dispatch({\n                  type: 'SET_LOADING',\n                  payload: true\n                });\n\n                _context.next = 5;\n                return _this.props.getItems(query);\n\n              case 5:\n                autocompleteItems = _context.sent;\n\n                _this.dispatch({\n                  type: 'SET_LOADING',\n                  payload: false\n                });\n\n                autocompleteItemsUnique = autocompleteItems.filter(function (item) {\n                  return !_this.hasValueInItems(_this.props.selectedItems, item);\n                });\n\n                if (query === '' || _this.state.inputValue !== '') {\n                  _this.dispatch({\n                    type: 'SET_AUTOCOMPLETE_ITEMS',\n                    payload: autocompleteItemsUnique\n                  }, function () {\n                    LayoutEvents.emit();\n\n                    _this.highlightMenuItem();\n                  });\n                }\n\n              case 9:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee);\n      }));\n\n      return function (_x) {\n        return _ref3.apply(this, arguments);\n      };\n    }();\n\n    _this.handleKeyDown = function (event) {\n      if (_this.isCursorVisible) {\n        _this.handleInputKeyDown(event);\n      } else {\n        _this.handleWrapperKeyDown(event);\n      }\n    };\n\n    _this.handleInputKeyDown = function (e) {\n      e.stopPropagation();\n\n      if (_this.type !== TokenInputType.WithReference && (isKeyEnter(e) || _this.delimiters.includes(e.key))) {\n        e.preventDefault();\n        var newValue = _this.state.inputValue;\n\n        if (newValue !== '') {\n          _this.handleAddItem();\n        }\n      }\n\n      switch (true) {\n        case isKeyEnter(e):\n          if (_this.menuRef) {\n            _this.menuRef.enter(e);\n          }\n\n          break;\n\n        case isKeyArrowVertical(e):\n          e.preventDefault();\n\n          if (_this.menuRef) {\n            if (isKeyArrowUp(e)) {\n              _this.menuRef.up();\n            } else {\n              _this.menuRef.down();\n            }\n          }\n\n          break;\n\n        case isKeyEscape(e):\n          _this.input.blur();\n\n          break;\n\n        case isKeyBackspace(e):\n          _this.moveFocusToLastToken();\n\n          break;\n\n        case isKeyArrowLeft(e):\n          if (_this.input.selectionStart === 0) {\n            _this.moveFocusToLastToken();\n          }\n\n          break;\n      }\n    };\n\n    _this.focusInput = function () {\n      process.nextTick(function () {\n        return _this.input.focus();\n      });\n    };\n\n    _this.handleWrapperKeyDown = function (e) {\n      switch (true) {\n        case isKeyBackspace(e):\n        case isKeyDelete(e):\n          {\n            var itemsNew = _this.props.selectedItems.filter(function (item) {\n              return !_this.hasValueInItems(_this.state.activeTokens, item);\n            });\n\n            _this.props.onValueChange(itemsNew);\n\n            _this.dispatch({\n              type: 'REMOVE_ALL_ACTIVE_TOKENS'\n            }, function () {\n              LayoutEvents.emit();\n\n              _this.input.focus();\n            });\n\n            break;\n          }\n\n        case isKeyArrowHorizontal(e):\n          _this.handleWrapperArrows(e);\n\n          break;\n\n        case isKeyEscape(e):\n          _this.wrapper.blur();\n\n          break;\n\n        case isShortcutSelectAll(e):\n          e.preventDefault();\n\n          _this.dispatch({\n            type: 'SET_ACTIVE_TOKENS',\n            payload: _this.props.selectedItems\n          });\n\n          break;\n      }\n    };\n\n    _this.handleWrapperArrows = function (e) {\n      e.preventDefault();\n      var activeTokens = _this.state.activeTokens;\n\n      var activeItemIndex = _this.props.selectedItems.indexOf(activeTokens[0]);\n\n      var newItemIndex = activeItemIndex + (isKeyArrowLeft(e) ? -1 : +1);\n      var isLeftEdge = activeItemIndex === 0 && isKeyArrowLeft(e);\n      var isRightEdge = activeItemIndex === _this.props.selectedItems.length - 1 && isKeyArrowRight(e);\n\n      if (!e.shiftKey && activeTokens.length === 1) {\n        _this.handleWrapperArrowsWithoutShift(isLeftEdge, isRightEdge, newItemIndex);\n      } else {\n        _this.handleWrapperArrowsWithShift(isLeftEdge, isRightEdge, newItemIndex);\n      }\n    };\n\n    _this.handleWrapperArrowsWithoutShift = function (isLeftEdge, isRightEdge, newItemIndex) {\n      if (isRightEdge) {\n        _this.dispatch({\n          type: 'REMOVE_ALL_ACTIVE_TOKENS'\n        }, function () {\n          return _this.input.focus();\n        });\n      } else if (!isLeftEdge) {\n        _this.dispatch({\n          type: 'SET_ACTIVE_TOKENS',\n          payload: [_this.props.selectedItems[newItemIndex]]\n        });\n      }\n    };\n\n    _this.handleWrapperArrowsWithShift = function (isLeftEdge, isRightEdge, newItemIndex) {\n      if (!isLeftEdge && !isRightEdge) {\n        var itemNew = _this.props.selectedItems[newItemIndex];\n        var itemsNew = [itemNew].concat(_this.state.activeTokens.filter(function (item) {\n          return !isEqual(item, itemNew);\n        }));\n\n        _this.dispatch({\n          type: 'SET_ACTIVE_TOKENS',\n          payload: itemsNew\n        });\n      }\n    };\n\n    _this.handleValueChange = function (item) {\n      if (_this.hasValueInItems(_this.props.selectedItems, item)) {\n        return;\n      }\n\n      var newItems = _this.props.selectedItems.concat([item]);\n\n      _this.props.onValueChange(newItems);\n\n      _this.dispatch({\n        type: 'CLEAR_INPUT'\n      });\n\n      _this.tryGetItems();\n    };\n\n    _this.handleAddItem = function () {\n      var item = _this.state.inputValue;\n\n      var value = _this.props.valueToItem(item);\n\n      if (_this.hasValueInItems(_this.props.selectedItems, value)) {\n        return;\n      }\n\n      var newItems = _this.props.selectedItems.concat([value]);\n\n      _this.props.onValueChange(newItems);\n\n      _this.dispatch({\n        type: 'CLEAR_INPUT'\n      });\n\n      _this.tryGetItems();\n    };\n\n    _this.handleRemoveToken = function (item) {\n      _this.props.onValueChange(_this.props.selectedItems.filter(function (_) {\n        return !isEqual(_, item);\n      }));\n\n      var filteredActiveTokens = _this.state.activeTokens.filter(function (_) {\n        return !isEqual(_, item);\n      });\n\n      _this.dispatch({\n        type: 'SET_ACTIVE_TOKENS',\n        payload: filteredActiveTokens\n      });\n\n      if (filteredActiveTokens.length === 0) {\n        _this.focusInput();\n      }\n\n      _this.tryGetItems();\n    };\n\n    _this.handleTokenClick = function (event, itemNew) {\n      var items = _this.state.activeTokens;\n\n      if (event.ctrlKey) {\n        var newItems = _this.hasValueInItems(_this.state.activeTokens, itemNew) ? items.filter(function (item) {\n          return !isEqual(item, itemNew);\n        }) : [].concat(items, [itemNew]);\n\n        _this.dispatch({\n          type: 'SET_ACTIVE_TOKENS',\n          payload: newItems\n        });\n      } else {\n        _this.dispatch({\n          type: 'SET_ACTIVE_TOKENS',\n          payload: [itemNew]\n        });\n      }\n\n      _this.focusInput();\n    };\n\n    _this.handleChangeInputValue = function (event) {\n      var query = event.target.value.trimLeft();\n\n      if (query.endsWith(' ')) {\n        query = query.trimRight() + ' ';\n      }\n\n      if (_this.state.inputValue !== '' && query === '') {\n        _this.dispatch({\n          type: 'SET_AUTOCOMPLETE_ITEMS',\n          payload: undefined\n        });\n      }\n\n      _this.dispatch({\n        type: 'UPDATE_QUERY',\n        payload: query\n      }, function () {\n        _this.tryGetItems(query);\n      });\n\n      if (_this.props.onInputValueChange) {\n        _this.props.onInputValueChange(query);\n      }\n    };\n\n    _this.highlightMenuItem = function () {\n      if (_this.menuRef && _this.state.autocompleteItems && _this.state.autocompleteItems.length > 0 && _this.type !== TokenInputType.Combined) {\n        _this.menuRef.highlightItem(0);\n      }\n    };\n\n    _this.renderTokenFields = function () {\n      return _this.props.selectedItems.map(_this.renderToken);\n    };\n\n    _this.renderToken = function (item) {\n      var _this$props = _this.props,\n          _this$props$renderTok = _this$props.renderToken,\n          renderToken = _this$props$renderTok === void 0 ? defaultRenderToken : _this$props$renderTok,\n          disabled = _this$props.disabled;\n\n      var isActive = _this.state.activeTokens.includes(item); // TODO useCallback\n\n\n      var handleIconClick = function handleIconClick(event) {\n        event.stopPropagation();\n\n        _this.handleRemoveToken(item);\n      }; // TODO useCallback\n\n\n      var handleTokenClick = function handleTokenClick(event) {\n        event.stopPropagation();\n\n        _this.handleTokenClick(event, item);\n      };\n\n      return renderToken(item, {\n        isActive: isActive,\n        onClick: handleTokenClick,\n        onRemove: handleIconClick,\n        disabled: disabled\n      });\n    };\n\n    _this.renderAddButton = function (value) {\n      if (value === void 0) {\n        value = _this.state.inputValue;\n      }\n\n      if (!_this.showAddItemHint) {\n        return;\n      }\n\n      if (_this.props.renderAddButton) {\n        return _this.props.renderAddButton(value, _this.handleAddItem);\n      }\n\n      var _this$locale = _this.locale,\n          addButtonComment = _this$locale.addButtonComment,\n          addButtonTitle = _this$locale.addButtonTitle;\n      return React.createElement(MenuItem, {\n        onClick: _this.handleAddItem,\n        comment: addButtonComment,\n        key: \"renderAddButton\"\n      }, addButtonTitle, \" \", value);\n    };\n\n    return _this;\n  }\n\n  var _proto = TokenInput.prototype;\n\n  _proto.componentDidMount = function componentDidMount() {\n    this.updateInputTextWidth();\n    document.addEventListener('copy', this.handleCopy);\n\n    if (this.props.autoFocus) {\n      this.focusInput();\n    }\n  };\n\n  _proto.componentDidUpdate = function componentDidUpdate(prevProps, prevState) {\n    if (prevState.inputValue !== this.state.inputValue) {\n      this.updateInputTextWidth();\n    }\n\n    if (prevState.activeTokens.length === 0 && this.state.activeTokens.length > 0) {\n      this.dispatch({\n        type: 'SET_AUTOCOMPLETE_ITEMS',\n        payload: undefined\n      });\n    }\n\n    if (prevProps.selectedItems.length !== this.props.selectedItems.length) {\n      LayoutEvents.emit();\n    }\n\n    if (!this.isCursorVisibleForState(prevState) && this.isCursorVisible) {\n      this.tryGetItems(this.state.inputValue);\n    }\n  };\n\n  _proto.componentWillUnmount = function componentWillUnmount() {\n    document.removeEventListener('copy', this.handleCopy);\n  };\n\n  _proto.render = function render() {\n    var _this2 = this;\n\n    return React.createElement(ThemeContext.Consumer, null, function (theme) {\n      _this2.theme = theme;\n      return _this2.renderMain();\n    });\n  };\n\n  _proto.renderMain = function renderMain() {\n    var _cn, _cn2;\n\n    if (this.type !== TokenInputType.WithoutReference && !this.props.getItems) {\n      throw Error('Missed getItems for type ' + this.type);\n    }\n\n    var _this$props2 = this.props,\n        selectedItems = _this$props2.selectedItems,\n        width = _this$props2.width,\n        maxMenuHeight = _this$props2.maxMenuHeight,\n        error = _this$props2.error,\n        warning = _this$props2.warning,\n        disabled = _this$props2.disabled,\n        placeholder = _this$props2.placeholder,\n        renderItem = _this$props2.renderItem,\n        renderNotFound = _this$props2.renderNotFound,\n        hideMenuIfEmptyInputValue = _this$props2.hideMenuIfEmptyInputValue,\n        onMouseEnter = _this$props2.onMouseEnter,\n        onMouseLeave = _this$props2.onMouseLeave;\n    var _this$state = this.state,\n        activeTokens = _this$state.activeTokens,\n        inFocus = _this$state.inFocus,\n        inputValueWidth = _this$state.inputValueWidth,\n        inputValue = _this$state.inputValue,\n        autocompleteItems = _this$state.autocompleteItems,\n        loading = _this$state.loading;\n    var showMenu = this.type !== TokenInputType.WithoutReference && this.isCursorVisible && activeTokens.length === 0 && (inputValue !== '' || !hideMenuIfEmptyInputValue);\n    var inputInlineStyles = {\n      // вычисляем ширину чтобы input автоматически перенёсся на следующую строку при необходимости\n      width: Math.max(50, inputValueWidth + 7),\n      // input растягивается на всю ширину чтобы placeholder не обрезался\n      flex: selectedItems && selectedItems.length === 0 ? 1 : undefined,\n      // в ie не работает, но альтернативный способ --- дать tabindex для label --- предположительно ещё сложнее\n      caretColor: this.isCursorVisible ? undefined : 'transparent'\n    };\n    var theme = this.theme;\n    var labelClassName = cn(jsStyles.label(theme), (_cn = {}, _cn[jsStyles.labelFocused(theme)] = !!inFocus, _cn[jsStyles.error(theme)] = !!error, _cn[jsStyles.warning(theme)] = !!warning, _cn[jsStyles.labelDisabled(theme)] = !!disabled, _cn));\n    var inputClassName = cn(jsStyles.input(theme), (_cn2 = {}, _cn2[jsStyles.inputDisabled(theme)] = !!disabled, _cn2));\n    return React.createElement(\"div\", {\n      onMouseEnter: onMouseEnter,\n      onMouseLeave: onMouseLeave\n    }, React.createElement(TextWidthHelper, {\n      ref: this.textHelperRef,\n      text: inputValue\n    }), React.createElement(\"label\", {\n      ref: this.wrapperRef,\n      style: {\n        width: width\n      },\n      className: labelClassName,\n      onMouseDown: this.handleWrapperMouseDown,\n      onMouseUp: this.handleWrapperMouseUp\n    }, this.renderTokenFields(), React.createElement(\"input\", {\n      type: \"text\",\n      ref: this.inputRef,\n      value: inputValue,\n      style: inputInlineStyles,\n      autoComplete: \"off\",\n      spellCheck: false,\n      disabled: disabled,\n      className: inputClassName,\n      placeholder: selectedItems.length > 0 ? undefined : placeholder,\n      onFocus: this.handleInputFocus,\n      onBlur: this.handleInputBlur,\n      onChange: this.handleChangeInputValue,\n      onKeyDown: this.handleKeyDown,\n      onPaste: this.handleInputPaste\n    }), showMenu && React.createElement(TokenInputMenu, {\n      ref: this.tokensInputMenuRef,\n      items: autocompleteItems,\n      loading: loading,\n      opened: showMenu,\n      maxMenuHeight: maxMenuHeight,\n      anchorElement: this.input,\n      renderNotFound: renderNotFound,\n      renderItem: renderItem,\n      onValueChange: this.handleValueChange,\n      renderAddButton: this.renderAddButton\n    })));\n  }\n  /**\r\n   * Сбрасывает введенное пользователем значение\r\n   * @public\r\n   */\n  ;\n\n  _proto.reset = function reset() {\n    this.dispatch({\n      type: 'RESET'\n    });\n  };\n\n  _proto.isCursorVisibleForState = function isCursorVisibleForState(state) {\n    return state.inFocus && (state.inputValue !== '' || state.activeTokens.length === 0);\n  };\n\n  _proto.updateInputTextWidth = function updateInputTextWidth() {\n    if (this.textHelper) {\n      var inputValueWidth = this.textHelper.getTextWidth();\n      this.dispatch({\n        type: 'SET_INPUT_VALUE_WIDTH',\n        payload: inputValueWidth\n      }, LayoutEvents.emit);\n    }\n  };\n\n  _proto.moveFocusToLastToken = function moveFocusToLastToken() {\n    var items = this.props.selectedItems;\n\n    if (this.state.inputValue === '' && items && items.length > 0) {\n      this.dispatch({\n        type: 'SET_ACTIVE_TOKENS',\n        payload: items.slice(-1)\n      });\n    }\n  };\n\n  _createClass(TokenInput, [{\n    key: \"showAddItemHint\",\n    get: function get() {\n      var items = this.state.autocompleteItems;\n      var value = this.props.valueToItem(this.state.inputValue);\n\n      if (items && this.hasValueInItems(items, value)) {\n        return false;\n      }\n\n      var selectedItems = this.props.selectedItems;\n\n      if (selectedItems && this.hasValueInItems(selectedItems, value)) {\n        return false;\n      }\n\n      if (this.type === TokenInputType.Combined && this.state.inputValue !== '') {\n        return true;\n      }\n    }\n  }, {\n    key: \"type\",\n    get: function get() {\n      return this.props.type ? this.props.type : TokenInputType.WithReference;\n    }\n  }, {\n    key: \"delimiters\",\n    get: function get() {\n      return this.props.delimiters ? this.props.delimiters : [','];\n    }\n  }, {\n    key: \"menuRef\",\n    get: function get() {\n      return this.tokensInputMenu && this.tokensInputMenu.getMenuRef();\n    }\n  }, {\n    key: \"isCursorVisible\",\n    get: function get() {\n      return this.isCursorVisibleForState(this.state);\n    }\n  }]);\n\n  return TokenInput;\n}(React.PureComponent), _class2.__KONTUR_REACT_UI__ = 'TokenInput', _class2.defaultProps = {\n  selectedItems: [],\n  renderItem: identity,\n  renderValue: identity,\n  valueToString: identity,\n  valueToItem: function valueToItem(item) {\n    return item;\n  },\n  toKey: defaultToKey,\n  onValueChange: function onValueChange() {\n    return void 0;\n  },\n  width: 250,\n  onBlur: emptyHandler,\n  onFocus: emptyHandler,\n  onMouseEnter: emptyHandler,\n  onMouseLeave: emptyHandler\n}, _temp)) || _class);"]},"metadata":{},"sourceType":"module"}