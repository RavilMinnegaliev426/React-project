{"version":3,"sources":["Checkbox.tsx"],"names":["React","PropTypes","cn","tabListener","ThemeContext","OkIcon","SquareIcon","isEdge","isFirefox","isIE11","jsStyles","Checkbox","state","focusedByTab","indeterminate","props","initialIndeterminate","theme","input","componentDidMount","setIndeterminate","setState","resetIndeterminate","handleFocus","e","disabled","process","nextTick","isTabPressed","handleBlur","onBlur","inputRef","ref","handleChange","event","checked","currentTarget","onValueChange","onChange","UNSAFE_componentWillReceiveProps","nextProps","render","renderMain","focus","blur","children","error","warning","onMouseEnter","onMouseLeave","onMouseOver","style","className","type","rest","isIndeterminate","rootClass","root","rootFallback","Boolean","inputProps","onFocus","caption","captionClass","captionIE11","iconClass","iconUnchecked","iconFixBaseline","box","Component","__KONTUR_REACT_UI__","propTypes","bool","func"],"mappings":"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","sourcesContent":["import React from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport cn from 'classnames';\r\n\r\nimport { Nullable, Override } from '../../typings/utility-types';\r\nimport { tabListener } from '../../lib/events/tabListener';\r\nimport { Theme } from '../../lib/theming/Theme';\r\nimport { ThemeContext } from '../../lib/theming/ThemeContext';\r\nimport { OkIcon, SquareIcon } from '../../internal/icons/16px';\r\nimport { isEdge, isFirefox, isIE11 } from '../../lib/utils';\r\n\r\nimport { jsStyles } from './Checkbox.styles';\r\n\r\nexport type CheckboxProps = Override<\r\n  React.InputHTMLAttributes<HTMLInputElement>,\r\n  {\r\n    /** Контент `label` */\r\n    children?: React.ReactNode;\r\n    /** Состояние ошибки */\r\n    error?: boolean;\r\n    /** Состояние Предупреждения */\r\n    warning?: boolean;\r\n    /** Вызывается на label */\r\n    onMouseEnter?: React.MouseEventHandler<HTMLLabelElement>;\r\n    /** Вызывается на label */\r\n    onMouseLeave?: React.MouseEventHandler<HTMLLabelElement>;\r\n    /** Вызывается на label */\r\n    onMouseOver?: React.MouseEventHandler<HTMLLabelElement>;\r\n    /** Вызывается при изменении `value` */\r\n    onValueChange?: (value: boolean) => void;\r\n    /** onBlur */\r\n    onBlur?: (event: React.FocusEvent<HTMLInputElement>) => void;\r\n    /** Состояние частичного выделения */\r\n    initialIndeterminate?: boolean;\r\n  }\r\n>;\r\n\r\nexport interface CheckboxState {\r\n  focusedByTab: boolean;\r\n  indeterminate: boolean;\r\n}\r\n\r\n/**\r\n * Все свойства, кроме перечисленных, `className` и `style` передаются в `input`.\r\n */\r\nexport class Checkbox extends React.Component<CheckboxProps, CheckboxState> {\r\n  public static __KONTUR_REACT_UI__ = 'Checkbox';\r\n\r\n  public static propTypes = {\r\n    checked: PropTypes.bool,\r\n    disabled: PropTypes.bool,\r\n    error: PropTypes.bool,\r\n    warning: PropTypes.bool,\r\n    onValueChange: PropTypes.func,\r\n    onBlur: PropTypes.func,\r\n    onMouseEnter: PropTypes.func,\r\n    onMouseLeave: PropTypes.func,\r\n    onMouseOver: PropTypes.func,\r\n  };\r\n\r\n  public state = {\r\n    focusedByTab: false,\r\n    indeterminate: this.props.initialIndeterminate || false,\r\n  };\r\n\r\n  private theme!: Theme;\r\n  private input: Nullable<HTMLInputElement>;\r\n\r\n  public componentDidMount = () => {\r\n    if (this.state.indeterminate && this.input) {\r\n      this.input.indeterminate = true;\r\n    }\r\n  };\r\n\r\n  public UNSAFE_componentWillReceiveProps(nextProps: CheckboxProps) {\r\n    if (nextProps.checked !== this.props.checked) {\r\n      this.resetIndeterminate();\r\n    }\r\n  }\r\n\r\n  public render() {\r\n    return (\r\n      <ThemeContext.Consumer>\r\n        {theme => {\r\n          this.theme = theme;\r\n          return this.renderMain();\r\n        }}\r\n      </ThemeContext.Consumer>\r\n    );\r\n  }\r\n\r\n  /**\r\n   * @public\r\n   */\r\n  public focus() {\r\n    tabListener.isTabPressed = true;\r\n    this.input?.focus();\r\n  }\r\n\r\n  /**\r\n   * @public\r\n   */\r\n  public blur() {\r\n    this.input?.blur();\r\n  }\r\n\r\n  /**\r\n   * Установить промежуточное значение\r\n   * @public\r\n   */\r\n  public setIndeterminate = () => {\r\n    this.setState({\r\n      indeterminate: true,\r\n    });\r\n    if (this.input) {\r\n      this.input.indeterminate = true;\r\n    }\r\n  };\r\n\r\n  /**\r\n   * Сбросить промежуточное значение\r\n   * @public\r\n   */\r\n  public resetIndeterminate = () => {\r\n    this.setState({\r\n      indeterminate: false,\r\n    });\r\n    if (this.input) {\r\n      this.input.indeterminate = false;\r\n    }\r\n  };\r\n\r\n  private renderMain() {\r\n    const props = this.props;\r\n    const {\r\n      children,\r\n      error,\r\n      warning,\r\n      onMouseEnter,\r\n      onMouseLeave,\r\n      onMouseOver,\r\n      onValueChange,\r\n      style,\r\n      className,\r\n      type,\r\n      initialIndeterminate,\r\n      ...rest\r\n    } = props;\r\n    const isIndeterminate = this.state.indeterminate;\r\n\r\n    const rootClass = cn({\r\n      [jsStyles.root(this.theme)]: true,\r\n      [jsStyles.rootFallback()]: isIE11 || isEdge,\r\n      [jsStyles.disabled(this.theme)]: Boolean(props.disabled),\r\n      [jsStyles.checked(this.theme)]: Boolean(props.checked),\r\n      [jsStyles.indeterminate(this.theme)]: isIndeterminate,\r\n      [jsStyles.focus(this.theme)]: this.state.focusedByTab,\r\n      [jsStyles.warning(this.theme)]: Boolean(props.warning),\r\n      [jsStyles.error(this.theme)]: Boolean(props.error),\r\n    });\r\n\r\n    const inputProps = {\r\n      ...rest,\r\n      type: 'checkbox',\r\n      className: jsStyles.input(),\r\n      onChange: this.handleChange,\r\n      onFocus: this.handleFocus,\r\n      onBlur: this.handleBlur,\r\n      ref: this.inputRef,\r\n    };\r\n\r\n    let caption = null;\r\n    if (children) {\r\n      const captionClass = cn({\r\n        [jsStyles.caption()]: true,\r\n        [jsStyles.captionIE11()]: isIE11 || isEdge,\r\n      });\r\n      caption = <span className={captionClass}>{children}</span>;\r\n    }\r\n\r\n    const iconClass = cn({\r\n      [jsStyles.iconUnchecked()]: !props.checked && !isIndeterminate,\r\n      [jsStyles.iconFixBaseline()]: isFirefox || isIE11 || isEdge,\r\n    });\r\n\r\n    const box = (\r\n      <span className={jsStyles.box(this.theme)}>\r\n        {(isIndeterminate && <SquareIcon className={iconClass} />) || <OkIcon className={iconClass} />}\r\n      </span>\r\n    );\r\n\r\n    return (\r\n      <label className={rootClass} onMouseEnter={onMouseEnter} onMouseLeave={onMouseLeave} onMouseOver={onMouseOver}>\r\n        <input {...inputProps} />\r\n        {box}\r\n        {caption}\r\n      </label>\r\n    );\r\n  }\r\n\r\n  private handleFocus = (e: React.FocusEvent<any>) => {\r\n    if (!this.props.disabled) {\r\n      // focus event fires before keyDown eventlistener\r\n      // so we should check tabPressed in async way\r\n      process.nextTick(() => {\r\n        if (tabListener.isTabPressed) {\r\n          this.setState({ focusedByTab: true });\r\n        }\r\n      });\r\n    }\r\n  };\r\n\r\n  private handleBlur = (e: React.FocusEvent<HTMLInputElement>) => {\r\n    this.props.onBlur?.(e);\r\n    this.setState({ focusedByTab: false });\r\n  };\r\n\r\n  private inputRef = (ref: HTMLInputElement | null) => {\r\n    this.input = ref;\r\n  };\r\n\r\n  private handleChange = (event: React.ChangeEvent<HTMLInputElement>) => {\r\n    const checked = event.currentTarget.checked;\r\n    this.props.onValueChange?.(checked);\r\n\r\n    this.resetIndeterminate();\r\n\r\n    this.props.onChange?.(event);\r\n  };\r\n}\r\n"]}