{"version":3,"sources":["Indicator.tsx"],"names":["React","findDOMNode","throttle","cn","LayoutEvents","ThemeContext","jsStyles","TabsContext","Indicator","context","state","styles","theme","eventListener","removeTabUpdatesListener","reflow","getTab","activeTab","node","nodeStyles","getStyles","stylesUpdated","some","prop","setState","throttledReflow","componentDidMount","addListener","props","tabUpdates","on","componentWillUnmount","cancel","remove","componentDidUpdate","_","prevState","render","renderMain","indicators","getIndicators","error","warning","success","primary","disabled","root","className","Component","HTMLElement","rect","getBoundingClientRect","vertical","width","left","offsetLeft","top","offsetTop","height","bottom","offsetHeight","right","contextType"],"mappings":"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","sourcesContent":["import React from 'react';\r\nimport { findDOMNode } from 'react-dom';\r\nimport throttle from 'lodash.throttle';\r\nimport cn from 'classnames';\r\n\r\nimport * as LayoutEvents from '../../lib/LayoutEvents';\r\nimport { Nullable } from '../../typings/utility-types';\r\nimport { ThemeContext } from '../../lib/theming/ThemeContext';\r\nimport { Theme } from '../../lib/theming/Theme';\r\n\r\nimport { jsStyles } from './Indicator.styles';\r\nimport { TabsContext, TabsContextType } from './TabsContext';\r\nimport { TabIndicators } from './Tab';\r\n\r\nexport interface IndicatorProps {\r\n  className?: string;\r\n  tabUpdates: {\r\n    on: (x0: () => void) => () => void;\r\n  };\r\n  vertical: boolean;\r\n}\r\n\r\nexport interface IndicatorState {\r\n  styles: React.CSSProperties;\r\n}\r\n\r\nexport class Indicator extends React.Component<IndicatorProps, IndicatorState> {\r\n  public static contextType = TabsContext;\r\n  public context: TabsContextType = this.context;\r\n\r\n  public state: IndicatorState = {\r\n    styles: {},\r\n  };\r\n\r\n  private theme!: Theme;\r\n\r\n  private eventListener: Nullable<{\r\n    remove: () => void;\r\n  }> = null;\r\n\r\n  private removeTabUpdatesListener: Nullable<() => void> = null;\r\n\r\n  public componentDidMount() {\r\n    this.eventListener = LayoutEvents.addListener(this.throttledReflow);\r\n    this.removeTabUpdatesListener = this.props.tabUpdates.on(this.reflow);\r\n    this.reflow();\r\n  }\r\n\r\n  public componentWillUnmount() {\r\n    this.throttledReflow.cancel();\r\n\r\n    if (this.eventListener) {\r\n      this.eventListener.remove();\r\n    }\r\n    if (this.removeTabUpdatesListener) {\r\n      this.removeTabUpdatesListener();\r\n    }\r\n  }\r\n\r\n  public componentDidUpdate(_: IndicatorProps, prevState: IndicatorState) {\r\n    this.reflow();\r\n  }\r\n\r\n  public render() {\r\n    return (\r\n      <ThemeContext.Consumer>\r\n        {theme => {\r\n          this.theme = theme;\r\n          return this.renderMain();\r\n        }}\r\n      </ThemeContext.Consumer>\r\n    );\r\n  }\r\n\r\n  private renderMain() {\r\n    const { getTab, activeTab } = this.context;\r\n    const node = getTab(activeTab);\r\n    const indicators: TabIndicators = (node && node.getIndicators && node.getIndicators()) || {\r\n      error: false,\r\n      warning: false,\r\n      success: false,\r\n      primary: false,\r\n      disabled: false,\r\n    };\r\n    return (\r\n      <div\r\n        className={cn(\r\n          jsStyles.root(this.theme),\r\n          indicators.primary && jsStyles.primary(this.theme),\r\n          indicators.success && jsStyles.success(this.theme),\r\n          indicators.warning && jsStyles.warning(this.theme),\r\n          indicators.error && jsStyles.error(this.theme),\r\n          this.props.className,\r\n        )}\r\n        style={this.state.styles}\r\n      />\r\n    );\r\n  }\r\n\r\n  private reflow = () => {\r\n    const { getTab, activeTab } = this.context;\r\n    const node = getTab(activeTab);\r\n    const nodeStyles = this.getStyles(node);\r\n    const stylesUpdated = ['left', 'top', 'width', 'height'].some(\r\n      prop => nodeStyles[prop as keyof React.CSSProperties] !== this.state.styles[prop as keyof React.CSSProperties],\r\n    );\r\n    if (stylesUpdated) {\r\n      this.setState({ styles: nodeStyles });\r\n    }\r\n  };\r\n\r\n  private throttledReflow = throttle(this.reflow, 100);\r\n\r\n  private getStyles(node: any): React.CSSProperties {\r\n    if (node instanceof React.Component) {\r\n      node = findDOMNode(node);\r\n    }\r\n\r\n    if (node instanceof HTMLElement) {\r\n      const rect = node.getBoundingClientRect();\r\n      if (this.props.vertical) {\r\n        return {\r\n          width: 3,\r\n          left: node.offsetLeft,\r\n          top: node.offsetTop,\r\n          height: rect.bottom - rect.top,\r\n        };\r\n      }\r\n\r\n      return {\r\n        left: node.offsetLeft,\r\n        top: node.offsetHeight + node.offsetTop - 3,\r\n        width: rect.right - rect.left,\r\n      };\r\n    }\r\n\r\n    return {};\r\n  }\r\n}\r\n"]}