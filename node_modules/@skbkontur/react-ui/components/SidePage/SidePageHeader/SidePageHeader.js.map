{"version":3,"sources":["SidePageHeader.tsx"],"names":["React","cn","Sticky","CrossIcon","isFunction","ThemeContext","jsStyles","SidePageContext","REGULAR_HEADER_PADDING_TOP","FIXED_HEADER_PADDING_TOP","FONT_FAMILY_CORRECTION","CLOSE_ELEMENT_OFFSET","FIXED_HEADER_HEIGHT","SidePageHeader","state","isReadyToFix","theme","wrapper","lastRegularHeight","componentDidMount","window","addEventListener","update","componentWillUnmount","removeEventListener","updateReadyToFix","renderHeader","fixed","header","headerFixed","renderClose","title","titleFixed","props","children","renderCloseContent","requestClose","close","closeIcon","wrapperScrolledUp","getBoundingClientRect","top","regularHeight","setState","wrapperRef","el","render","renderMain","height","Component","__KONTUR_REACT_UI__"],"mappings":"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","sourcesContent":["import React from 'react';\r\nimport cn from 'classnames';\r\n\r\nimport { Sticky } from '../Sticky';\r\nimport { CrossIcon } from '../../internal/icons/CrossIcon';\r\nimport { isFunction } from '../../lib/utils';\r\nimport { ThemeContext } from '../../lib/theming/ThemeContext';\r\nimport { Theme } from '../../lib/theming/Theme';\r\n\r\nimport { jsStyles } from './SidePage.styles';\r\nimport { SidePageContext } from './SidePageContext';\r\n\r\nconst REGULAR_HEADER_PADDING_TOP = 25;\r\nconst FIXED_HEADER_PADDING_TOP = 13;\r\nconst FONT_FAMILY_CORRECTION = 1;\r\nconst CLOSE_ELEMENT_OFFSET = REGULAR_HEADER_PADDING_TOP - FIXED_HEADER_PADDING_TOP - FONT_FAMILY_CORRECTION;\r\nconst FIXED_HEADER_HEIGHT = 50;\r\n\r\nexport interface SidePageHeaderProps {\r\n  children?: React.ReactNode | ((fixed: boolean) => React.ReactNode);\r\n}\r\n\r\nexport interface SidePageHeaderState {\r\n  isReadyToFix: boolean;\r\n}\r\n\r\n/**\r\n * Шапка сайдпейджа\r\n *\r\n * @visibleName SidePage.Header\r\n */\r\nexport class SidePageHeader extends React.Component<SidePageHeaderProps, SidePageHeaderState> {\r\n  public static __KONTUR_REACT_UI__ = 'SidePageHeader';\r\n\r\n  public state = {\r\n    isReadyToFix: false,\r\n  };\r\n\r\n  private theme!: Theme;\r\n  private wrapper: HTMLElement | null = null;\r\n  private lastRegularHeight = 0;\r\n\r\n  public get regularHeight(): number {\r\n    const { isReadyToFix } = this.state;\r\n    if (!this.wrapper) {\r\n      return 0;\r\n    }\r\n    if (!isReadyToFix) {\r\n      this.lastRegularHeight = this.wrapper.getBoundingClientRect().height;\r\n    }\r\n    return this.lastRegularHeight;\r\n  }\r\n\r\n  public componentDidMount = () => {\r\n    window.addEventListener('scroll', this.update, true);\r\n  };\r\n\r\n  public componentWillUnmount = () => {\r\n    window.removeEventListener('scroll', this.update, true);\r\n  };\r\n\r\n  public update = () => {\r\n    this.updateReadyToFix();\r\n  };\r\n\r\n  public render(): JSX.Element {\r\n    return (\r\n      <ThemeContext.Consumer>\r\n        {theme => {\r\n          this.theme = theme;\r\n          return this.renderMain();\r\n        }}\r\n      </ThemeContext.Consumer>\r\n    );\r\n  }\r\n\r\n  private renderMain() {\r\n    const { isReadyToFix } = this.state;\r\n    return (\r\n      <div ref={this.wrapperRef}>\r\n        {isReadyToFix ? <Sticky side=\"top\">{this.renderHeader}</Sticky> : this.renderHeader()}\r\n      </div>\r\n    );\r\n  }\r\n\r\n  private renderHeader = (fixed = false) => {\r\n    return (\r\n      <div className={cn(jsStyles.header(), { [jsStyles.headerFixed(this.theme)]: fixed })}>\r\n        {this.renderClose()}\r\n        <div className={cn(jsStyles.title(), { [jsStyles.titleFixed()]: fixed })}>\r\n          {isFunction(this.props.children) ? this.props.children(fixed) : this.props.children}\r\n        </div>\r\n      </div>\r\n    );\r\n  };\r\n\r\n  private renderCloseContent = (fixed: boolean) => (\r\n    <SidePageContext.Consumer>\r\n      {({ requestClose }) => (\r\n        <a\r\n          className={cn(jsStyles.close(this.theme), {\r\n            [jsStyles.fixed()]: fixed,\r\n          })}\r\n          onClick={requestClose}\r\n          data-tid=\"SidePage__close\"\r\n        >\r\n          <span className={jsStyles.closeIcon()}>\r\n            <CrossIcon />\r\n          </span>\r\n        </a>\r\n      )}\r\n    </SidePageContext.Consumer>\r\n  );\r\n\r\n  private renderClose = () => (\r\n    <Sticky side=\"top\" offset={CLOSE_ELEMENT_OFFSET}>\r\n      {this.renderCloseContent}\r\n    </Sticky>\r\n  );\r\n\r\n  private updateReadyToFix = () => {\r\n    if (this.wrapper) {\r\n      const wrapperScrolledUp = this.wrapper.getBoundingClientRect().top;\r\n      const isReadyToFix = this.regularHeight + wrapperScrolledUp <= FIXED_HEADER_HEIGHT;\r\n      this.setState(state => (state.isReadyToFix !== isReadyToFix ? { isReadyToFix } : state));\r\n    }\r\n  };\r\n\r\n  private wrapperRef = (el: HTMLElement | null) => {\r\n    this.wrapper = el;\r\n  };\r\n}\r\n"]}