{"version":3,"sources":["TokenInput.tsx"],"names":["React","findDOMNode","isEqual","cn","isKeyArrowHorizontal","isKeyArrowLeft","isKeyArrowRight","isKeyArrowUp","isKeyArrowVertical","isKeyBackspace","isKeyDelete","isKeyEnter","isKeyEscape","isShortcutSelectAll","LayoutEvents","Token","emptyHandler","ThemeContext","locale","MenuItem","TokenInputLocaleHelper","jsStyles","tokenInputReducer","TokenInputMenu","TextWidthHelper","TokenInputType","DefaultState","inputValue","autocompleteItems","undefined","activeTokens","inFocus","loading","preventBlur","inputValueWidth","defaultToKey","item","toString","identity","defaultRenderToken","isActive","onClick","onRemove","disabled","TokenInput","state","theme","input","tokensInputMenu","textHelper","wrapper","hasValueInItems","items","value","includes","some","inputRef","node","tokensInputMenuRef","textHelperRef","wrapperRef","dispatch","action","cb","setState","prevState","handleInputFocus","event","type","props","onFocus","handleInputBlur","isBlurToMenu","preventDefault","focus","process","nextTick","payload","onBlur","menuRef","menu","relatedTarget","document","activeElement","contains","handleWrapperMouseDown","target","isClickOnToken","handleWrapperMouseUp","handleCopy","length","isCursorVisible","tokens","map","token","selectedItems","indexOf","sort","index","valueToString","clipboardData","setData","join","delimiters","handleInputPaste","WithReference","paste","getData","delimiter","stopPropagation","split","valueToItem","filter","newItems","concat","onValueChange","tryGetItems","query","getItems","hideMenuIfEmptyInputValue","autocompleteItemsUnique","emit","highlightMenuItem","handleKeyDown","handleInputKeyDown","handleWrapperKeyDown","e","key","newValue","handleAddItem","enter","up","down","blur","moveFocusToLastToken","selectionStart","focusInput","itemsNew","handleWrapperArrows","activeItemIndex","newItemIndex","isLeftEdge","isRightEdge","shiftKey","handleWrapperArrowsWithoutShift","handleWrapperArrowsWithShift","itemNew","handleValueChange","handleRemoveToken","_","filteredActiveTokens","handleTokenClick","ctrlKey","handleChangeInputValue","trimLeft","endsWith","trimRight","onInputValueChange","Combined","highlightItem","renderTokenFields","renderToken","handleIconClick","renderAddButton","showAddItemHint","addButtonComment","addButtonTitle","componentDidMount","updateInputTextWidth","addEventListener","autoFocus","componentDidUpdate","prevProps","isCursorVisibleForState","componentWillUnmount","removeEventListener","render","renderMain","WithoutReference","Error","width","maxMenuHeight","error","warning","placeholder","renderItem","renderNotFound","onMouseEnter","onMouseLeave","showMenu","inputInlineStyles","Math","max","flex","caretColor","labelClassName","label","labelFocused","labelDisabled","inputClassName","inputDisabled","reset","getTextWidth","slice","getMenuRef","PureComponent","__KONTUR_REACT_UI__","defaultProps","renderValue","toKey"],"mappings":"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","sourcesContent":["import React, { ChangeEvent, FocusEvent, FocusEventHandler, KeyboardEvent, MouseEventHandler, ReactNode } from 'react';\r\nimport { findDOMNode } from 'react-dom';\r\nimport isEqual from 'lodash.isequal';\r\nimport cn from 'classnames';\r\n\r\nimport {\r\n  isKeyArrowHorizontal,\r\n  isKeyArrowLeft,\r\n  isKeyArrowRight,\r\n  isKeyArrowUp,\r\n  isKeyArrowVertical,\r\n  isKeyBackspace,\r\n  isKeyDelete,\r\n  isKeyEnter,\r\n  isKeyEscape,\r\n  isShortcutSelectAll,\r\n} from '../../lib/events/keyboard/identifiers';\r\nimport * as LayoutEvents from '../../lib/LayoutEvents';\r\nimport { Menu } from '../../internal/Menu';\r\nimport { Token, TokenProps } from '../Token';\r\nimport { MenuItemState } from '../MenuItem';\r\nimport { emptyHandler } from '../../lib/utils';\r\nimport { ThemeContext } from '../../lib/theming/ThemeContext';\r\nimport { Theme } from '../../lib/theming/Theme';\r\nimport { locale } from '../../lib/locale/decorators';\r\nimport { MenuItem } from '../MenuItem/MenuItem';\r\n\r\nimport { TokenInputLocale, TokenInputLocaleHelper } from './locale';\r\nimport { jsStyles } from './TokenInput.styles';\r\nimport { TokenInputAction, tokenInputReducer } from './TokenInputReducer';\r\nimport { TokenInputMenu } from './TokenInputMenu';\r\nimport { TextWidthHelper } from './TextWidthHelper';\r\n\r\nexport enum TokenInputType {\r\n  WithReference,\r\n  WithoutReference,\r\n  Combined,\r\n}\r\n\r\nexport interface TokenInputProps<T> {\r\n  selectedItems: T[];\r\n  onValueChange: (items: T[]) => void;\r\n  onMouseEnter: MouseEventHandler<HTMLDivElement>;\r\n  onMouseLeave: MouseEventHandler<HTMLDivElement>;\r\n  onFocus: FocusEventHandler<HTMLInputElement>;\r\n  onBlur: FocusEventHandler<HTMLInputElement>;\r\n  autoFocus?: boolean;\r\n  type?: TokenInputType;\r\n  getItems?: (query: string) => Promise<T[]>;\r\n  hideMenuIfEmptyInputValue?: boolean;\r\n  renderItem: (item: T, state: MenuItemState) => React.ReactNode | null;\r\n  renderValue: (item: T) => React.ReactNode;\r\n  /**\r\n   * Функция должна возвращать строковое представление токена\r\n   * @default item => item\r\n   */\r\n  valueToString: (item: T) => string;\r\n  renderNotFound?: () => React.ReactNode;\r\n  valueToItem: (item: string) => T;\r\n  toKey: (item: T) => string | number | undefined;\r\n  placeholder?: string;\r\n  delimiters?: string[];\r\n  error?: boolean;\r\n  warning?: boolean;\r\n  disabled?: boolean;\r\n  width?: string | number;\r\n  maxMenuHeight?: number | string;\r\n  renderToken?: (item: T, props: Partial<TokenProps>) => ReactNode;\r\n  /**\r\n   * Вызывается при изменении текста в поле ввода,\r\n   */\r\n  onInputValueChange?: (value: string) => void;\r\n  /**\r\n   * Функция отрисовки кнопки добавления в выпадающем списке\r\n   */\r\n  renderAddButton?: (query?: string, onAddItem?: () => void) => ReactNode;\r\n}\r\n\r\nexport interface TokenInputState<T> {\r\n  autocompleteItems?: T[];\r\n  activeTokens: T[];\r\n  inFocus?: boolean;\r\n  inputValue: string;\r\n  inputValueWidth: number;\r\n  preventBlur?: boolean;\r\n  loading?: boolean;\r\n}\r\n\r\nexport const DefaultState = {\r\n  inputValue: '',\r\n  autocompleteItems: undefined,\r\n  activeTokens: [],\r\n  inFocus: false,\r\n  loading: false,\r\n  preventBlur: false,\r\n  inputValueWidth: 20,\r\n};\r\n\r\nconst defaultToKey = <T extends any>(item: T): string => item.toString();\r\nconst identity = <T extends any>(item: T): T => item;\r\nconst defaultRenderToken = <T extends any>(item: T, { isActive, onClick, onRemove, disabled }: Partial<TokenProps>) => (\r\n  <Token key={item.toString()} isActive={isActive} onClick={onClick} onRemove={onRemove} disabled={disabled}>\r\n    {item}\r\n  </Token>\r\n);\r\n\r\n@locale('TokenInput', TokenInputLocaleHelper)\r\nexport class TokenInput<T = string> extends React.PureComponent<TokenInputProps<T>, TokenInputState<T>> {\r\n  public static __KONTUR_REACT_UI__ = 'TokenInput';\r\n\r\n  public static defaultProps: Partial<TokenInputProps<any>> = {\r\n    selectedItems: [],\r\n    renderItem: identity,\r\n    renderValue: identity,\r\n    valueToString: identity,\r\n    valueToItem: (item: string) => item,\r\n    toKey: defaultToKey,\r\n    onValueChange: () => void 0,\r\n    width: 250 as string | number,\r\n    onBlur: emptyHandler,\r\n    onFocus: emptyHandler,\r\n    onMouseEnter: emptyHandler,\r\n    onMouseLeave: emptyHandler,\r\n  };\r\n\r\n  public state: TokenInputState<T> = DefaultState;\r\n\r\n  private readonly locale!: TokenInputLocale;\r\n  private theme!: Theme;\r\n  private input: HTMLInputElement | null = null;\r\n  private tokensInputMenu: TokenInputMenu<T> | null = null;\r\n  private textHelper: TextWidthHelper | null = null;\r\n  private wrapper: HTMLLabelElement | null = null;\r\n\r\n  public componentDidMount() {\r\n    this.updateInputTextWidth();\r\n    document.addEventListener('copy', this.handleCopy);\r\n    if (this.props.autoFocus) {\r\n      this.focusInput();\r\n    }\r\n  }\r\n\r\n  public componentDidUpdate(prevProps: TokenInputProps<T>, prevState: TokenInputState<T>) {\r\n    if (prevState.inputValue !== this.state.inputValue) {\r\n      this.updateInputTextWidth();\r\n    }\r\n    if (prevState.activeTokens.length === 0 && this.state.activeTokens.length > 0) {\r\n      this.dispatch({\r\n        type: 'SET_AUTOCOMPLETE_ITEMS',\r\n        payload: undefined,\r\n      });\r\n    }\r\n    if (prevProps.selectedItems.length !== this.props.selectedItems.length) {\r\n      LayoutEvents.emit();\r\n    }\r\n    if (!this.isCursorVisibleForState(prevState) && this.isCursorVisible) {\r\n      this.tryGetItems(this.state.inputValue);\r\n    }\r\n  }\r\n\r\n  public componentWillUnmount() {\r\n    document.removeEventListener('copy', this.handleCopy);\r\n  }\r\n\r\n  public render() {\r\n    return (\r\n      <ThemeContext.Consumer>\r\n        {theme => {\r\n          this.theme = theme;\r\n          return this.renderMain();\r\n        }}\r\n      </ThemeContext.Consumer>\r\n    );\r\n  }\r\n\r\n  private renderMain() {\r\n    if (this.type !== TokenInputType.WithoutReference && !this.props.getItems) {\r\n      throw Error('Missed getItems for type ' + this.type);\r\n    }\r\n\r\n    const {\r\n      selectedItems,\r\n      width,\r\n      maxMenuHeight,\r\n      error,\r\n      warning,\r\n      disabled,\r\n      placeholder,\r\n      renderItem,\r\n      renderNotFound,\r\n      hideMenuIfEmptyInputValue,\r\n      onMouseEnter,\r\n      onMouseLeave,\r\n    } = this.props;\r\n\r\n    const { activeTokens, inFocus, inputValueWidth, inputValue, autocompleteItems, loading } = this.state;\r\n\r\n    const showMenu =\r\n      this.type !== TokenInputType.WithoutReference &&\r\n      this.isCursorVisible &&\r\n      activeTokens.length === 0 &&\r\n      (inputValue !== '' || !hideMenuIfEmptyInputValue);\r\n\r\n    const inputInlineStyles: React.CSSProperties = {\r\n      // вычисляем ширину чтобы input автоматически перенёсся на следующую строку при необходимости\r\n      width: Math.max(50, inputValueWidth + 7),\r\n      // input растягивается на всю ширину чтобы placeholder не обрезался\r\n      flex: selectedItems && selectedItems.length === 0 ? 1 : undefined,\r\n      // в ie не работает, но альтернативный способ --- дать tabindex для label --- предположительно ещё сложнее\r\n      caretColor: this.isCursorVisible ? undefined : 'transparent',\r\n    };\r\n\r\n    const theme = this.theme;\r\n    const labelClassName = cn(jsStyles.label(theme), {\r\n      [jsStyles.labelFocused(theme)]: !!inFocus,\r\n      [jsStyles.error(theme)]: !!error,\r\n      [jsStyles.warning(theme)]: !!warning,\r\n      [jsStyles.labelDisabled(theme)]: !!disabled,\r\n    });\r\n    const inputClassName = cn(jsStyles.input(theme), {\r\n      [jsStyles.inputDisabled(theme)]: !!disabled,\r\n    });\r\n    return (\r\n      <div onMouseEnter={onMouseEnter} onMouseLeave={onMouseLeave}>\r\n        {/* расчёт ширины текста с последующим обновлением ширины input */}\r\n        <TextWidthHelper ref={this.textHelperRef} text={inputValue} />\r\n        <label\r\n          ref={this.wrapperRef}\r\n          style={{ width }}\r\n          className={labelClassName}\r\n          onMouseDown={this.handleWrapperMouseDown}\r\n          onMouseUp={this.handleWrapperMouseUp}\r\n        >\r\n          {this.renderTokenFields()}\r\n          <input\r\n            type=\"text\"\r\n            ref={this.inputRef}\r\n            value={inputValue}\r\n            style={inputInlineStyles}\r\n            autoComplete=\"off\"\r\n            spellCheck={false}\r\n            disabled={disabled}\r\n            className={inputClassName}\r\n            placeholder={selectedItems.length > 0 ? undefined : placeholder}\r\n            onFocus={this.handleInputFocus}\r\n            onBlur={this.handleInputBlur}\r\n            onChange={this.handleChangeInputValue}\r\n            onKeyDown={this.handleKeyDown}\r\n            onPaste={this.handleInputPaste}\r\n          />\r\n          {showMenu && (\r\n            <TokenInputMenu\r\n              ref={this.tokensInputMenuRef}\r\n              items={autocompleteItems}\r\n              loading={loading}\r\n              opened={showMenu}\r\n              maxMenuHeight={maxMenuHeight}\r\n              anchorElement={this.input!}\r\n              renderNotFound={renderNotFound}\r\n              renderItem={renderItem}\r\n              onValueChange={this.handleValueChange}\r\n              renderAddButton={this.renderAddButton}\r\n            />\r\n          )}\r\n        </label>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Сбрасывает введенное пользователем значение\r\n   * @public\r\n   */\r\n  public reset() {\r\n    this.dispatch({ type: 'RESET' });\r\n  }\r\n\r\n  private hasValueInItems = (items: T[], value: T) => {\r\n    if (typeof value === 'string') {\r\n      return items.includes(value);\r\n    }\r\n    // todo: как то не очень\r\n    return items.some(item => isEqual(item, value));\r\n  };\r\n\r\n  private get showAddItemHint() {\r\n    const items = this.state.autocompleteItems;\r\n    const value = this.props.valueToItem(this.state.inputValue);\r\n\r\n    if (items && this.hasValueInItems(items, value)) {\r\n      return false;\r\n    }\r\n\r\n    const selectedItems = this.props.selectedItems;\r\n    if (selectedItems && this.hasValueInItems(selectedItems, value)) {\r\n      return false;\r\n    }\r\n\r\n    if (this.type === TokenInputType.Combined && this.state.inputValue !== '') {\r\n      return true;\r\n    }\r\n  }\r\n\r\n  private get type() {\r\n    return this.props.type ? this.props.type : TokenInputType.WithReference;\r\n  }\r\n\r\n  private get delimiters() {\r\n    return this.props.delimiters ? this.props.delimiters : [','];\r\n  }\r\n\r\n  private get menuRef(): Menu | null {\r\n    return this.tokensInputMenu && this.tokensInputMenu.getMenuRef();\r\n  }\r\n\r\n  private get isCursorVisible() {\r\n    return this.isCursorVisibleForState(this.state);\r\n  }\r\n\r\n  private isCursorVisibleForState(state: TokenInputState<T>) {\r\n    return state.inFocus && (state.inputValue !== '' || state.activeTokens.length === 0);\r\n  }\r\n\r\n  private inputRef = (node: HTMLInputElement) => (this.input = node);\r\n  private tokensInputMenuRef = (node: TokenInputMenu<T>) => (this.tokensInputMenu = node);\r\n  private textHelperRef = (node: TextWidthHelper) => (this.textHelper = node);\r\n  private wrapperRef = (node: HTMLLabelElement) => (this.wrapper = node);\r\n\r\n  private dispatch = (action: TokenInputAction, cb?: () => void) => {\r\n    this.setState(prevState => tokenInputReducer(prevState, action), cb);\r\n  };\r\n\r\n  private updateInputTextWidth() {\r\n    if (this.textHelper) {\r\n      const inputValueWidth = this.textHelper.getTextWidth();\r\n      this.dispatch({ type: 'SET_INPUT_VALUE_WIDTH', payload: inputValueWidth }, LayoutEvents.emit);\r\n    }\r\n  }\r\n\r\n  private handleInputFocus = (event: FocusEvent<HTMLInputElement>) => {\r\n    this.dispatch({ type: 'SET_FOCUS_IN' });\r\n    if (this.props.onFocus) {\r\n      this.props.onFocus(event);\r\n    }\r\n  };\r\n\r\n  private handleInputBlur = (event: FocusEvent<HTMLInputElement>) => {\r\n    if (this.isBlurToMenu(event) || this.state.preventBlur) {\r\n      event.preventDefault();\r\n      // первый focus нужен для предотвращения/уменьшения моргания в других браузерах\r\n      this.input!.focus();\r\n      // в firefox не работает без второго focus\r\n      process.nextTick(() => this.input!.focus());\r\n      this.dispatch({ type: 'SET_PREVENT_BLUR', payload: false });\r\n    } else {\r\n      this.dispatch({ type: 'BLUR' });\r\n    }\r\n    if (this.props.onBlur) {\r\n      this.props.onBlur(event);\r\n    }\r\n  };\r\n\r\n  private isBlurToMenu = (event: FocusEvent<HTMLElement>) => {\r\n    if (this.menuRef) {\r\n      const menu = findDOMNode(this.menuRef) as HTMLElement | null;\r\n      const relatedTarget = (event.relatedTarget || document.activeElement) as HTMLElement;\r\n      if (menu && menu.contains(relatedTarget)) {\r\n        return true;\r\n      }\r\n    }\r\n    return false;\r\n  };\r\n\r\n  private handleWrapperMouseDown = (event: React.MouseEvent<HTMLElement>) => {\r\n    this.dispatch({ type: 'SET_PREVENT_BLUR', payload: true });\r\n    const target = event.target as HTMLElement;\r\n    const isClickOnToken =\r\n      target && this.wrapper!.contains(target) && target !== this.wrapper! && target !== this.input!;\r\n    if (!isClickOnToken) {\r\n      this.dispatch({ type: 'REMOVE_ALL_ACTIVE_TOKENS' });\r\n    }\r\n  };\r\n\r\n  private handleWrapperMouseUp = () => {\r\n    this.dispatch({ type: 'SET_PREVENT_BLUR', payload: false });\r\n  };\r\n\r\n  private handleCopy = (event: any) => {\r\n    if (!this.state.inFocus || this.state.activeTokens.length === 0 || this.isCursorVisible) {\r\n      return;\r\n    }\r\n    event.preventDefault();\r\n\r\n    // упорядочивание токенов по индексу\r\n    const tokens = this.state.activeTokens\r\n      .map(token => this.props.selectedItems.indexOf(token))\r\n      .sort()\r\n      .map(index => this.props.selectedItems[index])\r\n      .map(item => this.props.valueToString(item));\r\n    event.clipboardData.setData('text/plain', tokens.join(this.delimiters[0]));\r\n  };\r\n\r\n  private handleInputPaste = (event: React.ClipboardEvent<HTMLElement>) => {\r\n    if (this.type === TokenInputType.WithReference || !event.clipboardData) {\r\n      return;\r\n    }\r\n    let paste = event.clipboardData.getData('text');\r\n    const delimiters = this.delimiters;\r\n    if (delimiters.some(delimiter => paste.includes(delimiter))) {\r\n      event.preventDefault();\r\n      event.stopPropagation();\r\n      for (const delimiter of delimiters) {\r\n        paste = paste.split(delimiter).join(delimiters[0]);\r\n      }\r\n      const tokens = paste.split(delimiters[0]);\r\n      const items = tokens\r\n        .map(token => this.props.valueToItem(token))\r\n        .filter(item => !this.hasValueInItems(this.props.selectedItems, item));\r\n      const newItems = this.props.selectedItems.concat(items);\r\n      this.props.onValueChange(newItems);\r\n    }\r\n  };\r\n\r\n  private tryGetItems = async (query = '') => {\r\n    if (this.props.getItems && (this.state.inputValue !== '' || !this.props.hideMenuIfEmptyInputValue)) {\r\n      this.dispatch({ type: 'SET_LOADING', payload: true });\r\n      const autocompleteItems = await this.props.getItems(query);\r\n      this.dispatch({ type: 'SET_LOADING', payload: false });\r\n\r\n      const autocompleteItemsUnique = autocompleteItems.filter(\r\n        item => !this.hasValueInItems(this.props.selectedItems, item),\r\n      );\r\n      if (query === '' || this.state.inputValue !== '') {\r\n        this.dispatch({ type: 'SET_AUTOCOMPLETE_ITEMS', payload: autocompleteItemsUnique }, () => {\r\n          LayoutEvents.emit();\r\n          this.highlightMenuItem();\r\n        });\r\n      }\r\n    }\r\n  };\r\n\r\n  private handleKeyDown = (event: KeyboardEvent<HTMLInputElement>) => {\r\n    if (this.isCursorVisible) {\r\n      this.handleInputKeyDown(event);\r\n    } else {\r\n      this.handleWrapperKeyDown(event);\r\n    }\r\n  };\r\n\r\n  private handleInputKeyDown = (e: KeyboardEvent<HTMLInputElement>) => {\r\n    e.stopPropagation();\r\n\r\n    if (this.type !== TokenInputType.WithReference && (isKeyEnter(e) || this.delimiters.includes(e.key))) {\r\n      e.preventDefault();\r\n      const newValue = this.state.inputValue;\r\n      if (newValue !== '') {\r\n        this.handleAddItem();\r\n      }\r\n    }\r\n\r\n    switch (true) {\r\n      case isKeyEnter(e):\r\n        if (this.menuRef) {\r\n          this.menuRef.enter(e);\r\n        }\r\n        break;\r\n      case isKeyArrowVertical(e):\r\n        e.preventDefault();\r\n        if (this.menuRef) {\r\n          if (isKeyArrowUp(e)) {\r\n            this.menuRef.up();\r\n          } else {\r\n            this.menuRef.down();\r\n          }\r\n        }\r\n        break;\r\n      case isKeyEscape(e):\r\n        this.input!.blur();\r\n        break;\r\n      case isKeyBackspace(e):\r\n        this.moveFocusToLastToken();\r\n        break;\r\n      case isKeyArrowLeft(e):\r\n        if (this.input!.selectionStart === 0) {\r\n          this.moveFocusToLastToken();\r\n        }\r\n        break;\r\n    }\r\n  };\r\n\r\n  private moveFocusToLastToken() {\r\n    const items = this.props.selectedItems;\r\n    if (this.state.inputValue === '' && items && items.length > 0) {\r\n      this.dispatch({ type: 'SET_ACTIVE_TOKENS', payload: items.slice(-1) });\r\n    }\r\n  }\r\n\r\n  private focusInput = () => {\r\n    process.nextTick(() => this.input!.focus());\r\n  };\r\n\r\n  private handleWrapperKeyDown = (e: KeyboardEvent<HTMLElement>) => {\r\n    switch (true) {\r\n      case isKeyBackspace(e):\r\n      case isKeyDelete(e): {\r\n        const itemsNew = this.props.selectedItems.filter(item => !this.hasValueInItems(this.state.activeTokens, item));\r\n        this.props.onValueChange(itemsNew);\r\n        this.dispatch({ type: 'REMOVE_ALL_ACTIVE_TOKENS' }, () => {\r\n          LayoutEvents.emit();\r\n          this.input!.focus();\r\n        });\r\n        break;\r\n      }\r\n      case isKeyArrowHorizontal(e):\r\n        this.handleWrapperArrows(e);\r\n        break;\r\n      case isKeyEscape(e):\r\n        this.wrapper!.blur();\r\n        break;\r\n      case isShortcutSelectAll(e):\r\n        e.preventDefault();\r\n        this.dispatch({\r\n          type: 'SET_ACTIVE_TOKENS',\r\n          payload: this.props.selectedItems,\r\n        });\r\n        break;\r\n    }\r\n  };\r\n\r\n  private handleWrapperArrows = (e: KeyboardEvent<HTMLElement>) => {\r\n    e.preventDefault();\r\n    const activeTokens = this.state.activeTokens;\r\n    const activeItemIndex = this.props.selectedItems.indexOf(activeTokens[0]);\r\n    const newItemIndex = activeItemIndex + (isKeyArrowLeft(e) ? -1 : +1);\r\n    const isLeftEdge = activeItemIndex === 0 && isKeyArrowLeft(e);\r\n    const isRightEdge = activeItemIndex === this.props.selectedItems.length - 1 && isKeyArrowRight(e);\r\n    if (!e.shiftKey && activeTokens.length === 1) {\r\n      this.handleWrapperArrowsWithoutShift(isLeftEdge, isRightEdge, newItemIndex);\r\n    } else {\r\n      this.handleWrapperArrowsWithShift(isLeftEdge, isRightEdge, newItemIndex);\r\n    }\r\n  };\r\n\r\n  private handleWrapperArrowsWithoutShift = (isLeftEdge: boolean, isRightEdge: boolean, newItemIndex: number) => {\r\n    if (isRightEdge) {\r\n      this.dispatch({ type: 'REMOVE_ALL_ACTIVE_TOKENS' }, () => this.input!.focus());\r\n    } else if (!isLeftEdge) {\r\n      this.dispatch({\r\n        type: 'SET_ACTIVE_TOKENS',\r\n        payload: [this.props.selectedItems[newItemIndex]],\r\n      });\r\n    }\r\n  };\r\n\r\n  private handleWrapperArrowsWithShift = (isLeftEdge: boolean, isRightEdge: boolean, newItemIndex: number) => {\r\n    if (!isLeftEdge && !isRightEdge) {\r\n      const itemNew = this.props.selectedItems[newItemIndex];\r\n      const itemsNew = [itemNew, ...this.state.activeTokens.filter(item => !isEqual(item, itemNew))];\r\n      this.dispatch({ type: 'SET_ACTIVE_TOKENS', payload: itemsNew });\r\n    }\r\n  };\r\n\r\n  private handleValueChange = (item: T) => {\r\n    if (this.hasValueInItems(this.props.selectedItems, item)) {\r\n      return;\r\n    }\r\n\r\n    const newItems = this.props.selectedItems.concat([item]);\r\n    this.props.onValueChange(newItems);\r\n\r\n    this.dispatch({ type: 'CLEAR_INPUT' });\r\n    this.tryGetItems();\r\n  };\r\n\r\n  private handleAddItem = () => {\r\n    const item = this.state.inputValue;\r\n    const value = this.props.valueToItem(item);\r\n    if (this.hasValueInItems(this.props.selectedItems, value)) {\r\n      return;\r\n    }\r\n\r\n    const newItems = this.props.selectedItems.concat([value]);\r\n    this.props.onValueChange(newItems);\r\n\r\n    this.dispatch({ type: 'CLEAR_INPUT' });\r\n    this.tryGetItems();\r\n  };\r\n\r\n  private handleRemoveToken = (item: T) => {\r\n    this.props.onValueChange(this.props.selectedItems.filter(_ => !isEqual(_, item)));\r\n    const filteredActiveTokens = this.state.activeTokens.filter(_ => !isEqual(_, item));\r\n\r\n    this.dispatch({ type: 'SET_ACTIVE_TOKENS', payload: filteredActiveTokens });\r\n    if (filteredActiveTokens.length === 0) {\r\n      this.focusInput();\r\n    }\r\n\r\n    this.tryGetItems();\r\n  };\r\n\r\n  private handleTokenClick = (event: React.MouseEvent<HTMLElement>, itemNew: T) => {\r\n    const items = this.state.activeTokens;\r\n    if (event.ctrlKey) {\r\n      const newItems = this.hasValueInItems(this.state.activeTokens, itemNew)\r\n        ? items.filter(item => !isEqual(item, itemNew))\r\n        : [...items, itemNew];\r\n      this.dispatch({ type: 'SET_ACTIVE_TOKENS', payload: newItems });\r\n    } else {\r\n      this.dispatch({ type: 'SET_ACTIVE_TOKENS', payload: [itemNew] });\r\n    }\r\n    this.focusInput();\r\n  };\r\n\r\n  private handleChangeInputValue = (event: ChangeEvent<HTMLInputElement>) => {\r\n    let query = event.target.value.trimLeft();\r\n    if (query.endsWith(' ')) {\r\n      query = query.trimRight() + ' ';\r\n    }\r\n    if (this.state.inputValue !== '' && query === '') {\r\n      this.dispatch({ type: 'SET_AUTOCOMPLETE_ITEMS', payload: undefined });\r\n    }\r\n    this.dispatch({ type: 'UPDATE_QUERY', payload: query }, () => {\r\n      this.tryGetItems(query);\r\n    });\r\n    if (this.props.onInputValueChange) {\r\n      this.props.onInputValueChange(query);\r\n    }\r\n  };\r\n\r\n  private highlightMenuItem = () => {\r\n    if (\r\n      this.menuRef &&\r\n      this.state.autocompleteItems &&\r\n      this.state.autocompleteItems.length > 0 &&\r\n      this.type !== TokenInputType.Combined\r\n    ) {\r\n      this.menuRef.highlightItem(0);\r\n    }\r\n  };\r\n\r\n  private renderTokenFields = () => {\r\n    return this.props.selectedItems.map(this.renderToken);\r\n  };\r\n\r\n  private renderToken = (item: T) => {\r\n    const { renderToken = defaultRenderToken, disabled } = this.props;\r\n\r\n    const isActive = this.state.activeTokens.includes(item);\r\n\r\n    // TODO useCallback\r\n    const handleIconClick: React.MouseEventHandler<HTMLElement> = event => {\r\n      event.stopPropagation();\r\n      this.handleRemoveToken(item);\r\n    };\r\n\r\n    // TODO useCallback\r\n    const handleTokenClick: React.MouseEventHandler<HTMLDivElement> = event => {\r\n      event.stopPropagation();\r\n      this.handleTokenClick(event, item);\r\n    };\r\n\r\n    return renderToken(item, {\r\n      isActive,\r\n      onClick: handleTokenClick,\r\n      onRemove: handleIconClick,\r\n      disabled,\r\n    });\r\n  };\r\n\r\n  private renderAddButton = (value = this.state.inputValue): React.ReactNode | undefined => {\r\n    if (!this.showAddItemHint) {\r\n      return;\r\n    }\r\n\r\n    if (this.props.renderAddButton) {\r\n      return this.props.renderAddButton(value, this.handleAddItem);\r\n    }\r\n\r\n    const { addButtonComment, addButtonTitle } = this.locale;\r\n\r\n    return (\r\n      <MenuItem onClick={this.handleAddItem} comment={addButtonComment} key=\"renderAddButton\">\r\n        {addButtonTitle} {value}\r\n      </MenuItem>\r\n    );\r\n  };\r\n}\r\n"]}