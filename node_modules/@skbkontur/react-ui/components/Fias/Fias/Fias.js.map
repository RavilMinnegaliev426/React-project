{"version":3,"sources":["Fias.tsx"],"names":["React","isEqual","warning","cn","Link","locale","ThemeContext","EditIcon","LocaleContext","FiasLocaleHelper","FiasExtraFields","FiasModal","FiasForm","FiasAPI","FiasAddress","FiasLogger","jsStyles","deepMerge","dst","src","forEach","obj","k","Fias","props","state","opened","address","get","fieldsSettings","theme","api","baseUrl","version","form","componentDidMount","updateLocale","init","componentDidUpdate","prevProps","prevState","value","updateAddress","updateFieldsSettings","onInit","getValue","isFieldVisible","postalcode","getAddress","setState","nextLocale","handleOpen","handleClose","onClose","handleSave","submit","hasErrors","allowNotVerified","handleChange","onValueChange","refForm","element","log","warnings","baseUrlOrApiIsRequired","field","render","renderMain","showAddressText","label","icon","error","feedback","linkText","isEmpty","addressFill","addressEdit","validation","Boolean","getFullText","readonly","renderModal","search","limit","formValidation","countrySelector","userSettings","defaultSettings","ALL_FIELDS","reduce","settings","visible","Component","__KONTUR_REACT_UI__","defaultProps"],"mappings":"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","sourcesContent":["import React from 'react';\r\nimport isEqual from 'lodash.isequal';\r\nimport warning from 'warning';\r\nimport cn from 'classnames';\r\n\r\nimport { Link } from '../Link';\r\nimport { locale } from '../../lib/locale/decorators';\r\nimport { ThemeContext } from '../../lib/theming/ThemeContext';\r\nimport { Theme } from '../../lib/theming/Theme';\r\nimport { EditIcon } from '../../internal/icons/16px';\r\nimport { LocaleContext } from '../../lib/locale';\r\n\r\nimport { FiasLocale, FiasLocaleHelper } from './locale';\r\nimport {\r\n  FiasAPIProvider,\r\n  FiasExtraFields,\r\n  FiasValue,\r\n  FiasFields,\r\n  FiasFieldsSettings,\r\n  FiasFormValidation,\r\n} from './types';\r\nimport { FiasModal } from './FiasModal';\r\nimport { FiasForm } from './Form/FiasForm';\r\nimport { FiasAPI } from './api/FiasAPI';\r\nimport { FiasAddress } from './models/FiasAddress';\r\nimport { FiasLogger } from './logger/FiasLogger';\r\nimport { jsStyles } from './Fias.styles';\r\n\r\nexport interface FiasProps {\r\n  /**\r\n   * Значение адреса. См. формат в примерах\r\n   */\r\n  value?: Partial<FiasValue>;\r\n  error?: boolean;\r\n  warning?: boolean;\r\n  /**\r\n   * Сообщение пользователю в режиме `error` или `warning`\r\n   */\r\n  feedback?: string;\r\n  /**\r\n   * Выводить ли текстовую интерпретацию адреса над ссылкой\r\n   */\r\n  showAddressText?: boolean;\r\n  /**\r\n   * Текст ссылки\r\n   */\r\n  label?: string;\r\n  /**\r\n   * Иконка рядом со ссылкой\r\n   */\r\n  icon?: React.ReactElement<any>;\r\n  readonly?: boolean;\r\n  /**\r\n   * API URL. Существует тестовый\r\n   * `https://api.testkontur.ru/fias/v1/` и боевой `https://api.kontur.ru/fias/v1/`\r\n   */\r\n  baseUrl?: string;\r\n  /**\r\n   * API instance. Если нет возможности использовать стандартный API.\r\n   */\r\n  api?: FiasAPIProvider;\r\n  /**\r\n   * Позволяет получить полный FiasValue после обработки входного `value`\r\n   */\r\n  onInit?: (value: FiasValue) => void;\r\n  onValueChange?: (value: FiasValue) => void;\r\n  onClose?: () => void;\r\n  /**\r\n   * Добавляет поле поиска адреса в произвольной форме\r\n   */\r\n  search?: boolean;\r\n  /**\r\n   * Количество отображаемых элементов в выпадающих списках\r\n   */\r\n  limit?: number;\r\n  /**\r\n   * Уровень критичности ошибок валидации полей адреса\r\n   */\r\n  formValidation?: FiasFormValidation;\r\n  /**\r\n   * Разрешать ли сохранять неверефицированный (произвольный, не из базы) адрес\r\n   */\r\n  allowNotVerified?: boolean;\r\n  /**\r\n   * Версия базы данных ФИАС. Формат: \"2018-10-22\"\r\n   */\r\n  version?: string;\r\n  /**\r\n   * Настройка полей. Достаточно переопределить только нужные.\r\n   * Внимание, не рекомендуется скрывать поля в произвольном порядке. Это может привести\r\n   * к невозможности заполнения некоторых адресов.\r\n   * Значение по умолчанию:\r\n   *\r\n   * ```ts\r\n   *  {\r\n   *     region:\r\n   *     ...\r\n   *     room: {\r\n   *       visible: true\r\n   *     },\r\n   *     postalcode: {\r\n   *       visible: false\r\n   *     }\r\n   *  }```\r\n   *\r\n   */\r\n  fieldsSettings: FiasFieldsSettings;\r\n  /* Выбор страны */\r\n  countrySelector: boolean;\r\n}\r\n\r\nexport interface FiasState {\r\n  opened: boolean;\r\n  address: FiasAddress;\r\n  locale: FiasLocale;\r\n  fieldsSettings: FiasFieldsSettings;\r\n}\r\n\r\nfunction deepMerge<T>(dst: T, ...src: T[]): T {\r\n  src.forEach(obj => {\r\n    for (const k in obj) {\r\n      if (dst[k] != null && typeof obj[k] === 'object') {\r\n        dst[k] = deepMerge(dst[k], obj[k]);\r\n      } else {\r\n        dst[k] = obj[k];\r\n      }\r\n    }\r\n  });\r\n  return dst;\r\n}\r\n\r\n/**\r\n * @deprecated Контур-специфичный компонент, будет удален в 3.0.0, перенесен в `@skbkontur/react-ui-addons` смотри [миграцию](https://github.com/skbkontur/retail-ui/blob/master/packages/react-ui/MIGRATION.md)\r\n */\r\n\r\n@locale('Fias', FiasLocaleHelper)\r\nexport class Fias extends React.Component<FiasProps, FiasState> {\r\n  public static __KONTUR_REACT_UI__ = 'Fias';\r\n\r\n  public static defaultProps = {\r\n    showAddressText: true,\r\n    error: false,\r\n    warning: false,\r\n    readonly: false,\r\n    search: false,\r\n    icon: <EditIcon />,\r\n    allowNotVerified: true,\r\n    fieldsSettings: {},\r\n    countrySelector: false,\r\n  };\r\n\r\n  public state: FiasState = {\r\n    opened: false,\r\n    address: new FiasAddress(),\r\n    locale: FiasLocaleHelper.get(),\r\n    fieldsSettings: this.fieldsSettings,\r\n  };\r\n\r\n  private theme!: Theme;\r\n  private api: FiasAPIProvider = this.props.api || new FiasAPI(this.props.baseUrl, this.props.version);\r\n  private form: FiasForm | null = null;\r\n\r\n  private readonly locale!: FiasLocale;\r\n\r\n  public constructor(props: FiasProps) {\r\n    super(props);\r\n    warning(\r\n      true,\r\n      `Fias has been deprecated, use Fias from @skbkontur/react-ui-addons instead, see [migration](https://github.com/skbkontur/retail-ui/blob/master/packages/react-ui/MIGRATION.md)`,\r\n    );\r\n    if (!props.baseUrl && !props.api) {\r\n      FiasLogger.log(FiasLogger.warnings.baseUrlOrApiIsRequired);\r\n    }\r\n  }\r\n\r\n  public get fieldsSettings(): FiasFieldsSettings {\r\n    const { fieldsSettings: userSettings, countrySelector } = this.props;\r\n    // TODO: implement deepMerge with clone\r\n    const defaultSettings = FiasAddress.ALL_FIELDS.reduce<FiasFieldsSettings>(\r\n      (settings: FiasFieldsSettings, field: FiasFields | FiasExtraFields) => ({\r\n        ...settings,\r\n        [field]: {\r\n          visible: true,\r\n        },\r\n      }),\r\n      {},\r\n    );\r\n    return deepMerge<FiasFieldsSettings>(\r\n      defaultSettings,\r\n      {\r\n        [FiasExtraFields.postalcode]: {\r\n          visible: Boolean(countrySelector),\r\n        },\r\n      },\r\n      userSettings,\r\n    );\r\n  }\r\n\r\n  public componentDidMount = () => {\r\n    this.updateLocale();\r\n    this.init();\r\n  };\r\n\r\n  public componentDidUpdate = (prevProps: FiasProps, prevState: FiasState) => {\r\n    if (!isEqual(prevProps.value, this.props.value)) {\r\n      this.updateAddress();\r\n    }\r\n    if (!isEqual(prevState.locale, this.locale)) {\r\n      this.updateLocale(this.locale);\r\n    }\r\n    if (!isEqual(prevProps.fieldsSettings, this.props.fieldsSettings)) {\r\n      this.updateFieldsSettings();\r\n    }\r\n  };\r\n\r\n  public isFieldVisible(field: FiasFields | FiasExtraFields): boolean {\r\n    return FiasAddress.isFieldVisible(field, this.state.fieldsSettings);\r\n  }\r\n\r\n  public render() {\r\n    return (\r\n      <ThemeContext.Consumer>\r\n        {theme => {\r\n          this.theme = theme;\r\n          return this.renderMain();\r\n        }}\r\n      </ThemeContext.Consumer>\r\n    );\r\n  }\r\n\r\n  private renderMain() {\r\n    const { showAddressText, label, icon, error, warning, feedback } = this.props;\r\n    const { opened, address } = this.state;\r\n\r\n    const linkText = label || (address.isEmpty ? this.state.locale.addressFill : this.state.locale.addressEdit);\r\n\r\n    const validation =\r\n      (error || warning) && feedback ? (\r\n        <span\r\n          className={cn({\r\n            [jsStyles.error(this.theme)]: Boolean(error),\r\n            [jsStyles.warning(this.theme)]: Boolean(warning),\r\n          })}\r\n        >\r\n          {feedback}\r\n        </span>\r\n      ) : null;\r\n\r\n    return (\r\n      <LocaleContext.Provider value={{ locale: { Fias: this.state.locale } }}>\r\n        <div>\r\n          {showAddressText && <span>{address.getFullText(this.isFieldVisible(FiasExtraFields.postalcode))}</span>}\r\n          {!this.props.readonly && (\r\n            <div>\r\n              <Link icon={icon} onClick={this.handleOpen}>\r\n                {linkText}\r\n              </Link>\r\n            </div>\r\n          )}\r\n          {validation}\r\n          {opened && this.renderModal()}\r\n        </div>\r\n      </LocaleContext.Provider>\r\n    );\r\n  }\r\n\r\n  private renderModal() {\r\n    const { address, fieldsSettings } = this.state;\r\n    const { search, limit, formValidation, countrySelector } = this.props;\r\n    return (\r\n      <FiasModal onClose={this.handleClose} onSave={this.handleSave}>\r\n        <FiasForm\r\n          ref={this.refForm}\r\n          address={address}\r\n          api={this.api}\r\n          search={search}\r\n          limit={limit}\r\n          validationLevel={formValidation}\r\n          fieldsSettings={fieldsSettings}\r\n          countrySelector={countrySelector}\r\n        />\r\n      </FiasModal>\r\n    );\r\n  }\r\n\r\n  private init = async () => {\r\n    const address = await this.updateAddress();\r\n    if (this.props.onInit) {\r\n      this.props.onInit(address.getValue(this.isFieldVisible(FiasExtraFields.postalcode)));\r\n    }\r\n  };\r\n\r\n  private updateAddress = async (): Promise<FiasAddress> => {\r\n    const address = await FiasAddress.getAddress(this.api, this.props.value, this.state.fieldsSettings);\r\n    this.setState({\r\n      address,\r\n    });\r\n    return address;\r\n  };\r\n\r\n  private updateLocale = (nextLocale: FiasLocale = FiasLocaleHelper.get()): void => {\r\n    this.setState({ locale: nextLocale });\r\n  };\r\n\r\n  private updateFieldsSettings = (): void => {\r\n    this.setState({\r\n      fieldsSettings: this.fieldsSettings,\r\n    });\r\n  };\r\n\r\n  private handleOpen = () => {\r\n    this.setState({ opened: true });\r\n  };\r\n\r\n  private handleClose = () => {\r\n    this.setState({ opened: false });\r\n    const onClose = this.props.onClose;\r\n    if (onClose) {\r\n      onClose();\r\n    }\r\n  };\r\n\r\n  private handleSave = async () => {\r\n    if (this.form) {\r\n      const address = await this.form.submit();\r\n      if (address.hasErrors && this.props.allowNotVerified === false) {\r\n        return;\r\n      }\r\n      this.handleChange(address);\r\n    }\r\n    this.handleClose();\r\n  };\r\n\r\n  private handleChange = (address: FiasAddress) => {\r\n    if (this.props.onValueChange) {\r\n      this.props.onValueChange(address.getValue(this.isFieldVisible(FiasExtraFields.postalcode)));\r\n    }\r\n  };\r\n\r\n  private refForm = (element: FiasForm | null) => {\r\n    this.form = element;\r\n  };\r\n}\r\n"]}