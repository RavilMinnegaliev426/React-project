{"version":3,"sources":["FiasForm.tsx"],"names":["React","Gapped","Button","locale","FiasLocaleHelper","FiasExtraFields","FiasFields","FiasFormValidation","FiasAddressElement","Tooltip","Input","FiasSearch","Textarea","FiasAddress","FiasCountrySelector","jsStyles","FiasComboBox","FiasForm","props","state","address","fields","lastVerifyPromise","submit","getCommonFieldProps","field","validationLevel","error","hasError","Error","warning","Warning","placeholder","renderFields","fieldsSettings","map","control","settings","Boolean","visible","meta","render","label","tooltip","renderAddressComboBox","width","comboboxField","isComboboxMeta","createRef","commonProps","limit","renderPostalCodeInput","inputField","postalcode","isInputMeta","value","postalCode","createAddressComboboxMeta","ref","createAddressComboBoxProps","createAddressComboBoxTooltip","createPostalCodeInputMeta","createPostalCodeInputProps","createPostalCodeTooltip","getItems","searchText","createItemsSource","onValueChange","newFields","addressField","handleAddressChange","createFromAddress","validate","onInputValueChange","resetAddressErrors","onUnexpectedInput","query","undefined","renderItem","element","region","data","regionCode","code","substr","getText","diffAddress","getDiffFields","hasParentFields","getClosestParentFiasId","isTypeMatchField","renderValue","renderNotFound","messages","addressNotFound","isAllowedToFill","hasOnlyIndirectParent","push","addressFillParentOrSearch","message","i","m","valueToString","name","itemToValue","defaultProps","options","parentFiasId","fullAddress","isAllowedToSearchFullAddress","directParent","isAllowedToSearchThroughChildrenOfDirectParent","api","search","then","result","success","Promise","resolve","item","createFromResponse","reject","getFieldTooltipContent","None","getError","tooltipContent","combobox","hasItems","addressSelectItemFromList","replacePostalCode","additionalFields","isPostalCodeAltered","postalcodeReplace","verify","removeFiasData","handleCountryChange","country","handleForeignAddressChange","foreignAddress","callback","setState","filterVisibleFields","handleSearchChange","hasErrors","errors","ALL_FIELDS","reduce","district","city","intracityarea","settlement","planningstructure","street","stead","house","room","componentDidMount","countrySelector","countryLabel","searchPlaceholder","isForeignForm","foreignAddressLabel","foreignAddressPlaceholder","newAdditionalFields","verifyPromise","verifiedAddress","isForeign","Component","__KONTUR_REACT_UI__","Field","children","row","Object","prototype","hasOwnProperty","call"],"mappings":"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","sourcesContent":["import React from 'react';\r\n\r\nimport { Gapped } from '../../Gapped';\r\nimport { Button } from '../../Button';\r\nimport { locale } from '../../../lib/locale/decorators';\r\nimport { FiasLocale, FiasLocaleHelper } from '../locale';\r\nimport {\r\n  FiasAddressResponse,\r\n  FiasAPIProvider,\r\n  FiasAPIResult,\r\n  FiasExtraFields,\r\n  FiasCountry,\r\n  FiasFields,\r\n  FiasFieldsSettings,\r\n  FiasFormValidation,\r\n  FiasSearchOptions,\r\n  FiasVerifyResponse,\r\n} from '../types';\r\nimport { FiasAddressElement } from '../models/FiasAddressElement';\r\nimport { Tooltip } from '../../Tooltip';\r\nimport { Input, InputProps } from '../../Input';\r\nimport { FiasSearch } from '../FiasSearch/FiasSearch';\r\nimport { Textarea } from '../../Textarea';\r\nimport { FiasAddress } from '../models/FiasAddress';\r\n\r\nimport { FiasCountrySelector } from './FiasCountrySelector';\r\nimport { jsStyles } from './FiasForm.styles';\r\nimport { FiasComboBox, FiasComboBoxProps } from './FiasComboBox';\r\n\r\ninterface FiasFormProps {\r\n  api: FiasAPIProvider;\r\n  address: FiasAddress;\r\n  fieldsSettings: FiasFieldsSettings;\r\n  search?: boolean;\r\n  limit?: number;\r\n  validationLevel?: FiasFormValidation;\r\n  countrySelector?: boolean;\r\n}\r\n\r\ninterface FiasFormState {\r\n  address: FiasAddress;\r\n}\r\n\r\ntype FiasFormFields = {\r\n  [field in FiasFields | FiasExtraFields]?: {\r\n    meta: FiasFormFieldMeta;\r\n    render: () => React.ReactNode;\r\n  };\r\n};\r\n\r\ninterface FieldMeta<C, P> {\r\n  ref: C | null;\r\n  props: P;\r\n  createRef: (ref: C | null) => any;\r\n  tooltip: () => React.ReactNode;\r\n}\r\n\r\ntype ComboBoxMeta = FieldMeta<FiasComboBox, FiasComboBoxProps>;\r\ntype InputMeta = FieldMeta<Input, InputProps>;\r\ntype FiasFormFieldMeta = ComboBoxMeta | InputMeta;\r\n\r\n@locale('Fias', FiasLocaleHelper)\r\nexport class FiasForm extends React.Component<FiasFormProps, FiasFormState> {\r\n  public static __KONTUR_REACT_UI__ = 'FiasForm';\r\n\r\n  public static defaultProps = {\r\n    validationLevel: 'Error',\r\n    limit: 5,\r\n    fieldsSettings: {},\r\n    countrySelector: false,\r\n  };\r\n\r\n  public static Field = ({ label, children }: { label?: string; children?: React.ReactNode }) => (\r\n    <div className={jsStyles.row()}>\r\n      {label && <div className={jsStyles.label()}>{label}</div>}\r\n      <div className={jsStyles.field()}>{children}</div>\r\n    </div>\r\n  );\r\n\r\n  public static isComboboxMeta = (meta: FiasFormFieldMeta): meta is ComboBoxMeta => {\r\n    const { props } = meta;\r\n    return (\r\n      Object.prototype.hasOwnProperty.call(props, 'onUnexpectedInput') &&\r\n      Object.prototype.hasOwnProperty.call(props, 'getItems')\r\n    );\r\n  };\r\n\r\n  public static isInputMeta = (meta: FiasFormFieldMeta): meta is InputMeta => {\r\n    const { props } = meta;\r\n    return !FiasForm.isComboboxMeta(meta) && Object.prototype.hasOwnProperty.call(props, 'onValueChange');\r\n  };\r\n\r\n  public state: FiasFormState = {\r\n    address: this.props.address,\r\n  };\r\n\r\n  private readonly locale!: FiasLocale;\r\n\r\n  private fields: FiasFormFields;\r\n\r\n  private lastVerifyPromise: Promise<FiasAddress> | null = null;\r\n\r\n  constructor(props: FiasFormProps) {\r\n    super(props);\r\n\r\n    this.fields = FiasAddress.ALL_FIELDS.reduce<FiasFormFields>(\r\n      (fields: FiasFormFields, field: FiasFields | FiasExtraFields) => {\r\n        switch (field) {\r\n          case FiasFields.region:\r\n          case FiasFields.district:\r\n          case FiasFields.city:\r\n          case FiasFields.intracityarea:\r\n          case FiasFields.settlement:\r\n          case FiasFields.planningstructure:\r\n          case FiasFields.street:\r\n          case FiasFields.stead:\r\n          case FiasFields.house:\r\n          case FiasFields.room:\r\n            return {\r\n              ...fields,\r\n              [field]: {\r\n                meta: this.createAddressComboboxMeta(field),\r\n                render: () => this.renderAddressComboBox(field),\r\n              },\r\n            };\r\n          case FiasExtraFields.postalcode:\r\n            return {\r\n              ...fields,\r\n              [field]: {\r\n                meta: this.createPostalCodeInputMeta(),\r\n                render: () => this.renderPostalCodeInput(),\r\n              },\r\n            };\r\n          default:\r\n            return fields;\r\n        }\r\n      },\r\n      {},\r\n    );\r\n  }\r\n\r\n  public get isForeignForm(): boolean {\r\n    const { address } = this.state;\r\n    const { countrySelector } = this.props;\r\n    return address.isForeign || (Boolean(countrySelector) && !address.country);\r\n  }\r\n\r\n  public componentDidMount() {\r\n    this.validate();\r\n  }\r\n\r\n  public submit = async (): Promise<FiasAddress> => {\r\n    await this.lastVerifyPromise;\r\n    return this.state.address;\r\n  };\r\n\r\n  public render() {\r\n    const { address } = this.state;\r\n    const { api, limit, countrySelector } = this.props;\r\n    return (\r\n      <div>\r\n        <Gapped vertical>\r\n          {countrySelector && (\r\n            <FiasForm.Field label={this.locale.countryLabel}>\r\n              <FiasCountrySelector\r\n                api={api}\r\n                country={address.country}\r\n                onValueChange={this.handleCountryChange}\r\n                limit={limit}\r\n              />\r\n            </FiasForm.Field>\r\n          )}\r\n          {this.props.search && (\r\n            <FiasForm.Field>\r\n              <FiasSearch\r\n                api={api}\r\n                address={address}\r\n                onValueChange={this.handleSearchChange}\r\n                limit={limit}\r\n                placeholder={this.locale.searchPlaceholder}\r\n              />\r\n            </FiasForm.Field>\r\n          )}\r\n          {this.isForeignForm ? (\r\n            <Gapped vertical>\r\n              <FiasForm.Field label={this.locale.foreignAddressLabel}>\r\n                <Textarea\r\n                  value={address.foreignAddress}\r\n                  onValueChange={this.handleForeignAddressChange}\r\n                  placeholder={this.locale.foreignAddressPlaceholder}\r\n                  width=\"100%\"\r\n                  resize=\"none\"\r\n                />\r\n              </FiasForm.Field>\r\n              {this.renderFields([FiasExtraFields.postalcode])}\r\n            </Gapped>\r\n          ) : (\r\n            this.renderFields(FiasAddress.ALL_FIELDS)\r\n          )}\r\n        </Gapped>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  private getCommonFieldProps = (\r\n    field: FiasFields | FiasExtraFields,\r\n  ): {\r\n    warning: boolean;\r\n    error: boolean;\r\n    placeholder: string;\r\n  } => {\r\n    const { address } = this.state;\r\n    const { validationLevel } = this.props;\r\n    return {\r\n      error: address.hasError(field) && validationLevel === FiasFormValidation.Error,\r\n      warning: address.hasError(field) && validationLevel === FiasFormValidation.Warning,\r\n      placeholder: this.locale[`${field}Placeholder` as keyof FiasLocale],\r\n    };\r\n  };\r\n\r\n  private renderFields = (fields: Array<FiasFields | FiasExtraFields>): React.ReactNode => {\r\n    const { fieldsSettings } = this.props;\r\n    return fields.map((field: FiasFields | FiasExtraFields) => {\r\n      const control = this.fields[field];\r\n      const settings = fieldsSettings[field];\r\n      if (control && Boolean(settings && settings.visible)) {\r\n        const { meta, render } = control;\r\n        const label = this.locale[`${field}Label` as keyof FiasLocale];\r\n        return (\r\n          control && (\r\n            <FiasForm.Field label={label} key={field}>\r\n              <Tooltip pos={'right middle'} render={meta.tooltip}>\r\n                {render()}\r\n              </Tooltip>\r\n            </FiasForm.Field>\r\n          )\r\n        );\r\n      }\r\n    });\r\n  };\r\n\r\n  private renderAddressComboBox = (field: FiasFields, width: string | number = '100%'): React.ReactNode => {\r\n    const comboboxField = this.fields[field];\r\n    if (comboboxField && FiasForm.isComboboxMeta(comboboxField.meta)) {\r\n      const { address } = this.state;\r\n      const { props, createRef } = comboboxField.meta;\r\n      const commonProps = this.getCommonFieldProps(field);\r\n      return (\r\n        <FiasComboBox\r\n          {...commonProps}\r\n          {...props}\r\n          value={address}\r\n          width={width}\r\n          drawArrow={false}\r\n          searchOnFocus={false}\r\n          limit={this.props.limit}\r\n          ref={createRef}\r\n        />\r\n      );\r\n    }\r\n  };\r\n\r\n  private renderPostalCodeInput = (): React.ReactNode => {\r\n    const inputField = this.fields[FiasExtraFields.postalcode];\r\n    if (inputField && FiasForm.isInputMeta(inputField.meta)) {\r\n      const { address } = this.state;\r\n      const { props, createRef } = inputField.meta;\r\n      const commonProps = this.getCommonFieldProps(FiasExtraFields.postalcode);\r\n      const value = address.postalCode;\r\n      return <Input {...commonProps} {...props} value={value} width={130} ref={createRef} />;\r\n    }\r\n  };\r\n\r\n  private createAddressComboboxMeta = (field: FiasFields): ComboBoxMeta => {\r\n    return {\r\n      ref: null,\r\n      props: this.createAddressComboBoxProps(field),\r\n      tooltip: this.createAddressComboBoxTooltip(field),\r\n      createRef: (ref: FiasComboBox | null) => {\r\n        const comboboxField = this.fields[field];\r\n        if (comboboxField) {\r\n          comboboxField.meta.ref = ref;\r\n        }\r\n      },\r\n    };\r\n  };\r\n\r\n  private createPostalCodeInputMeta = (): InputMeta => {\r\n    return {\r\n      ref: null,\r\n      props: this.createPostalCodeInputProps(),\r\n      tooltip: () => this.createPostalCodeTooltip(),\r\n      createRef: (ref: Input | null) => {\r\n        const inputField = this.fields[FiasExtraFields.postalcode];\r\n        if (inputField) {\r\n          inputField.meta.ref = ref;\r\n        }\r\n      },\r\n    };\r\n  };\r\n\r\n  private createAddressComboBoxProps = (field: FiasFields): FiasComboBoxProps => {\r\n    const getItems = async (searchText: string) => this.createItemsSource(searchText, field);\r\n\r\n    const onValueChange = (value: FiasAddress) => {\r\n      const { address } = this.state;\r\n      const newFields = {\r\n        ...address.fields,\r\n        ...value.fields,\r\n      };\r\n      // get rid of undefineds\r\n      let addressField: FiasFields;\r\n      for (addressField in newFields) {\r\n        if (!newFields[addressField]) {\r\n          delete newFields[addressField];\r\n        }\r\n      }\r\n      this.handleAddressChange(FiasAddress.createFromAddress(address, { fields: newFields }), this.validate);\r\n    };\r\n\r\n    const onInputValueChange = () => {\r\n      this.resetAddressErrors();\r\n    };\r\n\r\n    const onUnexpectedInput = (query: string) => {\r\n      const { address } = this.state;\r\n      const newFields = {\r\n        ...address.fields,\r\n        [field]: query ? new FiasAddressElement(field, query) : undefined,\r\n      };\r\n      return FiasAddress.createFromAddress(address, { fields: newFields });\r\n    };\r\n\r\n    const renderItem = (address: FiasAddress): string => {\r\n      const element = address.fields[field];\r\n      if (!element) {\r\n        return '';\r\n      }\r\n\r\n      if (field === FiasFields.region && element.data) {\r\n        const regionCode = element.data.code.substr(0, 2);\r\n        return `${regionCode} ${element.getText()}`;\r\n      }\r\n\r\n      const diffAddress = new FiasAddress({\r\n        fields: this.state.address.getDiffFields(address, this.props.fieldsSettings),\r\n      });\r\n      const hasParentFields = Boolean(diffAddress.getClosestParentFiasId(field));\r\n      return hasParentFields ? diffAddress.getText() : element.getText(element.isTypeMatchField(field));\r\n    };\r\n\r\n    const renderValue = (address: FiasAddress): React.ReactNode => {\r\n      const element = address.fields[field];\r\n      return element && element.getText(element.isTypeMatchField(field));\r\n    };\r\n\r\n    const renderNotFound = (): React.ReactNode => {\r\n      const { address } = this.state;\r\n      let messages = [this.locale[`${field}NotFound` as keyof FiasLocale] || this.locale.addressNotFound];\r\n\r\n      if (address.isAllowedToFill(field)) {\r\n        if (address.hasOnlyIndirectParent(field)) {\r\n          messages.push(this.locale.addressFillParentOrSearch);\r\n        }\r\n      } else {\r\n        messages = this.locale[`${field}FillBefore` as keyof FiasLocale]\r\n          ? [this.locale[`${field}FillBefore` as keyof FiasLocale]]\r\n          : messages;\r\n      }\r\n\r\n      return (\r\n        <div>\r\n          {messages.map((message, i, m) => (\r\n            <div key={i}>{message + (m[i + 1] ? '.' : '')}</div>\r\n          ))}\r\n        </div>\r\n      );\r\n    };\r\n\r\n    const valueToString = (address: FiasAddress): string => {\r\n      const element = address.fields[field];\r\n      return element ? element.name : '';\r\n    };\r\n\r\n    const itemToValue = valueToString;\r\n\r\n    return {\r\n      getItems,\r\n      onValueChange,\r\n      onInputValueChange,\r\n      onUnexpectedInput: onUnexpectedInput,\r\n      renderItem,\r\n      renderValue,\r\n      itemToValue,\r\n      valueToString,\r\n      renderNotFound,\r\n    };\r\n  };\r\n\r\n  private createPostalCodeInputProps(): InputProps {\r\n    return {\r\n      onValueChange: (value: string) => {\r\n        const { address } = this.state;\r\n        const newAdditionalFields = {\r\n          ...address.additionalFields,\r\n          [FiasExtraFields.postalcode]: value,\r\n        };\r\n        this.handleAddressChange(\r\n          FiasAddress.createFromAddress(address, {\r\n            additionalFields: newAdditionalFields,\r\n          }),\r\n        );\r\n      },\r\n    };\r\n  }\r\n\r\n  private createItemsSource = async (searchText: string, field: FiasFields) => {\r\n    const { address } = this.state;\r\n    const limit = this.props.limit || FiasForm.defaultProps.limit;\r\n\r\n    if (address.isAllowedToFill(field)) {\r\n      const options: FiasSearchOptions = {\r\n        searchText,\r\n        field,\r\n        parentFiasId: address.getClosestParentFiasId(field),\r\n        fullAddress: address.isAllowedToSearchFullAddress(field),\r\n        directParent: !address.isAllowedToSearchThroughChildrenOfDirectParent(field, this.props.fieldsSettings),\r\n        limit: limit + 1, // +1 to detect if there are more items\r\n      };\r\n      return this.props.api.search(options).then(result => {\r\n        const { success, data, error } = result;\r\n        return success && data\r\n          ? Promise.resolve(\r\n              data.map((item: FiasAddressResponse) => {\r\n                return FiasAddress.createFromResponse(item);\r\n              }),\r\n            )\r\n          : Promise.reject(error);\r\n      });\r\n    }\r\n    return Promise.resolve([]);\r\n  };\r\n\r\n  private getFieldTooltipContent = (field: FiasFields | FiasExtraFields): React.ReactNode => {\r\n    const { address } = this.state;\r\n    const { validationLevel } = this.props;\r\n    if (validationLevel !== FiasFormValidation.None && address.hasError(field)) {\r\n      return address.getError(field);\r\n    }\r\n    return null;\r\n  };\r\n\r\n  private createAddressComboBoxTooltip = (field: FiasFields) => (): React.ReactNode => {\r\n    const tooltipContent = this.getFieldTooltipContent(field);\r\n    const comboboxField = this.fields[field];\r\n    if (comboboxField && FiasForm.isComboboxMeta(comboboxField.meta)) {\r\n      const combobox = comboboxField.meta.ref;\r\n      const hasItems = combobox ? combobox.hasItems : false;\r\n      return tooltipContent !== null && hasItems ? this.locale.addressSelectItemFromList : tooltipContent;\r\n    }\r\n    return tooltipContent;\r\n  };\r\n\r\n  private createPostalCodeTooltip = (): React.ReactNode => {\r\n    const tooltipContent = this.getFieldTooltipContent(FiasExtraFields.postalcode);\r\n    const replacePostalCode = () => {\r\n      const { address } = this.state;\r\n      const additionalFields = { ...address.additionalFields };\r\n      delete additionalFields[FiasExtraFields.postalcode];\r\n      this.handleAddressChange(FiasAddress.createFromAddress(address, { additionalFields }));\r\n    };\r\n    return (\r\n      tooltipContent && (\r\n        <div>\r\n          <span>{tooltipContent}</span>\r\n          {this.state.address.isPostalCodeAltered && (\r\n            <div>\r\n              <Button onClick={replacePostalCode} use=\"link\">\r\n                {this.locale.postalcodeReplace}\r\n              </Button>\r\n            </div>\r\n          )}\r\n        </div>\r\n      )\r\n    );\r\n  };\r\n\r\n  private verify = (): Promise<FiasAddress> => {\r\n    const { address } = this.state;\r\n    const { api } = this.props;\r\n\r\n    return api.verify(address).then((result: FiasAPIResult<FiasVerifyResponse>) => {\r\n      const { success, data } = result;\r\n      if (success && data) {\r\n        return FiasAddress.verify(address, data);\r\n      }\r\n      return FiasAddress.removeFiasData(address);\r\n    });\r\n  };\r\n\r\n  private validate(): void {\r\n    const verifyPromise = (this.lastVerifyPromise = this.verify());\r\n\r\n    verifyPromise.then(verifiedAddress => {\r\n      if (verifyPromise === this.lastVerifyPromise) {\r\n        this.setState({\r\n          address: FiasAddress.validate(verifiedAddress, this.locale),\r\n        });\r\n      }\r\n    });\r\n  }\r\n\r\n  private handleCountryChange = (country?: FiasCountry) => {\r\n    this.handleAddressChange(FiasAddress.createFromAddress(this.state.address, { country }));\r\n  };\r\n\r\n  private handleForeignAddressChange = (value: string) => {\r\n    this.handleAddressChange(\r\n      FiasAddress.createFromAddress(this.state.address, {\r\n        foreignAddress: value,\r\n      }),\r\n    );\r\n  };\r\n\r\n  private handleAddressChange = (address: FiasAddress, callback?: () => void) => {\r\n    this.setState(\r\n      {\r\n        address: FiasAddress.createFromAddress(address, {\r\n          fields: FiasAddress.filterVisibleFields(address.fields, this.props.fieldsSettings),\r\n        }),\r\n      },\r\n      callback,\r\n    );\r\n  };\r\n\r\n  private handleSearchChange = (address: FiasAddress) => {\r\n    this.handleAddressChange(address);\r\n  };\r\n\r\n  private resetAddressErrors = () => {\r\n    const { address } = this.state;\r\n    if (address.hasErrors) {\r\n      this.setState({\r\n        address: FiasAddress.createFromAddress(address, { errors: {} }),\r\n      });\r\n    }\r\n  };\r\n}\r\n"]}