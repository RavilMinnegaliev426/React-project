import _extends from "@babel/runtime/helpers/esm/extends";
import _regeneratorRuntime from "@babel/runtime/regenerator";
import _asyncToGenerator from "@babel/runtime/helpers/esm/asyncToGenerator";
import _inheritsLoose from "@babel/runtime/helpers/esm/inheritsLoose";

var _dec, _class, _class2, _temp;

import React from 'react';
import warning from 'warning';
import { FiasLocaleHelper } from "../../locale";
import { FiasComboBox } from "../../Form/FiasComboBox";
import { FiasFields } from "../../types";
import { locale } from "../../../../lib/locale/decorators";
import { filterProps } from "../../../../lib/filterProps";
import { FiasAddress } from "../..";
var COMBOBOX_PASS_PROPS = {
  limit: true,
  align: true,
  searchOnFocus: true,
  drawArrow: true,
  autoFocus: true,
  borderless: true,
  disablePortal: true,
  disabled: true,
  error: true,
  maxLength: true,
  menuAlign: true,
  onBlur: true,
  onFocus: true,
  onInputValueChange: true,
  placeholder: true,
  size: true,
  warning: true,
  width: true,
  maxMenuHeight: true,
  onMouseEnter: true,
  onMouseOver: true,
  onMouseLeave: true
};
export
/**
 * @deprecated Контур-специфичный компонент, будет удален в 3.0.0, перенесен в `@skbkontur/react-ui-addons` смотри [миграцию](https://github.com/skbkontur/retail-ui/blob/master/packages/react-ui/MIGRATION.md)
 */
var FiasSearch = (_dec = locale('Fias', FiasLocaleHelper), _dec(_class = (_temp = _class2 =
/*#__PURE__*/
function (_React$Component) {
  _inheritsLoose(FiasSearch, _React$Component);

  function FiasSearch(props) {
    var _this;

    _this = _React$Component.call(this, props) || this;
    _this.locale = void 0;

    _this.renderItem = function (address) {
      return address.getText();
    };

    _this.renderValue = function (address) {
      return address.getText(FiasFields.room);
    };

    _this.renderNotFound = function () {
      return _this.locale.searchNotFound;
    };

    _this.valueToString = function (address) {
      return address.getText(FiasFields.room);
    };

    _this.onValueChange = function (address) {
      var onValueChange = _this.props.onValueChange;

      if (onValueChange) {
        onValueChange(address);
      }
    };

    _this.onUnexpectedInput = function (query) {
      if (!query) {
        return new FiasAddress();
      }
    };

    _this.getItems =
    /*#__PURE__*/
    function () {
      var _ref = _asyncToGenerator(
      /*#__PURE__*/
      _regeneratorRuntime.mark(function _callee(searchText) {
        var _this$props, api, limit, options;

        return _regeneratorRuntime.wrap(function _callee$(_context) {
          while (1) {
            switch (_context.prev = _context.next) {
              case 0:
                _this$props = _this.props, api = _this$props.api, limit = _this$props.limit;
                options = {
                  searchText: searchText,
                  fullAddress: true,
                  directParent: false,
                  limit: (limit || FiasSearch.defaultProps.limit) + 1 // +1 to detect if there are more items

                };
                return _context.abrupt("return", api.search(options).then(function (result) {
                  var success = result.success,
                      data = result.data,
                      error = result.error;
                  return success && data ? Promise.resolve(data.map(function (item) {
                    return FiasAddress.createFromResponse(item);
                  })) : Promise.reject(error);
                }));

              case 3:
              case "end":
                return _context.stop();
            }
          }
        }, _callee);
      }));

      return function (_x) {
        return _ref.apply(this, arguments);
      };
    }();

    warning(false, "FiasSearch has been deprecated, use FiasSearch from @skbkontur/react-ui-addons instead, see [migration](https://github.com/skbkontur/retail-ui/blob/master/packages/react-ui/MIGRATION.md)");
    return _this;
  }

  var _proto = FiasSearch.prototype;

  _proto.render = function render() {
    var restComboBoxProps = filterProps(this.props, COMBOBOX_PASS_PROPS);
    return React.createElement(FiasComboBox, _extends({
      getItems: this.getItems,
      value: this.props.address,
      renderItem: this.renderItem,
      renderValue: this.renderValue,
      valueToString: this.valueToString,
      onValueChange: this.onValueChange,
      onUnexpectedInput: this.onUnexpectedInput,
      renderNotFound: this.renderNotFound
    }, restComboBoxProps));
  };

  return FiasSearch;
}(React.Component), _class2.__KONTUR_REACT_UI__ = 'FiasSearch', _class2.defaultProps = {
  width: '100%',
  limit: 5,
  drawArrow: false,
  searchOnFocus: false
}, _temp)) || _class);