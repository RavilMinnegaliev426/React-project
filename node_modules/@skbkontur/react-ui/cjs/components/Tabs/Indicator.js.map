{"version":3,"sources":["Indicator.tsx"],"names":["Indicator","context","state","styles","theme","eventListener","removeTabUpdatesListener","reflow","getTab","activeTab","node","nodeStyles","getStyles","stylesUpdated","some","prop","setState","throttledReflow","componentDidMount","LayoutEvents","addListener","props","tabUpdates","on","componentWillUnmount","cancel","remove","componentDidUpdate","_","prevState","render","renderMain","indicators","getIndicators","error","warning","success","primary","disabled","jsStyles","root","className","React","Component","HTMLElement","rect","getBoundingClientRect","vertical","width","left","offsetLeft","top","offsetTop","height","bottom","offsetHeight","right","contextType","TabsContext"],"mappings":"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","sourcesContent":["import React from 'react';\r\nimport { findDOMNode } from 'react-dom';\r\nimport throttle from 'lodash.throttle';\r\nimport cn from 'classnames';\r\n\r\nimport * as LayoutEvents from '../../lib/LayoutEvents';\r\nimport { Nullable } from '../../typings/utility-types';\r\nimport { ThemeContext } from '../../lib/theming/ThemeContext';\r\nimport { Theme } from '../../lib/theming/Theme';\r\n\r\nimport { jsStyles } from './Indicator.styles';\r\nimport { TabsContext, TabsContextType } from './TabsContext';\r\nimport { TabIndicators } from './Tab';\r\n\r\nexport interface IndicatorProps {\r\n  className?: string;\r\n  tabUpdates: {\r\n    on: (x0: () => void) => () => void;\r\n  };\r\n  vertical: boolean;\r\n}\r\n\r\nexport interface IndicatorState {\r\n  styles: React.CSSProperties;\r\n}\r\n\r\nexport class Indicator extends React.Component<IndicatorProps, IndicatorState> {\r\n  public static contextType = TabsContext;\r\n  public context: TabsContextType = this.context;\r\n\r\n  public state: IndicatorState = {\r\n    styles: {},\r\n  };\r\n\r\n  private theme!: Theme;\r\n\r\n  private eventListener: Nullable<{\r\n    remove: () => void;\r\n  }> = null;\r\n\r\n  private removeTabUpdatesListener: Nullable<() => void> = null;\r\n\r\n  public componentDidMount() {\r\n    this.eventListener = LayoutEvents.addListener(this.throttledReflow);\r\n    this.removeTabUpdatesListener = this.props.tabUpdates.on(this.reflow);\r\n    this.reflow();\r\n  }\r\n\r\n  public componentWillUnmount() {\r\n    this.throttledReflow.cancel();\r\n\r\n    if (this.eventListener) {\r\n      this.eventListener.remove();\r\n    }\r\n    if (this.removeTabUpdatesListener) {\r\n      this.removeTabUpdatesListener();\r\n    }\r\n  }\r\n\r\n  public componentDidUpdate(_: IndicatorProps, prevState: IndicatorState) {\r\n    this.reflow();\r\n  }\r\n\r\n  public render() {\r\n    return (\r\n      <ThemeContext.Consumer>\r\n        {theme => {\r\n          this.theme = theme;\r\n          return this.renderMain();\r\n        }}\r\n      </ThemeContext.Consumer>\r\n    );\r\n  }\r\n\r\n  private renderMain() {\r\n    const { getTab, activeTab } = this.context;\r\n    const node = getTab(activeTab);\r\n    const indicators: TabIndicators = (node && node.getIndicators && node.getIndicators()) || {\r\n      error: false,\r\n      warning: false,\r\n      success: false,\r\n      primary: false,\r\n      disabled: false,\r\n    };\r\n    return (\r\n      <div\r\n        className={cn(\r\n          jsStyles.root(this.theme),\r\n          indicators.primary && jsStyles.primary(this.theme),\r\n          indicators.success && jsStyles.success(this.theme),\r\n          indicators.warning && jsStyles.warning(this.theme),\r\n          indicators.error && jsStyles.error(this.theme),\r\n          this.props.className,\r\n        )}\r\n        style={this.state.styles}\r\n      />\r\n    );\r\n  }\r\n\r\n  private reflow = () => {\r\n    const { getTab, activeTab } = this.context;\r\n    const node = getTab(activeTab);\r\n    const nodeStyles = this.getStyles(node);\r\n    const stylesUpdated = ['left', 'top', 'width', 'height'].some(\r\n      prop => nodeStyles[prop as keyof React.CSSProperties] !== this.state.styles[prop as keyof React.CSSProperties],\r\n    );\r\n    if (stylesUpdated) {\r\n      this.setState({ styles: nodeStyles });\r\n    }\r\n  };\r\n\r\n  private throttledReflow = throttle(this.reflow, 100);\r\n\r\n  private getStyles(node: any): React.CSSProperties {\r\n    if (node instanceof React.Component) {\r\n      node = findDOMNode(node);\r\n    }\r\n\r\n    if (node instanceof HTMLElement) {\r\n      const rect = node.getBoundingClientRect();\r\n      if (this.props.vertical) {\r\n        return {\r\n          width: 3,\r\n          left: node.offsetLeft,\r\n          top: node.offsetTop,\r\n          height: rect.bottom - rect.top,\r\n        };\r\n      }\r\n\r\n      return {\r\n        left: node.offsetLeft,\r\n        top: node.offsetHeight + node.offsetTop - 3,\r\n        width: rect.right - rect.left,\r\n      };\r\n    }\r\n\r\n    return {};\r\n  }\r\n}\r\n"]}