{"version":3,"sources":["Tab.tsx"],"names":["Tab","context","state","focusedByKeyboard","theme","tabComponent","isArrowKeyPressed","getUnderlyingNode","getId","props","id","href","refTabComponent","instance","handleKeyDownGlobal","e","getTabInstance","switchTab","event","disabled","preventDefault","onClick","defaultPrevented","handleMouseDown","handleKeyDown","onKeyDown","delta","shiftFocus","handleFocus","process","nextTick","tabListener","isTabPressed","setState","handleBlur","UNSAFE_componentWillMount","TabsContextDefaultValue","componentDidMount","addTab","window","addEventListener","componentDidUpdate","activeTab","notifyUpdate","componentWillUnmount","removeTab","removeEventListener","render","renderMain","getIndicators","error","Boolean","warning","success","primary","children","component","Component","defaultProps","style","isActive","isVertical","vertical","jsStyles","root","active","focus","React","__KONTUR_REACT_UI__","contextType","TabsContext","propTypes","PropTypes","node","any","bool","string","isRequired","func"],"mappings":"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","sourcesContent":["import React from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport invariant from 'invariant';\r\nimport cn from 'classnames';\r\n\r\nimport { isKeyArrow, isKeyArrowLeft, isKeyArrowUp } from '../../lib/events/keyboard/identifiers';\r\nimport { tabListener } from '../../lib/events/tabListener';\r\nimport { Nullable } from '../../typings/utility-types';\r\nimport { isFunctionalComponent } from '../../lib/utils';\r\nimport { ThemeContext } from '../../lib/theming/ThemeContext';\r\nimport { Theme } from '../../lib/theming/Theme';\r\n\r\nimport { TabsContext, TabsContextType, TabsContextDefaultValue } from './TabsContext';\r\nimport { jsStyles } from './Tab.styles';\r\n\r\nexport interface TabIndicators {\r\n  error: boolean;\r\n  warning: boolean;\r\n  success: boolean;\r\n  primary: boolean;\r\n  disabled: boolean;\r\n}\r\n\r\nexport interface TabProps {\r\n  /**\r\n   * Tab content\r\n   */\r\n  children?: React.ReactNode;\r\n\r\n  /**\r\n   * Component to use as a tab\r\n   */\r\n  component?: React.ComponentType<any> | string;\r\n\r\n  /**\r\n   * Link href\r\n   */\r\n  href?: string;\r\n\r\n  /**\r\n   * Tab identifier\r\n   */\r\n  id?: string;\r\n\r\n  /**\r\n   * Click event\r\n   */\r\n  onClick?: (event: React.MouseEvent<HTMLElement>) => void;\r\n\r\n  /**\r\n   * Click event\r\n   */\r\n  onKeyDown?: (event: React.KeyboardEvent<HTMLElement>) => void;\r\n\r\n  /**\r\n   * Disabled indicator\r\n   */\r\n  disabled?: boolean;\r\n\r\n  /**\r\n   * Error indicator\r\n   */\r\n  error?: boolean;\r\n\r\n  /**\r\n   * Warning indicator\r\n   */\r\n  warning?: boolean;\r\n\r\n  /**\r\n   * Success indicator\r\n   */\r\n  success?: boolean;\r\n\r\n  /**\r\n   * Primary indicator\r\n   */\r\n  primary?: boolean;\r\n\r\n  /**\r\n   * Style property\r\n   */\r\n  style?: React.CSSProperties;\r\n}\r\n\r\nexport interface TabState {\r\n  focusedByKeyboard: boolean;\r\n}\r\n\r\n/**\r\n * Tab element of Tabs component\r\n *\r\n * Can be used for creating custom tabs\r\n * ```js\r\n *\r\n * const RouteTab = (props) => (\r\n *   <Tab id={props.to} component={RouteLink} {...props}/>\r\n * )\r\n *\r\n * const MyAwesomeTab = (props) => <Tab id={props.id}>8) {props.children}</Tab>\r\n * ```\r\n *\r\n * Works only inside Tabs component, otherwise throws\r\n */\r\nexport class Tab extends React.Component<TabProps, TabState> {\r\n  public static __KONTUR_REACT_UI__ = 'Tab';\r\n\r\n  public static contextType = TabsContext;\r\n  public context: TabsContextType = this.context;\r\n\r\n  public static propTypes = {\r\n    children: PropTypes.node,\r\n    component: PropTypes.any,\r\n    disabled: PropTypes.bool,\r\n    href: PropTypes.string.isRequired,\r\n    id: PropTypes.string.isRequired,\r\n    onClick: PropTypes.func,\r\n    onKeyDown: PropTypes.func,\r\n  };\r\n\r\n  public static defaultProps = {\r\n    component: 'a',\r\n    href: '',\r\n  };\r\n\r\n  public state: TabState = {\r\n    focusedByKeyboard: false,\r\n  };\r\n\r\n  private theme!: Theme;\r\n  private tabComponent: Nullable<React.ReactElement<Tab>> = null;\r\n  private isArrowKeyPressed = false;\r\n\r\n  public UNSAFE_componentWillMount() {\r\n    invariant(this.context !== TabsContextDefaultValue, 'Tab should be placed inside Tabs component');\r\n  }\r\n\r\n  public componentDidMount() {\r\n    const id = this.getId();\r\n    if (typeof id === 'string') {\r\n      this.context.addTab(id, this.getTabInstance);\r\n    }\r\n    window.addEventListener('keydown', this.handleKeyDownGlobal);\r\n  }\r\n\r\n  public componentDidUpdate() {\r\n    if (this.context.activeTab === this.props.id) {\r\n      this.context.notifyUpdate();\r\n    }\r\n  }\r\n\r\n  public componentWillUnmount() {\r\n    const id = this.getId();\r\n    if (typeof id === 'string') {\r\n      this.context.removeTab(id);\r\n    }\r\n    window.removeEventListener('keydown', this.handleKeyDownGlobal);\r\n  }\r\n\r\n  public render() {\r\n    return (\r\n      <ThemeContext.Consumer>\r\n        {theme => {\r\n          this.theme = theme;\r\n          return this.renderMain();\r\n        }}\r\n      </ThemeContext.Consumer>\r\n    );\r\n  }\r\n\r\n  public getIndicators() {\r\n    return {\r\n      error: Boolean(this.props.error),\r\n      warning: Boolean(this.props.warning),\r\n      success: Boolean(this.props.success),\r\n      primary: Boolean(this.props.primary),\r\n      disabled: Boolean(this.props.disabled),\r\n    };\r\n  }\r\n\r\n  public getUnderlyingNode = () => this.tabComponent;\r\n\r\n  private renderMain() {\r\n    const {\r\n      children,\r\n      disabled,\r\n      error,\r\n      warning,\r\n      success,\r\n      primary,\r\n      component: Component = Tab.defaultProps.component,\r\n      href,\r\n      style,\r\n    } = this.props;\r\n\r\n    let isActive = false;\r\n    let isVertical = false;\r\n\r\n    const id = this.getId();\r\n    if (typeof id === 'string') {\r\n      isActive = this.context.activeTab === this.getId();\r\n      isVertical = this.context.vertical;\r\n    }\r\n\r\n    return (\r\n      <Component\r\n        className={cn({\r\n          [jsStyles.root(this.theme)]: true,\r\n          [jsStyles.vertical(this.theme)]: !!isVertical,\r\n          [jsStyles.primary(this.theme)]: !!primary,\r\n          [jsStyles.success(this.theme)]: !!success,\r\n          [jsStyles.warning(this.theme)]: !!warning,\r\n          [jsStyles.error(this.theme)]: !!error,\r\n          [jsStyles.active(this.theme)]: !!isActive,\r\n          [jsStyles.disabled(this.theme)]: !!disabled,\r\n        })}\r\n        onBlur={this.handleBlur}\r\n        onClick={this.switchTab}\r\n        onMouseDown={this.handleMouseDown}\r\n        onFocus={this.handleFocus}\r\n        onKeyDown={this.handleKeyDown}\r\n        tabIndex={disabled ? -1 : 0}\r\n        ref={isFunctionalComponent(Component) ? null : this.refTabComponent}\r\n        href={href}\r\n        style={style}\r\n      >\r\n        {children}\r\n        {this.state.focusedByKeyboard && <div className={jsStyles.focus(this.theme)} />}\r\n      </Component>\r\n    );\r\n  }\r\n\r\n  private getId = () => this.props.id || this.props.href;\r\n\r\n  private refTabComponent = (instance: React.ReactElement<any>) => {\r\n    this.tabComponent = instance;\r\n  };\r\n\r\n  private handleKeyDownGlobal = (e: KeyboardEvent) => {\r\n    this.isArrowKeyPressed = isKeyArrow(e);\r\n  };\r\n\r\n  private getTabInstance = () => this;\r\n\r\n  private switchTab = (event: React.MouseEvent<HTMLElement>) => {\r\n    if (this.props.disabled) {\r\n      event.preventDefault();\r\n      return;\r\n    }\r\n\r\n    const id = this.props.id || this.props.href;\r\n    if (this.props.onClick) {\r\n      this.props.onClick(event);\r\n      if (event.defaultPrevented) {\r\n        return;\r\n      }\r\n    }\r\n    if (typeof id === 'string') {\r\n      this.context.switchTab(id);\r\n    }\r\n    if (!this.props.href) {\r\n      event.preventDefault();\r\n    }\r\n  };\r\n\r\n  private handleMouseDown = () => (this.isArrowKeyPressed = false);\r\n\r\n  private handleKeyDown = (e: React.KeyboardEvent<HTMLElement>) => {\r\n    if (this.props.disabled) {\r\n      return;\r\n    }\r\n\r\n    if (this.props.onKeyDown) {\r\n      this.props.onKeyDown(e);\r\n      if (e.defaultPrevented) {\r\n        return;\r\n      }\r\n    }\r\n    const id = this.getId();\r\n    if (typeof id !== 'string') {\r\n      return;\r\n    }\r\n    if (!isKeyArrow(e)) {\r\n      return;\r\n    }\r\n    e.preventDefault();\r\n    const delta = isKeyArrowLeft(e) || isKeyArrowUp(e) ? -1 : 1;\r\n    this.context.shiftFocus(id, delta);\r\n  };\r\n\r\n  private handleFocus = () => {\r\n    if (this.props.disabled) {\r\n      return;\r\n    }\r\n\r\n    // focus event fires before keyDown eventlistener\r\n    // so we should check focusKeyPressed in async way\r\n    process.nextTick(() => {\r\n      if (tabListener.isTabPressed || this.isArrowKeyPressed) {\r\n        this.setState({ focusedByKeyboard: true });\r\n      }\r\n    });\r\n  };\r\n\r\n  private handleBlur = () => {\r\n    if (this.props.disabled) {\r\n      return;\r\n    }\r\n\r\n    this.setState({ focusedByKeyboard: false });\r\n  };\r\n}\r\n"]}