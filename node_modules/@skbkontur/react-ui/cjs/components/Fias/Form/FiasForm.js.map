{"version":3,"sources":["FiasForm.tsx"],"names":["FiasForm","FiasLocaleHelper","props","state","address","locale","fields","lastVerifyPromise","submit","getCommonFieldProps","field","validationLevel","error","hasError","FiasFormValidation","Error","warning","Warning","placeholder","renderFields","fieldsSettings","map","control","settings","Boolean","visible","meta","render","label","tooltip","renderAddressComboBox","width","comboboxField","isComboboxMeta","createRef","commonProps","limit","renderPostalCodeInput","inputField","FiasExtraFields","postalcode","isInputMeta","value","postalCode","createAddressComboboxMeta","ref","createAddressComboBoxProps","createAddressComboBoxTooltip","createPostalCodeInputMeta","createPostalCodeInputProps","createPostalCodeTooltip","getItems","searchText","createItemsSource","onValueChange","newFields","addressField","handleAddressChange","FiasAddress","createFromAddress","validate","onInputValueChange","resetAddressErrors","onUnexpectedInput","query","FiasAddressElement","undefined","renderItem","element","FiasFields","region","data","regionCode","code","substr","getText","diffAddress","getDiffFields","hasParentFields","getClosestParentFiasId","isTypeMatchField","renderValue","renderNotFound","messages","addressNotFound","isAllowedToFill","hasOnlyIndirectParent","push","addressFillParentOrSearch","message","i","m","valueToString","name","itemToValue","defaultProps","options","parentFiasId","fullAddress","isAllowedToSearchFullAddress","directParent","isAllowedToSearchThroughChildrenOfDirectParent","api","search","then","result","success","Promise","resolve","item","createFromResponse","reject","getFieldTooltipContent","None","getError","tooltipContent","combobox","hasItems","addressSelectItemFromList","replacePostalCode","additionalFields","isPostalCodeAltered","postalcodeReplace","verify","removeFiasData","handleCountryChange","country","handleForeignAddressChange","foreignAddress","callback","setState","filterVisibleFields","handleSearchChange","hasErrors","errors","ALL_FIELDS","reduce","district","city","intracityarea","settlement","planningstructure","street","stead","house","room","componentDidMount","countrySelector","countryLabel","searchPlaceholder","isForeignForm","foreignAddressLabel","foreignAddressPlaceholder","newAdditionalFields","verifyPromise","verifiedAddress","isForeign","React","Component","__KONTUR_REACT_UI__","Field","children","jsStyles","row","Object","prototype","hasOwnProperty","call"],"mappings":"qlBAAA;;AAEA;AACA;AACA;AACA;AACA;;;;;;;;;;;;AAYA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,8C;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAmCaA,Q,WADZ,wBAAO,MAAP,EAAeC,wBAAf,C;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAyCC,oBAAYC,MAAZ,EAAkC;AAChC,wCAAMA,MAAN,UADgC,MAV3BC,KAU2B,GAVJ,EAC5BC,OAAO,EAAE,MAAKF,KAAL,CAAWE,OADQ,EAUI,OANjBC,MAMiB,gBAJ1BC,MAI0B,gBAF1BC,iBAE0B,GAFuB,IAEvB;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAiD3BC,IAAAA,MAjD2B,wFAiDlB;AACR,sBAAKD,iBADG;AAEP,oBAAKJ,KAAL,CAAWC,OAFJ,0DAjDkB;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAsG1BK,IAAAA,mBAtG0B,GAsGJ;AAC5BC,IAAAA,KAD4B;;;;;AAMzB;AACKN,MAAAA,OADL,GACiB,MAAKD,KADtB,CACKC,OADL;AAEKO,MAAAA,eAFL,GAEyB,MAAKT,KAF9B,CAEKS,eAFL;AAGH,aAAO;AACLC,QAAAA,KAAK,EAAER,OAAO,CAACS,QAAR,CAAiBH,KAAjB,KAA2BC,eAAe,KAAKG,0BAAmBC,KADpE;AAELC,QAAAA,OAAO,EAAEZ,OAAO,CAACS,QAAR,CAAiBH,KAAjB,KAA2BC,eAAe,KAAKG,0BAAmBG,OAFtE;AAGLC,QAAAA,WAAW,EAAE,MAAKb,MAAL,CAAeK,KAAf,iBAHR,EAAP;;AAKD,KApHiC;;AAsH1BS,IAAAA,YAtH0B,GAsHX,UAACb,MAAD,EAAkE;AAC/Ec,MAAAA,cAD+E,GAC5D,MAAKlB,KADuD,CAC/EkB,cAD+E;AAEvF,aAAOd,MAAM,CAACe,GAAP,CAAW,UAACX,KAAD,EAAyC;AACzD,YAAMY,OAAO,GAAG,MAAKhB,MAAL,CAAYI,KAAZ,CAAhB;AACA,YAAMa,QAAQ,GAAGH,cAAc,CAACV,KAAD,CAA/B;AACA,YAAIY,OAAO,IAAIE,OAAO,CAACD,QAAQ,IAAIA,QAAQ,CAACE,OAAtB,CAAtB,EAAsD;AAC5CC,UAAAA,IAD4C,GAC3BJ,OAD2B,CAC5CI,IAD4C,CACtCC,MADsC,GAC3BL,OAD2B,CACtCK,MADsC;AAEpD,cAAMC,KAAK,GAAG,MAAKvB,MAAL,CAAeK,KAAf,WAAd;AACA;AACEY,YAAAA,OAAO;AACL,yCAAC,QAAD,CAAU,KAAV,IAAgB,KAAK,EAAEM,KAAvB,EAA8B,GAAG,EAAElB,KAAnC;AACE,yCAAC,gBAAD,IAAS,GAAG,EAAE,cAAd,EAA8B,MAAM,EAAEgB,IAAI,CAACG,OAA3C;AACGF,YAAAA,MAAM,EADT,CADF,CAFJ;;;;;AASD;AACF,OAhBM,CAAP;AAiBD,KAzIiC;;AA2I1BG,IAAAA,qBA3I0B,GA2IF,UAACpB,KAAD,EAAoBqB,KAApB,EAAyE,KAArDA,KAAqD,cAArDA,KAAqD,GAA5B,MAA4B;AACvG,UAAMC,aAAa,GAAG,MAAK1B,MAAL,CAAYI,KAAZ,CAAtB;AACA,UAAIsB,aAAa,IAAIhC,QAAQ,CAACiC,cAAT,CAAwBD,aAAa,CAACN,IAAtC,CAArB,EAAkE;AACxDtB,QAAAA,OADwD,GAC5C,MAAKD,KADuC,CACxDC,OADwD;AAEnC4B,QAAAA,aAAa,CAACN,IAFqB,CAExDxB,KAFwD,uBAExDA,KAFwD,CAEjDgC,SAFiD,uBAEjDA,SAFiD;AAGhE,YAAMC,WAAW,GAAG,MAAK1B,mBAAL,CAAyBC,KAAzB,CAApB;AACA;AACE,uCAAC,0BAAD;AACMyB,UAAAA,WADN;AAEMjC,UAAAA,KAFN;AAGE,YAAA,KAAK,EAAEE,OAHT;AAIE,YAAA,KAAK,EAAE2B,KAJT;AAKE,YAAA,SAAS,EAAE,KALb;AAME,YAAA,aAAa,EAAE,KANjB;AAOE,YAAA,KAAK,EAAE,MAAK7B,KAAL,CAAWkC,KAPpB;AAQE,YAAA,GAAG,EAAEF,SARP,IADF;;;AAYD;AACF,KA9JiC;;AAgK1BG,IAAAA,qBAhK0B,GAgKF,YAAuB;AACrD,UAAMC,UAAU,GAAG,MAAKhC,MAAL,CAAYiC,uBAAgBC,UAA5B,CAAnB;AACA,UAAIF,UAAU,IAAItC,QAAQ,CAACyC,WAAT,CAAqBH,UAAU,CAACZ,IAAhC,CAAlB,EAAyD;AAC/CtB,QAAAA,OAD+C,GACnC,MAAKD,KAD8B,CAC/CC,OAD+C;AAE1BkC,QAAAA,UAAU,CAACZ,IAFe,CAE/CxB,KAF+C,oBAE/CA,KAF+C,CAExCgC,SAFwC,oBAExCA,SAFwC;AAGvD,YAAMC,WAAW,GAAG,MAAK1B,mBAAL,CAAyB8B,uBAAgBC,UAAzC,CAApB;AACA,YAAME,KAAK,GAAGtC,OAAO,CAACuC,UAAtB;AACA,eAAO,6BAAC,YAAD,6BAAWR,WAAX,EAA4BjC,KAA5B,IAAmC,KAAK,EAAEwC,KAA1C,EAAiD,KAAK,EAAE,GAAxD,EAA6D,GAAG,EAAER,SAAlE,IAAP;AACD;AACF,KAzKiC;;AA2K1BU,IAAAA,yBA3K0B,GA2KE,UAAClC,KAAD,EAAqC;AACvE,aAAO;AACLmC,QAAAA,GAAG,EAAE,IADA;AAEL3C,QAAAA,KAAK,EAAE,MAAK4C,0BAAL,CAAgCpC,KAAhC,CAFF;AAGLmB,QAAAA,OAAO,EAAE,MAAKkB,4BAAL,CAAkCrC,KAAlC,CAHJ;AAILwB,QAAAA,SAAS,EAAE,mBAACW,GAAD,EAA8B;AACvC,cAAMb,aAAa,GAAG,MAAK1B,MAAL,CAAYI,KAAZ,CAAtB;AACA,cAAIsB,aAAJ,EAAmB;AACjBA,YAAAA,aAAa,CAACN,IAAd,CAAmBmB,GAAnB,GAAyBA,GAAzB;AACD;AACF,SATI,EAAP;;AAWD,KAvLiC;;AAyL1BG,IAAAA,yBAzL0B,GAyLE,YAAiB;AACnD,aAAO;AACLH,QAAAA,GAAG,EAAE,IADA;AAEL3C,QAAAA,KAAK,EAAE,MAAK+C,0BAAL,EAFF;AAGLpB,QAAAA,OAAO,EAAE,2BAAM,MAAKqB,uBAAL,EAAN,EAHJ;AAILhB,QAAAA,SAAS,EAAE,mBAACW,GAAD,EAAuB;AAChC,cAAMP,UAAU,GAAG,MAAKhC,MAAL,CAAYiC,uBAAgBC,UAA5B,CAAnB;AACA,cAAIF,UAAJ,EAAgB;AACdA,YAAAA,UAAU,CAACZ,IAAX,CAAgBmB,GAAhB,GAAsBA,GAAtB;AACD;AACF,SATI,EAAP;;AAWD,KArMiC;;AAuM1BC,IAAAA,0BAvM0B,GAuMG,UAACpC,KAAD,EAA0C;AAC7E,UAAMyC,QAAQ,iHAAG,kBAAOC,UAAP,iKAA8B,MAAKC,iBAAL,CAAuBD,UAAvB,EAAmC1C,KAAnC,CAA9B,4DAAH,mBAARyC,QAAQ,+CAAd;;AAEA,UAAMG,aAAa,GAAG,SAAhBA,aAAgB,CAACZ,KAAD,EAAwB;AACpCtC,QAAAA,OADoC,GACxB,MAAKD,KADmB,CACpCC,OADoC;AAE5C,YAAMmD,SAAS;AACVnD,QAAAA,OAAO,CAACE,MADE;AAEVoC,QAAAA,KAAK,CAACpC,MAFI,CAAf;;AAIA;AACA,YAAIkD,YAAJ;AACA,aAAKA,YAAL,IAAqBD,SAArB,EAAgC;AAC9B,cAAI,CAACA,SAAS,CAACC,YAAD,CAAd,EAA8B;AAC5B,mBAAOD,SAAS,CAACC,YAAD,CAAhB;AACD;AACF;AACD,cAAKC,mBAAL,CAAyBC,yBAAYC,iBAAZ,CAA8BvD,OAA9B,EAAuC,EAAEE,MAAM,EAAEiD,SAAV,EAAvC,CAAzB,EAAwF,MAAKK,QAA7F;AACD,OAdD;;AAgBA,UAAMC,kBAAkB,GAAG,SAArBA,kBAAqB,GAAM;AAC/B,cAAKC,kBAAL;AACD,OAFD;;AAIA,UAAMC,iBAAiB,GAAG,SAApBA,iBAAoB,CAACC,KAAD,EAAmB;AACnC5D,QAAAA,OADmC,GACvB,MAAKD,KADkB,CACnCC,OADmC;AAE3C,YAAMmD,SAAS;AACVnD,QAAAA,OAAO,CAACE,MADE;AAEZI,QAAAA,KAFY,IAEJsD,KAAK,GAAG,IAAIC,sCAAJ,CAAuBvD,KAAvB,EAA8BsD,KAA9B,CAAH,GAA0CE,SAF3C,aAAf;;AAIA,eAAOR,yBAAYC,iBAAZ,CAA8BvD,OAA9B,EAAuC,EAAEE,MAAM,EAAEiD,SAAV,EAAvC,CAAP;AACD,OAPD;;AASA,UAAMY,UAAU,GAAG,SAAbA,UAAa,CAAC/D,OAAD,EAAkC;AACnD,YAAMgE,OAAO,GAAGhE,OAAO,CAACE,MAAR,CAAeI,KAAf,CAAhB;AACA,YAAI,CAAC0D,OAAL,EAAc;AACZ,iBAAO,EAAP;AACD;;AAED,YAAI1D,KAAK,KAAK2D,kBAAWC,MAArB,IAA+BF,OAAO,CAACG,IAA3C,EAAiD;AAC/C,cAAMC,UAAU,GAAGJ,OAAO,CAACG,IAAR,CAAaE,IAAb,CAAkBC,MAAlB,CAAyB,CAAzB,EAA4B,CAA5B,CAAnB;AACA,iBAAUF,UAAV,SAAwBJ,OAAO,CAACO,OAAR,EAAxB;AACD;;AAED,YAAMC,WAAW,GAAG,IAAIlB,wBAAJ,CAAgB;AAClCpD,UAAAA,MAAM,EAAE,MAAKH,KAAL,CAAWC,OAAX,CAAmByE,aAAnB,CAAiCzE,OAAjC,EAA0C,MAAKF,KAAL,CAAWkB,cAArD,CAD0B,EAAhB,CAApB;;AAGA,YAAM0D,eAAe,GAAGtD,OAAO,CAACoD,WAAW,CAACG,sBAAZ,CAAmCrE,KAAnC,CAAD,CAA/B;AACA,eAAOoE,eAAe,GAAGF,WAAW,CAACD,OAAZ,EAAH,GAA2BP,OAAO,CAACO,OAAR,CAAgBP,OAAO,CAACY,gBAAR,CAAyBtE,KAAzB,CAAhB,CAAjD;AACD,OAhBD;;AAkBA,UAAMuE,WAAW,GAAG,SAAdA,WAAc,CAAC7E,OAAD,EAA2C;AAC7D,YAAMgE,OAAO,GAAGhE,OAAO,CAACE,MAAR,CAAeI,KAAf,CAAhB;AACA,eAAO0D,OAAO,IAAIA,OAAO,CAACO,OAAR,CAAgBP,OAAO,CAACY,gBAAR,CAAyBtE,KAAzB,CAAhB,CAAlB;AACD,OAHD;;AAKA,UAAMwE,cAAc,GAAG,SAAjBA,cAAiB,GAAuB;AACpC9E,QAAAA,OADoC,GACxB,MAAKD,KADmB,CACpCC,OADoC;AAE5C,YAAI+E,QAAQ,GAAG,CAAC,MAAK9E,MAAL,CAAeK,KAAf,kBAAuD,MAAKL,MAAL,CAAY+E,eAApE,CAAf;;AAEA,YAAIhF,OAAO,CAACiF,eAAR,CAAwB3E,KAAxB,CAAJ,EAAoC;AAClC,cAAIN,OAAO,CAACkF,qBAAR,CAA8B5E,KAA9B,CAAJ,EAA0C;AACxCyE,YAAAA,QAAQ,CAACI,IAAT,CAAc,MAAKlF,MAAL,CAAYmF,yBAA1B;AACD;AACF,SAJD,MAIO;AACLL,UAAAA,QAAQ,GAAG,MAAK9E,MAAL,CAAeK,KAAf;AACP,WAAC,MAAKL,MAAL,CAAeK,KAAf,gBAAD,CADO;AAEPyE,UAAAA,QAFJ;AAGD;;AAED;AACE;AACGA,UAAAA,QAAQ,CAAC9D,GAAT,CAAa,UAACoE,OAAD,EAAUC,CAAV,EAAaC,CAAb;AACZ,oDAAK,GAAG,EAAED,CAAV,IAAcD,OAAO,IAAIE,CAAC,CAACD,CAAC,GAAG,CAAL,CAAD,GAAW,GAAX,GAAiB,EAArB,CAArB,CADY,GAAb,CADH,CADF;;;;AAOD,OArBD;;AAuBA,UAAME,aAAa,GAAG,SAAhBA,aAAgB,CAACxF,OAAD,EAAkC;AACtD,YAAMgE,OAAO,GAAGhE,OAAO,CAACE,MAAR,CAAeI,KAAf,CAAhB;AACA,eAAO0D,OAAO,GAAGA,OAAO,CAACyB,IAAX,GAAkB,EAAhC;AACD,OAHD;;AAKA,UAAMC,WAAW,GAAGF,aAApB;;AAEA,aAAO;AACLzC,QAAAA,QAAQ,EAARA,QADK;AAELG,QAAAA,aAAa,EAAbA,aAFK;AAGLO,QAAAA,kBAAkB,EAAlBA,kBAHK;AAILE,QAAAA,iBAAiB,EAAEA,iBAJd;AAKLI,QAAAA,UAAU,EAAVA,UALK;AAMLc,QAAAA,WAAW,EAAXA,WANK;AAOLa,QAAAA,WAAW,EAAXA,WAPK;AAQLF,QAAAA,aAAa,EAAbA,aARK;AASLV,QAAAA,cAAc,EAAdA,cATK,EAAP;;AAWD,KAvSiC;;;;;;;;;;;;;;;;;;;AA0T1B7B,IAAAA,iBA1T0B,iHA0TN,kBAAOD,UAAP,EAA2B1C,KAA3B;AAClBN,gBAAAA,OADkB,GACN,MAAKD,KADC,CAClBC,OADkB;AAEpBgC,gBAAAA,KAFoB,GAEZ,MAAKlC,KAAL,CAAWkC,KAAX,IAAoBpC,QAAQ,CAAC+F,YAAT,CAAsB3D,KAF9B;;AAItBhC,gBAAAA,OAAO,CAACiF,eAAR,CAAwB3E,KAAxB,CAJsB;AAKlBsF,gBAAAA,OALkB,GAKW;AACjC5C,kBAAAA,UAAU,EAAVA,UADiC;AAEjC1C,kBAAAA,KAAK,EAALA,KAFiC;AAGjCuF,kBAAAA,YAAY,EAAE7F,OAAO,CAAC2E,sBAAR,CAA+BrE,KAA/B,CAHmB;AAIjCwF,kBAAAA,WAAW,EAAE9F,OAAO,CAAC+F,4BAAR,CAAqCzF,KAArC,CAJoB;AAKjC0F,kBAAAA,YAAY,EAAE,CAAChG,OAAO,CAACiG,8CAAR,CAAuD3F,KAAvD,EAA8D,MAAKR,KAAL,CAAWkB,cAAzE,CALkB;AAMjCgB,kBAAAA,KAAK,EAAEA,KAAK,GAAG,CANkB,CAMf;AANe,iBALX;AAajB,sBAAKlC,KAAL,CAAWoG,GAAX,CAAeC,MAAf,CAAsBP,OAAtB,EAA+BQ,IAA/B,CAAoC,UAAAC,MAAM,EAAI;AAC3CC,kBAAAA,OAD2C,GAClBD,MADkB,CAC3CC,OAD2C,CAClCnC,IADkC,GAClBkC,MADkB,CAClClC,IADkC,CAC5B3D,KAD4B,GAClB6F,MADkB,CAC5B7F,KAD4B;AAEnD,yBAAO8F,OAAO,IAAInC,IAAX;AACHoC,kBAAAA,OAAO,CAACC,OAAR;AACErC,kBAAAA,IAAI,CAAClD,GAAL,CAAS,UAACwF,IAAD,EAA+B;AACtC,2BAAOnD,yBAAYoD,kBAAZ,CAA+BD,IAA/B,CAAP;AACD,mBAFD,CADF,CADG;;AAMHF,kBAAAA,OAAO,CAACI,MAAR,CAAenG,KAAf,CANJ;AAOD,iBATM,CAbiB;;AAwBnB+F,gBAAAA,OAAO,CAACC,OAAR,CAAgB,EAAhB,CAxBmB,4DA1TM;;;AAqV1BI,IAAAA,sBArV0B,GAqVD,UAACtG,KAAD,EAA0D;AACjFN,MAAAA,OADiF,GACrE,MAAKD,KADgE,CACjFC,OADiF;AAEjFO,MAAAA,eAFiF,GAE7D,MAAKT,KAFwD,CAEjFS,eAFiF;AAGzF,UAAIA,eAAe,KAAKG,0BAAmBmG,IAAvC,IAA+C7G,OAAO,CAACS,QAAR,CAAiBH,KAAjB,CAAnD,EAA4E;AAC1E,eAAON,OAAO,CAAC8G,QAAR,CAAiBxG,KAAjB,CAAP;AACD;AACD,aAAO,IAAP;AACD,KA5ViC;;AA8V1BqC,IAAAA,4BA9V0B,GA8VK,UAACrC,KAAD,UAAuB,YAAuB;AACnF,YAAMyG,cAAc,GAAG,MAAKH,sBAAL,CAA4BtG,KAA5B,CAAvB;AACA,YAAMsB,aAAa,GAAG,MAAK1B,MAAL,CAAYI,KAAZ,CAAtB;AACA,YAAIsB,aAAa,IAAIhC,QAAQ,CAACiC,cAAT,CAAwBD,aAAa,CAACN,IAAtC,CAArB,EAAkE;AAChE,cAAM0F,QAAQ,GAAGpF,aAAa,CAACN,IAAd,CAAmBmB,GAApC;AACA,cAAMwE,QAAQ,GAAGD,QAAQ,GAAGA,QAAQ,CAACC,QAAZ,GAAuB,KAAhD;AACA,iBAAOF,cAAc,KAAK,IAAnB,IAA2BE,QAA3B,GAAsC,MAAKhH,MAAL,CAAYiH,yBAAlD,GAA8EH,cAArF;AACD;AACD,eAAOA,cAAP;AACD,OATsC,EA9VL;;AAyW1BjE,IAAAA,uBAzW0B,GAyWA,YAAuB;AACvD,UAAMiE,cAAc,GAAG,MAAKH,sBAAL,CAA4BzE,uBAAgBC,UAA5C,CAAvB;AACA,UAAM+E,iBAAiB,GAAG,SAApBA,iBAAoB,GAAM;AACtBnH,QAAAA,OADsB,GACV,MAAKD,KADK,CACtBC,OADsB;AAE9B,YAAMoH,gBAAgB,8BAAQpH,OAAO,CAACoH,gBAAhB,CAAtB;AACA,eAAOA,gBAAgB,CAACjF,uBAAgBC,UAAjB,CAAvB;AACA,cAAKiB,mBAAL,CAAyBC,yBAAYC,iBAAZ,CAA8BvD,OAA9B,EAAuC,EAAEoH,gBAAgB,EAAhBA,gBAAF,EAAvC,CAAzB;AACD,OALD;AAMA;AACEL,QAAAA,cAAc;AACZ;AACE,mDAAOA,cAAP,CADF;AAEG,cAAKhH,KAAL,CAAWC,OAAX,CAAmBqH,mBAAnB;AACC;AACE,qCAAC,cAAD,IAAQ,OAAO,EAAEF,iBAAjB,EAAoC,GAAG,EAAC,MAAxC;AACG,cAAKlH,MAAL,CAAYqH,iBADf,CADF,CAHJ,CAFJ;;;;;;;AAcD,KA/XiC;;AAiY1BC,IAAAA,MAjY0B,GAiYjB,YAA4B;AACnCvH,MAAAA,OADmC,GACvB,MAAKD,KADkB,CACnCC,OADmC;AAEnCkG,MAAAA,GAFmC,GAE3B,MAAKpG,KAFsB,CAEnCoG,GAFmC;;AAI3C,aAAOA,GAAG,CAACqB,MAAJ,CAAWvH,OAAX,EAAoBoG,IAApB,CAAyB,UAACC,MAAD,EAA+C;AACrEC,QAAAA,OADqE,GACnDD,MADmD,CACrEC,OADqE,CAC5DnC,IAD4D,GACnDkC,MADmD,CAC5DlC,IAD4D;AAE7E,YAAImC,OAAO,IAAInC,IAAf,EAAqB;AACnB,iBAAOb,yBAAYiE,MAAZ,CAAmBvH,OAAnB,EAA4BmE,IAA5B,CAAP;AACD;AACD,eAAOb,yBAAYkE,cAAZ,CAA2BxH,OAA3B,CAAP;AACD,OANM,CAAP;AAOD,KA5YiC;;;;;;;;;;;;;;AA0Z1ByH,IAAAA,mBA1Z0B,GA0ZJ,UAACC,OAAD,EAA2B;AACvD,YAAKrE,mBAAL,CAAyBC,yBAAYC,iBAAZ,CAA8B,MAAKxD,KAAL,CAAWC,OAAzC,EAAkD,EAAE0H,OAAO,EAAPA,OAAF,EAAlD,CAAzB;AACD,KA5ZiC;;AA8Z1BC,IAAAA,0BA9Z0B,GA8ZG,UAACrF,KAAD,EAAmB;AACtD,YAAKe,mBAAL;AACEC,+BAAYC,iBAAZ,CAA8B,MAAKxD,KAAL,CAAWC,OAAzC,EAAkD;AAChD4H,QAAAA,cAAc,EAAEtF,KADgC,EAAlD,CADF;;;AAKD,KApaiC;;AAsa1Be,IAAAA,mBAta0B,GAsaJ,UAACrD,OAAD,EAAuB6H,QAAvB,EAAiD;AAC7E,YAAKC,QAAL;AACE;AACE9H,QAAAA,OAAO,EAAEsD,yBAAYC,iBAAZ,CAA8BvD,OAA9B,EAAuC;AAC9CE,UAAAA,MAAM,EAAEoD,yBAAYyE,mBAAZ,CAAgC/H,OAAO,CAACE,MAAxC,EAAgD,MAAKJ,KAAL,CAAWkB,cAA3D,CADsC,EAAvC,CADX,EADF;;;AAME6G,MAAAA,QANF;;AAQD,KA/aiC;;AAib1BG,IAAAA,kBAjb0B,GAibL,UAAChI,OAAD,EAA0B;AACrD,YAAKqD,mBAAL,CAAyBrD,OAAzB;AACD,KAnbiC;;AAqb1B0D,IAAAA,kBArb0B,GAqbL,YAAM;AACzB1D,MAAAA,OADyB,GACb,MAAKD,KADQ,CACzBC,OADyB;AAEjC,UAAIA,OAAO,CAACiI,SAAZ,EAAuB;AACrB,cAAKH,QAAL,CAAc;AACZ9H,UAAAA,OAAO,EAAEsD,yBAAYC,iBAAZ,CAA8BvD,OAA9B,EAAuC,EAAEkI,MAAM,EAAE,EAAV,EAAvC,CADG,EAAd;;AAGD;AACF,KA5biC,CAGhC,MAAKhI,MAAL,GAAcoD,yBAAY6E,UAAZ,CAAuBC,MAAvB,CACZ,UAAClI,MAAD,EAAyBI,KAAzB,EAAiE,0BAC/D,QAAQA,KAAR,GACE,KAAK2D,kBAAWC,MAAhB,CACA,KAAKD,kBAAWoE,QAAhB,CACA,KAAKpE,kBAAWqE,IAAhB,CACA,KAAKrE,kBAAWsE,aAAhB,CACA,KAAKtE,kBAAWuE,UAAhB,CACA,KAAKvE,kBAAWwE,iBAAhB,CACA,KAAKxE,kBAAWyE,MAAhB,CACA,KAAKzE,kBAAW0E,KAAhB,CACA,KAAK1E,kBAAW2E,KAAhB,CACA,KAAK3E,kBAAW4E,IAAhB,CACE,kCACK3I,MADL,6BAEGI,KAFH,IAEW,EACPgB,IAAI,EAAE,MAAKkB,yBAAL,CAA+BlC,KAA/B,CADC,EAEPiB,MAAM,EAAE,0BAAM,MAAKG,qBAAL,CAA2BpB,KAA3B,CAAN,EAFD,EAFX,cAOF,KAAK6B,uBAAgBC,UAArB,CACE,kCACKlC,MADL,6BAEGI,KAFH,IAEW,EACPgB,IAAI,EAAE,MAAKsB,yBAAL,EADC,EAEPrB,MAAM,EAAE,0BAAM,MAAKU,qBAAL,EAAN,EAFD,EAFX,cAOF,QACE,OAAO/B,MAAP,CA3BJ,CA6BD,CA/BW,EAgCZ,EAhCY,CAAd,CAHgC,aAqCjC,C,uCAQM4I,iB,GAAP,6BAA2B,CACzB,KAAKtF,QAAL,GACD,C,QAOMjC,M,GAAP,kBAAgB,KACNvB,OADM,GACM,KAAKD,KADX,CACNC,OADM,mBAE0B,KAAKF,KAF/B,CAENoG,GAFM,eAENA,GAFM,CAEDlE,KAFC,eAEDA,KAFC,CAEM+G,eAFN,eAEMA,eAFN,CAGd,OACE,0CACE,6BAAC,cAAD,IAAQ,QAAQ,MAAhB,IACGA,eAAe,IACd,6BAAC,QAAD,CAAU,KAAV,IAAgB,KAAK,EAAE,KAAK9I,MAAL,CAAY+I,YAAnC,IACE,6BAAC,wCAAD,IACE,GAAG,EAAE9C,GADP,EAEE,OAAO,EAAElG,OAAO,CAAC0H,OAFnB,EAGE,aAAa,EAAE,KAAKD,mBAHtB,EAIE,KAAK,EAAEzF,KAJT,GADF,CAFJ,EAWG,KAAKlC,KAAL,CAAWqG,MAAX,IACC,6BAAC,QAAD,CAAU,KAAV,QACE,6BAAC,sBAAD,IACE,GAAG,EAAED,GADP,EAEE,OAAO,EAAElG,OAFX,EAGE,aAAa,EAAE,KAAKgI,kBAHtB,EAIE,KAAK,EAAEhG,KAJT,EAKE,WAAW,EAAE,KAAK/B,MAAL,CAAYgJ,iBAL3B,GADF,CAZJ,EAsBG,KAAKC,aAAL,GACC,6BAAC,cAAD,IAAQ,QAAQ,MAAhB,IACE,6BAAC,QAAD,CAAU,KAAV,IAAgB,KAAK,EAAE,KAAKjJ,MAAL,CAAYkJ,mBAAnC,IACE,6BAAC,kBAAD,IACE,KAAK,EAAEnJ,OAAO,CAAC4H,cADjB,EAEE,aAAa,EAAE,KAAKD,0BAFtB,EAGE,WAAW,EAAE,KAAK1H,MAAL,CAAYmJ,yBAH3B,EAIE,KAAK,EAAC,MAJR,EAKE,MAAM,EAAC,MALT,GADF,CADF,EAUG,KAAKrI,YAAL,CAAkB,CAACoB,uBAAgBC,UAAjB,CAAlB,CAVH,CADD,GAcC,KAAKrB,YAAL,CAAkBuC,yBAAY6E,UAA9B,CApCJ,CADF,CADF,CA2CD,C,QAqMOtF,0B,GAAR,sCAAiD,mBAC/C,OAAO,EACLK,aAAa,EAAE,uBAACZ,KAAD,EAAmB,mBACxBtC,OADwB,GACZ,MAAI,CAACD,KADO,CACxBC,OADwB,CAEhC,IAAMqJ,mBAAmB,8BACpBrJ,OAAO,CAACoH,gBADY,6BAEtBjF,uBAAgBC,UAFM,IAEOE,KAFP,aAAzB,CAIA,MAAI,CAACe,mBAAL,CACEC,yBAAYC,iBAAZ,CAA8BvD,OAA9B,EAAuC,EACrCoH,gBAAgB,EAAEiC,mBADmB,EAAvC,CADF,EAKD,CAZI,EAAP,CAcD,C,QAsFO7F,Q,GAAR,oBAAyB,mBACvB,IAAM8F,aAAa,GAAI,KAAKnJ,iBAAL,GAAyB,KAAKoH,MAAL,EAAhD,CAEA+B,aAAa,CAAClD,IAAd,CAAmB,UAAAmD,eAAe,EAAI,CACpC,IAAID,aAAa,KAAK,MAAI,CAACnJ,iBAA3B,EAA8C,CAC5C,MAAI,CAAC2H,QAAL,CAAc,EACZ9H,OAAO,EAAEsD,yBAAYE,QAAZ,CAAqB+F,eAArB,EAAsC,MAAI,CAACtJ,MAA3C,CADG,EAAd,EAGD,CACF,CAND,EAOD,C,mFAjXmC,KAC1BD,OAD0B,GACd,KAAKD,KADS,CAC1BC,OAD0B,KAE1B+I,eAF0B,GAEN,KAAKjJ,KAFC,CAE1BiJ,eAF0B,CAGlC,OAAO/I,OAAO,CAACwJ,SAAR,IAAsBpI,OAAO,CAAC2H,eAAD,CAAP,IAA4B,CAAC/I,OAAO,CAAC0H,OAAlE,CACD,C,uBAnF2B+B,eAAMC,S,WACpBC,mB,GAAsB,U,UAEtBhE,Y,GAAe,EAC3BpF,eAAe,EAAE,OADU,EAE3ByB,KAAK,EAAE,CAFoB,EAG3BhB,cAAc,EAAE,EAHW,EAI3B+H,eAAe,EAAE,KAJU,E,UAOfa,K,GAAQ,sBAAGpI,KAAH,SAAGA,KAAH,CAAUqI,QAAV,SAAUA,QAAV,QACpB,sCAAK,SAAS,EAAEC,mBAASC,GAAT,EAAhB,IACGvI,KAAK,IAAI,sCAAK,SAAS,EAAEsI,mBAAStI,KAAT,EAAhB,IAAmCA,KAAnC,CADZ,EAEE,sCAAK,SAAS,EAAEsI,mBAASxJ,KAAT,EAAhB,IAAmCuJ,QAAnC,CAFF,CADoB,E,UAORhI,c,GAAiB,UAACP,IAAD,EAAmD,KACxExB,KADwE,GAC9DwB,IAD8D,CACxExB,KADwE,CAEhF,OACEkK,MAAM,CAACC,SAAP,CAAiBC,cAAjB,CAAgCC,IAAhC,CAAqCrK,KAArC,EAA4C,mBAA5C,KACAkK,MAAM,CAACC,SAAP,CAAiBC,cAAjB,CAAgCC,IAAhC,CAAqCrK,KAArC,EAA4C,UAA5C,CAFF,CAID,C,UAEauC,W,GAAc,UAACf,IAAD,EAAgD,KAClExB,KADkE,GACxDwB,IADwD,CAClExB,KADkE,CAE1E,OAAO,CAACF,QAAQ,CAACiC,cAAT,CAAwBP,IAAxB,CAAD,IAAkC0I,MAAM,CAACC,SAAP,CAAiBC,cAAjB,CAAgCC,IAAhC,CAAqCrK,KAArC,EAA4C,eAA5C,CAAzC,CACD,C","sourcesContent":["import React from 'react';\r\n\r\nimport { Gapped } from '../../Gapped';\r\nimport { Button } from '../../Button';\r\nimport { locale } from '../../../lib/locale/decorators';\r\nimport { FiasLocale, FiasLocaleHelper } from '../locale';\r\nimport {\r\n  FiasAddressResponse,\r\n  FiasAPIProvider,\r\n  FiasAPIResult,\r\n  FiasExtraFields,\r\n  FiasCountry,\r\n  FiasFields,\r\n  FiasFieldsSettings,\r\n  FiasFormValidation,\r\n  FiasSearchOptions,\r\n  FiasVerifyResponse,\r\n} from '../types';\r\nimport { FiasAddressElement } from '../models/FiasAddressElement';\r\nimport { Tooltip } from '../../Tooltip';\r\nimport { Input, InputProps } from '../../Input';\r\nimport { FiasSearch } from '../FiasSearch/FiasSearch';\r\nimport { Textarea } from '../../Textarea';\r\nimport { FiasAddress } from '../models/FiasAddress';\r\n\r\nimport { FiasCountrySelector } from './FiasCountrySelector';\r\nimport { jsStyles } from './FiasForm.styles';\r\nimport { FiasComboBox, FiasComboBoxProps } from './FiasComboBox';\r\n\r\ninterface FiasFormProps {\r\n  api: FiasAPIProvider;\r\n  address: FiasAddress;\r\n  fieldsSettings: FiasFieldsSettings;\r\n  search?: boolean;\r\n  limit?: number;\r\n  validationLevel?: FiasFormValidation;\r\n  countrySelector?: boolean;\r\n}\r\n\r\ninterface FiasFormState {\r\n  address: FiasAddress;\r\n}\r\n\r\ntype FiasFormFields = {\r\n  [field in FiasFields | FiasExtraFields]?: {\r\n    meta: FiasFormFieldMeta;\r\n    render: () => React.ReactNode;\r\n  };\r\n};\r\n\r\ninterface FieldMeta<C, P> {\r\n  ref: C | null;\r\n  props: P;\r\n  createRef: (ref: C | null) => any;\r\n  tooltip: () => React.ReactNode;\r\n}\r\n\r\ntype ComboBoxMeta = FieldMeta<FiasComboBox, FiasComboBoxProps>;\r\ntype InputMeta = FieldMeta<Input, InputProps>;\r\ntype FiasFormFieldMeta = ComboBoxMeta | InputMeta;\r\n\r\n@locale('Fias', FiasLocaleHelper)\r\nexport class FiasForm extends React.Component<FiasFormProps, FiasFormState> {\r\n  public static __KONTUR_REACT_UI__ = 'FiasForm';\r\n\r\n  public static defaultProps = {\r\n    validationLevel: 'Error',\r\n    limit: 5,\r\n    fieldsSettings: {},\r\n    countrySelector: false,\r\n  };\r\n\r\n  public static Field = ({ label, children }: { label?: string; children?: React.ReactNode }) => (\r\n    <div className={jsStyles.row()}>\r\n      {label && <div className={jsStyles.label()}>{label}</div>}\r\n      <div className={jsStyles.field()}>{children}</div>\r\n    </div>\r\n  );\r\n\r\n  public static isComboboxMeta = (meta: FiasFormFieldMeta): meta is ComboBoxMeta => {\r\n    const { props } = meta;\r\n    return (\r\n      Object.prototype.hasOwnProperty.call(props, 'onUnexpectedInput') &&\r\n      Object.prototype.hasOwnProperty.call(props, 'getItems')\r\n    );\r\n  };\r\n\r\n  public static isInputMeta = (meta: FiasFormFieldMeta): meta is InputMeta => {\r\n    const { props } = meta;\r\n    return !FiasForm.isComboboxMeta(meta) && Object.prototype.hasOwnProperty.call(props, 'onValueChange');\r\n  };\r\n\r\n  public state: FiasFormState = {\r\n    address: this.props.address,\r\n  };\r\n\r\n  private readonly locale!: FiasLocale;\r\n\r\n  private fields: FiasFormFields;\r\n\r\n  private lastVerifyPromise: Promise<FiasAddress> | null = null;\r\n\r\n  constructor(props: FiasFormProps) {\r\n    super(props);\r\n\r\n    this.fields = FiasAddress.ALL_FIELDS.reduce<FiasFormFields>(\r\n      (fields: FiasFormFields, field: FiasFields | FiasExtraFields) => {\r\n        switch (field) {\r\n          case FiasFields.region:\r\n          case FiasFields.district:\r\n          case FiasFields.city:\r\n          case FiasFields.intracityarea:\r\n          case FiasFields.settlement:\r\n          case FiasFields.planningstructure:\r\n          case FiasFields.street:\r\n          case FiasFields.stead:\r\n          case FiasFields.house:\r\n          case FiasFields.room:\r\n            return {\r\n              ...fields,\r\n              [field]: {\r\n                meta: this.createAddressComboboxMeta(field),\r\n                render: () => this.renderAddressComboBox(field),\r\n              },\r\n            };\r\n          case FiasExtraFields.postalcode:\r\n            return {\r\n              ...fields,\r\n              [field]: {\r\n                meta: this.createPostalCodeInputMeta(),\r\n                render: () => this.renderPostalCodeInput(),\r\n              },\r\n            };\r\n          default:\r\n            return fields;\r\n        }\r\n      },\r\n      {},\r\n    );\r\n  }\r\n\r\n  public get isForeignForm(): boolean {\r\n    const { address } = this.state;\r\n    const { countrySelector } = this.props;\r\n    return address.isForeign || (Boolean(countrySelector) && !address.country);\r\n  }\r\n\r\n  public componentDidMount() {\r\n    this.validate();\r\n  }\r\n\r\n  public submit = async (): Promise<FiasAddress> => {\r\n    await this.lastVerifyPromise;\r\n    return this.state.address;\r\n  };\r\n\r\n  public render() {\r\n    const { address } = this.state;\r\n    const { api, limit, countrySelector } = this.props;\r\n    return (\r\n      <div>\r\n        <Gapped vertical>\r\n          {countrySelector && (\r\n            <FiasForm.Field label={this.locale.countryLabel}>\r\n              <FiasCountrySelector\r\n                api={api}\r\n                country={address.country}\r\n                onValueChange={this.handleCountryChange}\r\n                limit={limit}\r\n              />\r\n            </FiasForm.Field>\r\n          )}\r\n          {this.props.search && (\r\n            <FiasForm.Field>\r\n              <FiasSearch\r\n                api={api}\r\n                address={address}\r\n                onValueChange={this.handleSearchChange}\r\n                limit={limit}\r\n                placeholder={this.locale.searchPlaceholder}\r\n              />\r\n            </FiasForm.Field>\r\n          )}\r\n          {this.isForeignForm ? (\r\n            <Gapped vertical>\r\n              <FiasForm.Field label={this.locale.foreignAddressLabel}>\r\n                <Textarea\r\n                  value={address.foreignAddress}\r\n                  onValueChange={this.handleForeignAddressChange}\r\n                  placeholder={this.locale.foreignAddressPlaceholder}\r\n                  width=\"100%\"\r\n                  resize=\"none\"\r\n                />\r\n              </FiasForm.Field>\r\n              {this.renderFields([FiasExtraFields.postalcode])}\r\n            </Gapped>\r\n          ) : (\r\n            this.renderFields(FiasAddress.ALL_FIELDS)\r\n          )}\r\n        </Gapped>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  private getCommonFieldProps = (\r\n    field: FiasFields | FiasExtraFields,\r\n  ): {\r\n    warning: boolean;\r\n    error: boolean;\r\n    placeholder: string;\r\n  } => {\r\n    const { address } = this.state;\r\n    const { validationLevel } = this.props;\r\n    return {\r\n      error: address.hasError(field) && validationLevel === FiasFormValidation.Error,\r\n      warning: address.hasError(field) && validationLevel === FiasFormValidation.Warning,\r\n      placeholder: this.locale[`${field}Placeholder` as keyof FiasLocale],\r\n    };\r\n  };\r\n\r\n  private renderFields = (fields: Array<FiasFields | FiasExtraFields>): React.ReactNode => {\r\n    const { fieldsSettings } = this.props;\r\n    return fields.map((field: FiasFields | FiasExtraFields) => {\r\n      const control = this.fields[field];\r\n      const settings = fieldsSettings[field];\r\n      if (control && Boolean(settings && settings.visible)) {\r\n        const { meta, render } = control;\r\n        const label = this.locale[`${field}Label` as keyof FiasLocale];\r\n        return (\r\n          control && (\r\n            <FiasForm.Field label={label} key={field}>\r\n              <Tooltip pos={'right middle'} render={meta.tooltip}>\r\n                {render()}\r\n              </Tooltip>\r\n            </FiasForm.Field>\r\n          )\r\n        );\r\n      }\r\n    });\r\n  };\r\n\r\n  private renderAddressComboBox = (field: FiasFields, width: string | number = '100%'): React.ReactNode => {\r\n    const comboboxField = this.fields[field];\r\n    if (comboboxField && FiasForm.isComboboxMeta(comboboxField.meta)) {\r\n      const { address } = this.state;\r\n      const { props, createRef } = comboboxField.meta;\r\n      const commonProps = this.getCommonFieldProps(field);\r\n      return (\r\n        <FiasComboBox\r\n          {...commonProps}\r\n          {...props}\r\n          value={address}\r\n          width={width}\r\n          drawArrow={false}\r\n          searchOnFocus={false}\r\n          limit={this.props.limit}\r\n          ref={createRef}\r\n        />\r\n      );\r\n    }\r\n  };\r\n\r\n  private renderPostalCodeInput = (): React.ReactNode => {\r\n    const inputField = this.fields[FiasExtraFields.postalcode];\r\n    if (inputField && FiasForm.isInputMeta(inputField.meta)) {\r\n      const { address } = this.state;\r\n      const { props, createRef } = inputField.meta;\r\n      const commonProps = this.getCommonFieldProps(FiasExtraFields.postalcode);\r\n      const value = address.postalCode;\r\n      return <Input {...commonProps} {...props} value={value} width={130} ref={createRef} />;\r\n    }\r\n  };\r\n\r\n  private createAddressComboboxMeta = (field: FiasFields): ComboBoxMeta => {\r\n    return {\r\n      ref: null,\r\n      props: this.createAddressComboBoxProps(field),\r\n      tooltip: this.createAddressComboBoxTooltip(field),\r\n      createRef: (ref: FiasComboBox | null) => {\r\n        const comboboxField = this.fields[field];\r\n        if (comboboxField) {\r\n          comboboxField.meta.ref = ref;\r\n        }\r\n      },\r\n    };\r\n  };\r\n\r\n  private createPostalCodeInputMeta = (): InputMeta => {\r\n    return {\r\n      ref: null,\r\n      props: this.createPostalCodeInputProps(),\r\n      tooltip: () => this.createPostalCodeTooltip(),\r\n      createRef: (ref: Input | null) => {\r\n        const inputField = this.fields[FiasExtraFields.postalcode];\r\n        if (inputField) {\r\n          inputField.meta.ref = ref;\r\n        }\r\n      },\r\n    };\r\n  };\r\n\r\n  private createAddressComboBoxProps = (field: FiasFields): FiasComboBoxProps => {\r\n    const getItems = async (searchText: string) => this.createItemsSource(searchText, field);\r\n\r\n    const onValueChange = (value: FiasAddress) => {\r\n      const { address } = this.state;\r\n      const newFields = {\r\n        ...address.fields,\r\n        ...value.fields,\r\n      };\r\n      // get rid of undefineds\r\n      let addressField: FiasFields;\r\n      for (addressField in newFields) {\r\n        if (!newFields[addressField]) {\r\n          delete newFields[addressField];\r\n        }\r\n      }\r\n      this.handleAddressChange(FiasAddress.createFromAddress(address, { fields: newFields }), this.validate);\r\n    };\r\n\r\n    const onInputValueChange = () => {\r\n      this.resetAddressErrors();\r\n    };\r\n\r\n    const onUnexpectedInput = (query: string) => {\r\n      const { address } = this.state;\r\n      const newFields = {\r\n        ...address.fields,\r\n        [field]: query ? new FiasAddressElement(field, query) : undefined,\r\n      };\r\n      return FiasAddress.createFromAddress(address, { fields: newFields });\r\n    };\r\n\r\n    const renderItem = (address: FiasAddress): string => {\r\n      const element = address.fields[field];\r\n      if (!element) {\r\n        return '';\r\n      }\r\n\r\n      if (field === FiasFields.region && element.data) {\r\n        const regionCode = element.data.code.substr(0, 2);\r\n        return `${regionCode} ${element.getText()}`;\r\n      }\r\n\r\n      const diffAddress = new FiasAddress({\r\n        fields: this.state.address.getDiffFields(address, this.props.fieldsSettings),\r\n      });\r\n      const hasParentFields = Boolean(diffAddress.getClosestParentFiasId(field));\r\n      return hasParentFields ? diffAddress.getText() : element.getText(element.isTypeMatchField(field));\r\n    };\r\n\r\n    const renderValue = (address: FiasAddress): React.ReactNode => {\r\n      const element = address.fields[field];\r\n      return element && element.getText(element.isTypeMatchField(field));\r\n    };\r\n\r\n    const renderNotFound = (): React.ReactNode => {\r\n      const { address } = this.state;\r\n      let messages = [this.locale[`${field}NotFound` as keyof FiasLocale] || this.locale.addressNotFound];\r\n\r\n      if (address.isAllowedToFill(field)) {\r\n        if (address.hasOnlyIndirectParent(field)) {\r\n          messages.push(this.locale.addressFillParentOrSearch);\r\n        }\r\n      } else {\r\n        messages = this.locale[`${field}FillBefore` as keyof FiasLocale]\r\n          ? [this.locale[`${field}FillBefore` as keyof FiasLocale]]\r\n          : messages;\r\n      }\r\n\r\n      return (\r\n        <div>\r\n          {messages.map((message, i, m) => (\r\n            <div key={i}>{message + (m[i + 1] ? '.' : '')}</div>\r\n          ))}\r\n        </div>\r\n      );\r\n    };\r\n\r\n    const valueToString = (address: FiasAddress): string => {\r\n      const element = address.fields[field];\r\n      return element ? element.name : '';\r\n    };\r\n\r\n    const itemToValue = valueToString;\r\n\r\n    return {\r\n      getItems,\r\n      onValueChange,\r\n      onInputValueChange,\r\n      onUnexpectedInput: onUnexpectedInput,\r\n      renderItem,\r\n      renderValue,\r\n      itemToValue,\r\n      valueToString,\r\n      renderNotFound,\r\n    };\r\n  };\r\n\r\n  private createPostalCodeInputProps(): InputProps {\r\n    return {\r\n      onValueChange: (value: string) => {\r\n        const { address } = this.state;\r\n        const newAdditionalFields = {\r\n          ...address.additionalFields,\r\n          [FiasExtraFields.postalcode]: value,\r\n        };\r\n        this.handleAddressChange(\r\n          FiasAddress.createFromAddress(address, {\r\n            additionalFields: newAdditionalFields,\r\n          }),\r\n        );\r\n      },\r\n    };\r\n  }\r\n\r\n  private createItemsSource = async (searchText: string, field: FiasFields) => {\r\n    const { address } = this.state;\r\n    const limit = this.props.limit || FiasForm.defaultProps.limit;\r\n\r\n    if (address.isAllowedToFill(field)) {\r\n      const options: FiasSearchOptions = {\r\n        searchText,\r\n        field,\r\n        parentFiasId: address.getClosestParentFiasId(field),\r\n        fullAddress: address.isAllowedToSearchFullAddress(field),\r\n        directParent: !address.isAllowedToSearchThroughChildrenOfDirectParent(field, this.props.fieldsSettings),\r\n        limit: limit + 1, // +1 to detect if there are more items\r\n      };\r\n      return this.props.api.search(options).then(result => {\r\n        const { success, data, error } = result;\r\n        return success && data\r\n          ? Promise.resolve(\r\n              data.map((item: FiasAddressResponse) => {\r\n                return FiasAddress.createFromResponse(item);\r\n              }),\r\n            )\r\n          : Promise.reject(error);\r\n      });\r\n    }\r\n    return Promise.resolve([]);\r\n  };\r\n\r\n  private getFieldTooltipContent = (field: FiasFields | FiasExtraFields): React.ReactNode => {\r\n    const { address } = this.state;\r\n    const { validationLevel } = this.props;\r\n    if (validationLevel !== FiasFormValidation.None && address.hasError(field)) {\r\n      return address.getError(field);\r\n    }\r\n    return null;\r\n  };\r\n\r\n  private createAddressComboBoxTooltip = (field: FiasFields) => (): React.ReactNode => {\r\n    const tooltipContent = this.getFieldTooltipContent(field);\r\n    const comboboxField = this.fields[field];\r\n    if (comboboxField && FiasForm.isComboboxMeta(comboboxField.meta)) {\r\n      const combobox = comboboxField.meta.ref;\r\n      const hasItems = combobox ? combobox.hasItems : false;\r\n      return tooltipContent !== null && hasItems ? this.locale.addressSelectItemFromList : tooltipContent;\r\n    }\r\n    return tooltipContent;\r\n  };\r\n\r\n  private createPostalCodeTooltip = (): React.ReactNode => {\r\n    const tooltipContent = this.getFieldTooltipContent(FiasExtraFields.postalcode);\r\n    const replacePostalCode = () => {\r\n      const { address } = this.state;\r\n      const additionalFields = { ...address.additionalFields };\r\n      delete additionalFields[FiasExtraFields.postalcode];\r\n      this.handleAddressChange(FiasAddress.createFromAddress(address, { additionalFields }));\r\n    };\r\n    return (\r\n      tooltipContent && (\r\n        <div>\r\n          <span>{tooltipContent}</span>\r\n          {this.state.address.isPostalCodeAltered && (\r\n            <div>\r\n              <Button onClick={replacePostalCode} use=\"link\">\r\n                {this.locale.postalcodeReplace}\r\n              </Button>\r\n            </div>\r\n          )}\r\n        </div>\r\n      )\r\n    );\r\n  };\r\n\r\n  private verify = (): Promise<FiasAddress> => {\r\n    const { address } = this.state;\r\n    const { api } = this.props;\r\n\r\n    return api.verify(address).then((result: FiasAPIResult<FiasVerifyResponse>) => {\r\n      const { success, data } = result;\r\n      if (success && data) {\r\n        return FiasAddress.verify(address, data);\r\n      }\r\n      return FiasAddress.removeFiasData(address);\r\n    });\r\n  };\r\n\r\n  private validate(): void {\r\n    const verifyPromise = (this.lastVerifyPromise = this.verify());\r\n\r\n    verifyPromise.then(verifiedAddress => {\r\n      if (verifyPromise === this.lastVerifyPromise) {\r\n        this.setState({\r\n          address: FiasAddress.validate(verifiedAddress, this.locale),\r\n        });\r\n      }\r\n    });\r\n  }\r\n\r\n  private handleCountryChange = (country?: FiasCountry) => {\r\n    this.handleAddressChange(FiasAddress.createFromAddress(this.state.address, { country }));\r\n  };\r\n\r\n  private handleForeignAddressChange = (value: string) => {\r\n    this.handleAddressChange(\r\n      FiasAddress.createFromAddress(this.state.address, {\r\n        foreignAddress: value,\r\n      }),\r\n    );\r\n  };\r\n\r\n  private handleAddressChange = (address: FiasAddress, callback?: () => void) => {\r\n    this.setState(\r\n      {\r\n        address: FiasAddress.createFromAddress(address, {\r\n          fields: FiasAddress.filterVisibleFields(address.fields, this.props.fieldsSettings),\r\n        }),\r\n      },\r\n      callback,\r\n    );\r\n  };\r\n\r\n  private handleSearchChange = (address: FiasAddress) => {\r\n    this.handleAddressChange(address);\r\n  };\r\n\r\n  private resetAddressErrors = () => {\r\n    const { address } = this.state;\r\n    if (address.hasErrors) {\r\n      this.setState({\r\n        address: FiasAddress.createFromAddress(address, { errors: {} }),\r\n      });\r\n    }\r\n  };\r\n}\r\n"]}