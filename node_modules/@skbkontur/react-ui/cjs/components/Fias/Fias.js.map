{"version":3,"sources":["Fias.tsx"],"names":["deepMerge","dst","src","forEach","obj","k","Fias","FiasLocaleHelper","props","state","opened","address","FiasAddress","locale","get","fieldsSettings","theme","api","FiasAPI","baseUrl","version","form","componentDidMount","updateLocale","init","componentDidUpdate","prevProps","prevState","value","updateAddress","updateFieldsSettings","onInit","getValue","isFieldVisible","FiasExtraFields","postalcode","getAddress","setState","nextLocale","handleOpen","handleClose","onClose","handleSave","submit","hasErrors","allowNotVerified","handleChange","onValueChange","refForm","element","FiasLogger","log","warnings","baseUrlOrApiIsRequired","field","render","renderMain","showAddressText","label","icon","error","warning","feedback","linkText","isEmpty","addressFill","addressEdit","validation","jsStyles","Boolean","getFullText","readonly","renderModal","search","limit","formValidation","countrySelector","userSettings","defaultSettings","ALL_FIELDS","reduce","settings","visible","React","Component","__KONTUR_REACT_UI__","defaultProps"],"mappings":"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","sourcesContent":["import React from 'react';\r\nimport isEqual from 'lodash.isequal';\r\nimport warning from 'warning';\r\nimport cn from 'classnames';\r\n\r\nimport { Link } from '../Link';\r\nimport { locale } from '../../lib/locale/decorators';\r\nimport { ThemeContext } from '../../lib/theming/ThemeContext';\r\nimport { Theme } from '../../lib/theming/Theme';\r\nimport { EditIcon } from '../../internal/icons/16px';\r\nimport { LocaleContext } from '../../lib/locale';\r\n\r\nimport { FiasLocale, FiasLocaleHelper } from './locale';\r\nimport {\r\n  FiasAPIProvider,\r\n  FiasExtraFields,\r\n  FiasValue,\r\n  FiasFields,\r\n  FiasFieldsSettings,\r\n  FiasFormValidation,\r\n} from './types';\r\nimport { FiasModal } from './FiasModal';\r\nimport { FiasForm } from './Form/FiasForm';\r\nimport { FiasAPI } from './api/FiasAPI';\r\nimport { FiasAddress } from './models/FiasAddress';\r\nimport { FiasLogger } from './logger/FiasLogger';\r\nimport { jsStyles } from './Fias.styles';\r\n\r\nexport interface FiasProps {\r\n  /**\r\n   * Значение адреса. См. формат в примерах\r\n   */\r\n  value?: Partial<FiasValue>;\r\n  error?: boolean;\r\n  warning?: boolean;\r\n  /**\r\n   * Сообщение пользователю в режиме `error` или `warning`\r\n   */\r\n  feedback?: string;\r\n  /**\r\n   * Выводить ли текстовую интерпретацию адреса над ссылкой\r\n   */\r\n  showAddressText?: boolean;\r\n  /**\r\n   * Текст ссылки\r\n   */\r\n  label?: string;\r\n  /**\r\n   * Иконка рядом со ссылкой\r\n   */\r\n  icon?: React.ReactElement<any>;\r\n  readonly?: boolean;\r\n  /**\r\n   * API URL. Существует тестовый\r\n   * `https://api.testkontur.ru/fias/v1/` и боевой `https://api.kontur.ru/fias/v1/`\r\n   */\r\n  baseUrl?: string;\r\n  /**\r\n   * API instance. Если нет возможности использовать стандартный API.\r\n   */\r\n  api?: FiasAPIProvider;\r\n  /**\r\n   * Позволяет получить полный FiasValue после обработки входного `value`\r\n   */\r\n  onInit?: (value: FiasValue) => void;\r\n  onValueChange?: (value: FiasValue) => void;\r\n  onClose?: () => void;\r\n  /**\r\n   * Добавляет поле поиска адреса в произвольной форме\r\n   */\r\n  search?: boolean;\r\n  /**\r\n   * Количество отображаемых элементов в выпадающих списках\r\n   */\r\n  limit?: number;\r\n  /**\r\n   * Уровень критичности ошибок валидации полей адреса\r\n   */\r\n  formValidation?: FiasFormValidation;\r\n  /**\r\n   * Разрешать ли сохранять неверефицированный (произвольный, не из базы) адрес\r\n   */\r\n  allowNotVerified?: boolean;\r\n  /**\r\n   * Версия базы данных ФИАС. Формат: \"2018-10-22\"\r\n   */\r\n  version?: string;\r\n  /**\r\n   * Настройка полей. Достаточно переопределить только нужные.\r\n   * Внимание, не рекомендуется скрывать поля в произвольном порядке. Это может привести\r\n   * к невозможности заполнения некоторых адресов.\r\n   * Значение по умолчанию:\r\n   *\r\n   * ```ts\r\n   *  {\r\n   *     region:\r\n   *     ...\r\n   *     room: {\r\n   *       visible: true\r\n   *     },\r\n   *     postalcode: {\r\n   *       visible: false\r\n   *     }\r\n   *  }```\r\n   *\r\n   */\r\n  fieldsSettings: FiasFieldsSettings;\r\n  /* Выбор страны */\r\n  countrySelector: boolean;\r\n}\r\n\r\nexport interface FiasState {\r\n  opened: boolean;\r\n  address: FiasAddress;\r\n  locale: FiasLocale;\r\n  fieldsSettings: FiasFieldsSettings;\r\n}\r\n\r\nfunction deepMerge<T>(dst: T, ...src: T[]): T {\r\n  src.forEach(obj => {\r\n    for (const k in obj) {\r\n      if (dst[k] != null && typeof obj[k] === 'object') {\r\n        dst[k] = deepMerge(dst[k], obj[k]);\r\n      } else {\r\n        dst[k] = obj[k];\r\n      }\r\n    }\r\n  });\r\n  return dst;\r\n}\r\n\r\n/**\r\n * @deprecated Контур-специфичный компонент, будет удален в 3.0.0, перенесен в `@skbkontur/react-ui-addons` смотри [миграцию](https://github.com/skbkontur/retail-ui/blob/master/packages/react-ui/MIGRATION.md)\r\n */\r\n\r\n@locale('Fias', FiasLocaleHelper)\r\nexport class Fias extends React.Component<FiasProps, FiasState> {\r\n  public static __KONTUR_REACT_UI__ = 'Fias';\r\n\r\n  public static defaultProps = {\r\n    showAddressText: true,\r\n    error: false,\r\n    warning: false,\r\n    readonly: false,\r\n    search: false,\r\n    icon: <EditIcon />,\r\n    allowNotVerified: true,\r\n    fieldsSettings: {},\r\n    countrySelector: false,\r\n  };\r\n\r\n  public state: FiasState = {\r\n    opened: false,\r\n    address: new FiasAddress(),\r\n    locale: FiasLocaleHelper.get(),\r\n    fieldsSettings: this.fieldsSettings,\r\n  };\r\n\r\n  private theme!: Theme;\r\n  private api: FiasAPIProvider = this.props.api || new FiasAPI(this.props.baseUrl, this.props.version);\r\n  private form: FiasForm | null = null;\r\n\r\n  private readonly locale!: FiasLocale;\r\n\r\n  public constructor(props: FiasProps) {\r\n    super(props);\r\n    warning(\r\n      true,\r\n      `Fias has been deprecated, use Fias from @skbkontur/react-ui-addons instead, see [migration](https://github.com/skbkontur/retail-ui/blob/master/packages/react-ui/MIGRATION.md)`,\r\n    );\r\n    if (!props.baseUrl && !props.api) {\r\n      FiasLogger.log(FiasLogger.warnings.baseUrlOrApiIsRequired);\r\n    }\r\n  }\r\n\r\n  public get fieldsSettings(): FiasFieldsSettings {\r\n    const { fieldsSettings: userSettings, countrySelector } = this.props;\r\n    // TODO: implement deepMerge with clone\r\n    const defaultSettings = FiasAddress.ALL_FIELDS.reduce<FiasFieldsSettings>(\r\n      (settings: FiasFieldsSettings, field: FiasFields | FiasExtraFields) => ({\r\n        ...settings,\r\n        [field]: {\r\n          visible: true,\r\n        },\r\n      }),\r\n      {},\r\n    );\r\n    return deepMerge<FiasFieldsSettings>(\r\n      defaultSettings,\r\n      {\r\n        [FiasExtraFields.postalcode]: {\r\n          visible: Boolean(countrySelector),\r\n        },\r\n      },\r\n      userSettings,\r\n    );\r\n  }\r\n\r\n  public componentDidMount = () => {\r\n    this.updateLocale();\r\n    this.init();\r\n  };\r\n\r\n  public componentDidUpdate = (prevProps: FiasProps, prevState: FiasState) => {\r\n    if (!isEqual(prevProps.value, this.props.value)) {\r\n      this.updateAddress();\r\n    }\r\n    if (!isEqual(prevState.locale, this.locale)) {\r\n      this.updateLocale(this.locale);\r\n    }\r\n    if (!isEqual(prevProps.fieldsSettings, this.props.fieldsSettings)) {\r\n      this.updateFieldsSettings();\r\n    }\r\n  };\r\n\r\n  public isFieldVisible(field: FiasFields | FiasExtraFields): boolean {\r\n    return FiasAddress.isFieldVisible(field, this.state.fieldsSettings);\r\n  }\r\n\r\n  public render() {\r\n    return (\r\n      <ThemeContext.Consumer>\r\n        {theme => {\r\n          this.theme = theme;\r\n          return this.renderMain();\r\n        }}\r\n      </ThemeContext.Consumer>\r\n    );\r\n  }\r\n\r\n  private renderMain() {\r\n    const { showAddressText, label, icon, error, warning, feedback } = this.props;\r\n    const { opened, address } = this.state;\r\n\r\n    const linkText = label || (address.isEmpty ? this.state.locale.addressFill : this.state.locale.addressEdit);\r\n\r\n    const validation =\r\n      (error || warning) && feedback ? (\r\n        <span\r\n          className={cn({\r\n            [jsStyles.error(this.theme)]: Boolean(error),\r\n            [jsStyles.warning(this.theme)]: Boolean(warning),\r\n          })}\r\n        >\r\n          {feedback}\r\n        </span>\r\n      ) : null;\r\n\r\n    return (\r\n      <LocaleContext.Provider value={{ locale: { Fias: this.state.locale } }}>\r\n        <div>\r\n          {showAddressText && <span>{address.getFullText(this.isFieldVisible(FiasExtraFields.postalcode))}</span>}\r\n          {!this.props.readonly && (\r\n            <div>\r\n              <Link icon={icon} onClick={this.handleOpen}>\r\n                {linkText}\r\n              </Link>\r\n            </div>\r\n          )}\r\n          {validation}\r\n          {opened && this.renderModal()}\r\n        </div>\r\n      </LocaleContext.Provider>\r\n    );\r\n  }\r\n\r\n  private renderModal() {\r\n    const { address, fieldsSettings } = this.state;\r\n    const { search, limit, formValidation, countrySelector } = this.props;\r\n    return (\r\n      <FiasModal onClose={this.handleClose} onSave={this.handleSave}>\r\n        <FiasForm\r\n          ref={this.refForm}\r\n          address={address}\r\n          api={this.api}\r\n          search={search}\r\n          limit={limit}\r\n          validationLevel={formValidation}\r\n          fieldsSettings={fieldsSettings}\r\n          countrySelector={countrySelector}\r\n        />\r\n      </FiasModal>\r\n    );\r\n  }\r\n\r\n  private init = async () => {\r\n    const address = await this.updateAddress();\r\n    if (this.props.onInit) {\r\n      this.props.onInit(address.getValue(this.isFieldVisible(FiasExtraFields.postalcode)));\r\n    }\r\n  };\r\n\r\n  private updateAddress = async (): Promise<FiasAddress> => {\r\n    const address = await FiasAddress.getAddress(this.api, this.props.value, this.state.fieldsSettings);\r\n    this.setState({\r\n      address,\r\n    });\r\n    return address;\r\n  };\r\n\r\n  private updateLocale = (nextLocale: FiasLocale = FiasLocaleHelper.get()): void => {\r\n    this.setState({ locale: nextLocale });\r\n  };\r\n\r\n  private updateFieldsSettings = (): void => {\r\n    this.setState({\r\n      fieldsSettings: this.fieldsSettings,\r\n    });\r\n  };\r\n\r\n  private handleOpen = () => {\r\n    this.setState({ opened: true });\r\n  };\r\n\r\n  private handleClose = () => {\r\n    this.setState({ opened: false });\r\n    const onClose = this.props.onClose;\r\n    if (onClose) {\r\n      onClose();\r\n    }\r\n  };\r\n\r\n  private handleSave = async () => {\r\n    if (this.form) {\r\n      const address = await this.form.submit();\r\n      if (address.hasErrors && this.props.allowNotVerified === false) {\r\n        return;\r\n      }\r\n      this.handleChange(address);\r\n    }\r\n    this.handleClose();\r\n  };\r\n\r\n  private handleChange = (address: FiasAddress) => {\r\n    if (this.props.onValueChange) {\r\n      this.props.onValueChange(address.getValue(this.isFieldVisible(FiasExtraFields.postalcode)));\r\n    }\r\n  };\r\n\r\n  private refForm = (element: FiasForm | null) => {\r\n    this.form = element;\r\n  };\r\n}\r\n"]}