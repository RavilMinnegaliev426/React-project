{"version":3,"sources":["FiasSearch.tsx"],"names":["COMBOBOX_PASS_PROPS","limit","align","searchOnFocus","drawArrow","autoFocus","borderless","disablePortal","disabled","error","maxLength","menuAlign","onBlur","onFocus","onInputValueChange","placeholder","size","warning","width","maxMenuHeight","onMouseEnter","onMouseOver","onMouseLeave","FiasSearch","FiasLocaleHelper","props","locale","renderItem","address","getText","renderValue","FiasFields","room","renderNotFound","searchNotFound","valueToString","onValueChange","onUnexpectedInput","query","FiasAddress","getItems","searchText","api","options","fullAddress","directParent","defaultProps","search","then","result","success","data","Promise","resolve","map","item","createFromResponse","reject","render","restComboBoxProps","React","Component","__KONTUR_REACT_UI__"],"mappings":"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","sourcesContent":["import React from 'react';\r\nimport warning from 'warning';\r\n\r\nimport { FiasLocale, FiasLocaleHelper } from '../locale';\r\nimport { FiasComboBox, FiasComboBoxProps } from '../Form/FiasComboBox';\r\nimport { FiasAddressResponse, FiasAPIProvider, FiasFields, FiasSearchOptions } from '../types';\r\nimport { locale } from '../../../lib/locale/decorators';\r\nimport { filterProps } from '../../../lib/filterProps';\r\n\r\nimport { FiasAddress } from '..';\r\n\r\nconst COMBOBOX_PASS_PROPS = {\r\n  limit: true,\r\n  align: true,\r\n  searchOnFocus: true,\r\n  drawArrow: true,\r\n  autoFocus: true,\r\n  borderless: true,\r\n  disablePortal: true,\r\n  disabled: true,\r\n  error: true,\r\n  maxLength: true,\r\n  menuAlign: true,\r\n  onBlur: true,\r\n  onFocus: true,\r\n  onInputValueChange: true,\r\n  placeholder: true,\r\n  size: true,\r\n  warning: true,\r\n  width: true,\r\n  maxMenuHeight: true,\r\n  onMouseEnter: true,\r\n  onMouseOver: true,\r\n  onMouseLeave: true,\r\n};\r\n\r\nexport interface FiasSearchProps extends Pick<FiasComboBoxProps, keyof typeof COMBOBOX_PASS_PROPS> {\r\n  api: FiasAPIProvider;\r\n  address?: FiasAddress;\r\n  onValueChange?: (address: FiasAddress) => void;\r\n}\r\n\r\n/**\r\n * @deprecated Контур-специфичный компонент, будет удален в 3.0.0, перенесен в `@skbkontur/react-ui-addons` смотри [миграцию](https://github.com/skbkontur/retail-ui/blob/master/packages/react-ui/MIGRATION.md)\r\n */\r\n\r\n@locale('Fias', FiasLocaleHelper)\r\nexport class FiasSearch extends React.Component<FiasSearchProps> {\r\n  public static __KONTUR_REACT_UI__ = 'FiasSearch';\r\n\r\n  public static defaultProps = {\r\n    width: '100%',\r\n    limit: 5,\r\n    drawArrow: false,\r\n    searchOnFocus: false,\r\n  };\r\n\r\n  private readonly locale!: FiasLocale;\r\n\r\n  public constructor(props: FiasSearchProps) {\r\n    super(props);\r\n    warning(\r\n      false,\r\n      `FiasSearch has been deprecated, use FiasSearch from @skbkontur/react-ui-addons instead, see [migration](https://github.com/skbkontur/retail-ui/blob/master/packages/react-ui/MIGRATION.md)`,\r\n    );\r\n  }\r\n\r\n  public render() {\r\n    const restComboBoxProps = filterProps(this.props, COMBOBOX_PASS_PROPS);\r\n    return (\r\n      <FiasComboBox\r\n        getItems={this.getItems}\r\n        value={this.props.address}\r\n        renderItem={this.renderItem}\r\n        renderValue={this.renderValue}\r\n        valueToString={this.valueToString}\r\n        onValueChange={this.onValueChange}\r\n        onUnexpectedInput={this.onUnexpectedInput}\r\n        renderNotFound={this.renderNotFound}\r\n        {...restComboBoxProps}\r\n      />\r\n    );\r\n  }\r\n\r\n  private renderItem = (address: FiasAddress): string => {\r\n    return address.getText();\r\n  };\r\n\r\n  private renderValue = (address: FiasAddress): string => {\r\n    return address.getText(FiasFields.room);\r\n  };\r\n\r\n  private renderNotFound = (): React.ReactNode => {\r\n    return this.locale.searchNotFound;\r\n  };\r\n\r\n  private valueToString = (address: FiasAddress): string => {\r\n    return address.getText(FiasFields.room);\r\n  };\r\n\r\n  private onValueChange = (address: FiasAddress) => {\r\n    const { onValueChange } = this.props;\r\n    if (onValueChange) {\r\n      onValueChange(address);\r\n    }\r\n  };\r\n\r\n  private onUnexpectedInput = (query: string) => {\r\n    if (!query) {\r\n      return new FiasAddress();\r\n    }\r\n  };\r\n\r\n  private getItems = async (searchText: string) => {\r\n    const { api, limit } = this.props;\r\n\r\n    const options: FiasSearchOptions = {\r\n      searchText,\r\n      fullAddress: true,\r\n      directParent: false,\r\n      limit: (limit || FiasSearch.defaultProps.limit) + 1, // +1 to detect if there are more items\r\n    };\r\n\r\n    return api.search(options).then(result => {\r\n      const { success, data, error } = result;\r\n      return success && data\r\n        ? Promise.resolve(data.map((item: FiasAddressResponse) => FiasAddress.createFromResponse(item)))\r\n        : Promise.reject(error);\r\n    });\r\n  };\r\n}\r\n"]}