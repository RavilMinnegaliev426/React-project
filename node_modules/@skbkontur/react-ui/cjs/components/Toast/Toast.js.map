{"version":3,"sources":["Toast.tsx"],"names":["Toast","push","notification","action","ToastStatic","close","props","_toast","_timeout","safelyCall","onClose","state","setState","_clearTimer","clearTimeout","_setTimer","timeOut","window","setTimeout","_refToast","element","id","componentWillUnmount","render","_renderToast","onPush","toastProps","onMouseEnter","onMouseLeave","children","enter","jsStyles","enterActive","exit","exitActive","React","Component","__KONTUR_REACT_UI__","fn","args"],"mappings":"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","sourcesContent":["import React from 'react';\r\nimport { CSSTransition, TransitionGroup } from 'react-transition-group';\r\n\r\nimport { RenderContainer } from '../../internal/RenderContainer';\r\nimport { Nullable } from '../../typings/utility-types';\r\n\r\nimport { jsStyles } from './Toast.styles';\r\nimport { ToastView, ToastViewProps } from './ToastView';\r\nimport { ToastStatic } from './ToastStatic';\r\n\r\nexport interface Action {\r\n  label: string;\r\n  handler: () => void;\r\n}\r\n\r\nexport interface ToastState {\r\n  notification: Nullable<string>;\r\n  action: Nullable<Action>;\r\n  id: number;\r\n}\r\n\r\nexport interface ToastProps {\r\n  onPush?: (notification: string, action?: Action) => void;\r\n  onClose?: (notification: string, action?: Action) => void;\r\n}\r\n\r\n/**\r\n * Toast manages notifications\r\n * method `push` is sending notification,\r\n * then automatically hides it after 3 or 7 seconds,\r\n * depending on if this notification contains action or not.\r\n *\r\n * Can be used like `Toast.push('message')` or\r\n * `Toast.push('message', {label: 'Cancel', handler: cancelHandler})`\r\n */\r\nexport class Toast extends React.Component<ToastProps, ToastState> {\r\n  public static __KONTUR_REACT_UI__ = 'Toast';\r\n\r\n  public static push(notification: string, action?: Action) {\r\n    ToastStatic.push(notification, action);\r\n  }\r\n\r\n  public static close() {\r\n    ToastStatic.close();\r\n  }\r\n\r\n  public _toast: Nullable<ToastView>;\r\n  private _timeout: Nullable<number> = null;\r\n\r\n  constructor(props: ToastProps) {\r\n    super(props);\r\n    this.state = {\r\n      notification: null,\r\n      action: null,\r\n      id: 0,\r\n    };\r\n  }\r\n\r\n  public componentWillUnmount() {\r\n    this._clearTimer();\r\n  }\r\n\r\n  public render() {\r\n    return (\r\n      <RenderContainer>\r\n        <TransitionGroup>{this._renderToast()}</TransitionGroup>\r\n      </RenderContainer>\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Показывает тост с `notification` в качестве сообщения.\r\n   *\r\n   * `action` опциональный параметр формата `{ label: string, handler: function }` добавляет кнопку в виде ссылки при клике на которую вызывается переданный handler\r\n   * @public\r\n   * @param notification\r\n   * @param action\r\n   */\r\n  public push(notification: string, action?: Action) {\r\n    if (this.state.notification) {\r\n      this.close();\r\n    }\r\n\r\n    safelyCall(this.props.onPush, notification, action);\r\n\r\n    this.setState(({ id }) => ({ notification, action, id: id + 1 }), this._setTimer);\r\n  }\r\n\r\n  /**\r\n   * @public\r\n   */\r\n  public close = () => {\r\n    safelyCall(this.props.onClose, this.state.notification, this.state.action);\r\n    this.setState({ notification: null, action: null });\r\n  };\r\n\r\n  private _renderToast() {\r\n    const { notification, action, id } = this.state;\r\n\r\n    if (!notification) {\r\n      return null;\r\n    }\r\n\r\n    const toastProps: ToastViewProps = {\r\n      onMouseEnter: this._clearTimer,\r\n      onMouseLeave: this._setTimer,\r\n      onClose: this.close,\r\n      children: notification,\r\n      action,\r\n    };\r\n\r\n    return (\r\n      <CSSTransition\r\n        key={id}\r\n        classNames={{\r\n          enter: jsStyles.enter(),\r\n          enterActive: jsStyles.enterActive(),\r\n          exit: jsStyles.exit(),\r\n          exitActive: jsStyles.exitActive(),\r\n        }}\r\n        timeout={{\r\n          enter: 200,\r\n          exit: 150,\r\n        }}\r\n      >\r\n        <ToastView ref={this._refToast} {...toastProps} />\r\n      </CSSTransition>\r\n    );\r\n  }\r\n\r\n  private _clearTimer = () => {\r\n    if (this._timeout) {\r\n      clearTimeout(this._timeout);\r\n      this._timeout = null;\r\n    }\r\n  };\r\n\r\n  private _setTimer = () => {\r\n    this._clearTimer();\r\n\r\n    const timeOut = this.state.action ? 7 : 3;\r\n\r\n    this._timeout = window.setTimeout(this.close, timeOut * 1000);\r\n  };\r\n\r\n  private _refToast = (element: ToastView) => {\r\n    this._toast = element;\r\n  };\r\n}\r\n\r\nfunction safelyCall(fn: Nullable<(a?: any) => any>, ...args: any[]) {\r\n  if (fn) {\r\n    fn(...args);\r\n  }\r\n}\r\n"]}