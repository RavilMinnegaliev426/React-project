{"version":3,"sources":["Checkbox.tsx"],"names":["Checkbox","state","focusedByTab","indeterminate","props","initialIndeterminate","theme","input","componentDidMount","setIndeterminate","setState","resetIndeterminate","handleFocus","e","disabled","process","nextTick","tabListener","isTabPressed","handleBlur","onBlur","inputRef","ref","handleChange","event","checked","currentTarget","onValueChange","onChange","UNSAFE_componentWillReceiveProps","nextProps","render","renderMain","focus","blur","children","error","warning","onMouseEnter","onMouseLeave","onMouseOver","style","className","type","rest","isIndeterminate","rootClass","jsStyles","root","rootFallback","isIE11","isEdge","Boolean","inputProps","onFocus","caption","captionClass","captionIE11","iconClass","iconUnchecked","iconFixBaseline","isFirefox","box","React","Component","__KONTUR_REACT_UI__","propTypes","PropTypes","bool","func"],"mappings":"kcAAA;AACA;AACA;;;AAGA;;AAEA;AACA;AACA;;AAEA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA+BA;;;AAGaA,Q;;;;;;;;;;;;;;;AAeJC,IAAAA,K,GAAQ;AACbC,MAAAA,YAAY,EAAE,KADD;AAEbC,MAAAA,aAAa,EAAE,MAAKC,KAAL,CAAWC,oBAAX,IAAmC,KAFrC,E;;;AAKPC,IAAAA,K;AACAC,IAAAA,K;;AAEDC,IAAAA,iB,GAAoB,YAAM;AAC/B,UAAI,MAAKP,KAAL,CAAWE,aAAX,IAA4B,MAAKI,KAArC,EAA4C;AAC1C,cAAKA,KAAL,CAAWJ,aAAX,GAA2B,IAA3B;AACD;AACF,K;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAsCMM,IAAAA,gB,GAAmB,YAAM;AAC9B,YAAKC,QAAL,CAAc;AACZP,QAAAA,aAAa,EAAE,IADH,EAAd;;AAGA,UAAI,MAAKI,KAAT,EAAgB;AACd,cAAKA,KAAL,CAAWJ,aAAX,GAA2B,IAA3B;AACD;AACF,K;;;;;;AAMMQ,IAAAA,kB,GAAqB,YAAM;AAChC,YAAKD,QAAL,CAAc;AACZP,QAAAA,aAAa,EAAE,KADH,EAAd;;AAGA,UAAI,MAAKI,KAAT,EAAgB;AACd,cAAKA,KAAL,CAAWJ,aAAX,GAA2B,KAA3B;AACD;AACF,K;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAsEOS,IAAAA,W,GAAc,UAACC,CAAD,EAA8B;AAClD,UAAI,CAAC,MAAKT,KAAL,CAAWU,QAAhB,EAA0B;AACxB;AACA;AACAC,QAAAA,OAAO,CAACC,QAAR,CAAiB,YAAM;AACrB,cAAIC,yBAAYC,YAAhB,EAA8B;AAC5B,kBAAKR,QAAL,CAAc,EAAER,YAAY,EAAE,IAAhB,EAAd;AACD;AACF,SAJD;AAKD;AACF,K;;AAEOiB,IAAAA,U,GAAa,UAACN,CAAD,EAA2C;AAC9D,YAAKT,KAAL,CAAWgB,MAAX,0BAAKhB,KAAL,CAAWgB,MAAX,CAAoBP,CAApB;AACA,YAAKH,QAAL,CAAc,EAAER,YAAY,EAAE,KAAhB,EAAd;AACD,K;;AAEOmB,IAAAA,Q,GAAW,UAACC,GAAD,EAAkC;AACnD,YAAKf,KAAL,GAAae,GAAb;AACD,K;;AAEOC,IAAAA,Y,GAAe,UAACC,KAAD,EAAgD;AACrE,UAAMC,OAAO,GAAGD,KAAK,CAACE,aAAN,CAAoBD,OAApC;AACA,YAAKrB,KAAL,CAAWuB,aAAX,0BAAKvB,KAAL,CAAWuB,aAAX,CAA2BF,OAA3B;;AAEA,YAAKd,kBAAL;;AAEA,YAAKP,KAAL,CAAWwB,QAAX,0BAAKxB,KAAL,CAAWwB,QAAX,CAAsBJ,KAAtB;AACD,K,sDA1JMK,gC,GAAP,0CAAwCC,SAAxC,EAAkE,CAChE,IAAIA,SAAS,CAACL,OAAV,KAAsB,KAAKrB,KAAL,CAAWqB,OAArC,EAA8C,CAC5C,KAAKd,kBAAL,GACD,CACF,C,QAEMoB,M,GAAP,kBAAgB,mBACd,OACE,6BAAC,0BAAD,CAAc,QAAd,QACG,UAAAzB,KAAK,EAAI,CACR,MAAI,CAACA,KAAL,GAAaA,KAAb,CACA,OAAO,MAAI,CAAC0B,UAAL,EAAP,CACD,CAJH,CADF,CAQD,C,CAED;;sbAGOC,K,GAAP,iBAAe,iBACbhB,yBAAYC,YAAZ,GAA2B,IAA3B,CACA,oBAAKX,KAAL,iCAAY0B,KAAZ,GACD,C,CAED;;4lBAGOC,I,GAAP,gBAAc,kBACZ,qBAAK3B,KAAL,kCAAY2B,IAAZ,GACD,C,CAED;;;qtBA0BQF,U,GAAR,sBAAqB,eACnB,IAAM5B,KAAK,GAAG,KAAKA,KAAnB,CADmB,IAGjB+B,QAHiB,GAef/B,KAfe,CAGjB+B,QAHiB,CAIjBC,KAJiB,GAefhC,KAfe,CAIjBgC,KAJiB,CAKjBC,OALiB,GAefjC,KAfe,CAKjBiC,OALiB,CAMjBC,YANiB,GAeflC,KAfe,CAMjBkC,YANiB,CAOjBC,YAPiB,GAefnC,KAfe,CAOjBmC,YAPiB,CAQjBC,WARiB,GAefpC,KAfe,CAQjBoC,WARiB,CASjBb,aATiB,GAefvB,KAfe,CASjBuB,aATiB,CAUjBc,KAViB,GAefrC,KAfe,CAUjBqC,KAViB,CAWjBC,SAXiB,GAeftC,KAfe,CAWjBsC,SAXiB,CAYjBC,IAZiB,GAefvC,KAfe,CAYjBuC,IAZiB,CAajBtC,oBAbiB,GAefD,KAfe,CAajBC,oBAbiB,CAcduC,IAdc,+CAefxC,KAfe,0JAgBnB,IAAMyC,eAAe,GAAG,KAAK5C,KAAL,CAAWE,aAAnC,CAEA,IAAM2C,SAAS,GAAG,wCACfC,mBAASC,IAAT,CAAc,KAAK1C,KAAnB,CADe,IACa,IADb,MAEfyC,mBAASE,YAAT,EAFe,IAEWC,iBAAUC,aAFrB,MAGfJ,mBAASjC,QAAT,CAAkB,KAAKR,KAAvB,CAHe,IAGiB8C,OAAO,CAAChD,KAAK,CAACU,QAAP,CAHxB,MAIfiC,mBAAStB,OAAT,CAAiB,KAAKnB,KAAtB,CAJe,IAIgB8C,OAAO,CAAChD,KAAK,CAACqB,OAAP,CAJvB,MAKfsB,mBAAS5C,aAAT,CAAuB,KAAKG,KAA5B,CALe,IAKsBuC,eALtB,MAMfE,mBAASd,KAAT,CAAe,KAAK3B,KAApB,CANe,IAMc,KAAKL,KAAL,CAAWC,YANzB,MAOf6C,mBAASV,OAAT,CAAiB,KAAK/B,KAAtB,CAPe,IAOgB8C,OAAO,CAAChD,KAAK,CAACiC,OAAP,CAPvB,MAQfU,mBAASX,KAAT,CAAe,KAAK9B,KAApB,CARe,IAQc8C,OAAO,CAAChD,KAAK,CAACgC,KAAP,CARrB,OAAlB,CAWA,IAAMiB,UAAU,8BACXT,IADW,IAEdD,IAAI,EAAE,UAFQ,EAGdD,SAAS,EAAEK,mBAASxC,KAAT,EAHG,EAIdqB,QAAQ,EAAE,KAAKL,YAJD,EAKd+B,OAAO,EAAE,KAAK1C,WALA,EAMdQ,MAAM,EAAE,KAAKD,UANC,EAOdG,GAAG,EAAE,KAAKD,QAPI,GAAhB,CAUA,IAAIkC,OAAO,GAAG,IAAd,CACA,IAAIpB,QAAJ,EAAc,UACZ,IAAMqB,YAAY,GAAG,0CAClBT,mBAASQ,OAAT,EADkB,IACG,IADH,OAElBR,mBAASU,WAAT,EAFkB,IAEOP,iBAAUC,aAFjB,QAArB,CAIAI,OAAO,GAAG,uCAAM,SAAS,EAAEC,YAAjB,IAAgCrB,QAAhC,CAAV,CACD,CAED,IAAMuB,SAAS,GAAG,0CACfX,mBAASY,aAAT,EADe,IACY,CAACvD,KAAK,CAACqB,OAAP,IAAkB,CAACoB,eAD/B,OAEfE,mBAASa,eAAT,EAFe,IAEcC,oBAAaX,aAAb,IAAuBC,aAFrC,QAAlB,CAKA,IAAMW,GAAG,GACP,uCAAM,SAAS,EAAEf,mBAASe,GAAT,CAAa,KAAKxD,KAAlB,CAAjB,IACIuC,eAAe,IAAI,6BAAC,cAAD,IAAY,SAAS,EAAEa,SAAvB,GAApB,IAA6D,6BAAC,UAAD,IAAQ,SAAS,EAAEA,SAAnB,GADhE,CADF,CAMA,OACE,wCAAO,SAAS,EAAEZ,SAAlB,EAA6B,YAAY,EAAER,YAA3C,EAAyD,YAAY,EAAEC,YAAvE,EAAqF,WAAW,EAAEC,WAAlG,IACE,sCAAWa,UAAX,CADF,EAEGS,GAFH,EAGGP,OAHH,CADF,CAOD,C,mBAzJ2BQ,eAAMC,S,8BAAvBhE,Q,CACGiE,mB,GAAsB,U,CADzBjE,Q,CAGGkE,S,GAAY,EACxBzC,OAAO,EAAE0C,mBAAUC,IADK,EAExBtD,QAAQ,EAAEqD,mBAAUC,IAFI,EAGxBhC,KAAK,EAAE+B,mBAAUC,IAHO,EAIxB/B,OAAO,EAAE8B,mBAAUC,IAJK,EAKxBzC,aAAa,EAAEwC,mBAAUE,IALD,EAMxBjD,MAAM,EAAE+C,mBAAUE,IANM,EAOxB/B,YAAY,EAAE6B,mBAAUE,IAPA,EAQxB9B,YAAY,EAAE4B,mBAAUE,IARA,EASxB7B,WAAW,EAAE2B,mBAAUE,IATC,E","sourcesContent":["import React from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport cn from 'classnames';\r\n\r\nimport { Nullable, Override } from '../../typings/utility-types';\r\nimport { tabListener } from '../../lib/events/tabListener';\r\nimport { Theme } from '../../lib/theming/Theme';\r\nimport { ThemeContext } from '../../lib/theming/ThemeContext';\r\nimport { OkIcon, SquareIcon } from '../../internal/icons/16px';\r\nimport { isEdge, isFirefox, isIE11 } from '../../lib/utils';\r\n\r\nimport { jsStyles } from './Checkbox.styles';\r\n\r\nexport type CheckboxProps = Override<\r\n  React.InputHTMLAttributes<HTMLInputElement>,\r\n  {\r\n    /** Контент `label` */\r\n    children?: React.ReactNode;\r\n    /** Состояние ошибки */\r\n    error?: boolean;\r\n    /** Состояние Предупреждения */\r\n    warning?: boolean;\r\n    /** Вызывается на label */\r\n    onMouseEnter?: React.MouseEventHandler<HTMLLabelElement>;\r\n    /** Вызывается на label */\r\n    onMouseLeave?: React.MouseEventHandler<HTMLLabelElement>;\r\n    /** Вызывается на label */\r\n    onMouseOver?: React.MouseEventHandler<HTMLLabelElement>;\r\n    /** Вызывается при изменении `value` */\r\n    onValueChange?: (value: boolean) => void;\r\n    /** onBlur */\r\n    onBlur?: (event: React.FocusEvent<HTMLInputElement>) => void;\r\n    /** Состояние частичного выделения */\r\n    initialIndeterminate?: boolean;\r\n  }\r\n>;\r\n\r\nexport interface CheckboxState {\r\n  focusedByTab: boolean;\r\n  indeterminate: boolean;\r\n}\r\n\r\n/**\r\n * Все свойства, кроме перечисленных, `className` и `style` передаются в `input`.\r\n */\r\nexport class Checkbox extends React.Component<CheckboxProps, CheckboxState> {\r\n  public static __KONTUR_REACT_UI__ = 'Checkbox';\r\n\r\n  public static propTypes = {\r\n    checked: PropTypes.bool,\r\n    disabled: PropTypes.bool,\r\n    error: PropTypes.bool,\r\n    warning: PropTypes.bool,\r\n    onValueChange: PropTypes.func,\r\n    onBlur: PropTypes.func,\r\n    onMouseEnter: PropTypes.func,\r\n    onMouseLeave: PropTypes.func,\r\n    onMouseOver: PropTypes.func,\r\n  };\r\n\r\n  public state = {\r\n    focusedByTab: false,\r\n    indeterminate: this.props.initialIndeterminate || false,\r\n  };\r\n\r\n  private theme!: Theme;\r\n  private input: Nullable<HTMLInputElement>;\r\n\r\n  public componentDidMount = () => {\r\n    if (this.state.indeterminate && this.input) {\r\n      this.input.indeterminate = true;\r\n    }\r\n  };\r\n\r\n  public UNSAFE_componentWillReceiveProps(nextProps: CheckboxProps) {\r\n    if (nextProps.checked !== this.props.checked) {\r\n      this.resetIndeterminate();\r\n    }\r\n  }\r\n\r\n  public render() {\r\n    return (\r\n      <ThemeContext.Consumer>\r\n        {theme => {\r\n          this.theme = theme;\r\n          return this.renderMain();\r\n        }}\r\n      </ThemeContext.Consumer>\r\n    );\r\n  }\r\n\r\n  /**\r\n   * @public\r\n   */\r\n  public focus() {\r\n    tabListener.isTabPressed = true;\r\n    this.input?.focus();\r\n  }\r\n\r\n  /**\r\n   * @public\r\n   */\r\n  public blur() {\r\n    this.input?.blur();\r\n  }\r\n\r\n  /**\r\n   * Установить промежуточное значение\r\n   * @public\r\n   */\r\n  public setIndeterminate = () => {\r\n    this.setState({\r\n      indeterminate: true,\r\n    });\r\n    if (this.input) {\r\n      this.input.indeterminate = true;\r\n    }\r\n  };\r\n\r\n  /**\r\n   * Сбросить промежуточное значение\r\n   * @public\r\n   */\r\n  public resetIndeterminate = () => {\r\n    this.setState({\r\n      indeterminate: false,\r\n    });\r\n    if (this.input) {\r\n      this.input.indeterminate = false;\r\n    }\r\n  };\r\n\r\n  private renderMain() {\r\n    const props = this.props;\r\n    const {\r\n      children,\r\n      error,\r\n      warning,\r\n      onMouseEnter,\r\n      onMouseLeave,\r\n      onMouseOver,\r\n      onValueChange,\r\n      style,\r\n      className,\r\n      type,\r\n      initialIndeterminate,\r\n      ...rest\r\n    } = props;\r\n    const isIndeterminate = this.state.indeterminate;\r\n\r\n    const rootClass = cn({\r\n      [jsStyles.root(this.theme)]: true,\r\n      [jsStyles.rootFallback()]: isIE11 || isEdge,\r\n      [jsStyles.disabled(this.theme)]: Boolean(props.disabled),\r\n      [jsStyles.checked(this.theme)]: Boolean(props.checked),\r\n      [jsStyles.indeterminate(this.theme)]: isIndeterminate,\r\n      [jsStyles.focus(this.theme)]: this.state.focusedByTab,\r\n      [jsStyles.warning(this.theme)]: Boolean(props.warning),\r\n      [jsStyles.error(this.theme)]: Boolean(props.error),\r\n    });\r\n\r\n    const inputProps = {\r\n      ...rest,\r\n      type: 'checkbox',\r\n      className: jsStyles.input(),\r\n      onChange: this.handleChange,\r\n      onFocus: this.handleFocus,\r\n      onBlur: this.handleBlur,\r\n      ref: this.inputRef,\r\n    };\r\n\r\n    let caption = null;\r\n    if (children) {\r\n      const captionClass = cn({\r\n        [jsStyles.caption()]: true,\r\n        [jsStyles.captionIE11()]: isIE11 || isEdge,\r\n      });\r\n      caption = <span className={captionClass}>{children}</span>;\r\n    }\r\n\r\n    const iconClass = cn({\r\n      [jsStyles.iconUnchecked()]: !props.checked && !isIndeterminate,\r\n      [jsStyles.iconFixBaseline()]: isFirefox || isIE11 || isEdge,\r\n    });\r\n\r\n    const box = (\r\n      <span className={jsStyles.box(this.theme)}>\r\n        {(isIndeterminate && <SquareIcon className={iconClass} />) || <OkIcon className={iconClass} />}\r\n      </span>\r\n    );\r\n\r\n    return (\r\n      <label className={rootClass} onMouseEnter={onMouseEnter} onMouseLeave={onMouseLeave} onMouseOver={onMouseOver}>\r\n        <input {...inputProps} />\r\n        {box}\r\n        {caption}\r\n      </label>\r\n    );\r\n  }\r\n\r\n  private handleFocus = (e: React.FocusEvent<any>) => {\r\n    if (!this.props.disabled) {\r\n      // focus event fires before keyDown eventlistener\r\n      // so we should check tabPressed in async way\r\n      process.nextTick(() => {\r\n        if (tabListener.isTabPressed) {\r\n          this.setState({ focusedByTab: true });\r\n        }\r\n      });\r\n    }\r\n  };\r\n\r\n  private handleBlur = (e: React.FocusEvent<HTMLInputElement>) => {\r\n    this.props.onBlur?.(e);\r\n    this.setState({ focusedByTab: false });\r\n  };\r\n\r\n  private inputRef = (ref: HTMLInputElement | null) => {\r\n    this.input = ref;\r\n  };\r\n\r\n  private handleChange = (event: React.ChangeEvent<HTMLInputElement>) => {\r\n    const checked = event.currentTarget.checked;\r\n    this.props.onValueChange?.(checked);\r\n\r\n    this.resetIndeterminate();\r\n\r\n    this.props.onChange?.(event);\r\n  };\r\n}\r\n"]}