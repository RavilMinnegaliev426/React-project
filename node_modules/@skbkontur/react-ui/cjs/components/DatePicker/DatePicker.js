"use strict";var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");exports.__esModule = true;exports.DatePicker = void 0;var _extends2 = _interopRequireDefault(require("@babel/runtime/helpers/extends"));var _inheritsLoose2 = _interopRequireDefault(require("@babel/runtime/helpers/inheritsLoose"));var _propTypes = _interopRequireDefault(require("prop-types"));
var _react = _interopRequireDefault(require("react"));
var _reactDom = require("react-dom");

var _InternalDate = require("../../lib/date/InternalDate");
var _InternalDateTransformer = require("../../lib/date/InternalDateTransformer");
var _constants = require("../../lib/date/constants");
var _types = require("../../lib/date/types");


var _DateInput = require("../DateInput");
var _DropdownContainer = require("../../internal/DropdownContainer");
var _filterProps = require("../../lib/filterProps");

var _Picker = require("./Picker");
var _DatePicker = require("./DatePicker.styles");

var INPUT_PASS_PROPS = {
  autoFocus: true,
  disabled: true,
  warning: true,
  error: true,
  size: true,
  onKeyDown: true };var












































DatePicker = /*#__PURE__*/function (_React$Component) {(0, _inheritsLoose2.default)(DatePicker, _React$Component);function DatePicker() {var _this;for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {args[_key] = arguments[_key];}_this = _React$Component.call.apply(_React$Component, [this].concat(args)) || this;_this.




















































































    state = { opened: false };_this.

    input = null;_this.
    focused = false;_this.
    internalDate = _this.parseValueToDate(_this.props.value);_this.
    minDate = _this.parseValueToDate(_this.props.minDate);_this.
    maxDate = _this.parseValueToDate(_this.props.maxDate);_this.





























































































    getInputRef = function (ref) {
      _this.input = ref;
    };_this.












    handleFocus = function () {
      if (_this.focused) {
        return;
      }

      _this.focused = true;

      _this.setState({ opened: true });

      if (_this.props.onFocus) {
        _this.props.onFocus();
      }
    };_this.

    handleBlur = function () {
      if (!_this.focused) {
        return;
      }

      _this.focused = false;
      _this.close();

      if (_this.props.onBlur) {
        _this.props.onBlur();
      }
    };_this.

    handlePick = function (dateShape) {
      _this.handleSelect(dateShape);
      _this.blur();
    };_this.

    handleSelect = function (_ref) {var date = _ref.date,month = _ref.month,year = _ref.year;
      var value = _InternalDateTransformer.InternalDateTransformer.dateToInternalString({ date: date, month: month + 1, year: year });
      if (_this.props.onValueChange) {
        _this.props.onValueChange(value);
      }
    };_this.

    isHoliday = function (_ref2) {var date = _ref2.date,month = _ref2.month,year = _ref2.year,isWeekend = _ref2.isWeekend;
      var dateString = _InternalDateTransformer.InternalDateTransformer.dateToInternalString({ date: date, month: month + 1, year: year });
      return _this.props.isHoliday(dateString, isWeekend);
    };return _this;}var _proto = DatePicker.prototype;_proto.componentDidMount = function componentDidMount() {if (this.props.autoFocus) {this.focus();}};_proto.UNSAFE_componentWillReceiveProps = function UNSAFE_componentWillReceiveProps(nextProps) {var disabled = nextProps.disabled;var opened = this.state.opened;if (disabled && opened) {this.close();}this.internalDate = this.parseValueToDate(nextProps.value);this.minDate = this.parseValueToDate(nextProps.minDate);this.maxDate = this.parseValueToDate(nextProps.maxDate);} /**
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                * @public
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                */;_proto.blur = function blur() {if (this.input) {this.input.blur();}this.handleBlur();} /**
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           * @public
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           */;_proto.focus = function focus() {if (this.props.disabled) {return;}if (this.input) {this.input.focus();}this.handleFocus();} /**
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            * Закрывает выпадашку выбора дня
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            * @public
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            */;_proto.close = function close() {this.setState({ opened: false });};_proto.render = function render() {var _this2 = this;var picker = null;var date = this.internalDate ? this.internalDate.toNativeFormat() : null;if (this.state.opened) {picker = _react.default.createElement(_DropdownContainer.DropdownContainer, { getParent: function getParent() {return (0, _reactDom.findDOMNode)(_this2);}, offsetY: 2, align: this.props.menuAlign }, _react.default.createElement(_Picker.Picker, { value: date, minDate: this.minDate && this.minDate.toNativeFormat() || undefined, maxDate: this.maxDate && this.maxDate.toNativeFormat() || undefined, onPick: this.handlePick, onSelect: this.handleSelect, enableTodayLink: this.props.enableTodayLink, isHoliday: this.isHoliday }));}return _react.default.createElement("label", { className: _DatePicker.jsStyles.root(), style: { width: this.props.width }, onMouseEnter: this.props.onMouseEnter, onMouseLeave: this.props.onMouseLeave, onMouseOver: this.props.onMouseOver }, _react.default.createElement(_DateInput.DateInput, (0, _extends2.default)({}, (0, _filterProps.filterProps)(this.props, INPUT_PASS_PROPS), { ref: this.getInputRef, value: this.props.value || '', width: "100%", withIcon: true, minDate: this.props.minDate, maxDate: this.props.maxDate, onBlur: this.handleBlur, onFocus: this.handleFocus, onValueChange: this.props.onValueChange })), picker);};_proto.parseValueToDate = function parseValueToDate(value) {if (value === undefined || value === null) {return undefined;}var date = new _InternalDate.InternalDate({ value: value });if (date.validate({ checks: [_types.InternalDateValidateCheck.NotNull, _types.InternalDateValidateCheck.Native] })) {return date;}return undefined;};return DatePicker;}(_react.default.Component);exports.DatePicker = DatePicker;DatePicker.__KONTUR_REACT_UI__ = 'DatePicker';DatePicker.propTypes = { autoFocus: _propTypes.default.bool, disabled: _propTypes.default.bool, /**
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         * Включает кнопку сегодня в календаре
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         */enableTodayLink: _propTypes.default.bool, error: _propTypes.default.bool, /**
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * Максимальная дата в календаре.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      */maxDate: _propTypes.default.string.isRequired, menuAlign: _propTypes.default.oneOf(['left', 'right']), /**
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                * Минимальная дата в календаре.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                */minDate: _propTypes.default.string.isRequired, /**
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  * Строка формата `dd.mm.yyyy`
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  */value: _propTypes.default.string, warning: _propTypes.default.bool, width: _propTypes.default.oneOfType([_propTypes.default.number, _propTypes.default.string]).isRequired, onBlur: _propTypes.default.func, onValueChange: _propTypes.default.func.isRequired, onFocus: _propTypes.default.func, onKeyDown: _propTypes.default.func, onMouseEnter: _propTypes.default.func, onMouseLeave: _propTypes.default.func, onMouseOver: _propTypes.default.func, isHoliday: _propTypes.default.func.isRequired };DatePicker.defaultProps = { width: 120, minDate: _constants.MIN_FULLDATE, maxDate: _constants.MAX_FULLDATE, isHoliday: function isHoliday(_day, isWeekend) {return isWeekend;} };DatePicker.validate = function (value, range) {if (range === void 0) {range = {};}if (!value) {return false;}var _range = range,_range$minDate = _range.minDate,minDate = _range$minDate === void 0 ? _constants.MIN_FULLDATE : _range$minDate,_range$maxDate = _range.maxDate,maxDate = _range$maxDate === void 0 ? _constants.MAX_FULLDATE : _range$maxDate;var internalDate = new _InternalDate.InternalDate({ order: _types.InternalDateOrder.DMY, separator: _types.InternalDateSeparator.Dot }).setRangeStart(new _InternalDate.InternalDate({ value: minDate })).setRangeEnd(new _InternalDate.InternalDate({ value: maxDate })).parseValue(value);return internalDate.validate({ checks: [_types.InternalDateValidateCheck.NotNull, _types.InternalDateValidateCheck.Number, _types.InternalDateValidateCheck.Native, _types.InternalDateValidateCheck.Limits, _types.InternalDateValidateCheck.Range] });};