{"version":3,"sources":["Picker.tsx"],"names":["getTodayCalendarDate","d","Date","date","getDate","month","getMonth","year","getFullYear","Picker","DatePickerLocaleHelper","props","theme","calendar","locale","scrollToMonth","handleSelectToday","today","onSelect","toNativeFormat","state","getInitialDate","value","minDate","maxDate","componentDidUpdate","prevProps","render","renderMain","jsStyles","root","e","preventDefault","c","onPick","isHoliday","enableTodayLink","renderTodayLink","order","separator","InternalDate","setComponents","InternalDateGetter","getTodayComponents","todayWrapper","toString","withPad","withSeparator","React","Component","__KONTUR_REACT_UI__"],"mappings":"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","sourcesContent":["import React from 'react';\r\nimport shallowEqual from 'shallowequal';\r\n\r\nimport { InternalDate } from '../../lib/date/InternalDate';\r\nimport { InternalDateGetter } from '../../lib/date/InternalDateGetter';\r\nimport { Calendar, CalendarDateShape, isGreater, isLess } from '../../internal/Calendar';\r\nimport { locale } from '../../lib/locale/decorators';\r\nimport { Nullable } from '../../typings/utility-types';\r\nimport { Theme } from '../../lib/theming/Theme';\r\nimport { ThemeContext } from '../../lib/theming/ThemeContext';\r\n\r\nimport { jsStyles } from './Picker.styles';\r\nimport { DatePickerLocale, DatePickerLocaleHelper } from './locale';\r\n\r\ninterface Props {\r\n  maxDate?: CalendarDateShape;\r\n  minDate?: CalendarDateShape;\r\n  value: Nullable<CalendarDateShape>;\r\n  onPick: (date: CalendarDateShape) => void;\r\n  onSelect?: (date: CalendarDateShape) => void;\r\n  enableTodayLink?: boolean;\r\n  isHoliday?: (day: CalendarDateShape & { isWeekend: boolean }) => boolean;\r\n}\r\n\r\ninterface State {\r\n  date: CalendarDateShape;\r\n  today: CalendarDateShape;\r\n}\r\n\r\nconst getTodayCalendarDate = () => {\r\n  const d = new Date();\r\n  return {\r\n    date: d.getDate(),\r\n    month: d.getMonth(),\r\n    year: d.getFullYear(),\r\n  };\r\n};\r\n\r\n@locale('DatePicker', DatePickerLocaleHelper)\r\nexport class Picker extends React.Component<Props, State> {\r\n  public static __KONTUR_REACT_UI__ = 'Picker';\r\n\r\n  private theme!: Theme;\r\n  private calendar: Calendar | null = null;\r\n  private readonly locale!: DatePickerLocale;\r\n\r\n  constructor(props: Props) {\r\n    super(props);\r\n    const today = getTodayCalendarDate();\r\n    this.state = {\r\n      date: this.getInitialDate(today),\r\n      today,\r\n    };\r\n  }\r\n\r\n  public componentDidUpdate(prevProps: Props) {\r\n    const { value } = this.props;\r\n    if (value && !shallowEqual(value, prevProps.value)) {\r\n      this.scrollToMonth(value.month, value.year);\r\n    }\r\n  }\r\n\r\n  public render() {\r\n    return (\r\n      <ThemeContext.Consumer>\r\n        {theme => {\r\n          this.theme = theme;\r\n          return this.renderMain();\r\n        }}\r\n      </ThemeContext.Consumer>\r\n    );\r\n  }\r\n\r\n  private renderMain() {\r\n    const { date } = this.state;\r\n    return (\r\n      <div className={jsStyles.root(this.theme)} onMouseDown={e => e.preventDefault()}>\r\n        <Calendar\r\n          ref={c => (this.calendar = c)}\r\n          value={this.props.value}\r\n          initialMonth={date.month}\r\n          initialYear={date.year}\r\n          onSelect={this.props.onPick}\r\n          minDate={this.props.minDate}\r\n          maxDate={this.props.maxDate}\r\n          isHoliday={this.props.isHoliday}\r\n        />\r\n        {this.props.enableTodayLink && this.renderTodayLink()}\r\n      </div>\r\n    );\r\n  }\r\n\r\n  private scrollToMonth = (month: number, year: number) => {\r\n    if (this.calendar) {\r\n      this.calendar.scrollToMonth(month, year);\r\n    }\r\n  };\r\n\r\n  private renderTodayLink() {\r\n    const { order, separator } = this.locale;\r\n    const today = new InternalDate({ order, separator }).setComponents(InternalDateGetter.getTodayComponents());\r\n    return (\r\n      <button\r\n        data-tid=\"Picker__todayWrapper\"\r\n        className={jsStyles.todayWrapper(this.theme)}\r\n        onClick={this.handleSelectToday(today)}\r\n        tabIndex={-1}\r\n      >\r\n        {`${this.locale.today} ${today.toString({ withPad: true, withSeparator: true })}`}\r\n      </button>\r\n    );\r\n  }\r\n\r\n  private handleSelectToday = (today: InternalDate) => () => {\r\n    if (this.props.onSelect) {\r\n      this.props.onSelect(today.toNativeFormat()!);\r\n    }\r\n    if (this.calendar) {\r\n      const { month, year } = this.state.today;\r\n      this.calendar.scrollToMonth(month, year);\r\n    }\r\n  };\r\n\r\n  private getInitialDate = (today: CalendarDateShape) => {\r\n    if (this.props.value) {\r\n      return this.props.value;\r\n    }\r\n\r\n    if (this.props.minDate && isLess(today, this.props.minDate)) {\r\n      return this.props.minDate;\r\n    }\r\n\r\n    if (this.props.maxDate && isGreater(today, this.props.maxDate)) {\r\n      return this.props.maxDate;\r\n    }\r\n\r\n    return today;\r\n  };\r\n}\r\n"]}