{"version":3,"sources":["SidePage.tsx"],"names":["TRANSITION_TIMEOUT","SidePage","state","theme","stackSubscription","layoutRef","footer","updateLayout","update","getWidth","getBoundingClientRect","width","handleStackChange","stack","sidePages","filter","x","currentSidePagePosition","indexOf","isSidePageOnStackTop","hasMargin","length","hasShadow","hasBackground","setState","stackPosition","handleClickOutside","e","props","ignoreBackgroundClick","MouseEvent","clientX","document","documentElement","clientWidth","requestClose","handleKeyDown","disableClose","onClose","footerRef","ref","componentDidMount","window","addEventListener","ModalStack","add","componentWillUnmount","removeEventListener","remove","render","renderMain","blockBackground","disableAnimations","renderShadow","getTransitionNames","enter","exit","renderContainer","fromLeft","jsStyles","root","leftSide","Boolean","LayoutEvents","emit","container","shadow","getSidebarStyle","_","layout","children","overlay","background","backgroundGray","sidePageStyle","marginLeft","marginRight","transition","transitionRight","transitionLeft","enterActive","transitionActive","transitionLeave","exitActive","transitionLeaveActive","appear","appearActive","React","Component","__KONTUR_REACT_UI__","Header","SidePageHeader","Body","SidePageBody","Footer","SidePageFooter","Container","SidePageContainer"],"mappings":"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","sourcesContent":["import React from 'react';\r\nimport { CSSTransition } from 'react-transition-group';\r\nimport cn from 'classnames';\r\n\r\nimport { isKeyEscape } from '../../lib/events/keyboard/identifiers';\r\nimport * as LayoutEvents from '../../lib/LayoutEvents';\r\nimport { stopPropagation } from '../../lib/events/stopPropagation';\r\nimport { HideBodyVerticalScroll } from '../../internal/HideBodyVerticalScroll';\r\nimport { ModalStack, ModalStackSubscription } from '../../lib/ModalStack';\r\nimport { RenderContainer } from '../../internal/RenderContainer';\r\nimport { RenderLayer } from '../../internal/RenderLayer';\r\nimport { ZIndex } from '../../internal/ZIndex';\r\nimport { ThemeContext } from '../../lib/theming/ThemeContext';\r\nimport { Theme } from '../../lib/theming/Theme';\r\n\r\nimport { SidePageBody } from './SidePageBody';\r\nimport { SidePageContainer } from './SidePageContainer';\r\nimport { SidePageContext } from './SidePageContext';\r\nimport { SidePageFooter } from './SidePageFooter';\r\nimport { SidePageHeader } from './SidePageHeader';\r\nimport { jsStyles } from './SidePage.styles';\r\n\r\nexport interface SidePageProps {\r\n  /**\r\n   * Добавить блокирующий фон, когда сайдпейдж открыт\r\n   */\r\n  blockBackground?: boolean;\r\n\r\n  /**\r\n   * Отключает событие onClose, также дизейблит кнопку закрытия сайдпейджа\r\n   */\r\n  disableClose?: boolean;\r\n\r\n  /**\r\n   * Не закрывать сайдпейдж при клике на фон.\r\n   */\r\n  ignoreBackgroundClick?: boolean;\r\n\r\n  /**\r\n   * Задать ширину сайдпейджа\r\n   */\r\n  width?: number | string;\r\n\r\n  /**\r\n   * Вызывается, когда пользователь запросил закрытие сайдпейджа (нажал на фон, на\r\n   * Escape или на крестик).\r\n   */\r\n  onClose?: () => void;\r\n\r\n  /**\r\n   * Показывать сайдпэйдж слева\r\n   *\r\n   */\r\n  fromLeft?: boolean;\r\n\r\n  /**\r\n   * Отключить анимации\r\n   *\r\n   */\r\n  disableAnimations?: boolean;\r\n}\r\n\r\nexport interface SidePageState {\r\n  stackPosition?: number;\r\n  hasMargin?: boolean;\r\n  hasShadow?: boolean;\r\n  hasBackground?: boolean;\r\n}\r\n\r\nconst TRANSITION_TIMEOUT = 200;\r\n\r\n/**\r\n * Сайдпейдж\r\n *\r\n * Содержит в себе три компоненты: **SidePage.Header**,\r\n * **SidePage.Body** и **SidePage.Footer**\r\n *\r\n * Для отображения серой плашки в футере в компонент\r\n * **Footer** необходимо передать пропс **panel**\r\n */\r\nexport class SidePage extends React.Component<SidePageProps, SidePageState> {\r\n  public static __KONTUR_REACT_UI__ = 'SidePage';\r\n\r\n  public static Header = SidePageHeader;\r\n  public static Body = SidePageBody;\r\n  public static Footer = SidePageFooter;\r\n  public static Container = SidePageContainer;\r\n  public state: SidePageState = {};\r\n  private theme!: Theme;\r\n  private stackSubscription: ModalStackSubscription | null = null;\r\n  private layoutRef: HTMLElement | null = null;\r\n  private footer: SidePageFooter | null = null;\r\n\r\n  public componentDidMount() {\r\n    window.addEventListener('keydown', this.handleKeyDown);\r\n    this.stackSubscription = ModalStack.add(this, this.handleStackChange);\r\n  }\r\n\r\n  public componentWillUnmount() {\r\n    window.removeEventListener('keydown', this.handleKeyDown);\r\n    if (this.stackSubscription != null) {\r\n      this.stackSubscription.remove();\r\n    }\r\n    ModalStack.remove(this);\r\n  }\r\n\r\n  /**\r\n   * Обновляет разметку компонента.\r\n   * @public\r\n   */\r\n  public updateLayout = (): void => {\r\n    if (this.footer) {\r\n      this.footer.update();\r\n    }\r\n  };\r\n\r\n  public render(): JSX.Element {\r\n    return (\r\n      <ThemeContext.Consumer>\r\n        {theme => {\r\n          this.theme = theme;\r\n          return this.renderMain();\r\n        }}\r\n      </ThemeContext.Consumer>\r\n    );\r\n  }\r\n\r\n  private renderMain() {\r\n    const { blockBackground, disableAnimations } = this.props;\r\n\r\n    return (\r\n      <RenderContainer>\r\n        <div>\r\n          {blockBackground && this.renderShadow()}\r\n          <CSSTransition\r\n            in\r\n            classNames={this.getTransitionNames()}\r\n            appear={!disableAnimations}\r\n            enter={!disableAnimations}\r\n            exit={false}\r\n            timeout={{\r\n              enter: TRANSITION_TIMEOUT,\r\n              exit: TRANSITION_TIMEOUT,\r\n            }}\r\n          >\r\n            {this.renderContainer()}\r\n          </CSSTransition>\r\n        </div>\r\n      </RenderContainer>\r\n    );\r\n  }\r\n\r\n  private renderContainer(): JSX.Element {\r\n    const { width, blockBackground, fromLeft } = this.props;\r\n\r\n    return (\r\n      <ZIndex\r\n        priority={'Sidepage'}\r\n        data-tid=\"SidePage__root\"\r\n        className={cn({\r\n          [jsStyles.root()]: true,\r\n          [jsStyles.leftSide(this.theme)]: Boolean(fromLeft),\r\n        })}\r\n        onScroll={LayoutEvents.emit}\r\n        createStackingContext\r\n        style={{ width: width || (blockBackground ? 800 : 500) }}\r\n      >\r\n        <RenderLayer onClickOutside={this.handleClickOutside} active>\r\n          <div\r\n            data-tid=\"SidePage__container\"\r\n            className={cn(jsStyles.container(this.theme), this.state.hasShadow && jsStyles.shadow(this.theme))}\r\n            style={this.getSidebarStyle()}\r\n          >\r\n            <div ref={_ => (this.layoutRef = _)} className={jsStyles.layout()}>\r\n              <SidePageContext.Provider\r\n                value={{\r\n                  requestClose: this.requestClose,\r\n                  getWidth: this.getWidth,\r\n                  updateLayout: this.updateLayout,\r\n                  footerRef: this.footerRef,\r\n                }}\r\n              >\r\n                {this.props.children}\r\n              </SidePageContext.Provider>\r\n            </div>\r\n          </div>\r\n        </RenderLayer>\r\n      </ZIndex>\r\n    );\r\n  }\r\n\r\n  private getWidth = () => {\r\n    if (!this.layoutRef) {\r\n      return 'auto';\r\n    }\r\n    return this.layoutRef.getBoundingClientRect().width;\r\n  };\r\n\r\n  private renderShadow(): JSX.Element {\r\n    return (\r\n      <ZIndex priority={'Sidepage'} className={jsStyles.overlay()} onScroll={LayoutEvents.emit}>\r\n        <HideBodyVerticalScroll key=\"hbvs\" />\r\n        <div\r\n          key=\"overlay\"\r\n          className={cn({\r\n            [jsStyles.background()]: true,\r\n            [jsStyles.backgroundGray()]: this.state.hasBackground,\r\n          })}\r\n        />\r\n      </ZIndex>\r\n    );\r\n  }\r\n\r\n  private getSidebarStyle(): React.CSSProperties {\r\n    const sidePageStyle: React.CSSProperties = {};\r\n\r\n    if (this.state.hasMargin) {\r\n      if (this.props.fromLeft) {\r\n        sidePageStyle.marginLeft = 20;\r\n      } else {\r\n        sidePageStyle.marginRight = 20;\r\n      }\r\n    }\r\n\r\n    return sidePageStyle;\r\n  }\r\n\r\n  private getTransitionNames(): Record<string, string> {\r\n    const transition = this.props.fromLeft ? jsStyles.transitionRight : jsStyles.transitionLeft;\r\n\r\n    return {\r\n      enter: transition(),\r\n      enterActive: jsStyles.transitionActive(),\r\n      exit: jsStyles.transitionLeave(),\r\n      exitActive: jsStyles.transitionLeaveActive(),\r\n      appear: transition(),\r\n      appearActive: jsStyles.transitionActive(),\r\n    };\r\n  }\r\n\r\n  private handleStackChange = (stack: ReadonlyArray<React.Component>) => {\r\n    const sidePages = stack.filter(x => x instanceof SidePage);\r\n    const currentSidePagePosition = sidePages.indexOf(this);\r\n    const isSidePageOnStackTop = stack[0] instanceof SidePage;\r\n\r\n    const hasMargin = sidePages.length > 1 && currentSidePagePosition === sidePages.length - 1;\r\n    const hasShadow = sidePages.length < 3 || currentSidePagePosition > sidePages.length - 3;\r\n    const hasBackground = currentSidePagePosition === sidePages.length - 1 && isSidePageOnStackTop;\r\n\r\n    this.setState({\r\n      stackPosition: stack.indexOf(this),\r\n      hasMargin,\r\n      hasShadow,\r\n      hasBackground,\r\n    });\r\n  };\r\n\r\n  private handleClickOutside = (e: Event) => {\r\n    if (this.state.stackPosition === 0 && !this.props.ignoreBackgroundClick) {\r\n      // ignore mousedown on window scrollbar\r\n      if (e instanceof MouseEvent && e.clientX > document.documentElement.clientWidth) {\r\n        return;\r\n      }\r\n      this.requestClose();\r\n    }\r\n  };\r\n\r\n  private handleKeyDown = (e: KeyboardEvent) => {\r\n    if (this.state.stackPosition !== 0) {\r\n      return;\r\n    }\r\n    if (isKeyEscape(e)) {\r\n      stopPropagation(e);\r\n      this.requestClose();\r\n    }\r\n  };\r\n\r\n  private requestClose = () => {\r\n    if (this.props.disableClose) {\r\n      return;\r\n    }\r\n    if (this.props.onClose) {\r\n      this.props.onClose();\r\n    }\r\n  };\r\n\r\n  private footerRef = (ref: SidePageFooter | null) => {\r\n    this.footer = ref;\r\n  };\r\n}\r\n"]}