{"version":3,"sources":["MouseDrag.ts"],"names":["MouseDragEventType","items","Map","documentHandleMouseUp","e","forEach","mouseDrag","handleMouseUp","document","documentElement","addEventListener","MouseDrag","elem","mouseDragStartEvent","clicked","dragging","x1","y1","stop","removeEventListener","handleMouseDown","handleMouseMove","handleMouseLeave","delete","onMouseDragStart","handler","on","Start","onMouseDragMove","Move","onMouseDragLeave","Leave","onMouseDragEnd","End","dispatchEvent","createEvent","type","pageX","pageY","getLength","RADIUS","x2","y2","undefined","Math","sqrt","MouseEvent","eIE11","initEvent","mouseDragEvent","set","listen","has","get"],"mappings":"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","sourcesContent":["enum MouseDragEventType {\r\n  Start = 'mousedragstart',\r\n  Move = 'mousedragmove',\r\n  End = 'mousedragend',\r\n  Leave = 'mousedragleave',\r\n}\r\n\r\ntype MouseDragEvent = MouseEvent\r\n\r\ntype HandlerNative<E = MouseEvent> = (e: E) => void;\r\ntype Handler = (e: MouseDragEvent) => void;\r\ntype On = (handler: Handler) => MouseDrag;\r\nexport type MouseDragEventHandler = (e: MouseDragEvent) => void;\r\n\r\nconst items: Map<HTMLElement, MouseDrag> = new Map();\r\n\r\nconst documentHandleMouseUp: HandlerNative = e => items.forEach(mouseDrag => mouseDrag.handleMouseUp(e));\r\n\r\ndocument.documentElement.addEventListener('mouseup', documentHandleMouseUp);\r\n\r\n/**\r\n * ## Класс для отслеживания эффекта перетаскивания мышкой\r\n *\r\n * _Публичный метод `handleMouseUp` нельзя использовать!_\r\n *\r\n * ### Начало прослушивания и добавление обработчиков:\r\n * ```\r\n *   MouseDrag.listen(HTMLElement_1)\r\n *     .onMouseDragStart(start)\r\n *     .onMouseDragMove(move)\r\n *     .onMouseDragLeave(leave)\r\n *     .onMouseDragEnd(end);\r\n *\r\n * - - ИЛИ - -\r\n *\r\n *  const mouseDrag_1 = MouseDrag.listen(HTMLElement)...\r\n * ```\r\n *\r\n * ### Остановка прослушивания:\r\n * ```\r\n *   MouseDrag.stop(HTMLElement_1)\r\n *\r\n * - - ИЛИ - -\r\n *\r\n *   mouseDrag_1.stop();\r\n * ```\r\n */\r\nexport class MouseDrag {\r\n  // Радиус окружности, который необходимо преодолеть мышью, чтобы вызвалось событие `MouseDragStart`\r\n  public static readonly RADIUS: number = 5; // px\r\n\r\n  public static listen = (elem: HTMLElement): MouseDrag => {\r\n    if (items.has(elem)) {\r\n      const mouseDrag = items.get(elem);\r\n      if (mouseDrag) {\r\n        return mouseDrag;\r\n      }\r\n    }\r\n    return new MouseDrag(elem);\r\n  };\r\n\r\n  public static stop = (elem: HTMLElement | null): void => {\r\n    if (elem && items.has(elem)) {\r\n      const mouseDrag = items.get(elem);\r\n      if (mouseDrag) {\r\n        mouseDrag.stop();\r\n      }\r\n    }\r\n  };\r\n\r\n  private mouseDragStartEvent?: MouseDragEvent;\r\n  private clicked = false;\r\n  private dragging = false;\r\n\r\n  private x1?: number;\r\n  private y1?: number;\r\n\r\n  private elem: HTMLElement | null;\r\n\r\n  public constructor(elem: HTMLElement) {\r\n    this.elem = elem;\r\n    this.elem.addEventListener('mousedown', this.handleMouseDown);\r\n    this.elem.addEventListener('mousemove', this.handleMouseMove);\r\n    this.elem.addEventListener('mouseleave', this.handleMouseLeave);\r\n    items.set(this.elem, this);\r\n  }\r\n\r\n  public stop = (): void => {\r\n    if (this.elem !== null) {\r\n      this.elem.removeEventListener('mousedown', this.handleMouseDown);\r\n      this.elem.removeEventListener('mousemove', this.handleMouseMove);\r\n      this.elem.removeEventListener('mouseleave', this.handleMouseLeave);\r\n      items.delete(this.elem);\r\n    }\r\n    this.elem = null;\r\n  };\r\n\r\n  public onMouseDragStart: On = handler => this.on(MouseDragEventType.Start, handler);\r\n  public onMouseDragMove: On = handler => this.on(MouseDragEventType.Move, handler);\r\n  public onMouseDragLeave: On = handler => this.on(MouseDragEventType.Leave, handler);\r\n  public onMouseDragEnd: On = handler => this.on(MouseDragEventType.End, handler);\r\n\r\n  public handleMouseUp: HandlerNative = e => {\r\n    this.clicked = false;\r\n    if (this.dragging) {\r\n      this.dragging = false;\r\n      this.dispatchEvent(this.createEvent(MouseDragEventType.End, e));\r\n    }\r\n  };\r\n\r\n  private on = (type: MouseDragEventType, handler: Handler): MouseDrag => {\r\n    if (this.elem !== null) {\r\n      this.elem.removeEventListener(type, handler as HandlerNative<Event>);\r\n      this.elem.addEventListener(type, handler as HandlerNative<Event>);\r\n    }\r\n    return this;\r\n  };\r\n\r\n  private handleMouseDown: HandlerNative = e => {\r\n    if (!this.clicked) {\r\n      this.clicked = true;\r\n      this.x1 = e.pageX;\r\n      this.y1 = e.pageY;\r\n      this.mouseDragStartEvent = this.createEvent(MouseDragEventType.Start, e);\r\n    }\r\n  };\r\n\r\n  private handleMouseMove: HandlerNative = e => {\r\n    if (this.dragging) {\r\n      return this.dispatchEvent(this.createEvent(MouseDragEventType.Move, e));\r\n    }\r\n    if (this.clicked && this.getLength(e.pageX, e.pageY) > MouseDrag.RADIUS) {\r\n      this.dragging = true;\r\n      this.clicked = false;\r\n      if (this.mouseDragStartEvent) {\r\n        this.dispatchEvent(this.mouseDragStartEvent);\r\n      }\r\n    }\r\n  };\r\n\r\n  private handleMouseLeave: HandlerNative = e => {\r\n    if (this.dragging) {\r\n      this.dispatchEvent(this.createEvent(MouseDragEventType.Leave, e));\r\n    }\r\n  };\r\n\r\n  private getLength = (x2: number, y2: number): number => {\r\n    return this.x1 !== undefined && this.y1 !== undefined ? Math.sqrt((x2 - this.x1) ** 2 + (y2 - this.y1) ** 2) : 0;\r\n  };\r\n\r\n  private createEvent = (type: MouseDragEventType, e: MouseEvent): MouseDragEvent => {\r\n    if (typeof MouseEvent === 'function') {\r\n      return new MouseEvent(type, e);\r\n    }\r\n    // <=IE11\r\n    const eIE11 = document.createEvent('MouseEvent');\r\n    eIE11.initEvent(type, true, true);\r\n    return eIE11;\r\n  };\r\n\r\n  private dispatchEvent = (mouseDragEvent: MouseDragEvent): void => {\r\n    if (this.elem !== null) {\r\n      this.elem.dispatchEvent(mouseDragEvent);\r\n    }\r\n  };\r\n}\r\n"]}