{"version":3,"sources":["Popup.tsx"],"names":["POPUP_BORDER_DEFAULT_COLOR","TRANSITION_TIMEOUT","enter","exit","DUMMY_LOCATION","position","coordinates","top","left","PopupPositions","Popup","state","location","props","opened","theme","layoutEventsToken","locationUpdateId","lastPopupElement","anchorElement","anchorInstance","refAnchorElement","instance","element","extractElement","updateAnchorElement","handleMouseEnter","event","onMouseEnter","handleMouseLeave","onMouseLeave","handleClick","onClick","handleFocus","onFocus","handleBlur","onBlur","resetLocation","cancelDelayedUpdateLocation","setState","refPopupElement","zIndex","handleLayoutEvent","updateLocation","popupElement","getLocation","locationEquals","componentDidMount","LayoutEvents","addListener","UNSAFE_componentWillReceiveProps","nextProps","delayUpdateLocation","componentDidUpdate","prevProps","prevState","hadNoLocation","hasLocation","onOpen","componentWillUnmount","removeEventListeners","remove","render","renderMain","useWrapper","child","HTMLElement","React","isValidElement","undefined","renderContent","addEventListeners","addEventListener","removeEventListener","backgroundColor","disableAnimations","maxWidth","hasShadow","ignoreHover","children","renderChildren","PopupHelper","getPositionObject","direction","rootStyle","Boolean","jsStyles","popup","shadow","shadowFallback","isIE11","isEdge","popupIgnoreHover","transitionEnter","transitionEnterActive","transitionExit","content","contentInner","renderPin","isDefaultBorderColor","popupBorderColor","pinBorder","pinSize","pinOffset","borderColor","hasPin","popupBackground","raf","cancel","x","y","positions","anchorRect","getElementAbsoluteRect","popupRect","getCoordinates","isFullyVisible","canBecomeVisible","canBecomeFullyVisible","getPinnedPopupOffset","test","align","anchorSize","width","height","Math","max","positionName","margin","popupOffset","getHorizontalPosition","getVerticalPosition","Error","Component","__KONTUR_REACT_UI__","propTypes","PropTypes","oneOfType","node","isRequired","string","func","bool","number","array","defaultProps","process","env","enableReactTesting"],"mappings":"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","sourcesContent":["import React from 'react';\r\nimport { findDOMNode } from 'react-dom';\r\nimport PropTypes from 'prop-types';\r\nimport { Transition } from 'react-transition-group';\r\nimport raf from 'raf';\r\nimport warning from 'warning';\r\nimport cn from 'classnames';\r\n\r\nimport { Nullable } from '../../typings/utility-types';\r\nimport * as LayoutEvents from '../../lib/LayoutEvents';\r\nimport { ZIndex } from '../ZIndex';\r\nimport { RenderContainer } from '../RenderContainer';\r\nimport { FocusEventType, MouseEventType } from '../../typings/event-types';\r\nimport { isFunction, isIE11, isEdge } from '../../lib/utils';\r\nimport { ThemeContext } from '../../lib/theming/ThemeContext';\r\nimport { Theme } from '../../lib/theming/Theme';\r\nimport { safePropTypesInstanceOf } from \"../../lib/SSRSafe\";\r\n\r\nimport { PopupPin } from './PopupPin';\r\nimport { Offset, PopupHelper, PositionObject, Rect } from './PopupHelper';\r\nimport { jsStyles } from './Popup.styles';\r\n\r\nconst POPUP_BORDER_DEFAULT_COLOR = 'transparent';\r\nconst TRANSITION_TIMEOUT = { enter: 0, exit: 200 };\r\n\r\nconst DUMMY_LOCATION: PopupLocation = {\r\n  position: 'top left',\r\n  coordinates: {\r\n    top: -9999,\r\n    left: -9999,\r\n  },\r\n};\r\n\r\nexport type PopupPosition =\r\n  | 'top left'\r\n  | 'top center'\r\n  | 'top right'\r\n  | 'right top'\r\n  | 'right middle'\r\n  | 'right bottom'\r\n  | 'bottom left'\r\n  | 'bottom center'\r\n  | 'bottom right'\r\n  | 'left top'\r\n  | 'left middle'\r\n  | 'left bottom';\r\n\r\nexport const PopupPositions: PopupPosition[] = [\r\n  'top left',\r\n  'top center',\r\n  'top right',\r\n  'right top',\r\n  'right middle',\r\n  'right bottom',\r\n  'bottom right',\r\n  'bottom center',\r\n  'bottom left',\r\n  'left bottom',\r\n  'left middle',\r\n  'left top',\r\n];\r\n\r\nexport interface PopupHandlerProps {\r\n  onMouseEnter?: (event: MouseEventType) => void;\r\n  onMouseLeave?: (event: MouseEventType) => void;\r\n  onClick?: (event: MouseEventType) => void;\r\n  onFocus?: (event: FocusEventType) => void;\r\n  onBlur?: (event: FocusEventType) => void;\r\n  onOpen?: () => void;\r\n}\r\n\r\nexport interface PopupProps extends PopupHandlerProps {\r\n  anchorElement: React.ReactNode | HTMLElement;\r\n  backgroundColor?: React.CSSProperties['backgroundColor'];\r\n  borderColor?: React.CSSProperties['borderColor'];\r\n  children: React.ReactNode | (() => React.ReactNode);\r\n  hasPin: boolean;\r\n  hasShadow: boolean;\r\n  disableAnimations: boolean;\r\n  margin: number;\r\n  maxWidth?: number | string;\r\n  opened: boolean;\r\n  pinOffset: number;\r\n  pinSize: number;\r\n  popupOffset: number;\r\n  positions: PopupPosition[];\r\n  useWrapper: boolean;\r\n  ignoreHover: boolean;\r\n}\r\n\r\ninterface PopupLocation {\r\n  coordinates: {\r\n    left: number;\r\n    top: number;\r\n  };\r\n  position: PopupPosition;\r\n}\r\n\r\nexport interface PopupState {\r\n  location: Nullable<PopupLocation>;\r\n}\r\n\r\nexport class Popup extends React.Component<PopupProps, PopupState> {\r\n  public static __KONTUR_REACT_UI__ = 'Popup';\r\n\r\n  public static propTypes = {\r\n    /**\r\n     * Ссылка (ref) на элемент или React компонент, для которого рисуется попап\r\n     */\r\n    anchorElement: PropTypes.oneOfType([safePropTypesInstanceOf(() => HTMLElement), PropTypes.node]).isRequired,\r\n\r\n    /**\r\n     * Фон попапа и пина\r\n     */\r\n    backgroundColor: PropTypes.string,\r\n\r\n    children: PropTypes.oneOfType([PropTypes.node, PropTypes.func]),\r\n\r\n    /**\r\n     * Показывать ли пин\r\n     */\r\n    hasPin: PropTypes.bool,\r\n\r\n    /**\r\n     * Применять ли box-shadow на попапе. При false отключает границу на пине\r\n     */\r\n    hasShadow: PropTypes.bool,\r\n\r\n    /**\r\n     * Отступ попапа от элемента\r\n     */\r\n    margin: PropTypes.number,\r\n\r\n    /**\r\n     * Показан или скрыт попап\r\n     */\r\n    opened: PropTypes.bool,\r\n\r\n    /**\r\n     * Смещение пина от края попапа. Край задаётся в пропе position вторым словом\r\n     */\r\n    pinOffset: PropTypes.number,\r\n\r\n    /**\r\n     * Сторона пина без учёта границы.\r\n     * Пин представляет собой равносторонний треугольник, высота от попапа\r\n     * до \"носика\" пина будет соответствовать формуле (size* √3)/2\r\n     */\r\n    pinSize: PropTypes.number,\r\n\r\n    /**\r\n     * смещение попапа относительно родительского элемента\r\n     */\r\n    popupOffset: PropTypes.number,\r\n\r\n    /**\r\n     * С какой стороны показывать попап и край попапа,\r\n     * на котором будет отображаться пин\r\n     */\r\n    positions: PropTypes.array,\r\n\r\n    /**\r\n     * Игнорировать ли события hover/click\r\n     */\r\n    ignoreHover: PropTypes.bool,\r\n  };\r\n\r\n  public static defaultProps = {\r\n    margin: 10,\r\n    popupOffset: 0,\r\n    pinSize: 8,\r\n    pinOffset: 16,\r\n    hasPin: false,\r\n    hasShadow: false,\r\n    disableAnimations: Boolean(process.env.enableReactTesting),\r\n    useWrapper: false,\r\n    ignoreHover: false,\r\n  };\r\n\r\n  public state: PopupState = { location: this.props.opened ? DUMMY_LOCATION : null };\r\n  private theme!: Theme;\r\n  private layoutEventsToken: Nullable<ReturnType<typeof LayoutEvents.addListener>>;\r\n  private locationUpdateId: Nullable<number> = null;\r\n  private lastPopupElement: Nullable<HTMLElement>;\r\n  private anchorElement: Nullable<HTMLElement> = null;\r\n  private anchorInstance: Nullable<React.ReactInstance>;\r\n\r\n  public componentDidMount() {\r\n    this.updateLocation();\r\n    this.layoutEventsToken = LayoutEvents.addListener(this.handleLayoutEvent);\r\n  }\r\n\r\n  public UNSAFE_componentWillReceiveProps(nextProps: Readonly<PopupProps>) {\r\n    /**\r\n     * Delaying updateLocation to ensure it happens after props update\r\n     */\r\n    if (nextProps.opened) {\r\n      if (!this.state.location) {\r\n        this.setState({ location: DUMMY_LOCATION });\r\n      }\r\n      this.delayUpdateLocation();\r\n    }\r\n  }\r\n\r\n  public componentDidUpdate(prevProps: PopupProps, prevState: PopupState) {\r\n    const hadNoLocation = prevState.location === DUMMY_LOCATION;\r\n    const hasLocation = this.state.location !== DUMMY_LOCATION;\r\n    if (hadNoLocation && hasLocation && this.props.onOpen) {\r\n      this.props.onOpen();\r\n    }\r\n  }\r\n\r\n  public componentWillUnmount() {\r\n    this.cancelDelayedUpdateLocation();\r\n    this.removeEventListeners(this.anchorElement);\r\n    if (this.layoutEventsToken) {\r\n      this.layoutEventsToken.remove();\r\n      this.layoutEventsToken = null;\r\n    }\r\n  }\r\n\r\n  public render() {\r\n    return (\r\n      <ThemeContext.Consumer>\r\n        {theme => {\r\n          this.theme = theme;\r\n          return this.renderMain();\r\n        }}\r\n      </ThemeContext.Consumer>\r\n    );\r\n  }\r\n\r\n  private renderMain() {\r\n    const { location } = this.state;\r\n    const { anchorElement, useWrapper } = this.props;\r\n\r\n    let child: Nullable<React.ReactNode> = null;\r\n    if (anchorElement instanceof HTMLElement) {\r\n      this.updateAnchorElement(anchorElement);\r\n    } else if (React.isValidElement(anchorElement)) {\r\n      child = useWrapper ? <span>{anchorElement}</span> : anchorElement;\r\n    } else {\r\n      child = <span>{anchorElement}</span>;\r\n    }\r\n\r\n    return (\r\n      <RenderContainer anchor={child} ref={child ? this.refAnchorElement : undefined}>\r\n        {location && this.renderContent(location)}\r\n      </RenderContainer>\r\n    );\r\n  }\r\n\r\n  private refAnchorElement = (instance: React.ReactInstance | null) => {\r\n    this.anchorInstance = instance;\r\n    const element = this.extractElement(instance);\r\n    this.updateAnchorElement(element);\r\n    this.anchorElement = element;\r\n  };\r\n\r\n  private extractElement(instance: React.ReactInstance | null) {\r\n    if (!instance) {\r\n      return null;\r\n    }\r\n    const element = findDOMNode(instance);\r\n    return element instanceof HTMLElement ? element : null;\r\n  }\r\n\r\n  private updateAnchorElement(element: HTMLElement | null) {\r\n    const anchorElement = this.anchorElement;\r\n\r\n    if (element !== anchorElement) {\r\n      this.removeEventListeners(anchorElement);\r\n      this.anchorElement = element;\r\n      this.addEventListeners(element);\r\n    }\r\n  }\r\n\r\n  private addEventListeners(element: Nullable<HTMLElement>) {\r\n    if (element && element instanceof HTMLElement) {\r\n      element.addEventListener('mouseenter', this.handleMouseEnter);\r\n      element.addEventListener('mouseleave', this.handleMouseLeave);\r\n      element.addEventListener('click', this.handleClick);\r\n      element.addEventListener('focusin', this.handleFocus as EventListener);\r\n      element.addEventListener('focusout', this.handleBlur as EventListener);\r\n    }\r\n  }\r\n\r\n  private removeEventListeners(element: Nullable<HTMLElement>) {\r\n    if (element && element instanceof HTMLElement) {\r\n      element.removeEventListener('mouseenter', this.handleMouseEnter);\r\n      element.removeEventListener('mouseleave', this.handleMouseLeave);\r\n      element.removeEventListener('click', this.handleClick);\r\n      element.removeEventListener('focusin', this.handleFocus as EventListener);\r\n      element.removeEventListener('focusout', this.handleBlur as EventListener);\r\n    }\r\n  }\r\n\r\n  private handleMouseEnter = (event: MouseEventType) => {\r\n    if (this.props.onMouseEnter) {\r\n      this.props.onMouseEnter(event);\r\n    }\r\n  };\r\n\r\n  private handleMouseLeave = (event: MouseEventType) => {\r\n    if (this.props.onMouseLeave) {\r\n      this.props.onMouseLeave(event);\r\n    }\r\n  };\r\n\r\n  private handleClick = (event: MouseEventType) => {\r\n    if (this.props.onClick) {\r\n      this.props.onClick(event);\r\n    }\r\n  };\r\n\r\n  private handleFocus = (event: FocusEventType) => {\r\n    if (this.props.onFocus) {\r\n      this.props.onFocus(event);\r\n    }\r\n  };\r\n\r\n  private handleBlur = (event: FocusEventType) => {\r\n    if (this.props.onBlur) {\r\n      this.props.onBlur(event);\r\n    }\r\n  };\r\n\r\n  private renderContent(location: PopupLocation) {\r\n    const { backgroundColor, disableAnimations, maxWidth, hasShadow, ignoreHover, opened } = this.props;\r\n    const children = this.renderChildren();\r\n\r\n    const { direction } = PopupHelper.getPositionObject(location.position);\r\n    const rootStyle: React.CSSProperties = { ...location.coordinates, maxWidth };\r\n\r\n    return (\r\n      <Transition\r\n        timeout={TRANSITION_TIMEOUT}\r\n        appear={!disableAnimations}\r\n        in={Boolean(opened && children)}\r\n        mountOnEnter\r\n        unmountOnExit\r\n        enter={!disableAnimations}\r\n        exit={!disableAnimations}\r\n        onExited={this.resetLocation}\r\n      >\r\n        {(state: string) => (\r\n          <ZIndex\r\n            ref={this.refPopupElement}\r\n            priority={'Popup'}\r\n            className={cn({\r\n              [jsStyles.popup(this.theme)]: true,\r\n              [jsStyles.shadow(this.theme)]: hasShadow,\r\n              [jsStyles.shadowFallback(this.theme)]: hasShadow && (isIE11 || isEdge),\r\n              [jsStyles.popupIgnoreHover()]: ignoreHover,\r\n              ...(disableAnimations\r\n                ? {}\r\n                : {\r\n                    [jsStyles[`transition-enter-${direction}` as keyof typeof jsStyles](this.theme)]: true,\r\n                    [jsStyles.transitionEnter()]: state === 'entering',\r\n                    [jsStyles.transitionEnterActive()]: state === 'entered',\r\n                    [jsStyles.transitionExit()]: state === 'exiting',\r\n                  }),\r\n            })}\r\n            style={rootStyle}\r\n            onMouseEnter={this.handleMouseEnter}\r\n            onMouseLeave={this.handleMouseLeave}\r\n          >\r\n            <div className={jsStyles.content(this.theme)} data-tid={'PopupContent'}>\r\n              <div\r\n                className={jsStyles.contentInner(this.theme)}\r\n                style={{ backgroundColor }}\r\n                data-tid={'PopupContentInner'}\r\n              >\r\n                {children}\r\n              </div>\r\n            </div>\r\n            {this.renderPin(location.position)}\r\n          </ZIndex>\r\n        )}\r\n      </Transition>\r\n    );\r\n  }\r\n\r\n  private resetLocation = () => {\r\n    this.cancelDelayedUpdateLocation();\r\n    this.setState({ location: null });\r\n  };\r\n\r\n  private renderChildren() {\r\n    return isFunction(this.props.children) ? this.props.children() : this.props.children;\r\n  }\r\n\r\n  private refPopupElement = (zIndex: ZIndex | null) => {\r\n    if (zIndex) {\r\n      this.lastPopupElement = zIndex && (findDOMNode(zIndex) as HTMLElement);\r\n    }\r\n  };\r\n\r\n  private renderPin(position: string): React.ReactNode {\r\n    /**\r\n     * Box-shadow does not appear under the pin. Borders are used instead.\r\n     * In non-ie browsers drop-shadow filter is used. It is applying\r\n     * shadow to the pin too.\r\n     */\r\n    const isDefaultBorderColor = this.theme.popupBorderColor === POPUP_BORDER_DEFAULT_COLOR;\r\n    const pinBorder = isIE11 && isDefaultBorderColor ? 'rgba(0, 0, 0, 0.09)' : this.theme.popupBorderColor;\r\n\r\n    const { pinSize, pinOffset, hasShadow, backgroundColor, borderColor } = this.props;\r\n\r\n    return (\r\n      this.props.hasPin && (\r\n        <PopupPin\r\n          popupElement={this.lastPopupElement}\r\n          popupPosition={position}\r\n          size={pinSize}\r\n          offset={pinOffset}\r\n          borderWidth={hasShadow ? 1 : 0}\r\n          backgroundColor={backgroundColor || this.theme.popupBackground}\r\n          borderColor={borderColor || pinBorder}\r\n        />\r\n      )\r\n    );\r\n  }\r\n\r\n  private handleLayoutEvent = () => {\r\n    if (!this.state.location) {\r\n      return;\r\n    }\r\n    if (this.anchorInstance) {\r\n      this.updateAnchorElement(this.extractElement(this.anchorInstance));\r\n    }\r\n    this.updateLocation();\r\n  };\r\n\r\n  private delayUpdateLocation() {\r\n    this.cancelDelayedUpdateLocation();\r\n    this.locationUpdateId = raf(this.updateLocation);\r\n  }\r\n\r\n  private cancelDelayedUpdateLocation() {\r\n    if (this.locationUpdateId) {\r\n      raf.cancel(this.locationUpdateId);\r\n      this.locationUpdateId = null;\r\n    }\r\n  }\r\n\r\n  private updateLocation = () => {\r\n    const popupElement = this.lastPopupElement;\r\n\r\n    if (!popupElement) {\r\n      return;\r\n    }\r\n\r\n    const location = this.getLocation(popupElement, this.state.location);\r\n    if (!this.locationEquals(this.state.location, location)) {\r\n      this.setState({ location });\r\n    }\r\n  };\r\n\r\n  private locationEquals(x: Nullable<PopupLocation>, y: Nullable<PopupLocation>) {\r\n    if (x === y) {\r\n      return true;\r\n    }\r\n\r\n    if (x == null || y == null) {\r\n      return false;\r\n    }\r\n\r\n    return (\r\n      x.coordinates.left === y.coordinates.left && x.coordinates.top === y.coordinates.top && x.position === y.position\r\n    );\r\n  }\r\n\r\n  private getLocation(popupElement: HTMLElement, location?: Nullable<PopupLocation>) {\r\n    const positions = this.props.positions;\r\n    const anchorElement = this.anchorElement;\r\n\r\n    warning(\r\n      anchorElement && anchorElement instanceof HTMLElement,\r\n      'Anchor element is not defined or not instance of HTMLElement',\r\n    );\r\n\r\n    if (!(anchorElement && anchorElement instanceof HTMLElement)) {\r\n      return location;\r\n    }\r\n\r\n    const anchorRect = PopupHelper.getElementAbsoluteRect(anchorElement);\r\n    const popupRect = PopupHelper.getElementAbsoluteRect(popupElement);\r\n\r\n    let position: PopupPosition;\r\n    let coordinates: Offset;\r\n\r\n    if (location && location !== DUMMY_LOCATION && location.position) {\r\n      position = location.position;\r\n      coordinates = this.getCoordinates(anchorRect, popupRect, position);\r\n\r\n      const isFullyVisible = PopupHelper.isFullyVisible(coordinates, popupRect);\r\n      const canBecomeVisible = !isFullyVisible && PopupHelper.canBecomeFullyVisible(position, coordinates);\r\n      if (isFullyVisible || canBecomeVisible) {\r\n        return { coordinates, position };\r\n      }\r\n    }\r\n\r\n    for (position of positions) {\r\n      coordinates = this.getCoordinates(anchorRect, popupRect, position);\r\n      if (PopupHelper.isFullyVisible(coordinates, popupRect)) {\r\n        return { coordinates, position };\r\n      }\r\n    }\r\n\r\n    position = positions[0];\r\n    coordinates = this.getCoordinates(anchorRect, popupRect, position);\r\n    return { coordinates, position };\r\n  }\r\n\r\n  private getPinnedPopupOffset(anchorRect: Rect, position: PositionObject) {\r\n    if (!this.props.hasPin || /center|middle/.test(position.align)) {\r\n      return 0;\r\n    }\r\n\r\n    const anchorSize = /top|bottom/.test(position.direction) ? anchorRect.width : anchorRect.height;\r\n\r\n    const { pinOffset, pinSize } = this.props;\r\n    return Math.max(0, pinOffset + pinSize - anchorSize / 2);\r\n  }\r\n\r\n  private getCoordinates(anchorRect: Rect, popupRect: Rect, positionName: string) {\r\n    const margin = this.props.margin;\r\n    const position = PopupHelper.getPositionObject(positionName);\r\n    const popupOffset = this.props.popupOffset + this.getPinnedPopupOffset(anchorRect, position);\r\n\r\n    switch (position.direction) {\r\n      case 'top':\r\n        return {\r\n          top: anchorRect.top - popupRect.height - margin,\r\n          left: this.getHorizontalPosition(anchorRect, popupRect, position.align, popupOffset),\r\n        };\r\n      case 'bottom':\r\n        return {\r\n          top: anchorRect.top + anchorRect.height + margin,\r\n          left: this.getHorizontalPosition(anchorRect, popupRect, position.align, popupOffset),\r\n        };\r\n      case 'left':\r\n        return {\r\n          top: this.getVerticalPosition(anchorRect, popupRect, position.align, popupOffset),\r\n          left: anchorRect.left - popupRect.width - margin,\r\n        };\r\n      case 'right':\r\n        return {\r\n          top: this.getVerticalPosition(anchorRect, popupRect, position.align, popupOffset),\r\n          left: anchorRect.left + anchorRect.width + margin,\r\n        };\r\n      default:\r\n        throw new Error(`Unexpected direction '${position.direction}'`);\r\n    }\r\n  }\r\n\r\n  private getHorizontalPosition(anchorRect: Rect, popupRect: Rect, align: string, popupOffset: number) {\r\n    switch (align) {\r\n      case 'left':\r\n        return anchorRect.left - popupOffset;\r\n      case 'center':\r\n        return anchorRect.left - (popupRect.width - anchorRect.width) / 2;\r\n      case 'right':\r\n        return anchorRect.left - (popupRect.width - anchorRect.width) + popupOffset;\r\n      default:\r\n        throw new Error(`Unexpected align '${align}'`);\r\n    }\r\n  }\r\n\r\n  private getVerticalPosition(anchorRect: Rect, popupRect: Rect, align: string, popupOffset: number) {\r\n    switch (align) {\r\n      case 'top':\r\n        return anchorRect.top - popupOffset;\r\n      case 'middle':\r\n        return anchorRect.top - (popupRect.height - anchorRect.height) / 2;\r\n      case 'bottom':\r\n        return anchorRect.top - (popupRect.height - anchorRect.height) + popupOffset;\r\n      default:\r\n        throw new Error(`Unexpected align '${align}'`);\r\n    }\r\n  }\r\n}\r\n"]}