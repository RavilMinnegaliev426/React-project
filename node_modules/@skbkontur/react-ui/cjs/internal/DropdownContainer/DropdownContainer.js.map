{"version":3,"sources":["DropdownContainer.tsx"],"names":["DropdownContainer","state","position","minWidth","isDocumentElementRoot","getProps","defaultProps","dom","layoutSub","ref","e","isElement","node","Element","target","props","getParent","targetRect","getBoundingClientRect","document","body","docEl","documentElement","Error","scrollX","window","pageXOffset","scrollLeft","scrollY","pageYOffset","scrollTop","left","right","align","docWidth","offsetWidth","offsetX","offsetY","bottom","top","distanceToBottom","clientHeight","dropdownHeight","getHeight","scrollHeight","setState","getMinWidth","disablePortal","convertToRelativePosition","child","children","item","height","width","targetHeight","componentDidMount","LayoutEvents","addListener","UNSAFE_componentWillMount","htmlPosition","getComputedStyle","bodyPosition","hasLimitedHeightRoot","hasStaticRoot","componentWillUnmount","remove","render","style","undefined","content","React","Component","__KONTUR_REACT_UI__"],"mappings":"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","sourcesContent":["import React from 'react';\r\nimport { findDOMNode } from 'react-dom';\r\n\r\nimport * as LayoutEvents from '../../lib/LayoutEvents';\r\nimport { RenderContainer } from '../RenderContainer';\r\nimport { ZIndex } from '../ZIndex';\r\nimport { createPropsGetter } from '../../lib/createPropsGetter';\r\nimport { Nullable } from '../../typings/utility-types';\r\n\r\ntype DOMNode = Element | Text | null;\r\n\r\nexport interface DropdownContainerPosition {\r\n  top: Nullable<number>;\r\n  bottom: Nullable<number>;\r\n  left: Nullable<number>;\r\n  right: Nullable<number>;\r\n}\r\n\r\nexport interface DropdownContainerProps {\r\n  align?: 'left' | 'right';\r\n  getParent: () => DOMNode;\r\n  children?: React.ReactNode;\r\n  disablePortal?: boolean;\r\n  offsetY?: number;\r\n  offsetX?: number;\r\n}\r\n\r\nexport interface DropdownContainerState {\r\n  position: Nullable<DropdownContainerPosition>;\r\n  minWidth: number;\r\n  isDocumentElementRoot?: boolean;\r\n}\r\n\r\nexport class DropdownContainer extends React.Component<DropdownContainerProps, DropdownContainerState> {\r\n  public static __KONTUR_REACT_UI__ = 'DropdownContainer';\r\n\r\n  public static defaultProps = {\r\n    align: 'left',\r\n    disablePortal: false,\r\n    offsetX: 0,\r\n    offsetY: -1,\r\n  };\r\n\r\n  public state: DropdownContainerState = {\r\n    position: null,\r\n    minWidth: 0,\r\n    isDocumentElementRoot: true,\r\n  };\r\n\r\n  private getProps = createPropsGetter(DropdownContainer.defaultProps);\r\n\r\n  private dom: DOMNode = null;\r\n  private layoutSub: Nullable<ReturnType<typeof LayoutEvents.addListener>>;\r\n\r\n  public componentDidMount() {\r\n    this.position();\r\n    this.layoutSub = LayoutEvents.addListener(this.position);\r\n  }\r\n\r\n  public UNSAFE_componentWillMount() {\r\n    const { body, documentElement: docEl } = document;\r\n    const htmlPosition = getComputedStyle(docEl).position;\r\n    const bodyPosition = getComputedStyle(body).position;\r\n\r\n    const hasLimitedHeightRoot = body.scrollHeight > body.clientHeight;\r\n    const hasStaticRoot = htmlPosition === 'static' && bodyPosition === 'static';\r\n\r\n    this.setState({ isDocumentElementRoot: hasLimitedHeightRoot || hasStaticRoot });\r\n  }\r\n\r\n  public componentWillUnmount() {\r\n    if (this.layoutSub) {\r\n      this.layoutSub.remove();\r\n    }\r\n  }\r\n\r\n  public render() {\r\n    let style: React.CSSProperties = {\r\n      position: 'absolute',\r\n      top: '0',\r\n    };\r\n    if (this.state.position) {\r\n      const { top, bottom, left, right } = this.state.position;\r\n      style = {\r\n        ...style,\r\n        top: top !== null ? top : undefined,\r\n        bottom: bottom !== null ? bottom : undefined,\r\n        left: left !== null ? left : undefined,\r\n        right: right !== null ? right : undefined,\r\n        minWidth: this.state.minWidth,\r\n      };\r\n    }\r\n\r\n    const content = (\r\n      <ZIndex priority={'DropdownContainer'} ref={this.ref} style={style}>\r\n        {this.props.children}\r\n      </ZIndex>\r\n    );\r\n\r\n    return this.props.disablePortal ? content : <RenderContainer>{content}</RenderContainer>;\r\n  }\r\n\r\n  private ref = (e: ZIndex | null) => {\r\n    this.dom = e && findDOMNode(e);\r\n  };\r\n\r\n  private isElement = (node: DOMNode): node is Element => {\r\n    return node instanceof Element;\r\n  };\r\n\r\n  private position = () => {\r\n    const target = this.props.getParent();\r\n    const dom = this.dom;\r\n\r\n    if (this.isElement(target) && dom) {\r\n      const targetRect = target.getBoundingClientRect();\r\n      const { body, documentElement: docEl } = document;\r\n\r\n      if (!docEl) {\r\n        throw Error('There is no \"documentElement\" in \"document\"');\r\n      }\r\n\r\n      const scrollX = window.pageXOffset || docEl.scrollLeft || 0;\r\n      const scrollY = window.pageYOffset || docEl.scrollTop || 0;\r\n\r\n      let left = null;\r\n      let right = null;\r\n\r\n      if (this.props.align === 'right') {\r\n        const docWidth = docEl.offsetWidth || 0;\r\n        right = docWidth - (targetRect.right + scrollX) + this.getProps().offsetX;\r\n      } else {\r\n        left = targetRect.left + scrollX + this.getProps().offsetX;\r\n      }\r\n\r\n      const { offsetY = 0 } = this.props;\r\n      let bottom = null;\r\n      let top: number | null = targetRect.bottom + scrollY + offsetY;\r\n\r\n      const distanceToBottom = docEl.clientHeight - targetRect.bottom;\r\n      const dropdownHeight = this.getHeight();\r\n\r\n      if (distanceToBottom < dropdownHeight && targetRect.top > dropdownHeight) {\r\n        const clientHeight = this.state.isDocumentElementRoot ? docEl.clientHeight : body.scrollHeight;\r\n\r\n        top = null;\r\n        bottom = clientHeight + offsetY - scrollY - targetRect.top;\r\n      }\r\n\r\n      const position = {\r\n        top,\r\n        left,\r\n        right,\r\n        bottom,\r\n      };\r\n\r\n      this.setState({\r\n        minWidth: this.getMinWidth(),\r\n        position: this.props.disablePortal ? this.convertToRelativePosition(position) : position,\r\n      });\r\n    }\r\n  };\r\n\r\n  private getHeight = () => {\r\n    if (!this.isElement(this.dom)) {\r\n      return 0;\r\n    }\r\n    const child = this.dom.children.item(0);\r\n    if (!child) {\r\n      return 0;\r\n    }\r\n    return child.getBoundingClientRect().height;\r\n  };\r\n\r\n  private getMinWidth = () => {\r\n    const target = this.props.getParent();\r\n    if (!this.isElement(target)) {\r\n      return 0;\r\n    }\r\n    return target.getBoundingClientRect().width;\r\n  };\r\n\r\n  private convertToRelativePosition = (position: DropdownContainerPosition): DropdownContainerPosition => {\r\n    const target = this.props.getParent();\r\n    const { offsetX = 0, offsetY = 0 } = this.props;\r\n    const { top, bottom, left, right } = position;\r\n    if (this.isElement(target)) {\r\n      const targetHeight = target.getBoundingClientRect().height;\r\n      return {\r\n        top: top !== null ? targetHeight + offsetY : null,\r\n        bottom: bottom !== null ? targetHeight + offsetY : null,\r\n        left: left !== null ? offsetX : null,\r\n        right: right !== null ? offsetX : null,\r\n      };\r\n    }\r\n    return {\r\n      top: offsetY,\r\n      bottom: null,\r\n      left: offsetX,\r\n      right: null,\r\n    };\r\n  };\r\n}\r\n"]}