{"version":3,"sources":["Calendar.tsx"],"names":["getTodayDate","date","Date","getDate","month","getMonth","year","getFullYear","wrapperStyle","height","config","WRAPPER_HEIGHT","Calendar","props","theme","wheelEndTimeout","root","animation","scrollToMonth","inProgress","finish","Promise","r","setTimeout","minDate","maxDate","currentMonth","state","months","diffInMonths","scrollTo","maxMonthsToAdd","MAX_MONTHS_TO_APPEND_ON_SCROLL","onEnd","setState","CalendarUtils","getMonths","scrollPosition","isYearChanges","Math","abs","monthsToPrependCount","min","monthsToPrepend","Array","from","length","_","index","MonthViewModel","create","yearChanges","isFirstInYear","isLastInYear","concat","getMonthsHeight","targetPosition","monthsToAppendCount","monthsToAppend","slice","renderMain","positions","getMonthPositions","refRoot","jsStyles","wrapper","map","x","i","filter","top","isMonthVisible","renderMonth","element","addEventListener","handleWheel","passive","removeEventListener","handleMonthYearChange","event","WheelEvent","preventDefault","pixelY","scrollTarget","calculateScrollPosition","handleWheelEnd","animate","deltaY","applyDelta","CalendarScrollEvents","emit","clearTimeout","window","scrollToNearestWeek","scrollDirection","trasholdHeight","MONTH_TITLE_OFFSET_HEIGHT","DAY_HEIGHT","amount","pos","scrollAmmount","scrollAmount","today","initialMonth","initialYear","componentWillUnmount","cancel","render","value","onSelect","isHoliday","position","push","React","Component","__KONTUR_REACT_UI__","defaultProps","holidays","MIN_YEAR","MIN_MONTH","MIN_DATE","MAX_YEAR","MAX_MONTH","MAX_DATE"],"mappings":"8mBAAA;AACA;;AAEA;;;AAGA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;AAoBA,IAAMA,YAAY,GAAG,SAAfA,YAAe,GAAM;AACzB,MAAMC,IAAI,GAAG,IAAIC,IAAJ,EAAb;AACA,SAAO;AACLD,IAAAA,IAAI,EAAEA,IAAI,CAACE,OAAL,EADD;AAELC,IAAAA,KAAK,EAAEH,IAAI,CAACI,QAAL,EAFF;AAGLC,IAAAA,IAAI,EAAEL,IAAI,CAACM,WAAL,EAHD,EAAP;;AAKD,CAPD;;AASA,IAAMC,YAAY,GAAG,EAAEC,MAAM,EAAEC,eAAOC,cAAjB,EAArB,C;;AAEaC,Q;;;;;;;;;;;;;;;;;;;;;;AAsBX,oBAAYC,KAAZ,EAAkC;AAChC,wCAAMA,KAAN,UADgC,MAL1BC,KAK0B,gBAJ1BC,eAI0B,gBAH1BC,IAG0B,gBAF1BC,SAE0B,GAFd,2BAEc;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAsC3BC,IAAAA,aAtC2B,gHAsCX,iBAAOd,KAAP,EAAsBE,IAAtB;AACjB,sBAAKW,SAAL,CAAeE,UAAf,EADiB;AAEnB,sBAAKF,SAAL,CAAeG,MAAf;AACA;AAHmB,yCAIb,IAAIC,OAAJ,CAAY,UAAAC,CAAC,UAAIC,UAAU,CAACD,CAAD,CAAd,EAAb,CAJa;;;AAOQ,sBAAKT,KAPb,EAObW,OAPa,eAObA,OAPa,EAOJC,OAPI,eAOJA,OAPI;;AASjBD,gBAAAA,OAAO,IAAI,kCAAUA,OAAV,EAAmB,+BAAO,EAAP,EAAWpB,KAAX,EAAkBE,IAAlB,CAAnB,CATM;AAUnB,sBAAKY,aAAL,CAAmBM,OAAO,CAACpB,KAA3B,EAAkCoB,OAAO,CAAClB,IAA1C,EAVmB;;;;AAcjBmB,gBAAAA,OAAO,IAAI,+BAAOA,OAAP,EAAgB,+BAAO,CAAP,EAAUrB,KAAV,EAAiBE,IAAjB,CAAhB,CAdM;AAenB,sBAAKY,aAAL,CAAmBO,OAAO,CAACrB,KAA3B,EAAkCqB,OAAO,CAACnB,IAA1C,EAfmB;;;;AAmBfoB,gBAAAA,YAnBe,GAmBA,MAAKC,KAAL,CAAWC,MAAX,CAAkB,CAAlB,CAnBA;AAoBfC,gBAAAA,YApBe,GAoBAH,YAAY,CAACtB,KAAb,GAAqBsB,YAAY,CAACpB,IAAb,GAAoB,EAAzC,GAA8CF,KAA9C,GAAsDE,IAAI,GAAG,EApB7D;;AAsBjBuB,gBAAAA,YAAY,KAAK,CAtBA;AAuBnB,sBAAKC,QAAL,CAAc,CAAd,EAvBmB;;;;AA2BfC,gBAAAA,cA3Be,GA2BErB,eAAOsB,8BA3BT;;AA6BfC,gBAAAA,KA7Be,GA6BP,SAARA,KAAQ;AACZ,0BAAKC,QAAL,CAAc;AACZN,sBAAAA,MAAM,EAAEO,aAAa,CAACC,SAAd,CAAwBhC,KAAxB,EAA+BE,IAA/B,CADI;AAEZ+B,sBAAAA,cAAc,EAAE,CAFJ,EAAd,CADY,GA7BO;;;AAmCfC,gBAAAA,aAnCe,GAmCC,SAAhBA,aAAgB,CAACX,KAAD;AACpBA,oBAAAA,KAAK,CAACC,MAAN,CAAa,CAAb,EAAgBtB,IAAhB,KAAyBA,IAAzB;AACA;AACA;AACA;AACAiC,oBAAAA,IAAI,CAACC,GAAL,CAASX,YAAT,IAAyB,CALL,GAnCD;;AA0CrB;AACA;AACA,oBAAIA,YAAY,GAAG,CAAnB,EAAsB;AACdY,kBAAAA,oBADc,GACSF,IAAI,CAACG,GAAL,CAASH,IAAI,CAACC,GAAL,CAASX,YAAT,IAAyB,CAAlC,EAAqCE,cAArC,CADT;AAEdY,kBAAAA,eAFc,GAEIC,KAAK,CAACC,IAAN,CAAW,EAAEC,MAAM,EAAEL,oBAAV,EAAX,EAA6C,UAACM,CAAD,EAAIC,KAAJ;AACnEC,qDAAeC,MAAf,CAAsB9C,KAAK,GAAG4C,KAA9B,EAAqC1C,IAArC,CADmE,GAA7C,CAFJ;;AAKpB,wBAAK4B,QAAL;AACE,4BAAAP,KAAK,EAAI;AACP,wBAAMwB,WAAW,GAAGb,aAAa,CAACX,KAAD,CAAjC;AACA,wBAAIwB,WAAJ,EAAiB;AACf;AACA;AACAxB,sBAAAA,KAAK,CAACC,MAAN,CAAa,CAAb,EAAgBwB,aAAhB,GAAgC,IAAhC;AACA,0BAAIT,eAAe,CAACG,MAApB,EAA4B;AAC1B;AACAH,wBAAAA,eAAe,CAACA,eAAe,CAACG,MAAhB,GAAyB,CAA1B,CAAf,CAA4CO,YAA5C,GAA2D,IAA3D;AACD;AACF;AACD,2BAAO;AACLzB,sBAAAA,MAAM,EAAEe,eAAe,CAACW,MAAhB,CAAuB3B,KAAK,CAACC,MAA7B,CADH;AAELS,sBAAAA,cAAc,EAAE,CAACF,aAAa,CAACoB,eAAd,CAA8BZ,eAA9B,CAFZ,EAAP;;AAID,mBAhBH;AAiBE,8BAAM;AACJ,wBAAMa,cAAc,GAAG,MAAK7B,KAAL,CAAWC,MAAX,CAAkB,CAAlB,EAAqBnB,MAA5C;AACA,0BAAKqB,QAAL,CAAc0B,cAAd,EAA8BvB,KAA9B;AACD,mBApBH;;AAsBD;;AAED;AACA;AACA,oBAAIJ,YAAY,GAAG,CAAnB,EAAsB;AACd4B,kBAAAA,mBADc,GACQlB,IAAI,CAACG,GAAL,CAASH,IAAI,CAACC,GAAL,CAASX,YAAT,CAAT,EAAiCE,cAAjC,CADR;AAEd2B,kBAAAA,cAFc,GAEGd,KAAK,CAACC,IAAN,CAAW,EAAEC,MAAM,EAAEW,mBAAV,EAAX,EAA4C,UAACV,CAAD,EAAIC,KAAJ;AACjEC,qDAAeC,MAAf,CAAsB9C,KAAK,GAAG4C,KAAR,GAAgBS,mBAAhB,GAAsC,CAA5D,EAA+DnD,IAA/D,CADiE,GAA5C,CAFH;;AAKpB,wBAAK4B,QAAL;AACE,4BAAAP,KAAK,EAAI;AACP,wBAAIW,aAAa,CAACX,KAAD,CAAjB,EAA0B;AACxB;AACA;AACAA,sBAAAA,KAAK,CAACC,MAAN,CAAaD,KAAK,CAACC,MAAN,CAAakB,MAAb,GAAsB,CAAnC,EAAsCO,YAAtC,GAAqD,IAArD;AACA;AACA,0BAAIK,cAAc,CAAC,CAAD,CAAlB,EAAuB;AACrBA,wBAAAA,cAAc,CAAC,CAAD,CAAd,CAAkBN,aAAlB,GAAkC,IAAlC;AACD;AACF;AACD,2BAAO,EAAExB,MAAM,EAAED,KAAK,CAACC,MAAN,CAAa0B,MAAb,CAAoBI,cAApB,CAAV,EAAP;AACD,mBAZH;AAaE,8BAAM;AACJ,wBAAMF,cAAc,GAAG,CAAC,CAAD,GAAKrB,aAAa,CAACoB,eAAd,CAA8B,MAAK5B,KAAL,CAAWC,MAAX,CAAkB+B,KAAlB,CAAwB,CAAxB,EAA2B,CAAC,CAA5B,CAA9B,CAA5B;AACA,0BAAK7B,QAAL,CAAc0B,cAAd,EAA8BvB,KAA9B;AACD,mBAhBH;;AAkBD,iBAlGoB,yDAtCW;;;AA2I1B2B,IAAAA,UA3I0B,GA2Ib,YAAM;AACzB,UAAMC,SAAS,GAAG,MAAKC,iBAAL,EAAlB;AACA;AACE,8CAAK,GAAG,EAAE,MAAKC,OAAf,EAAwB,SAAS,EAAEC,mBAAShD,IAAT,CAAc,MAAKF,KAAnB,CAAnC;AACE,8CAAK,KAAK,EAAEN,YAAZ,EAA0B,SAAS,EAAEwD,mBAASC,OAAT,EAArC;AACG,cAAKtC,KAAL,CAAWC,MAAX;AACEsC,QAAAA,GADF,CACgC,UAACC,CAAD,EAAIC,CAAJ,UAAU,CAACP,SAAS,CAACO,CAAD,CAAV,EAAeD,CAAf,CAAV,EADhC;AAEEE,QAAAA,MAFF,CAES,sBAAEC,GAAF,YAAOlE,KAAP,mBAAkB+B,aAAa,CAACoC,cAAd,CAA6BD,GAA7B,EAAkClE,KAAlC,CAAlB,EAFT;AAGE8D,QAAAA,GAHF,CAGM,MAAKM,WAHX,8CADH,CADF,CADF;;;;AAUD,KAvJiC;;AAyJ1BT,IAAAA,OAzJ0B,GAyJhB,UAACU,OAAD,EAAiC;AACjD,UAAI,CAAC,MAAKzD,IAAN,IAAcyD,OAAlB,EAA2B;AACzBA,QAAAA,OAAO,CAACC,gBAAR,CAAyB,OAAzB,EAAkC,MAAKC,WAAvC,EAAoD,EAAEC,OAAO,EAAE,KAAX,EAApD;AACD;AACD,UAAI,MAAK5D,IAAL,IAAa,CAACyD,OAAlB,EAA2B;AACzB,cAAKzD,IAAL,CAAU6D,mBAAV,CAA8B,OAA9B,EAAuC,MAAKF,WAA5C;AACD;AACD,YAAK3D,IAAL,GAAYyD,OAAZ;AACD,KAjKiC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA8L1BK,IAAAA,qBA9L0B,GA8LF,UAAC1E,KAAD,EAAgBE,IAAhB,EAAiC;AAC/D,YAAKY,aAAL,CAAmBd,KAAnB,EAA0BE,IAA1B;AACD,KAhMiC;;AAkM1BqE,IAAAA,WAlM0B,GAkMZ,UAACI,KAAD,EAAkB;AACtC,UAAI,EAAEA,KAAK,YAAYC,UAAnB,CAAJ,EAAoC;AAClC;AACD;AACDD,MAAAA,KAAK,CAACE,cAAN,GAJsC;AAKnB,oCAAeF,KAAf,CALmB,CAK9BG,MAL8B,mBAK9BA,MAL8B;;AAOtC,YAAKhD,QAAL,CAAc,iBAA8C,KAA3CN,MAA2C,SAA3CA,MAA2C,CAAnCS,cAAmC,SAAnCA,cAAmC,CAAnB8C,YAAmB,SAAnBA,YAAmB;AAC1D,YAAM3B,cAAc,GAAGrB,aAAa,CAACiD,uBAAd,CAAsCxD,MAAtC,EAA8CS,cAA9C,EAA8D6C,MAA9D,EAAsE7C,cAA7F;AACA,eAAO,EAAE8C,YAAY,EAAE3B,cAAhB,EAAP;AACD,OAHD,EAGG,MAAK6B,cAHR;;AAKA,YAAKpE,SAAL,CAAeqE,OAAf,CAAuBJ,MAAvB,EAA+B,UAAAK,MAAM;AACnC;AACA,gBAAKrD,QAAL,CAAcC,aAAa,CAACqD,UAAd,CAAyBD,MAAzB,CAAd,CAFmC,GAArC;;;AAKAE,MAAAA,oBAAoB,CAACC,IAArB;AACD,KApNiC;;AAsN1BL,IAAAA,cAtN0B,GAsNT,YAAM;AAC7B,UAAI,MAAKtE,eAAT,EAA0B;AACxB4E,QAAAA,YAAY,CAAC,MAAK5E,eAAN,CAAZ;AACD;AACD,YAAKA,eAAL,GAAuB6E,MAAM,CAACrE,UAAP,CAAkB,MAAKsE,mBAAvB,EAA4C,GAA5C,CAAvB;AACD,KA3NiC;;AA6N1BA,IAAAA,mBA7N0B,GA6NJ,YAAM;AACQ,YAAKlE,KADb,CAC1BwD,YAD0B,eAC1BA,YAD0B,CACZW,eADY,eACZA,eADY;;AAGlC,UAAMC,cAAc,GAAGrF,eAAOsF,yBAAP,GAAmCtF,eAAOuF,UAAjE;;AAEA,UAAId,YAAY,GAAGY,cAAnB,EAAmC;AACjC,YAAIvC,cAAc,GAAG,CAArB;AACA,YAAIsC,eAAe,GAAG,CAAtB,EAAyB;AACvBtC,UAAAA,cAAc,GAAGuC,cAAjB;AACD;;AAED,cAAK7D,QAAL,CAAc,EAAEiD,YAAY,EAAE3B,cAAhB,EAAd,EAAgD,YAAM;AACpD,cAAM0C,MAAM,GAAGf,YAAY,GAAG3B,cAA9B;AACA,gBAAKvC,SAAL,CAAeqE,OAAf,CAAuBY,MAAvB,EAA+B,UAAAX,MAAM;AACnC;AACA,oBAAKrD,QAAL,CAAcC,aAAa,CAACqD,UAAd,CAAyBD,MAAzB,CAAd,CAFmC,GAArC;;AAID,SAND;AAOD;AACF,KAhPiC;;AAkP1BzD,IAAAA,QAlP0B,GAkPf,UAACqE,GAAD,EAAclE,KAAd,EAAqC;AACtD,UAAMmE,aAAa,GAAGD,GAAG,GAAG,MAAKxE,KAAL,CAAWU,cAAvC;AACA,aAAO,MAAKgE,YAAL,CAAkBD,aAAlB,EAAiCnE,KAAjC,CAAP;AACD,KArPiC;;AAuP1BoE,IAAAA,YAvP0B,GAuPX,UAACD,aAAD,EAAwBnE,KAAxB,EAA+C;AACpE,aAAO,MAAKhB,SAAL,CAAeqE,OAAf;AACLc,MAAAA,aADK;AAEL,gBAAAb,MAAM;AACJ,gBAAKrD,QAAL,CAAc,sBAAGG,cAAH,SAAGA,cAAH,QAAyB;AACrCA,cAAAA,cAAc,EAAEA,cAAc,GAAGkD,MADI,EAAzB,EAAd,CADI,GAFD;;AAMLtD,MAAAA,KANK,CAAP;;AAQD,KAhQiC,CAGhC,IAAMqE,KAAK,GAAGtG,YAAY,EAA1B,CAEA,IAAMuG,YAAY,GAAG1F,KAAK,CAAC0F,YAAN,IAAsB,IAAtB,GAA6BD,KAAK,CAAClG,KAAnC,GAA2CS,KAAK,CAAC0F,YAAtE,CACA,IAAMC,WAAW,GAAG3F,KAAK,CAAC2F,WAAN,IAAqB,IAArB,GAA4BF,KAAK,CAAChG,IAAlC,GAAyCO,KAAK,CAAC2F,WAAnE,CAEA,MAAK7E,KAAL,GAAa,EACXU,cAAc,EAAE,CADL,EAEXT,MAAM,EAAEO,aAAa,CAACC,SAAd,CAAwBmE,YAAxB,EAAsCC,WAAtC,CAFG,EAGXF,KAAK,EAALA,KAHW,EAIXR,eAAe,EAAE,CAJN,EAKXX,YAAY,EAAE,CALH,EAAb,CARgC,aAejC,C,uCAEMsB,oB,GAAP,gCAA8B,CAC5B,IAAI,KAAKxF,SAAL,CAAeE,UAAf,EAAJ,EAAiC,CAC/B,KAAKF,SAAL,CAAeyF,MAAf,GACD,CACF,C,QAEMC,M,GAAP,kBAAgB,mBACd,OACE,6BAAC,0BAAD,CAAc,QAAd,QACG,UAAA7F,KAAK,EAAI,CACR,MAAI,CAACA,KAAL,GAAaA,KAAb,CACA,OAAO,MAAI,CAAC8C,UAAL,EAAP,CACD,CAJH,CADF,CAQD,C,CAED;;;ktBAiIQY,W,GAAR,4BAA4D,KAAvCF,GAAuC,YAAlClE,KAAkC,YAC1D,OACE,6BAAC,YAAD,IACE,GAAG,EAAEA,KAAK,CAACA,KAAN,GAAc,GAAd,GAAoBA,KAAK,CAACE,IADjC,EAEE,GAAG,EAAEgE,GAFP,EAGE,KAAK,EAAElE,KAHT,EAIE,OAAO,EAAE,KAAKS,KAAL,CAAWY,OAJtB,EAKE,OAAO,EAAE,KAAKZ,KAAL,CAAWW,OALtB,EAME,KAAK,EAAE,KAAKG,KAAL,CAAW2E,KANpB,EAOE,KAAK,EAAE,KAAKzF,KAAL,CAAW+F,KAPpB,EAQE,WAAW,EAAE,KAAK/F,KAAL,CAAWgG,QAR1B,EASE,iBAAiB,EAAE,KAAK/B,qBAT1B,EAUE,SAAS,EAAE,KAAKjE,KAAL,CAAWiG,SAVxB,GADF,CAcD,C,QAEOhD,iB,GAAR,6BAA4B,oBACS,KAAKnC,KADd,CAClBU,cADkB,gBAClBA,cADkB,CACFT,MADE,gBACFA,MADE,CAE1B,IAAMiC,SAAS,GAAG,CAACxB,cAAc,GAAGT,MAAM,CAAC,CAAD,CAAN,CAAUnB,MAA5B,CAAlB,CACA,KAAK,IAAI2D,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGxC,MAAM,CAACkB,MAA3B,EAAmCsB,CAAC,EAApC,EAAwC,CACtC,IAAM2C,QAAQ,GAAGlD,SAAS,CAACO,CAAC,GAAG,CAAL,CAAT,GAAmBxC,MAAM,CAACwC,CAAC,GAAG,CAAL,CAAN,CAAc3D,MAAlD,CACAoD,SAAS,CAACmD,IAAV,CAAeD,QAAf,EACD,CACD,OAAOlD,SAAP,CACD,C,mBAlN2BoD,eAAMC,S,8BAAvBtG,Q,CACGuG,mB,GAAsB,U,CADzBvG,Q,CAGGwG,Y,GAAe,EAC3BC,QAAQ,EAAE,EADiB,EAE3B7F,OAAO,EAAE,EACPlB,IAAI,EAAEgH,mBADC,EAEPlH,KAAK,EAAEmH,oBAFA,EAGPtH,IAAI,EAAEuH,mBAHC,EAFkB,EAO3B/F,OAAO,EAAE,EACPnB,IAAI,EAAEmH,mBADC,EAEPrH,KAAK,EAAEsH,oBAFA,EAGPzH,IAAI,EAAE0H,mBAHC,EAPkB,E","sourcesContent":["import React from 'react';\r\nimport normalizeWheel from 'normalize-wheel';\r\n\r\nimport { MAX_DATE, MAX_MONTH, MAX_YEAR, MIN_DATE, MIN_MONTH, MIN_YEAR } from '../../lib/date/constants';\r\nimport { Nullable } from '../../typings/utility-types';\r\nimport { Theme } from '../../lib/theming/Theme';\r\nimport { ThemeContext } from '../../lib/theming/ThemeContext';\r\nimport { Animation } from '../../lib/animation';\r\n\r\nimport { config } from './config';\r\nimport * as CalendarUtils from './CalendarUtils';\r\nimport { MonthViewModel } from './MonthViewModel';\r\nimport * as CalendarScrollEvents from './CalendarScrollEvents';\r\nimport { Month } from './Month';\r\nimport { jsStyles } from './Calendar.styles';\r\nimport { CalendarDateShape, create, isGreater, isLess } from './CalendarDateShape';\r\n\r\nexport interface CalendarProps {\r\n  initialMonth?: number;\r\n  initialYear?: number;\r\n  onSelect?: (date: CalendarDateShape) => void;\r\n  value?: Nullable<CalendarDateShape>;\r\n  maxDate?: CalendarDateShape;\r\n  minDate?: CalendarDateShape;\r\n  isHoliday?: (day: CalendarDateShape & { isWeekend: boolean }) => boolean;\r\n}\r\n\r\nexport interface CalendarState {\r\n  scrollPosition: number;\r\n  months: MonthViewModel[];\r\n  today: CalendarDateShape;\r\n  scrollDirection: number;\r\n  scrollTarget: number;\r\n}\r\n\r\nconst getTodayDate = () => {\r\n  const date = new Date();\r\n  return {\r\n    date: date.getDate(),\r\n    month: date.getMonth(),\r\n    year: date.getFullYear(),\r\n  };\r\n};\r\n\r\nconst wrapperStyle = { height: config.WRAPPER_HEIGHT };\r\n\r\nexport class Calendar extends React.Component<CalendarProps, CalendarState> {\r\n  public static __KONTUR_REACT_UI__ = 'Calendar';\r\n\r\n  public static defaultProps = {\r\n    holidays: [],\r\n    minDate: {\r\n      year: MIN_YEAR,\r\n      month: MIN_MONTH,\r\n      date: MIN_DATE,\r\n    },\r\n    maxDate: {\r\n      year: MAX_YEAR,\r\n      month: MAX_MONTH,\r\n      date: MAX_DATE,\r\n    },\r\n  };\r\n\r\n  private theme!: Theme;\r\n  private wheelEndTimeout: Nullable<number>;\r\n  private root: Nullable<HTMLElement>;\r\n  private animation = Animation();\r\n\r\n  constructor(props: CalendarProps) {\r\n    super(props);\r\n\r\n    const today = getTodayDate();\r\n\r\n    const initialMonth = props.initialMonth == null ? today.month : props.initialMonth;\r\n    const initialYear = props.initialYear == null ? today.year : props.initialYear;\r\n\r\n    this.state = {\r\n      scrollPosition: 0,\r\n      months: CalendarUtils.getMonths(initialMonth, initialYear),\r\n      today,\r\n      scrollDirection: 1,\r\n      scrollTarget: 0,\r\n    };\r\n  }\r\n\r\n  public componentWillUnmount() {\r\n    if (this.animation.inProgress()) {\r\n      this.animation.cancel();\r\n    }\r\n  }\r\n\r\n  public render() {\r\n    return (\r\n      <ThemeContext.Consumer>\r\n        {theme => {\r\n          this.theme = theme;\r\n          return this.renderMain();\r\n        }}\r\n      </ThemeContext.Consumer>\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Scrolls calendar to given date\r\n   * @public\r\n   */\r\n  public scrollToMonth = async (month: number, year: number) => {\r\n    if (this.animation.inProgress()) {\r\n      this.animation.finish();\r\n      // FIXME: Dirty hack to await batched updates\r\n      await new Promise(r => setTimeout(r));\r\n    }\r\n\r\n    const { minDate, maxDate } = this.props;\r\n\r\n    if (minDate && isGreater(minDate, create(32, month, year))) {\r\n      this.scrollToMonth(minDate.month, minDate.year);\r\n      return;\r\n    }\r\n\r\n    if (maxDate && isLess(maxDate, create(0, month, year))) {\r\n      this.scrollToMonth(maxDate.month, maxDate.year);\r\n      return;\r\n    }\r\n\r\n    const currentMonth = this.state.months[1];\r\n    const diffInMonths = currentMonth.month + currentMonth.year * 12 - month - year * 12;\r\n\r\n    if (diffInMonths === 0) {\r\n      this.scrollTo(0);\r\n      return;\r\n    }\r\n\r\n    const maxMonthsToAdd = config.MAX_MONTHS_TO_APPEND_ON_SCROLL;\r\n\r\n    const onEnd = () =>\r\n      this.setState({\r\n        months: CalendarUtils.getMonths(month, year),\r\n        scrollPosition: 0,\r\n      });\r\n\r\n    const isYearChanges = (state: CalendarState) =>\r\n      state.months[1].year !== year &&\r\n      // if diff in months is 2 or less,\r\n      // either year is not changing either months already\r\n      // have right isFirstInYear/isLastInYear flags\r\n      Math.abs(diffInMonths) > 2;\r\n\r\n    // If scrolling upwards, prepend maximum maxMonthsToAdd months\r\n    // and scroll to the first month\r\n    if (diffInMonths > 0) {\r\n      const monthsToPrependCount = Math.min(Math.abs(diffInMonths) - 1, maxMonthsToAdd);\r\n      const monthsToPrepend = Array.from({ length: monthsToPrependCount }, (_, index) =>\r\n        MonthViewModel.create(month + index, year),\r\n      );\r\n      this.setState(\r\n        state => {\r\n          const yearChanges = isYearChanges(state);\r\n          if (yearChanges) {\r\n            // Mutating here can lead to some unexpected bugs\r\n            // but we couldn't find any yet\r\n            state.months[0].isFirstInYear = true;\r\n            if (monthsToPrepend.length) {\r\n              // Mutating item here is safe as it was just created\r\n              monthsToPrepend[monthsToPrepend.length - 1].isLastInYear = true;\r\n            }\r\n          }\r\n          return {\r\n            months: monthsToPrepend.concat(state.months),\r\n            scrollPosition: -CalendarUtils.getMonthsHeight(monthsToPrepend),\r\n          };\r\n        },\r\n        () => {\r\n          const targetPosition = this.state.months[0].height;\r\n          this.scrollTo(targetPosition, onEnd);\r\n        },\r\n      );\r\n    }\r\n\r\n    // If scrolling downwards, append maximum maxMonthsToAdd months\r\n    // and scroll to the last but one month\r\n    if (diffInMonths < 0) {\r\n      const monthsToAppendCount = Math.min(Math.abs(diffInMonths), maxMonthsToAdd);\r\n      const monthsToAppend = Array.from({ length: monthsToAppendCount }, (_, index) =>\r\n        MonthViewModel.create(month + index - monthsToAppendCount + 2, year),\r\n      );\r\n      this.setState(\r\n        state => {\r\n          if (isYearChanges(state)) {\r\n            // Mutating here can lead to some unexpected bugs\r\n            // but we couldn't find any yet\r\n            state.months[state.months.length - 1].isLastInYear = true;\r\n            // Mutating item here is safe as it was just created\r\n            if (monthsToAppend[0]) {\r\n              monthsToAppend[0].isFirstInYear = true;\r\n            }\r\n          }\r\n          return { months: state.months.concat(monthsToAppend) };\r\n        },\r\n        () => {\r\n          const targetPosition = -1 * CalendarUtils.getMonthsHeight(this.state.months.slice(1, -2));\r\n          this.scrollTo(targetPosition, onEnd);\r\n        },\r\n      );\r\n    }\r\n  };\r\n\r\n  private renderMain = () => {\r\n    const positions = this.getMonthPositions();\r\n    return (\r\n      <div ref={this.refRoot} className={jsStyles.root(this.theme)}>\r\n        <div style={wrapperStyle} className={jsStyles.wrapper()}>\r\n          {this.state.months\r\n            .map<[number, MonthViewModel]>((x, i) => [positions[i], x])\r\n            .filter(([top, month]) => CalendarUtils.isMonthVisible(top, month))\r\n            .map(this.renderMonth, this)}\r\n        </div>\r\n      </div>\r\n    );\r\n  };\r\n\r\n  private refRoot = (element: HTMLElement | null) => {\r\n    if (!this.root && element) {\r\n      element.addEventListener('wheel', this.handleWheel, { passive: false });\r\n    }\r\n    if (this.root && !element) {\r\n      this.root.removeEventListener('wheel', this.handleWheel);\r\n    }\r\n    this.root = element;\r\n  };\r\n\r\n  private renderMonth([top, month]: [number, MonthViewModel]) {\r\n    return (\r\n      <Month\r\n        key={month.month + '-' + month.year}\r\n        top={top}\r\n        month={month}\r\n        maxDate={this.props.maxDate}\r\n        minDate={this.props.minDate}\r\n        today={this.state.today}\r\n        value={this.props.value}\r\n        onDateClick={this.props.onSelect}\r\n        onMonthYearChange={this.handleMonthYearChange}\r\n        isHoliday={this.props.isHoliday}\r\n      />\r\n    );\r\n  }\r\n\r\n  private getMonthPositions() {\r\n    const { scrollPosition, months } = this.state;\r\n    const positions = [scrollPosition - months[0].height];\r\n    for (let i = 1; i < months.length; i++) {\r\n      const position = positions[i - 1] + months[i - 1].height;\r\n      positions.push(position);\r\n    }\r\n    return positions;\r\n  }\r\n\r\n  private handleMonthYearChange = (month: number, year: number) => {\r\n    this.scrollToMonth(month, year);\r\n  };\r\n\r\n  private handleWheel = (event: Event) => {\r\n    if (!(event instanceof WheelEvent)) {\r\n      return;\r\n    }\r\n    event.preventDefault();\r\n    const { pixelY } = normalizeWheel(event);\r\n\r\n    this.setState(({ months, scrollPosition, scrollTarget }) => {\r\n      const targetPosition = CalendarUtils.calculateScrollPosition(months, scrollPosition, pixelY).scrollPosition;\r\n      return { scrollTarget: targetPosition };\r\n    }, this.handleWheelEnd);\r\n\r\n    this.animation.animate(pixelY, deltaY =>\r\n      // FIXME: Typescript not resolving setState cb type\r\n      this.setState(CalendarUtils.applyDelta(deltaY) as any),\r\n    );\r\n\r\n    CalendarScrollEvents.emit();\r\n  };\r\n\r\n  private handleWheelEnd = () => {\r\n    if (this.wheelEndTimeout) {\r\n      clearTimeout(this.wheelEndTimeout);\r\n    }\r\n    this.wheelEndTimeout = window.setTimeout(this.scrollToNearestWeek, 300);\r\n  };\r\n\r\n  private scrollToNearestWeek = () => {\r\n    const { scrollTarget, scrollDirection } = this.state;\r\n\r\n    const trasholdHeight = config.MONTH_TITLE_OFFSET_HEIGHT + config.DAY_HEIGHT;\r\n\r\n    if (scrollTarget < trasholdHeight) {\r\n      let targetPosition = 0;\r\n      if (scrollDirection < 0) {\r\n        targetPosition = trasholdHeight;\r\n      }\r\n\r\n      this.setState({ scrollTarget: targetPosition }, () => {\r\n        const amount = scrollTarget - targetPosition;\r\n        this.animation.animate(amount, deltaY =>\r\n          // FIXME: Typescript not resolving setState cb type\r\n          this.setState(CalendarUtils.applyDelta(deltaY) as any),\r\n        );\r\n      });\r\n    }\r\n  };\r\n\r\n  private scrollTo = (pos: number, onEnd?: () => void) => {\r\n    const scrollAmmount = pos - this.state.scrollPosition;\r\n    return this.scrollAmount(scrollAmmount, onEnd);\r\n  };\r\n\r\n  private scrollAmount = (scrollAmmount: number, onEnd?: () => void) => {\r\n    return this.animation.animate(\r\n      scrollAmmount,\r\n      deltaY =>\r\n        this.setState(({ scrollPosition }) => ({\r\n          scrollPosition: scrollPosition + deltaY,\r\n        })),\r\n      onEnd,\r\n    );\r\n  };\r\n}\r\n"]}