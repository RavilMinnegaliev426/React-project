"use strict";var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");exports.__esModule = true;exports.ZIndex = void 0;var _extends2 = _interopRequireDefault(require("@babel/runtime/helpers/extends"));var _objectWithoutPropertiesLoose2 = _interopRequireDefault(require("@babel/runtime/helpers/objectWithoutPropertiesLoose"));var _inheritsLoose2 = _interopRequireDefault(require("@babel/runtime/helpers/inheritsLoose"));var _react = _interopRequireDefault(require("react"));

var _ZIndexStorage = require("./ZIndexStorage");

var ZIndexContext = _react.default.createContext({ parentLayerZIndex: 0, maxZIndex: Infinity });

ZIndexContext.displayName = 'ZIndexContext';var















ZIndex = /*#__PURE__*/function (_React$Component) {(0, _inheritsLoose2.default)(ZIndex, _React$Component);
























  function ZIndex(props) {var _this;
    _this = _React$Component.call(this, props) || this;_this.zIndex = 0;
    _this.zIndex = (0, _ZIndexStorage.incrementZIndex)(props.priority, props.delta);return _this;
  }var _proto = ZIndex.prototype;_proto.

  componentWillUnmount = function componentWillUnmount() {
    (0, _ZIndexStorage.removeZIndex)(this.zIndex);
  };_proto.

  render = function render() {var _this2 = this;var _this$props =










    this.props,style = _this$props.style,children = _this$props.children,delta = _this$props.delta,priority = _this$props.priority,applyZIndex = _this$props.applyZIndex,coverChildren = _this$props.coverChildren,createStackingContext = _this$props.createStackingContext,wrapperRef = _this$props.wrapperRef,props = (0, _objectWithoutPropertiesLoose2.default)(_this$props, ["style", "children", "delta", "priority", "applyZIndex", "coverChildren", "createStackingContext", "wrapperRef"]);

    var wrapperStyle = {};

    return (
      _react.default.createElement(ZIndexContext.Consumer, null,
      function (_ref) {var parentLayerZIndex = _ref.parentLayerZIndex,maxZIndex = _ref.maxZIndex;
        var zIndexContexValue = { parentLayerZIndex: parentLayerZIndex, maxZIndex: maxZIndex };

        if (applyZIndex) {
          var newZIndex = _this2.calcZIndex(parentLayerZIndex, maxZIndex);
          wrapperStyle.zIndex = newZIndex;

          zIndexContexValue = coverChildren ?
          { parentLayerZIndex: parentLayerZIndex, maxZIndex: newZIndex } :
          { parentLayerZIndex: newZIndex, maxZIndex: Number.isFinite(maxZIndex) ? newZIndex : Infinity };

          if (createStackingContext) {
            'isolation' in document.body.style ?
            wrapperStyle.isolation = 'isolate' :
            wrapperStyle.transform = 'rotate(0)';
          }
        }

        return (
          _react.default.createElement(ZIndexContext.Provider, { value: zIndexContexValue },
          _react.default.createElement("div", (0, _extends2.default)({ style: (0, _extends2.default)({}, style, {}, wrapperStyle), ref: wrapperRef }, props),
          children)));



      }));


  };_proto.

  calcZIndex = function calcZIndex(parentLayerZIndex, maxZIndex) {
    var newZIndex = this.zIndex;

    if (Number.isFinite(maxZIndex)) {
      var allowedValuesIntervalLength = maxZIndex - parentLayerZIndex;
      var scale = _ZIndexStorage.upperBorder / allowedValuesIntervalLength;
      newZIndex = Math.ceil(newZIndex / scale);
    }

    newZIndex += parentLayerZIndex;

    return newZIndex;
  };return ZIndex;}(_react.default.Component);exports.ZIndex = ZIndex;ZIndex.__KONTUR_REACT_UI__ = 'ZIndex';ZIndex.defaultProps = { delta: 10, priority: 0, style: {}, applyZIndex: true, coverChildren: false, createStackingContext: false };ZIndex.propTypes = { delta: function delta(props) {if (props.delta <= 0) {return new Error("[ZIndex]: Prop 'delta' must be greater than 0, received " + props.delta);}if (Math.trunc(props.delta) !== props.delta) {return new Error("[ZIndex]: Prop 'delta' must be integer, received " + props.delta);}} };