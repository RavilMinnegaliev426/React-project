{"version":3,"sources":["InternalMenu.tsx"],"names":["InternalMenu","state","highlightedIndex","maxHeight","props","scrollState","theme","scrollContainer","highlighted","rootElement","header","footer","getProps","defaultProps","renderHeader","el","jsStyles","fixedHeader","renderFooter","fixedFooter","focusOnRootElement","focus","shouldRecalculateMaxHeight","prevProps","children","prevMaxHeight","prevHeader","prevFooter","prevChildrenCount","React","Children","count","calculateMaxHeight","parsedMaxHeight","window","rootElementMaxHeight","getComputedStyle","parseFloat","calculatedMaxHeight","getBoundingClientRect","height","setState","setInitialSelection","i","initialSelectedItemIndex","moveDown","refScrollContainer","scrollToSelected","scrollTo","ReactDOM","findDOMNode","highlightItem","index","unhighlight","moveUp","move","handleKeyDown","e","onKeyDown","defaultPrevented","preventDefault","onClick","handleScrollStateChange","componentDidMount","componentDidUpdate","prevState","UNSAFE_componentWillReceiveProps","nextProps","render","renderMain","enableIconPadding","toArray","some","x","isValidElement","icon","isEmpty","root","shadow","hasShadow","width","element","preventWindowScroll","map","child","type","cloneElement","_enableIconPadding","highlight","ref","originalRef","menuItem","refHighlighted","select","bind","onMouseEnter","event","onMouseLeave","current","shouldHandleHref","item","childrenToArray","href","target","open","location","onItemClick","step","isActiveElement","cyclicSelection","length","filter","isExist","Component","__KONTUR_REACT_UI__","value","undefined","ret","forEach","push"],"mappings":"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","sourcesContent":["import React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport cn from 'classnames';\r\n\r\nimport { isKeyArrowDown, isKeyArrowUp, isKeyEnter } from '../../lib/events/keyboard/identifiers';\r\nimport { ScrollContainer, ScrollContainerScrollState } from '../../components/ScrollContainer';\r\nimport { isMenuItem, MenuItem, MenuItemProps } from '../../components/MenuItem';\r\nimport { isMenuHeader } from '../../components/MenuHeader';\r\nimport { createPropsGetter } from '../../lib/createPropsGetter';\r\nimport { Nullable } from '../../typings/utility-types';\r\nimport { ThemeContext } from '../../lib/theming/ThemeContext';\r\nimport { Theme } from '../../lib/theming/Theme';\r\n\r\nimport { jsStyles } from './InternalMenu.styles';\r\nimport { isActiveElement } from './isActiveElement';\r\n\r\ninterface MenuProps {\r\n  children?: React.ReactNode;\r\n  hasShadow?: boolean;\r\n  maxHeight?: number | string;\r\n  onItemClick?: (event: React.SyntheticEvent<HTMLElement>) => void;\r\n  width?: number | string;\r\n  preventWindowScroll?: boolean;\r\n  onKeyDown?: (event: React.KeyboardEvent<HTMLElement>) => void;\r\n\r\n  header?: React.ReactNode;\r\n  footer?: React.ReactNode;\r\n\r\n  // Циклический перебор айтемов меню (по-дефолтну включен)\r\n  cyclicSelection?: boolean;\r\n  initialSelectedItemIndex?: number;\r\n}\r\n\r\ninterface MenuState {\r\n  highlightedIndex: number;\r\n  maxHeight: number | string;\r\n  scrollState: ScrollContainerScrollState;\r\n}\r\n\r\nexport class InternalMenu extends React.Component<MenuProps, MenuState> {\r\n  public static __KONTUR_REACT_UI__ = 'InternalMenu';\r\n\r\n  public static defaultProps = {\r\n    width: 'auto',\r\n    maxHeight: 300,\r\n    hasShadow: true,\r\n    preventWindowScroll: true,\r\n    cyclicSelection: true,\r\n    initialSelectedItemIndex: -1,\r\n  };\r\n\r\n  public state: MenuState = {\r\n    highlightedIndex: -1,\r\n    maxHeight: this.props.maxHeight || 'none',\r\n    scrollState: 'top',\r\n  };\r\n\r\n  private theme!: Theme;\r\n  private scrollContainer: Nullable<ScrollContainer>;\r\n  private highlighted: Nullable<MenuItem>;\r\n  private rootElement: Nullable<HTMLDivElement>;\r\n  private header: Nullable<HTMLDivElement>;\r\n  private footer: Nullable<HTMLDivElement>;\r\n  private getProps = createPropsGetter(InternalMenu.defaultProps);\r\n\r\n  public componentDidMount() {\r\n    this.setInitialSelection();\r\n    this.calculateMaxHeight();\r\n  }\r\n\r\n  public componentDidUpdate(prevProps: MenuProps, prevState: MenuState) {\r\n    if (this.shouldRecalculateMaxHeight(prevProps)) {\r\n      this.calculateMaxHeight();\r\n    }\r\n  }\r\n\r\n  public UNSAFE_componentWillReceiveProps(nextProps: MenuProps) {\r\n    if (nextProps.maxHeight !== this.props.maxHeight) {\r\n      this.setState({\r\n        maxHeight: nextProps.maxHeight || 'none',\r\n      });\r\n    }\r\n  }\r\n\r\n  public focus() {\r\n    this.focusOnRootElement();\r\n  }\r\n\r\n  public render() {\r\n    return (\r\n      <ThemeContext.Consumer>\r\n        {theme => {\r\n          this.theme = theme;\r\n          return this.renderMain();\r\n        }}\r\n      </ThemeContext.Consumer>\r\n    );\r\n  }\r\n\r\n  private renderMain() {\r\n    const enableIconPadding = React.Children.toArray(this.props.children).some(\r\n      x => React.isValidElement(x) && x.props.icon,\r\n    );\r\n\r\n    if (this.isEmpty()) {\r\n      return null;\r\n    }\r\n\r\n    return (\r\n      <div\r\n        className={cn({\r\n          [jsStyles.root(this.theme)]: true,\r\n          [jsStyles.shadow()]: this.props.hasShadow,\r\n        })}\r\n        style={{\r\n          width: this.props.width,\r\n          maxHeight: this.state.maxHeight,\r\n        }}\r\n        onKeyDown={this.handleKeyDown}\r\n        ref={element => {\r\n          this.rootElement = element;\r\n        }}\r\n        tabIndex={0}\r\n      >\r\n        {this.props.header ? this.renderHeader() : null}\r\n        <ScrollContainer\r\n          ref={this.refScrollContainer}\r\n          maxHeight={this.props.maxHeight}\r\n          preventWindowScroll={this.props.preventWindowScroll}\r\n          onScrollStateChange={this.handleScrollStateChange}\r\n        >\r\n          {React.Children.map(this.props.children, (child, index) => {\r\n            if (typeof child === 'string' || typeof child === 'number' || child == null) {\r\n              return child;\r\n            }\r\n            if (React.isValidElement(child) && typeof child.type === 'string') {\r\n              return child;\r\n            }\r\n\r\n            if (enableIconPadding && (isMenuItem(child) || isMenuHeader(child))) {\r\n              child = React.cloneElement(child, {\r\n                _enableIconPadding: true,\r\n              });\r\n            }\r\n\r\n            if (isActiveElement(child)) {\r\n              const highlight = this.state.highlightedIndex === index;\r\n\r\n              let ref = child.ref;\r\n              const originalRef = ref;\r\n              if (highlight) {\r\n                ref = menuItem => this.refHighlighted(originalRef, menuItem);\r\n              }\r\n\r\n              return React.cloneElement<MenuItemProps, MenuItem>(child, {\r\n                ref,\r\n                state: highlight ? 'hover' : child.props.state,\r\n                onClick: this.select.bind(this, index, false),\r\n                onMouseEnter: event => {\r\n                  this.highlightItem(index);\r\n                  if (isMenuItem(child) && child.props.onMouseEnter) {\r\n                    child.props.onMouseEnter(event);\r\n                  }\r\n                },\r\n                onMouseLeave: event => {\r\n                  this.unhighlight();\r\n                  if (isMenuItem(child) && child.props.onMouseLeave) {\r\n                    child.props.onMouseLeave(event);\r\n                  }\r\n                },\r\n              });\r\n            }\r\n\r\n            return child;\r\n          })}\r\n        </ScrollContainer>\r\n        {this.props.footer ? this.renderFooter() : null}\r\n      </div>\r\n    );\r\n  }\r\n\r\n  private renderHeader = () => {\r\n    return (\r\n      <div\r\n        ref={el => (this.header = el)}\r\n        className={cn({\r\n          [jsStyles.header()]: true,\r\n          [jsStyles.fixedHeader()]: this.state.scrollState !== 'top',\r\n        })}\r\n      >\r\n        {this.props.header}\r\n      </div>\r\n    );\r\n  };\r\n\r\n  private renderFooter = () => {\r\n    return (\r\n      <div\r\n        ref={el => (this.footer = el)}\r\n        className={cn({\r\n          [jsStyles.footer()]: true,\r\n          [jsStyles.fixedFooter()]: this.state.scrollState !== 'bottom',\r\n        })}\r\n      >\r\n        {this.props.footer}\r\n      </div>\r\n    );\r\n  };\r\n\r\n  private focusOnRootElement = (): void => {\r\n    if (this.rootElement) {\r\n      this.rootElement.focus();\r\n    }\r\n  };\r\n\r\n  private shouldRecalculateMaxHeight = (prevProps: MenuProps): boolean => {\r\n    const { maxHeight, header, footer, children } = this.props;\r\n    const prevMaxHeight = prevProps.maxHeight;\r\n    const prevHeader = prevProps.header;\r\n    const prevFooter = prevProps.footer;\r\n    const prevChildrenCount = React.Children.count(prevProps.children);\r\n\r\n    return (\r\n      maxHeight !== prevMaxHeight ||\r\n      footer !== prevFooter ||\r\n      header !== prevHeader ||\r\n      React.Children.count(children) !== prevChildrenCount\r\n    );\r\n  };\r\n\r\n  private calculateMaxHeight = () => {\r\n    const { maxHeight } = this.props;\r\n    let parsedMaxHeight = maxHeight;\r\n\r\n    if (typeof maxHeight === 'string' && typeof window !== 'undefined' && this.rootElement) {\r\n      const rootElementMaxHeight = window.getComputedStyle(this.rootElement).maxHeight;\r\n\r\n      if (rootElementMaxHeight) {\r\n        parsedMaxHeight = parseFloat(rootElementMaxHeight);\r\n      }\r\n    }\r\n\r\n    const calculatedMaxHeight =\r\n      typeof parsedMaxHeight === 'number'\r\n        ? parsedMaxHeight +\r\n          ((this.header && this.header.getBoundingClientRect().height) || 0) +\r\n          ((this.footer && this.footer.getBoundingClientRect().height) || 0)\r\n        : maxHeight;\r\n\r\n    this.setState({\r\n      maxHeight: calculatedMaxHeight || 'none',\r\n    });\r\n  };\r\n\r\n  private setInitialSelection = () => {\r\n    for (let i = this.getProps().initialSelectedItemIndex; i > -1; i--) {\r\n      this.moveDown();\r\n    }\r\n  };\r\n\r\n  private refScrollContainer = (scrollContainer: Nullable<ScrollContainer>) => {\r\n    this.scrollContainer = scrollContainer;\r\n  };\r\n\r\n  private refHighlighted(\r\n    originalRef: string | ((instance: MenuItem | null) => void) | React.RefObject<MenuItem> | null | undefined,\r\n    menuItem: MenuItem | null,\r\n  ) {\r\n    this.highlighted = menuItem;\r\n\r\n    if (!originalRef || typeof originalRef === 'string') {\r\n      return;\r\n    }\r\n\r\n    if (typeof originalRef === 'function') {\r\n      originalRef(menuItem);\r\n    } else if (typeof originalRef === 'object') {\r\n      // @ts-ignore see issue https://github.com/DefinitelyTyped/DefinitelyTyped/issues/31065\r\n      originalRef.current = menuItem;\r\n    }\r\n  }\r\n\r\n  private scrollToSelected = () => {\r\n    if (this.scrollContainer && this.highlighted) {\r\n      this.scrollContainer.scrollTo(ReactDOM.findDOMNode(this.highlighted) as HTMLElement);\r\n    }\r\n  };\r\n\r\n  private select(index: number, shouldHandleHref: boolean, event: React.SyntheticEvent<HTMLElement>): boolean {\r\n    const item = childrenToArray(this.props.children)[index];\r\n\r\n    if (isActiveElement(item)) {\r\n      if (shouldHandleHref && item.props.href) {\r\n        if (item.props.target) {\r\n          window.open(item.props.href, item.props.target);\r\n        } else {\r\n          location.href = item.props.href;\r\n        }\r\n      }\r\n      if (item.props.onClick) {\r\n        item.props.onClick(event as React.MouseEvent<HTMLElement>);\r\n      }\r\n      if (this.props.onItemClick) {\r\n        this.props.onItemClick(event);\r\n      }\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  private highlightItem = (index: number): void => {\r\n    this.setState({ highlightedIndex: index });\r\n    if (this.rootElement) {\r\n      this.rootElement.focus();\r\n    }\r\n  };\r\n\r\n  private unhighlight = () => {\r\n    this.setState({ highlightedIndex: -1 });\r\n  };\r\n\r\n  private move(step: number) {\r\n    this.setState((state, props) => {\r\n      const children = childrenToArray(props.children);\r\n      if (!children.some(isActiveElement)) {\r\n        return null;\r\n      }\r\n      let index = state.highlightedIndex;\r\n      do {\r\n        index += step;\r\n        if (!props.cyclicSelection && (index < 0 || index > children.length)) {\r\n          return null;\r\n        }\r\n\r\n        if (index < 0) {\r\n          index = children.length - 1;\r\n        } else if (index > children.length) {\r\n          index = 0;\r\n        }\r\n\r\n        const child = children[index];\r\n        if (isActiveElement(child)) {\r\n          return { highlightedIndex: index };\r\n        }\r\n      } while (index !== state.highlightedIndex);\r\n      return null;\r\n    }, this.scrollToSelected);\r\n  }\r\n\r\n  private moveUp = () => {\r\n    this.move(-1);\r\n  };\r\n\r\n  private moveDown = () => {\r\n    this.move(1);\r\n  };\r\n\r\n  private isEmpty() {\r\n    const { children } = this.props;\r\n    return !children || !childrenToArray(children).filter(isExist).length;\r\n  }\r\n\r\n  private handleKeyDown = (e: React.KeyboardEvent<HTMLDivElement>): void => {\r\n    if (typeof this.props.onKeyDown === 'function') {\r\n      this.props.onKeyDown(e);\r\n    }\r\n\r\n    if (e.defaultPrevented) {\r\n      return;\r\n    }\r\n\r\n    if (isKeyArrowUp(e)) {\r\n      e.preventDefault();\r\n      this.moveUp();\r\n    } else if (isKeyArrowDown(e)) {\r\n      e.preventDefault();\r\n      this.moveDown();\r\n    } else if (isKeyEnter(e)) {\r\n      if (this.highlighted && this.highlighted.props.onClick) {\r\n        this.highlighted.props.onClick(e);\r\n      }\r\n    }\r\n  };\r\n\r\n  private handleScrollStateChange = (scrollState: ScrollContainerScrollState) => {\r\n    if (this.state.scrollState !== scrollState) {\r\n      this.setState({ scrollState });\r\n    }\r\n  };\r\n}\r\n\r\nfunction isExist(value: any): value is any {\r\n  return value !== null && value !== undefined;\r\n}\r\n\r\nfunction childrenToArray(children: React.ReactNode): React.ReactNode[] {\r\n  const ret: React.ReactNode[] = [];\r\n  // Use forEach instead of map to avoid cloning for key unifying.\r\n  React.Children.forEach(children, child => {\r\n    ret.push(child);\r\n  });\r\n  return ret;\r\n}\r\n"]}