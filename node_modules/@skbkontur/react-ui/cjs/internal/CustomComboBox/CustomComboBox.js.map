{"version":3,"sources":["CustomComboBox.tsx"],"names":["DELAY_BEFORE_SHOW_LOADER","LOADER_SHOW_TIME","DefaultState","inputChanged","editing","items","loading","opened","focused","textValue","repeatRequest","undefined","requestStatus","ComboBoxRequestStatus","Unknown","CustomComboBox","state","input","menu","inputLikeText","requestId","loaderShowDelay","cancelationToken","reducer","cancelLoaderDelay","focus","props","disabled","handleFocus","selectInputText","selectAll","blur","handleBlur","dispatch","action","effects","nextState","setState","stateAndEffect","Array","forEach","handleEffect","effect","getState","getProps","handleValueChange","value","type","keepFocus","handleClickOutside","e","close","handleInputBlur","handleInputClick","search","query","getItems","cancelPromise","Promise","_","reject","expectingId","resolve","cancelLoader","setTimeout","catch","race","code","cancelSearch","CancelationError","open","render","viewProps","align","borderless","disablePortal","error","menuAlign","drawArrow","placeholder","size","totalCount","warning","width","maxLength","maxMenuHeight","onValueChange","onClickOutside","onFocus","onFocusOutside","onInputBlur","onInputValueChange","onInputFocus","onInputClick","onInputKeyDown","event","persist","onMouseEnter","onMouseOver","onMouseLeave","renderItem","renderNotFound","renderValue","renderTotalCount","renderAddButton","refInput","refMenu","refInputLikeText","componentDidMount","autoFocus","componentDidUpdate","prevProps","prevState","reset","React","PureComponent","__KONTUR_REACT_UI__"],"mappings":"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","sourcesContent":["import React from 'react';\r\n\r\nimport { Nullable } from '../../typings/utility-types';\r\nimport { Input } from '../../components/Input';\r\nimport { Menu } from '../Menu';\r\nimport { InputLikeText } from '../InputLikeText';\r\nimport { MenuItemState } from '../../components/MenuItem';\r\nimport { CancelationError, taskWithDelay } from '../../lib/utils';\r\nimport { fixClickFocusIE } from '../../lib/events/fixClickFocusIE';\r\n\r\nimport { ComboBoxRequestStatus } from './CustomComboBoxTypes';\r\nimport { CustomComboBoxAction, CustomComboBoxEffect, reducer } from './CustomComboBoxReducer';\r\nimport { ComboBoxView } from './ComboBoxView';\r\n\r\nexport interface CustomComboBoxProps<T> {\r\n  align?: 'left' | 'center' | 'right';\r\n  autoFocus?: boolean;\r\n  borderless?: boolean;\r\n  disablePortal?: boolean;\r\n  disabled?: boolean;\r\n  error?: boolean;\r\n  maxLength?: number;\r\n  menuAlign?: 'left' | 'right';\r\n  drawArrow?: boolean;\r\n  searchOnFocus?: boolean;\r\n  onValueChange?: (value: T) => void;\r\n  onInputValueChange?: (value: string) => Nullable<string> | void;\r\n  onUnexpectedInput?: (value: string) => void | null | T;\r\n  onFocus?: () => void;\r\n  onBlur?: () => void;\r\n  onMouseEnter?: (e: React.MouseEvent) => void;\r\n  onMouseOver?: (e: React.MouseEvent) => void;\r\n  onMouseLeave?: (e: React.MouseEvent) => void;\r\n  onInputKeyDown?: (e: React.KeyboardEvent<HTMLElement>) => void;\r\n  placeholder?: string;\r\n  size?: 'small' | 'medium' | 'large';\r\n  totalCount?: number;\r\n  value?: Nullable<T>;\r\n  warning?: boolean;\r\n  width?: string | number;\r\n  maxMenuHeight?: number | string;\r\n  renderNotFound?: () => React.ReactNode;\r\n  renderTotalCount?: (found: number, total: number) => React.ReactNode;\r\n  renderItem: (item: T, state?: MenuItemState) => React.ReactNode;\r\n  renderValue: (value: T) => React.ReactNode;\r\n  renderAddButton?: (query?: string) => React.ReactNode;\r\n  valueToString: (value: T) => string;\r\n  itemToValue: (item: T) => string | number;\r\n  getItems: (query: string) => Promise<T[]>;\r\n}\r\n\r\nexport interface CustomComboBoxState<T> {\r\n  editing: boolean;\r\n  loading: boolean;\r\n  opened: boolean;\r\n  textValue: string;\r\n  items: Nullable<T[]>;\r\n  inputChanged: boolean;\r\n  focused: boolean;\r\n  repeatRequest: () => void;\r\n  requestStatus: ComboBoxRequestStatus;\r\n}\r\n\r\nexport const DELAY_BEFORE_SHOW_LOADER = 300;\r\nexport const LOADER_SHOW_TIME = 1000;\r\n\r\nexport const DefaultState = {\r\n  inputChanged: false,\r\n  editing: false,\r\n  items: null,\r\n  loading: false,\r\n  opened: false,\r\n  focused: false,\r\n  textValue: '',\r\n  repeatRequest: () => undefined,\r\n  requestStatus: ComboBoxRequestStatus.Unknown,\r\n};\r\n\r\nexport class CustomComboBox<T> extends React.PureComponent<CustomComboBoxProps<T>, CustomComboBoxState<T>> {\r\n  public static __KONTUR_REACT_UI__ = 'CustomComboBox';\r\n\r\n  public state: CustomComboBoxState<T> = DefaultState;\r\n  public input: Nullable<Input>;\r\n  public menu: Nullable<Menu>;\r\n  public inputLikeText: Nullable<InputLikeText>;\r\n  public requestId = 0;\r\n  public loaderShowDelay: Nullable<Promise<never>>;\r\n  private focused = false;\r\n  private cancelationToken: Nullable<(reason?: Error) => void> = null;\r\n\r\n  private reducer = reducer;\r\n  public cancelLoaderDelay: () => void = () => null;\r\n\r\n  /**\r\n   * @public\r\n   */\r\n  public focus = () => {\r\n    if (this.props.disabled) {\r\n      return;\r\n    }\r\n\r\n    this.handleFocus();\r\n  };\r\n\r\n  /**\r\n   * @public\r\n   */\r\n  public selectInputText = () => {\r\n    if (this.props.disabled) {\r\n      return;\r\n    }\r\n    if (this.input) {\r\n      this.input.selectAll();\r\n    }\r\n  };\r\n\r\n  /**\r\n   * @public\r\n   */\r\n  public blur = () => {\r\n    if (this.props.disabled) {\r\n      return;\r\n    }\r\n\r\n    this.handleBlur();\r\n  };\r\n\r\n  /**\r\n   * @public\r\n   */\r\n  public async search(query: string = this.state.textValue) {\r\n    const { getItems } = this.props;\r\n\r\n    const cancelPromise: Promise<never> = new Promise((_, reject) => (this.cancelationToken = reject));\r\n    const expectingId = (this.requestId += 1);\r\n\r\n    if (!this.loaderShowDelay) {\r\n      this.loaderShowDelay = new Promise(resolve => {\r\n        const cancelLoader = taskWithDelay(() => {\r\n          this.dispatch({ type: 'RequestItems' });\r\n          setTimeout(resolve, LOADER_SHOW_TIME);\r\n        }, DELAY_BEFORE_SHOW_LOADER);\r\n\r\n        cancelPromise.catch(() => cancelLoader());\r\n\r\n        this.cancelLoaderDelay = () => {\r\n          cancelLoader();\r\n          resolve();\r\n        };\r\n      });\r\n    }\r\n\r\n    try {\r\n      const items = await Promise.race([getItems(query), cancelPromise]);\r\n      if (this.state.loading) {\r\n        await Promise.race([this.loaderShowDelay, cancelPromise]);\r\n      }\r\n      if (expectingId === this.requestId) {\r\n        this.dispatch({\r\n          type: 'ReceiveItems',\r\n          items,\r\n        });\r\n      }\r\n    } catch (error) {\r\n      if (error && error.code === 'CancelationError') {\r\n        this.dispatch({ type: 'CancelRequest' });\r\n      } else if (expectingId === this.requestId) {\r\n        this.dispatch({\r\n          type: 'RequestFailure',\r\n          repeatRequest: () => {\r\n            this.search(query);\r\n            if (this.input) {\r\n              this.input.focus();\r\n            }\r\n          },\r\n        });\r\n      }\r\n    } finally {\r\n      if (expectingId === this.requestId) {\r\n        if (!this.state.loading) {\r\n          this.cancelLoaderDelay();\r\n        }\r\n        this.cancelationToken = null;\r\n        this.loaderShowDelay = null;\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @public\r\n   */\r\n  public cancelSearch() {\r\n    if (this.cancelationToken) {\r\n      this.cancelationToken(new CancelationError());\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @public\r\n   */\r\n  public open() {\r\n    this.dispatch({ type: 'Open' });\r\n  }\r\n\r\n  /**\r\n   * @public\r\n   */\r\n  public close() {\r\n    this.dispatch({ type: 'Close' });\r\n  }\r\n\r\n  public render() {\r\n    const viewProps = {\r\n      align: this.props.align,\r\n      borderless: this.props.borderless,\r\n      disabled: this.props.disabled,\r\n      disablePortal: this.props.disablePortal,\r\n      editing: this.state.editing,\r\n      error: this.props.error,\r\n      items: this.state.items,\r\n      loading: this.state.loading,\r\n      menuAlign: this.props.menuAlign,\r\n      opened: this.state.opened,\r\n      drawArrow: this.props.drawArrow,\r\n      placeholder: this.props.placeholder,\r\n      size: this.props.size,\r\n      textValue: this.state.textValue,\r\n      totalCount: this.props.totalCount,\r\n      value: this.props.value,\r\n      warning: this.props.warning,\r\n      width: this.props.width,\r\n      maxLength: this.props.maxLength,\r\n      maxMenuHeight: this.props.maxMenuHeight,\r\n\r\n      onValueChange: this.handleValueChange,\r\n      onClickOutside: this.handleClickOutside,\r\n      onFocus: this.handleFocus,\r\n      onFocusOutside: this.handleBlur,\r\n      onInputBlur: this.handleInputBlur,\r\n      onInputValueChange: (value: string) => this.dispatch({ type: 'TextChange', value }),\r\n      onInputFocus: this.handleFocus,\r\n      onInputClick: this.handleInputClick,\r\n      onInputKeyDown: (event: React.KeyboardEvent) => {\r\n        event.persist();\r\n        this.dispatch({ type: 'KeyPress', event });\r\n      },\r\n      onMouseEnter: this.props.onMouseEnter,\r\n      onMouseOver: this.props.onMouseOver,\r\n      onMouseLeave: this.props.onMouseLeave,\r\n      renderItem: this.props.renderItem,\r\n      renderNotFound: this.props.renderNotFound,\r\n      renderValue: this.props.renderValue,\r\n      renderTotalCount: this.props.renderTotalCount,\r\n      renderAddButton: this.props.renderAddButton,\r\n      repeatRequest: this.state.repeatRequest,\r\n      requestStatus: this.state.requestStatus,\r\n\r\n      refInput: (input: Nullable<Input>) => {\r\n        this.input = input;\r\n      },\r\n      refMenu: (menu: Nullable<Menu>) => {\r\n        this.menu = menu;\r\n      },\r\n      refInputLikeText: (inputLikeText: Nullable<InputLikeText>) => {\r\n        this.inputLikeText = inputLikeText;\r\n      },\r\n    };\r\n\r\n    return <ComboBoxView {...viewProps} />;\r\n  }\r\n\r\n  public componentDidMount() {\r\n    this.dispatch({ type: 'Mount' });\r\n    if (this.props.autoFocus) {\r\n      this.focus();\r\n    }\r\n  }\r\n\r\n  public componentDidUpdate(prevProps: CustomComboBoxProps<T>, prevState: CustomComboBoxState<T>) {\r\n    if (prevState.editing && !this.state.editing) {\r\n      this.handleBlur();\r\n    }\r\n    this.dispatch({ type: 'DidUpdate', prevProps, prevState });\r\n  }\r\n\r\n  /**\r\n   * @public\r\n   */\r\n  public reset() {\r\n    this.dispatch({ type: 'Reset' });\r\n  }\r\n\r\n  private dispatch = (action: CustomComboBoxAction<T>) => {\r\n    let effects: Array<CustomComboBoxEffect<T>>;\r\n    let nextState: Pick<CustomComboBoxState<T>, never>;\r\n\r\n    this.setState(\r\n      state => {\r\n        const stateAndEffect = this.reducer(state, this.props, action);\r\n\r\n        [nextState, effects] = stateAndEffect instanceof Array ? stateAndEffect : [stateAndEffect, []];\r\n\r\n        return nextState;\r\n      },\r\n      () => {\r\n        effects.forEach(this.handleEffect);\r\n      },\r\n    );\r\n  };\r\n\r\n  private handleEffect = (effect: CustomComboBoxEffect<T>) => {\r\n    effect(this.dispatch, this.getState, this.getProps, () => this);\r\n  };\r\n\r\n  private getProps = () => this.props;\r\n\r\n  private getState = () => this.state;\r\n\r\n  private handleValueChange = (value: T) => {\r\n    this.dispatch({\r\n      type: 'ValueChange',\r\n      value,\r\n      keepFocus: true,\r\n    });\r\n  };\r\n\r\n  private handleFocus = () => {\r\n    if (this.focused) {\r\n      return;\r\n    }\r\n    this.focused = true;\r\n    this.dispatch({ type: 'Focus' });\r\n  };\r\n\r\n  private handleClickOutside = (e: Event) => {\r\n    fixClickFocusIE(e);\r\n    this.handleBlur();\r\n  };\r\n\r\n  private handleBlur = () => {\r\n    if (!this.focused) {\r\n      if (this.state.opened) {\r\n        this.close();\r\n      }\r\n      return;\r\n    }\r\n    this.focused = false;\r\n    this.dispatch({ type: 'Blur' });\r\n  };\r\n\r\n  private handleInputBlur = () => {\r\n    // If menu opened, RenderLayer is active and\r\n    // it would call handleFocusOutside\r\n    // In that way handleBlur would be called\r\n    if (this.state.opened) {\r\n      return;\r\n    }\r\n    this.handleBlur();\r\n  };\r\n\r\n  private handleInputClick = () => {\r\n    if (!this.cancelationToken) {\r\n      this.dispatch({ type: 'InputClick' });\r\n    }\r\n  };\r\n}\r\n"]}