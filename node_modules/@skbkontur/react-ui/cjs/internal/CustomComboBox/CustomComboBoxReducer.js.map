{"version":3,"sources":["CustomComboBoxReducer.tsx"],"names":["DEBOUNCE_DELAY","getValueString","value","valueToString","Effect","Search","query","dispatch","getState","getProps","getInstance","search","DebouncedSearch","searchEffect","textValue","CancelRequest","cancel","cancelSearch","Blur","onBlur","Focus","onFocus","ValueChange","onValueChange","UnexpectedInput","items","onUnexpectedInput","Array","isArray","length","singleItem","valueContent","type","keepFocus","undefined","InputChange","onInputValueChange","returnedValue","InputFocus","input","focus","HighlightMenuItem","itemToValue","focused","requestStatus","menu","valueString","index","findIndex","x","highlightItem","process","nextTick","scrollToSelected","ComboBoxRequestStatus","Failed","down","SelectMenuItem","event","enter","MoveMenuHighlight","direction","ResetHighlightedMenuItem","combobox","hasHighlightedItem","reset","Reflow","LayoutEvents","emit","SelectInputText","selectInputText","InputKeyDown","onInputKeyDown","never","_","reducer","state","props","action","opened","inputChanged","editing","newState","searchOnFocus","e","effects","nextState","preventDefault","push","prevProps","DefaultState","loading","Pending","shouldResetMenuHighlight","Success","repeatRequest","Unknown"],"mappings":"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","sourcesContent":["import React from 'react';\r\nimport debounce from 'lodash.debounce';\r\nimport isEqual from 'lodash.isequal';\r\n\r\nimport { isKeyArrowUp, isKeyArrowVertical, isKeyEnter, isKeyEscape } from '../../lib/events/keyboard/identifiers';\r\nimport * as LayoutEvents from '../../lib/LayoutEvents';\r\nimport { Nullable } from '../../typings/utility-types';\r\n\r\nimport { CustomComboBox, CustomComboBoxProps, CustomComboBoxState, DefaultState } from './CustomComboBox';\r\nimport { ComboBoxRequestStatus } from './CustomComboBoxTypes';\r\n\r\nexport type CustomComboBoxAction<T> =\r\n  | { type: 'ValueChange'; value: T; keepFocus: boolean }\r\n  | { type: 'TextChange'; value: string }\r\n  | { type: 'KeyPress'; event: React.KeyboardEvent }\r\n  | {\r\n      type: 'DidUpdate';\r\n      prevProps: CustomComboBoxProps<T>;\r\n      prevState: CustomComboBoxState<T>;\r\n    }\r\n  | { type: 'Mount' }\r\n  | { type: 'Focus' }\r\n  | { type: 'InputClick' }\r\n  | { type: 'Blur' }\r\n  | { type: 'Reset' }\r\n  | { type: 'Open' }\r\n  | { type: 'Close' }\r\n  | { type: 'Search'; query: string }\r\n  | { type: 'RequestItems' }\r\n  | { type: 'ReceiveItems'; items: T[] }\r\n  | { type: 'RequestFailure'; repeatRequest: () => void }\r\n  | { type: 'CancelRequest' };\r\n\r\nexport type CustomComboBoxEffect<T> = (\r\n  dispatch: (action: CustomComboBoxAction<T>) => void,\r\n  getState: () => CustomComboBoxState<T>,\r\n  getProps: () => CustomComboBoxProps<T>,\r\n  getInstance: () => CustomComboBox<T>,\r\n) => void;\r\n\r\ntype Effect = CustomComboBoxEffect<any>;\r\n\r\ninterface EffectFactory {\r\n  Search: (query: string) => Effect;\r\n  DebouncedSearch: Effect & {\r\n    cancel(): void;\r\n    flush(): void;\r\n  };\r\n  CancelRequest: Effect;\r\n  Blur: Effect;\r\n  Focus: Effect;\r\n\r\n  ValueChange: (value: any) => Effect;\r\n  UnexpectedInput: (textValue: string, items: Nullable<any[]>) => Effect;\r\n  InputChange: Effect;\r\n  InputFocus: Effect;\r\n  HighlightMenuItem: Effect;\r\n  SelectMenuItem: (event: React.KeyboardEvent<HTMLElement>) => Effect;\r\n  InputKeyDown: (event: React.KeyboardEvent<HTMLElement>) => Effect;\r\n  MoveMenuHighlight: (direction: 'up' | 'down') => Effect;\r\n  ResetHighlightedMenuItem: Effect;\r\n  Reflow: Effect;\r\n  SelectInputText: Effect;\r\n}\r\n\r\nconst DEBOUNCE_DELAY = 300;\r\n\r\nconst getValueString = (value: any, valueToString: CustomComboBoxProps<any>['valueToString']) => {\r\n  return value ? valueToString(value) : '';\r\n};\r\n\r\nexport const Effect: EffectFactory = {\r\n  Search: query => (dispatch, getState, getProps, getInstance) => {\r\n    getInstance().search(query);\r\n  },\r\n  DebouncedSearch: debounce((dispatch, getState, getProps, getInstance) => {\r\n    const searchEffect = Effect.Search(getState().textValue);\r\n    searchEffect(dispatch, getState, getProps, getInstance);\r\n  }, DEBOUNCE_DELAY),\r\n  CancelRequest: (dispatch, getState, getProps, getInstance) => {\r\n    Effect.DebouncedSearch.cancel();\r\n    getInstance().cancelSearch();\r\n  },\r\n  Blur: (dispatch, getState, getProps) => {\r\n    const { onBlur } = getProps();\r\n    if (onBlur) {\r\n      onBlur();\r\n    }\r\n  },\r\n  Focus: (dispatch, getState, getProps) => {\r\n    const { onFocus } = getProps();\r\n    if (onFocus) {\r\n      onFocus();\r\n    }\r\n  },\r\n  ValueChange: value => (dispatch, getState, getProps) => {\r\n    const { onValueChange } = getProps();\r\n    if (onValueChange) {\r\n      onValueChange(value);\r\n    }\r\n  },\r\n  UnexpectedInput: (textValue, items) => (dispatch, getState, getProps) => {\r\n    const { onUnexpectedInput, valueToString } = getProps();\r\n\r\n    if (Array.isArray(items) && items.length === 1) {\r\n      const singleItem = items[0];\r\n      const valueContent = getValueString(singleItem, valueToString);\r\n\r\n      if (valueContent === textValue) {\r\n        dispatch({ type: 'ValueChange', value: singleItem, keepFocus: false });\r\n        return;\r\n      }\r\n    }\r\n\r\n    if (onUnexpectedInput) {\r\n      const value = onUnexpectedInput(textValue);\r\n      if (value !== undefined) {\r\n        dispatch({ type: 'ValueChange', value, keepFocus: false });\r\n      }\r\n    }\r\n  },\r\n  InputChange: (dispatch, getState, getProps) => {\r\n    const { onInputValueChange } = getProps();\r\n    const { textValue } = getState();\r\n    if (onInputValueChange) {\r\n      const returnedValue = onInputValueChange(textValue);\r\n      if (typeof returnedValue === 'string' && returnedValue !== textValue) {\r\n        dispatch({ type: 'TextChange', value: returnedValue });\r\n      }\r\n    }\r\n  },\r\n  InputFocus: (dispatch, getState, getProps, getInstance) => {\r\n    const { input } = getInstance();\r\n\r\n    if (!input) {\r\n      return;\r\n    }\r\n\r\n    input.focus();\r\n  },\r\n  HighlightMenuItem: (dispatch, getState, getProps, getInstance) => {\r\n    const { value, itemToValue, valueToString } = getProps();\r\n    const { items, focused, textValue, requestStatus } = getState();\r\n    const { menu } = getInstance();\r\n    const valueString = getValueString(value, valueToString);\r\n\r\n    if (!menu) {\r\n      return;\r\n    }\r\n\r\n    if (!focused) {\r\n      return;\r\n    }\r\n\r\n    let index = -1;\r\n    if (items && items.length && value) {\r\n      index = items.findIndex(x => itemToValue(x) === itemToValue(value));\r\n    }\r\n    menu.highlightItem(index);\r\n\r\n    if (index >= 0) {\r\n      // FIXME: accessing private props\r\n      // @ts-ignore\r\n      process.nextTick(() => menu && menu.scrollToSelected());\r\n      return;\r\n    }\r\n\r\n    if (textValue !== valueString || requestStatus === ComboBoxRequestStatus.Failed) {\r\n      process.nextTick(() => menu && menu.down());\r\n    }\r\n  },\r\n  SelectMenuItem: event => (dispatch, getState, getProps, getInstance) => {\r\n    const { menu } = getInstance();\r\n    if (menu) {\r\n      menu.enter(event);\r\n    }\r\n  },\r\n  MoveMenuHighlight: direction => (dispatch, getState, getProps, getInstance) => {\r\n    const { menu } = getInstance();\r\n    if (menu) {\r\n      menu[direction]();\r\n    }\r\n  },\r\n  ResetHighlightedMenuItem: (dispatch, getState, getProps, getInstance) => {\r\n    const combobox = getInstance();\r\n\r\n    if (combobox.menu && combobox.menu.hasHighlightedItem()) {\r\n      combobox.menu.reset();\r\n    }\r\n  },\r\n  Reflow: () => {\r\n    LayoutEvents.emit();\r\n  },\r\n  SelectInputText: (dispatch, getState, getProps, getInstance) => {\r\n    const combobox = getInstance();\r\n    combobox.selectInputText();\r\n  },\r\n  InputKeyDown: event => (dispatch, getState, getProps, getInstance) => {\r\n    const { onInputKeyDown } = getProps();\r\n    if (onInputKeyDown) {\r\n      onInputKeyDown(event);\r\n    }\r\n  },\r\n};\r\n\r\nconst never = (_: never) => null;\r\n\r\nexport function reducer<T>(\r\n  state: CustomComboBoxState<T>,\r\n  props: CustomComboBoxProps<T>,\r\n  action: CustomComboBoxAction<T>,\r\n): Pick<CustomComboBoxState<T>, never> | [Pick<CustomComboBoxState<T>, never>, Array<CustomComboBoxEffect<T>>] {\r\n  switch (action.type) {\r\n    case 'ValueChange': {\r\n      const { value, keepFocus } = action;\r\n      const textValue = getValueString(value, props.valueToString);\r\n      if (keepFocus) {\r\n        return [\r\n          {\r\n            opened: false,\r\n            inputChanged: false,\r\n            editing: true,\r\n            items: null,\r\n            textValue,\r\n          },\r\n          [Effect.ValueChange(value), Effect.CancelRequest, Effect.InputFocus],\r\n        ];\r\n      }\r\n      return [\r\n        {\r\n          opened: false,\r\n          inputChanged: false,\r\n          editing: false,\r\n          items: null,\r\n          textValue,\r\n        },\r\n        [Effect.ValueChange(value), Effect.CancelRequest],\r\n      ];\r\n    }\r\n    case 'TextChange': {\r\n      const newState = {\r\n        inputChanged: true,\r\n        textValue: action.value,\r\n      };\r\n      if (!action.value && !props.searchOnFocus) {\r\n        return [\r\n          {\r\n            ...newState,\r\n            opened: false,\r\n            items: null,\r\n          },\r\n          [Effect.InputChange],\r\n        ];\r\n      }\r\n      return [newState, [Effect.DebouncedSearch, Effect.InputChange]];\r\n    }\r\n    case 'KeyPress': {\r\n      const e = action.event as React.KeyboardEvent<HTMLElement>;\r\n      const effects = [];\r\n      let nextState = state;\r\n\r\n      switch (true) {\r\n        case isKeyEnter(e):\r\n          e.preventDefault();\r\n          effects.push(Effect.SelectMenuItem(e));\r\n          break;\r\n        case isKeyArrowVertical(e):\r\n          e.preventDefault();\r\n          effects.push(Effect.MoveMenuHighlight(isKeyArrowUp(e) ? 'up' : 'down'));\r\n          if (!state.opened) {\r\n            effects.push(Effect.Search(state.textValue));\r\n          }\r\n          break;\r\n        case isKeyEscape(e):\r\n          nextState = {\r\n            ...state,\r\n            items: null,\r\n            opened: false,\r\n          };\r\n          break;\r\n      }\r\n      return [nextState, [...effects, Effect.InputKeyDown(e)]];\r\n    }\r\n    case 'DidUpdate': {\r\n      if (isEqual(props.value, action.prevProps.value)) {\r\n        return state;\r\n      }\r\n\r\n      return {\r\n        opened: false,\r\n        textValue: state.editing ? state.textValue : getValueString(props.value, props.valueToString),\r\n      };\r\n    }\r\n    case 'Mount': {\r\n      return {\r\n        textValue: getValueString(props.value, props.valueToString),\r\n      };\r\n    }\r\n    case 'Focus': {\r\n      const newState = {\r\n        focused: true,\r\n        editing: true,\r\n      };\r\n      if (!props.searchOnFocus) {\r\n        return [newState, [Effect.Focus]];\r\n      }\r\n      if (state.editing) {\r\n        return [newState, [Effect.Search(state.textValue), Effect.Focus]];\r\n      }\r\n      return [newState, [Effect.Search(''), Effect.Focus, Effect.SelectInputText]];\r\n    }\r\n    case 'InputClick': {\r\n      if (!state.opened && props.searchOnFocus) {\r\n        return [state, [Effect.Search('')]];\r\n      }\r\n      return state;\r\n    }\r\n    case 'Blur': {\r\n      const { inputChanged, items } = state;\r\n      if (!inputChanged) {\r\n        return [\r\n          {\r\n            focused: false,\r\n            opened: false,\r\n            items: null,\r\n            editing: false,\r\n          },\r\n          [Effect.Blur, Effect.CancelRequest],\r\n        ];\r\n      }\r\n\r\n      return [\r\n        {\r\n          focused: false,\r\n          opened: false,\r\n          items: null,\r\n        },\r\n        [Effect.Blur, Effect.CancelRequest, Effect.UnexpectedInput(state.textValue, items)],\r\n      ];\r\n    }\r\n    case 'Reset': {\r\n      return DefaultState;\r\n    }\r\n    case 'Open': {\r\n      return { opened: true };\r\n    }\r\n    case 'Close': {\r\n      return { opened: false, items: null };\r\n    }\r\n    case 'Search': {\r\n      return [state, [Effect.Search(action.query)]];\r\n    }\r\n    case 'RequestItems': {\r\n      return {\r\n        loading: true,\r\n        opened: true,\r\n        requestStatus: ComboBoxRequestStatus.Pending,\r\n      };\r\n    }\r\n    case 'ReceiveItems': {\r\n      const shouldResetMenuHighlight = state.textValue === '';\r\n      return [\r\n        {\r\n          loading: false,\r\n          opened: true,\r\n          items: action.items,\r\n          requestStatus: ComboBoxRequestStatus.Success,\r\n        },\r\n        [shouldResetMenuHighlight ? Effect.ResetHighlightedMenuItem : Effect.HighlightMenuItem, Effect.Reflow],\r\n      ];\r\n    }\r\n    case 'RequestFailure': {\r\n      return [\r\n        {\r\n          loading: false,\r\n          opened: true,\r\n          items: null,\r\n          requestStatus: ComboBoxRequestStatus.Failed,\r\n          repeatRequest: action.repeatRequest,\r\n        },\r\n        [Effect.HighlightMenuItem],\r\n      ];\r\n    }\r\n    case 'CancelRequest': {\r\n      return {\r\n        loading: false,\r\n        requestStatus: ComboBoxRequestStatus.Unknown,\r\n      };\r\n    }\r\n    default: {\r\n      never(action);\r\n    }\r\n  }\r\n  return state;\r\n}\r\n"]}