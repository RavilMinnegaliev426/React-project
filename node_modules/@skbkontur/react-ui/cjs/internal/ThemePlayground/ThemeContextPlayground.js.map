{"version":3,"sources":["ThemeContextPlayground.tsx"],"names":["ThemeContextPlayground","props","editableThemesItems","value","ThemeType","Default","label","Flat","Dark","renderSidePage","state","currentTheme","themesErrors","editingThemeItem","themes","themeErrors","handleClose","jsStyles","editorHeaderWrapper","getEditableThemesItems","handleEditingThemeSwitch","fontSize","marginTop","handelGetTheme","sidePageBody","handleThemeVariableChange","themeObject","ThemeFactory","getKeys","forEach","key","descriptor","Object","getOwnPropertyDescriptor","get","DEFAULT_THEME","console","log","JSON","stringify","handleOpen","setState","editorOpened","find","i","currentThemeType","handleThemeChange","themeType","variable","editingThemeType","theme","currentValue","canSetVariable","ColorFunctions","isValid","nextThemeErrors","stateUpdate","result","changeThemeVariable","query","Promise","resolve","filter","toLowerCase","includes","item","variableName","variableValue","findPropertyDescriptor","enumerable","configurable","set","defineProperty","create","default","dark","darkTheme","flat","FLAT_THEME","render","React","Component","propName","getPrototypeOf","prototype","hasOwnProperty","call"],"mappings":"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","sourcesContent":["import React, { ReactNode } from 'react';\r\n\r\nimport { ThemeContext } from '../../lib/theming/ThemeContext';\r\nimport { Theme, ThemeIn } from '../../lib/theming/Theme';\r\nimport { ThemeFactory } from '../../lib/theming/ThemeFactory';\r\nimport { FLAT_THEME } from '../../lib/theming/themes/FlatTheme';\r\nimport { DEFAULT_THEME } from '../../lib/theming/themes/DefaultTheme';\r\nimport { SidePage } from '../../components/SidePage';\r\nimport { Gapped } from '../../components/Gapped';\r\nimport { ComboBox } from '../../components/ComboBox';\r\nimport { Link } from '../../components/Link';\r\nimport * as ColorFunctions from '../../lib/styles/ColorFunctions';\r\nimport { Writeable } from '../../typings/utility-types';\r\n\r\nimport { ThemeEditor } from './ThemeEditor';\r\nimport { jsStyles } from './Playground.styles';\r\nimport { Playground } from './Playground';\r\nimport { darkTheme } from './darkTheme';\r\nimport { ThemeType } from './constants';\r\n\r\ninterface PlaygroundState {\r\n  editorOpened: boolean;\r\n  editingThemeItem?: EditingThemeItem;\r\n  themes: Themes;\r\n  themesErrors: ThemesErrors;\r\n  currentTheme: Theme;\r\n  currentThemeType: ThemeType;\r\n}\r\ninterface Themes {\r\n  default: Theme;\r\n  dark: Theme;\r\n  flat: Theme;\r\n}\r\ninterface ThemesErrors {\r\n  default: ThemeErrorsType;\r\n  dark: ThemeErrorsType;\r\n  flat: ThemeErrorsType;\r\n}\r\ninterface EditingThemeItem {\r\n  value: ThemeType;\r\n  label: string;\r\n}\r\ninterface PlaygroundProps {\r\n  children?: ReactNode;\r\n}\r\nexport type ThemeErrorsType = Writeable<{ [key in keyof Theme]?: boolean }>;\r\n\r\nexport class ThemeContextPlayground extends React.Component<PlaygroundProps, PlaygroundState> {\r\n  private readonly editableThemesItems = [\r\n    { value: ThemeType.Default, label: 'Дефолтная' },\r\n    { value: ThemeType.Flat, label: 'Плоская' },\r\n    { value: ThemeType.Dark, label: 'Темная' },\r\n  ];\r\n\r\n  constructor(props: PlaygroundProps) {\r\n    super(props);\r\n    this.state = {\r\n      currentTheme: DEFAULT_THEME,\r\n      currentThemeType: ThemeType.Default,\r\n      editorOpened: false,\r\n      themes: {\r\n        default: DEFAULT_THEME,\r\n        dark: darkTheme,\r\n        flat: FLAT_THEME,\r\n      },\r\n      themesErrors: {\r\n        default: {},\r\n        dark: {},\r\n        flat: {},\r\n      },\r\n    };\r\n  }\r\n\r\n  public render() {\r\n    const { currentTheme, editorOpened, currentThemeType } = this.state;\r\n    return (\r\n      <ThemeContext.Provider value={currentTheme}>\r\n        {editorOpened && this.renderSidePage()}\r\n        {\r\n          <Playground\r\n            onThemeChange={this.handleThemeChange}\r\n            currentThemeType={currentThemeType}\r\n            onEditLinkClick={this.handleOpen}\r\n          />\r\n        }\r\n      </ThemeContext.Provider>\r\n    );\r\n  }\r\n\r\n  private renderSidePage = () => {\r\n    const { currentTheme, themesErrors, editingThemeItem, themes } = this.state;\r\n    const themeErrors = themesErrors[editingThemeItem ? editingThemeItem.value : 'default'];\r\n    return (\r\n      <SidePage disableAnimations ignoreBackgroundClick blockBackground width={600} onClose={this.handleClose}>\r\n        <SidePage.Header>\r\n          <div className={jsStyles.editorHeaderWrapper(currentTheme)}>\r\n            <Gapped wrap verticalAlign=\"middle\">\r\n              <span>Тема для редактирования:</span>\r\n              <ComboBox\r\n                getItems={this.getEditableThemesItems}\r\n                value={editingThemeItem}\r\n                onValueChange={this.handleEditingThemeSwitch}\r\n              />\r\n            </Gapped>\r\n          </div>\r\n          <div style={{ fontSize: 14, marginTop: 8 }}>\r\n            <Link onClick={this.handelGetTheme}>Вывести тему в консоль</Link>\r\n          </div>\r\n        </SidePage.Header>\r\n        <SidePage.Body>\r\n          <div className={jsStyles.sidePageBody()}>\r\n            <ThemeEditor\r\n              editingTheme={themes[editingThemeItem!.value]}\r\n              currentTheme={currentTheme}\r\n              currentErrors={themeErrors}\r\n              onValueChange={this.handleThemeVariableChange}\r\n            />\r\n          </div>\r\n        </SidePage.Body>\r\n      </SidePage>\r\n    );\r\n  };\r\n\r\n  private handelGetTheme = () => {\r\n    const currentTheme = this.state.currentTheme;\r\n    const themeObject: Writeable<ThemeIn> = {};\r\n    ThemeFactory.getKeys(currentTheme).forEach(key => {\r\n      const descriptor = Object.getOwnPropertyDescriptor(currentTheme, key);\r\n      if (descriptor && !descriptor.get && DEFAULT_THEME[key] && currentTheme[key] !== DEFAULT_THEME[key]) {\r\n        themeObject[key] = currentTheme[key] as keyof Theme;\r\n      }\r\n    });\r\n\r\n    console.log(JSON.stringify(themeObject));\r\n  };\r\n\r\n  private handleOpen = () => {\r\n    this.setState(state => ({\r\n      editorOpened: true,\r\n      editingThemeItem: this.editableThemesItems.find(i => i.value === state.currentThemeType),\r\n    }));\r\n  };\r\n\r\n  private handleClose = () => {\r\n    this.setState({\r\n      editorOpened: false,\r\n    });\r\n  };\r\n\r\n  private handleThemeChange = (value: string) => {\r\n    const themeType = value as ThemeType;\r\n    this.setState({\r\n      currentThemeType: themeType,\r\n      currentTheme: this.state.themes[themeType],\r\n    });\r\n  };\r\n\r\n  private handleThemeVariableChange = (variable: keyof Theme, value: string) => {\r\n    const { editingThemeItem, currentTheme, themes, themesErrors } = this.state;\r\n    const editingThemeType = editingThemeItem!.value;\r\n\r\n    const theme = themes[editingThemeType];\r\n    const currentValue = theme[variable] as string;\r\n\r\n    let canSetVariable = true;\r\n    if (ColorFunctions.isValid(currentValue)) {\r\n      canSetVariable = ColorFunctions.isValid(value);\r\n      themesErrors[editingThemeType][variable] = !canSetVariable;\r\n    }\r\n\r\n    const nextThemeErrors: ThemesErrors = { ...themesErrors };\r\n    nextThemeErrors[editingThemeType][variable] = !canSetVariable;\r\n    const stateUpdate = { themes, currentTheme, themesErrors: nextThemeErrors };\r\n\r\n    if (canSetVariable) {\r\n      const result = this.changeThemeVariable(theme, variable, value);\r\n      stateUpdate.themes[editingThemeType] = result;\r\n      if (this.state.currentThemeType === editingThemeType) {\r\n        stateUpdate.currentTheme = result;\r\n      }\r\n    }\r\n\r\n    this.setState(stateUpdate);\r\n  };\r\n\r\n  private getEditableThemesItems = (query: string) => {\r\n    return Promise.resolve(this.editableThemesItems.filter(i => i.label.toLowerCase().includes(query.toLowerCase())));\r\n  };\r\n\r\n  private handleEditingThemeSwitch = (item: EditingThemeItem) => {\r\n    this.setState({ editingThemeItem: item });\r\n  };\r\n\r\n  private changeThemeVariable = (theme: Theme, variableName: keyof Theme, variableValue: string): Theme => {\r\n    const result: ThemeIn = {};\r\n    ThemeFactory.getKeys(theme).forEach(key => {\r\n      const descriptor = findPropertyDescriptor(theme, key);\r\n      descriptor.enumerable = true;\r\n      descriptor.configurable = true;\r\n      if (key === variableName) {\r\n        delete descriptor.get;\r\n        delete descriptor.set;\r\n        descriptor.value = variableValue;\r\n      }\r\n      Object.defineProperty(result, key, descriptor);\r\n    });\r\n\r\n    return ThemeFactory.create<ThemeIn>(result);\r\n  };\r\n}\r\n\r\nfunction findPropertyDescriptor(theme: Theme, propName: keyof Theme) {\r\n  for (; theme != null; theme = Object.getPrototypeOf(theme)) {\r\n    if (Object.prototype.hasOwnProperty.call(theme, propName)) {\r\n      return Object.getOwnPropertyDescriptor(theme, propName) || {};\r\n    }\r\n  }\r\n  return {};\r\n}\r\n"]}