{"version":3,"sources":["Menu.tsx"],"names":["Menu","state","highlightedIndex","theme","scrollContainer","highlighted","unmounted","refScrollContainer","scrollToSelected","scrollTo","ReactDOM","findDOMNode","scrollToTop","scrollToBottom","highlight","index","setState","unhighlight","componentWillUnmount","render","renderMain","up","move","down","enter","event","select","reset","hasHighlightedItem","highlightItem","enableIconPadding","React","Children","toArray","props","children","some","x","isValidElement","icon","isEmpty","jsStyles","root","shadow","hasShadow","width","maxHeight","preventWindowScroll","map","child","cloneElement","_enableIconPadding","ref","refHighlighted","bind","onClick","onMouseEnter","onMouseLeave","originalRef","menuItem","shouldHandleHref","item","childrenToArray","href","target","window","open","location","onItemClick","step","activeElements","filter","isActiveElement","length","indexOf","isExist","Component","__KONTUR_REACT_UI__","defaultProps","value","undefined","ret","forEach","push"],"mappings":"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","sourcesContent":["import React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport cn from 'classnames';\r\n\r\nimport { ScrollContainer } from '../../components/ScrollContainer';\r\nimport { isMenuItem, MenuItem, MenuItemProps } from '../../components/MenuItem';\r\nimport { isMenuHeader } from '../../components/MenuHeader';\r\nimport { Nullable } from '../../typings/utility-types';\r\nimport { ThemeContext } from '../../lib/theming/ThemeContext';\r\nimport { Theme } from '../../lib/theming/Theme';\r\n\r\nimport { jsStyles } from './Menu.styles';\r\nimport { isActiveElement } from './isActiveElement';\r\n\r\nexport interface MenuProps {\r\n  children: React.ReactNode;\r\n  hasShadow?: boolean;\r\n  maxHeight?: number | string;\r\n  onItemClick?: () => void;\r\n  width?: number | string;\r\n  preventWindowScroll?: boolean;\r\n}\r\n\r\nexport interface MenuState {\r\n  highlightedIndex: number;\r\n}\r\n\r\nexport class Menu extends React.Component<MenuProps, MenuState> {\r\n  public static __KONTUR_REACT_UI__ = 'Menu';\r\n\r\n  public static defaultProps = {\r\n    width: 'auto',\r\n    maxHeight: 300,\r\n    hasShadow: true,\r\n    preventWindowScroll: true,\r\n  };\r\n\r\n  public state = {\r\n    highlightedIndex: -1,\r\n  };\r\n\r\n  private theme!: Theme;\r\n  private scrollContainer: Nullable<ScrollContainer>;\r\n  private highlighted: Nullable<MenuItem>;\r\n  private unmounted = false;\r\n\r\n  public componentWillUnmount() {\r\n    this.unmounted = true;\r\n  }\r\n\r\n  public render() {\r\n    return (\r\n      <ThemeContext.Consumer>\r\n        {theme => {\r\n          this.theme = theme;\r\n          return this.renderMain();\r\n        }}\r\n      </ThemeContext.Consumer>\r\n    );\r\n  }\r\n\r\n  /**\r\n   * @public\r\n   */\r\n  public up() {\r\n    this.move(-1);\r\n  }\r\n\r\n  /**\r\n   * @public\r\n   */\r\n  public down() {\r\n    this.move(1);\r\n  }\r\n\r\n  /**\r\n   * @public\r\n   */\r\n  public enter(event: React.SyntheticEvent<HTMLElement>) {\r\n    return this.select(this.state.highlightedIndex, true, event);\r\n  }\r\n\r\n  /**\r\n   * @public\r\n   */\r\n  public reset() {\r\n    this.setState({ highlightedIndex: -1 });\r\n  }\r\n\r\n  /**\r\n   * @public\r\n   */\r\n  public hasHighlightedItem() {\r\n    return this.state.highlightedIndex !== -1;\r\n  }\r\n\r\n  public highlightItem(index: number) {\r\n    this.highlight(index);\r\n  }\r\n\r\n  private renderMain() {\r\n    const enableIconPadding = React.Children.toArray(this.props.children).some(\r\n      x => React.isValidElement(x) && x.props.icon,\r\n    );\r\n\r\n    if (this.isEmpty()) {\r\n      return null;\r\n    }\r\n\r\n    return (\r\n      <div\r\n        className={cn({\r\n          [jsStyles.root(this.theme)]: true,\r\n          [jsStyles.shadow(this.theme)]: this.props.hasShadow,\r\n        })}\r\n        style={{ width: this.props.width, maxHeight: this.props.maxHeight }}\r\n      >\r\n        <ScrollContainer\r\n          ref={this.refScrollContainer}\r\n          maxHeight={this.props.maxHeight}\r\n          preventWindowScroll={this.props.preventWindowScroll}\r\n        >\r\n          {React.Children.map(this.props.children, (child, index) => {\r\n            if (!child) {\r\n              return child;\r\n            }\r\n            if (typeof child === 'string' || typeof child === 'number') {\r\n              return child;\r\n            }\r\n\r\n            if (enableIconPadding && (isMenuItem(child) || isMenuHeader(child))) {\r\n              child = React.cloneElement(child, {\r\n                _enableIconPadding: true,\r\n              });\r\n            }\r\n            if (isActiveElement(child)) {\r\n              const highlight = this.state.highlightedIndex === index;\r\n\r\n              let ref = child.ref;\r\n              if (highlight && typeof child.ref !== 'string') {\r\n                ref = this.refHighlighted.bind(this, child.ref);\r\n              }\r\n\r\n              return React.cloneElement<MenuItemProps, MenuItem>(child, {\r\n                ref,\r\n                state: highlight ? 'hover' : child.props.state,\r\n                onClick: this.select.bind(this, index, false),\r\n                onMouseEnter: this.highlight.bind(this, index),\r\n                onMouseLeave: this.unhighlight,\r\n              });\r\n            }\r\n            return child;\r\n          })}\r\n        </ScrollContainer>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  private refScrollContainer = (scrollContainer: Nullable<ScrollContainer>) => {\r\n    this.scrollContainer = scrollContainer;\r\n  };\r\n\r\n  private refHighlighted(\r\n    originalRef: ((menuItem: MenuItem | null) => any) | React.RefObject<MenuItem> | null | undefined,\r\n    menuItem: MenuItem | null,\r\n  ) {\r\n    this.highlighted = menuItem;\r\n\r\n    if (typeof originalRef === 'function') {\r\n      originalRef(menuItem);\r\n    }\r\n  }\r\n\r\n  private scrollToSelected = () => {\r\n    if (this.scrollContainer && this.highlighted) {\r\n      this.scrollContainer.scrollTo(ReactDOM.findDOMNode(this.highlighted) as HTMLElement);\r\n    }\r\n  };\r\n\r\n  private scrollToTop = () => {\r\n    if (this.scrollContainer) {\r\n      this.scrollContainer.scrollToTop();\r\n    }\r\n  };\r\n\r\n  private scrollToBottom = () => {\r\n    if (this.scrollContainer) {\r\n      this.scrollContainer.scrollToBottom();\r\n    }\r\n  };\r\n\r\n  private select(index: number, shouldHandleHref: boolean, event: React.SyntheticEvent<HTMLElement>): boolean {\r\n    const item = childrenToArray(this.props.children)[index];\r\n    if (isActiveElement(item)) {\r\n      if (shouldHandleHref && item.props.href) {\r\n        if (item.props.target) {\r\n          window.open(item.props.href, item.props.target);\r\n        } else {\r\n          location.href = item.props.href;\r\n        }\r\n      }\r\n      if (item.props.onClick) {\r\n        item.props.onClick(event);\r\n      }\r\n      if (this.props.onItemClick) {\r\n        this.props.onItemClick();\r\n      }\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  private highlight = (index: number) => {\r\n    this.setState({ highlightedIndex: index });\r\n  };\r\n\r\n  private unhighlight = () => {\r\n    this.setState({ highlightedIndex: -1 });\r\n  };\r\n\r\n  private move(step: number) {\r\n    if (this.unmounted) {\r\n      // NOTE workaround, because `ComboBox` call `process.nextTick` in reducer\r\n      return;\r\n    }\r\n\r\n    const children = childrenToArray(this.props.children);\r\n    const activeElements = children.filter(isActiveElement);\r\n    if (!activeElements.length) {\r\n      return;\r\n    }\r\n    let index = this.state.highlightedIndex;\r\n    do {\r\n      index += step;\r\n      if (index < 0) {\r\n        index = children.length - 1;\r\n      } else if (index > children.length) {\r\n        index = 0;\r\n      }\r\n\r\n      const child = children[index];\r\n      if (isActiveElement(child)) {\r\n        this.setState({ highlightedIndex: index }, () => {\r\n          switch (activeElements.indexOf(child)) {\r\n            case 0:\r\n              this.scrollToTop();\r\n              break;\r\n            case activeElements.length - 1:\r\n              this.scrollToBottom();\r\n              break;\r\n            default:\r\n              this.scrollToSelected();\r\n          }\r\n        });\r\n        return;\r\n      }\r\n    } while (index !== this.state.highlightedIndex);\r\n  }\r\n\r\n  private isEmpty() {\r\n    const { children } = this.props;\r\n    return !children || !childrenToArray(children).filter(isExist).length;\r\n  }\r\n}\r\n\r\nfunction isExist(value: any): value is any {\r\n  return value !== null && value !== undefined;\r\n}\r\n\r\nfunction childrenToArray(children: React.ReactNode): React.ReactNode[] {\r\n  const ret: React.ReactNode[] = [];\r\n  // Use forEach instead of map to avoid cloning for key unifying.\r\n  React.Children.forEach(children, child => {\r\n    ret.push(child);\r\n  });\r\n  return ret;\r\n}\r\n"]}