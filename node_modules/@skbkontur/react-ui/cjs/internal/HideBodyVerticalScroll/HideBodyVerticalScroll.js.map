{"version":3,"sources":["HideBodyVerticalScroll.tsx"],"names":["HideBodyVerticalScroll","disposeDocumentStyle","initialScroll","master","updateScrollVisibility","document","documentElement","restoreStyles","clientHeight","scrollHeight","shouldRestore","VerticalScrollCounter","get","shouldHide","makeSomeMagicWithScroll","scrollTop","documentComputedStyle","getComputedStyle","scrollWidth","documentMargin","parseFloat","marginRight","documentStyle","generateDocumentStyle","attachStyle","element","style","classList","add","className","removeStyleNode","attachStylesheet","css","remove","componentDidMount","counter","increment","window","addEventListener","componentDidUpdate","componentWillUnmount","decrement","removeEventListener","render","React","Component","__KONTUR_REACT_UI__","hash","Math","random","toString","slice","RetailUIVerticalScrollCounter","generateClassName","name","sheet","createElement","setAttribute","styleSheet","cssText","textnode","createTextNode","appendChild","head","getElementsByTagName","contains","removeChild"],"mappings":"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","sourcesContent":["import React from 'react';\r\n\r\nimport { getScrollWidth } from '../../lib/dom/getScrollWidth';\r\n\r\nexport class HideBodyVerticalScroll extends React.Component {\r\n  public static __KONTUR_REACT_UI__ = 'HideBodyVerticalScroll';\r\n\r\n  public static hash = Math.random()\r\n    .toString(16)\r\n    .slice(2, 6);\r\n  private disposeDocumentStyle: (() => void) | null = null;\r\n  private initialScroll = 0;\r\n  private master = false;\r\n\r\n  public componentDidMount() {\r\n    const counter = VerticalScrollCounter.increment();\r\n    if (counter === 1) {\r\n      this.master = true;\r\n      this.initialScroll = document.documentElement ? document.documentElement.scrollTop : 0;\r\n      this.updateScrollVisibility();\r\n      window.addEventListener('resize', this.updateScrollVisibility);\r\n    }\r\n  }\r\n\r\n  public componentDidUpdate() {\r\n    if (this.master) {\r\n      this.updateScrollVisibility();\r\n    }\r\n  }\r\n\r\n  public componentWillUnmount() {\r\n    this.restoreStyles();\r\n\r\n    const counter = VerticalScrollCounter.decrement();\r\n    if (counter === 0) {\r\n      this.updateScrollVisibility();\r\n      window.removeEventListener('resize', this.updateScrollVisibility);\r\n    }\r\n  }\r\n\r\n  public render() {\r\n    return null;\r\n  }\r\n\r\n  private updateScrollVisibility = () => {\r\n    const { documentElement } = document;\r\n\r\n    this.restoreStyles();\r\n\r\n    if (!documentElement) {\r\n      return;\r\n    }\r\n\r\n    const { clientHeight, scrollHeight } = documentElement;\r\n    const shouldRestore = VerticalScrollCounter.get() === 0;\r\n    const shouldHide = !shouldRestore && clientHeight < scrollHeight;\r\n\r\n    if (shouldHide) {\r\n      this.makeSomeMagicWithScroll(documentElement);\r\n    }\r\n\r\n    if (shouldRestore) {\r\n      documentElement.scrollTop = this.initialScroll;\r\n    }\r\n  };\r\n\r\n  private makeSomeMagicWithScroll = (document: HTMLElement) => {\r\n    const documentComputedStyle = getComputedStyle(document);\r\n    const scrollWidth = getScrollWidth();\r\n    const documentMargin = parseFloat(documentComputedStyle.marginRight || '');\r\n    const documentStyle = generateDocumentStyle(documentMargin + scrollWidth);\r\n\r\n    this.disposeDocumentStyle = this.attachStyle(document, documentStyle);\r\n  };\r\n\r\n  private attachStyle = (element: HTMLElement, style: { css: string; className: string }) => {\r\n    element.classList.add(style.className);\r\n    const removeStyleNode = attachStylesheet(style.css);\r\n    return () => {\r\n      removeStyleNode();\r\n      element.classList.remove(style.className);\r\n    };\r\n  };\r\n\r\n  private restoreStyles = () => {\r\n    if (this.disposeDocumentStyle) {\r\n      this.disposeDocumentStyle();\r\n      this.disposeDocumentStyle = null;\r\n    }\r\n\r\n    // Forcing reflow for Firefix\r\n    attachStylesheet('html, body { height: auto; }')();\r\n  };\r\n}\r\n\r\nclass VerticalScrollCounter {\r\n  public static increment = (): number => {\r\n    const counter = window.RetailUIVerticalScrollCounter || 0;\r\n    return (window.RetailUIVerticalScrollCounter = counter + 1);\r\n  };\r\n\r\n  public static decrement = (): number => {\r\n    const counter = window.RetailUIVerticalScrollCounter || 0;\r\n    return (window.RetailUIVerticalScrollCounter = counter - 1);\r\n  };\r\n\r\n  public static get = (): number => {\r\n    return window.RetailUIVerticalScrollCounter || 0;\r\n  };\r\n}\r\n\r\nfunction generateClassName(className: string) {\r\n  const { name, hash } = HideBodyVerticalScroll;\r\n  return `${name}-${className}-${hash}`;\r\n}\r\n\r\nfunction generateDocumentStyle(documentMargin: number) {\r\n  const className = generateClassName('document');\r\n  const css = `\\\r\n.${className} {\r\n  overflow: hidden !important;\r\n  margin-right: ${documentMargin}px !important;\r\n  height: 100%;\r\n}\r\n`;\r\n  return { className, css };\r\n}\r\n\r\nfunction attachStylesheet(sheet: string) {\r\n  const style = document.createElement('style');\r\n  style.setAttribute('type', 'text/css');\r\n  // @ts-ignore IE specific api\r\n  if (style.styleSheet) {\r\n    // @ts-ignore IE specific api\r\n    style.styleSheet.cssText = sheet;\r\n  } else {\r\n    const textnode = document.createTextNode(sheet);\r\n    style.appendChild(textnode);\r\n  }\r\n  const head = document.getElementsByTagName('head')[0];\r\n  head.appendChild(style);\r\n  return () => {\r\n    if (head.contains(style)) {\r\n      head.removeChild(style);\r\n    }\r\n  };\r\n}\r\n"]}