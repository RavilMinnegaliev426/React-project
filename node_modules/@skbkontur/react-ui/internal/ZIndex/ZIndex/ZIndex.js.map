{"version":3,"sources":["ZIndex.tsx"],"names":["React","incrementZIndex","removeZIndex","upperBorder","ZIndexContext","createContext","parentLayerZIndex","maxZIndex","Infinity","displayName","ZIndex","props","zIndex","priority","delta","componentWillUnmount","render","style","children","applyZIndex","coverChildren","createStackingContext","wrapperRef","wrapperStyle","zIndexContexValue","newZIndex","calcZIndex","Number","isFinite","document","body","isolation","transform","allowedValuesIntervalLength","scale","Math","ceil","Component","__KONTUR_REACT_UI__","defaultProps","propTypes","Error","trunc"],"mappings":"oOAAA,OAAOA,KAAP,MAAkB,OAAlB;;AAEA,SAASC,eAAT,EAA0BC,YAA1B,EAAwCC,WAAxC,QAA+E,iBAA/E;;AAEA,IAAMC,aAAa,GAAGJ,KAAK,CAACK,aAAN,CAAoB,EAAEC,iBAAiB,EAAE,CAArB,EAAwBC,SAAS,EAAEC,QAAnC,EAApB,CAAtB;;AAEAJ,aAAa,CAACK,WAAd,GAA4B,eAA5B;;;;;;;;;;;;;;;;AAgBA,WAAaC,MAAb;;;;;;;;;;;;;;;;;;;;;;;;;AAyBE,kBAAYC,KAAZ,EAAgC;AAC9B,wCAAMA,KAAN,UAD8B,MAFxBC,MAEwB,GAFf,CAEe;AAE9B,UAAKA,MAAL,GAAcX,eAAe,CAACU,KAAK,CAACE,QAAP,EAAiBF,KAAK,CAACG,KAAvB,CAA7B,CAF8B;AAG/B,GA5BH;;AA8BSC,EAAAA,oBA9BT,GA8BE,gCAA8B;AAC5Bb,IAAAA,YAAY,CAAC,KAAKU,MAAN,CAAZ;AACD,GAhCH;;AAkCSI,EAAAA,MAlCT,GAkCE,kBAAgB;;;;;;;;;;;AAWV,SAAKL,KAXK,CAEZM,KAFY,eAEZA,KAFY,CAGZC,QAHY,eAGZA,QAHY,CAIZJ,KAJY,eAIZA,KAJY,CAKZD,QALY,eAKZA,QALY,CAMZM,WANY,eAMZA,WANY,CAOZC,aAPY,eAOZA,aAPY,CAQZC,qBARY,eAQZA,qBARY,CASZC,UATY,eASZA,UATY,CAUTX,KAVS;;AAad,QAAMY,YAAiC,GAAG,EAA1C;;AAEA;AACE,0BAAC,aAAD,CAAe,QAAf;AACG,sBAAsC,KAAnCjB,iBAAmC,QAAnCA,iBAAmC,CAAhBC,SAAgB,QAAhBA,SAAgB;AACrC,YAAIiB,iBAAiB,GAAG,EAAElB,iBAAiB,EAAjBA,iBAAF,EAAqBC,SAAS,EAATA,SAArB,EAAxB;;AAEA,YAAIY,WAAJ,EAAiB;AACf,cAAMM,SAAS,GAAG,MAAI,CAACC,UAAL,CAAgBpB,iBAAhB,EAAmCC,SAAnC,CAAlB;AACAgB,UAAAA,YAAY,CAACX,MAAb,GAAsBa,SAAtB;;AAEAD,UAAAA,iBAAiB,GAAGJ,aAAa;AAC7B,YAAEd,iBAAiB,EAAjBA,iBAAF,EAAqBC,SAAS,EAAEkB,SAAhC,EAD6B;AAE7B,YAAEnB,iBAAiB,EAAEmB,SAArB,EAAgClB,SAAS,EAAEoB,MAAM,CAACC,QAAP,CAAgBrB,SAAhB,IAA6BkB,SAA7B,GAAyCjB,QAApF,EAFJ;;AAIA,cAAIa,qBAAJ,EAA2B;AACzB,2BAAeQ,QAAQ,CAACC,IAAT,CAAcb,KAA7B;AACKM,YAAAA,YAAY,CAACQ,SAAb,GAAyB,SAD9B;AAEKR,YAAAA,YAAY,CAACS,SAAb,GAAyB,WAF9B;AAGD;AACF;;AAED;AACE,8BAAC,aAAD,CAAe,QAAf,IAAwB,KAAK,EAAER,iBAA/B;AACE,gDAAK,KAAK,eAAOP,KAAP,MAAiBM,YAAjB,CAAV,EAA2C,GAAG,EAAED,UAAhD,IAAgEX,KAAhE;AACGO,UAAAA,QADH,CADF,CADF;;;;AAOD,OA1BH,CADF;;;AA8BD,GA/EH;;AAiFUQ,EAAAA,UAjFV,GAiFE,oBAAmBpB,iBAAnB,EAA8CC,SAA9C,EAAiE;AAC/D,QAAIkB,SAAS,GAAG,KAAKb,MAArB;;AAEA,QAAIe,MAAM,CAACC,QAAP,CAAgBrB,SAAhB,CAAJ,EAAgC;AAC9B,UAAM0B,2BAA2B,GAAG1B,SAAS,GAAGD,iBAAhD;AACA,UAAM4B,KAAK,GAAG/B,WAAW,GAAG8B,2BAA5B;AACAR,MAAAA,SAAS,GAAGU,IAAI,CAACC,IAAL,CAAUX,SAAS,GAAGS,KAAtB,CAAZ;AACD;;AAEDT,IAAAA,SAAS,IAAInB,iBAAb;;AAEA,WAAOmB,SAAP;AACD,GA7FH,iBAA4BzB,KAAK,CAACqC,SAAlC,EAAa3B,M,CACG4B,mB,GAAsB,Q,CADzB5B,M,CAGG6B,Y,GAAe,EAC3BzB,KAAK,EAAE,EADoB,EAE3BD,QAAQ,EAAE,CAFiB,EAG3BI,KAAK,EAAE,EAHoB,EAI3BE,WAAW,EAAE,IAJc,EAK3BC,aAAa,EAAE,KALY,EAM3BC,qBAAqB,EAAE,KANI,E,CAHlBX,M,CAYG8B,S,GAAY,EACxB1B,KADwB,iBAClBH,KADkB,EACE,CACxB,IAAIA,KAAK,CAACG,KAAN,IAAe,CAAnB,EAAsB,CACpB,OAAO,IAAI2B,KAAJ,8DAAqE9B,KAAK,CAACG,KAA3E,CAAP,CACD,CACD,IAAIqB,IAAI,CAACO,KAAL,CAAW/B,KAAK,CAACG,KAAjB,MAA4BH,KAAK,CAACG,KAAtC,EAA6C,CAC3C,OAAO,IAAI2B,KAAJ,uDAA8D9B,KAAK,CAACG,KAApE,CAAP,CACD,CACF,CARuB,E","sourcesContent":["import React from 'react';\r\n\r\nimport { incrementZIndex, removeZIndex, upperBorder, LayerComponentName } from './ZIndexStorage';\r\n\r\nconst ZIndexContext = React.createContext({ parentLayerZIndex: 0, maxZIndex: Infinity });\r\n\r\nZIndexContext.displayName = 'ZIndexContext';\r\n\r\nexport interface ZIndexProps extends React.HTMLAttributes<HTMLDivElement> {\r\n  /**\r\n   * Приращение к z-index\r\n   */\r\n  delta: number;\r\n  priority: number | LayerComponentName;\r\n  style: React.CSSProperties;\r\n  createStackingContext?: boolean;\r\n  coverChildren?: boolean;\r\n  applyZIndex?: boolean;\r\n  className?: string;\r\n  wrapperRef?: React.Ref<HTMLDivElement> | undefined | null;\r\n}\r\n\r\nexport class ZIndex extends React.Component<ZIndexProps> {\r\n  public static __KONTUR_REACT_UI__ = 'ZIndex';\r\n\r\n  public static defaultProps = {\r\n    delta: 10,\r\n    priority: 0,\r\n    style: {},\r\n    applyZIndex: true,\r\n    coverChildren: false,\r\n    createStackingContext: false,\r\n  };\r\n\r\n  public static propTypes = {\r\n    delta(props: ZIndexProps) {\r\n      if (props.delta <= 0) {\r\n        return new Error(`[ZIndex]: Prop 'delta' must be greater than 0, received ${props.delta}`);\r\n      }\r\n      if (Math.trunc(props.delta) !== props.delta) {\r\n        return new Error(`[ZIndex]: Prop 'delta' must be integer, received ${props.delta}`);\r\n      }\r\n    },\r\n  };\r\n\r\n  private zIndex = 0;\r\n\r\n  constructor(props: ZIndexProps) {\r\n    super(props);\r\n    this.zIndex = incrementZIndex(props.priority, props.delta);\r\n  }\r\n\r\n  public componentWillUnmount() {\r\n    removeZIndex(this.zIndex);\r\n  }\r\n\r\n  public render() {\r\n    const {\r\n      style,\r\n      children,\r\n      delta,\r\n      priority,\r\n      applyZIndex,\r\n      coverChildren,\r\n      createStackingContext,\r\n      wrapperRef,\r\n      ...props\r\n    } = this.props;\r\n\r\n    const wrapperStyle: React.CSSProperties = {};\r\n\r\n    return (\r\n      <ZIndexContext.Consumer>\r\n        {({ parentLayerZIndex, maxZIndex }) => {\r\n          let zIndexContexValue = { parentLayerZIndex, maxZIndex };\r\n\r\n          if (applyZIndex) {\r\n            const newZIndex = this.calcZIndex(parentLayerZIndex, maxZIndex);\r\n            wrapperStyle.zIndex = newZIndex;\r\n\r\n            zIndexContexValue = coverChildren\r\n              ? { parentLayerZIndex, maxZIndex: newZIndex }\r\n              : { parentLayerZIndex: newZIndex, maxZIndex: Number.isFinite(maxZIndex) ? newZIndex : Infinity };\r\n\r\n            if (createStackingContext) {\r\n              'isolation' in document.body.style\r\n                ? (wrapperStyle.isolation = 'isolate')\r\n                : (wrapperStyle.transform = 'rotate(0)');\r\n            }\r\n          }\r\n\r\n          return (\r\n            <ZIndexContext.Provider value={zIndexContexValue}>\r\n              <div style={{ ...style, ...wrapperStyle }} ref={wrapperRef} {...props}>\r\n                {children}\r\n              </div>\r\n            </ZIndexContext.Provider>\r\n          );\r\n        }}\r\n      </ZIndexContext.Consumer>\r\n    );\r\n  }\r\n\r\n  private calcZIndex(parentLayerZIndex: number, maxZIndex: number) {\r\n    let newZIndex = this.zIndex;\r\n\r\n    if (Number.isFinite(maxZIndex)) {\r\n      const allowedValuesIntervalLength = maxZIndex - parentLayerZIndex;\r\n      const scale = upperBorder / allowedValuesIntervalLength;\r\n      newZIndex = Math.ceil(newZIndex / scale);\r\n    }\r\n\r\n    newZIndex += parentLayerZIndex;\r\n\r\n    return newZIndex;\r\n  }\r\n}\r\n"]}