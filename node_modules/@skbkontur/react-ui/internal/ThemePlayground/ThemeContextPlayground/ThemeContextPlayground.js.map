{"version":3,"sources":["ThemeContextPlayground.tsx"],"names":["React","ThemeContext","ThemeFactory","FLAT_THEME","DEFAULT_THEME","SidePage","Gapped","ComboBox","Link","ColorFunctions","ThemeEditor","jsStyles","Playground","darkTheme","ThemeType","ThemeContextPlayground","props","editableThemesItems","value","Default","label","Flat","Dark","renderSidePage","state","currentTheme","themesErrors","editingThemeItem","themes","themeErrors","handleClose","editorHeaderWrapper","getEditableThemesItems","handleEditingThemeSwitch","fontSize","marginTop","handelGetTheme","sidePageBody","handleThemeVariableChange","themeObject","getKeys","forEach","key","descriptor","Object","getOwnPropertyDescriptor","get","console","log","JSON","stringify","handleOpen","setState","editorOpened","find","i","currentThemeType","handleThemeChange","themeType","variable","editingThemeType","theme","currentValue","canSetVariable","isValid","nextThemeErrors","stateUpdate","result","changeThemeVariable","query","Promise","resolve","filter","toLowerCase","includes","item","variableName","variableValue","findPropertyDescriptor","enumerable","configurable","set","defineProperty","create","dark","flat","render","Component","propName","getPrototypeOf","prototype","hasOwnProperty","call"],"mappings":"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","sourcesContent":["import React, { ReactNode } from 'react';\r\n\r\nimport { ThemeContext } from '../../lib/theming/ThemeContext';\r\nimport { Theme, ThemeIn } from '../../lib/theming/Theme';\r\nimport { ThemeFactory } from '../../lib/theming/ThemeFactory';\r\nimport { FLAT_THEME } from '../../lib/theming/themes/FlatTheme';\r\nimport { DEFAULT_THEME } from '../../lib/theming/themes/DefaultTheme';\r\nimport { SidePage } from '../../components/SidePage';\r\nimport { Gapped } from '../../components/Gapped';\r\nimport { ComboBox } from '../../components/ComboBox';\r\nimport { Link } from '../../components/Link';\r\nimport * as ColorFunctions from '../../lib/styles/ColorFunctions';\r\nimport { Writeable } from '../../typings/utility-types';\r\n\r\nimport { ThemeEditor } from './ThemeEditor';\r\nimport { jsStyles } from './Playground.styles';\r\nimport { Playground } from './Playground';\r\nimport { darkTheme } from './darkTheme';\r\nimport { ThemeType } from './constants';\r\n\r\ninterface PlaygroundState {\r\n  editorOpened: boolean;\r\n  editingThemeItem?: EditingThemeItem;\r\n  themes: Themes;\r\n  themesErrors: ThemesErrors;\r\n  currentTheme: Theme;\r\n  currentThemeType: ThemeType;\r\n}\r\ninterface Themes {\r\n  default: Theme;\r\n  dark: Theme;\r\n  flat: Theme;\r\n}\r\ninterface ThemesErrors {\r\n  default: ThemeErrorsType;\r\n  dark: ThemeErrorsType;\r\n  flat: ThemeErrorsType;\r\n}\r\ninterface EditingThemeItem {\r\n  value: ThemeType;\r\n  label: string;\r\n}\r\ninterface PlaygroundProps {\r\n  children?: ReactNode;\r\n}\r\nexport type ThemeErrorsType = Writeable<{ [key in keyof Theme]?: boolean }>;\r\n\r\nexport class ThemeContextPlayground extends React.Component<PlaygroundProps, PlaygroundState> {\r\n  private readonly editableThemesItems = [\r\n    { value: ThemeType.Default, label: 'Дефолтная' },\r\n    { value: ThemeType.Flat, label: 'Плоская' },\r\n    { value: ThemeType.Dark, label: 'Темная' },\r\n  ];\r\n\r\n  constructor(props: PlaygroundProps) {\r\n    super(props);\r\n    this.state = {\r\n      currentTheme: DEFAULT_THEME,\r\n      currentThemeType: ThemeType.Default,\r\n      editorOpened: false,\r\n      themes: {\r\n        default: DEFAULT_THEME,\r\n        dark: darkTheme,\r\n        flat: FLAT_THEME,\r\n      },\r\n      themesErrors: {\r\n        default: {},\r\n        dark: {},\r\n        flat: {},\r\n      },\r\n    };\r\n  }\r\n\r\n  public render() {\r\n    const { currentTheme, editorOpened, currentThemeType } = this.state;\r\n    return (\r\n      <ThemeContext.Provider value={currentTheme}>\r\n        {editorOpened && this.renderSidePage()}\r\n        {\r\n          <Playground\r\n            onThemeChange={this.handleThemeChange}\r\n            currentThemeType={currentThemeType}\r\n            onEditLinkClick={this.handleOpen}\r\n          />\r\n        }\r\n      </ThemeContext.Provider>\r\n    );\r\n  }\r\n\r\n  private renderSidePage = () => {\r\n    const { currentTheme, themesErrors, editingThemeItem, themes } = this.state;\r\n    const themeErrors = themesErrors[editingThemeItem ? editingThemeItem.value : 'default'];\r\n    return (\r\n      <SidePage disableAnimations ignoreBackgroundClick blockBackground width={600} onClose={this.handleClose}>\r\n        <SidePage.Header>\r\n          <div className={jsStyles.editorHeaderWrapper(currentTheme)}>\r\n            <Gapped wrap verticalAlign=\"middle\">\r\n              <span>Тема для редактирования:</span>\r\n              <ComboBox\r\n                getItems={this.getEditableThemesItems}\r\n                value={editingThemeItem}\r\n                onValueChange={this.handleEditingThemeSwitch}\r\n              />\r\n            </Gapped>\r\n          </div>\r\n          <div style={{ fontSize: 14, marginTop: 8 }}>\r\n            <Link onClick={this.handelGetTheme}>Вывести тему в консоль</Link>\r\n          </div>\r\n        </SidePage.Header>\r\n        <SidePage.Body>\r\n          <div className={jsStyles.sidePageBody()}>\r\n            <ThemeEditor\r\n              editingTheme={themes[editingThemeItem!.value]}\r\n              currentTheme={currentTheme}\r\n              currentErrors={themeErrors}\r\n              onValueChange={this.handleThemeVariableChange}\r\n            />\r\n          </div>\r\n        </SidePage.Body>\r\n      </SidePage>\r\n    );\r\n  };\r\n\r\n  private handelGetTheme = () => {\r\n    const currentTheme = this.state.currentTheme;\r\n    const themeObject: Writeable<ThemeIn> = {};\r\n    ThemeFactory.getKeys(currentTheme).forEach(key => {\r\n      const descriptor = Object.getOwnPropertyDescriptor(currentTheme, key);\r\n      if (descriptor && !descriptor.get && DEFAULT_THEME[key] && currentTheme[key] !== DEFAULT_THEME[key]) {\r\n        themeObject[key] = currentTheme[key] as keyof Theme;\r\n      }\r\n    });\r\n\r\n    console.log(JSON.stringify(themeObject));\r\n  };\r\n\r\n  private handleOpen = () => {\r\n    this.setState(state => ({\r\n      editorOpened: true,\r\n      editingThemeItem: this.editableThemesItems.find(i => i.value === state.currentThemeType),\r\n    }));\r\n  };\r\n\r\n  private handleClose = () => {\r\n    this.setState({\r\n      editorOpened: false,\r\n    });\r\n  };\r\n\r\n  private handleThemeChange = (value: string) => {\r\n    const themeType = value as ThemeType;\r\n    this.setState({\r\n      currentThemeType: themeType,\r\n      currentTheme: this.state.themes[themeType],\r\n    });\r\n  };\r\n\r\n  private handleThemeVariableChange = (variable: keyof Theme, value: string) => {\r\n    const { editingThemeItem, currentTheme, themes, themesErrors } = this.state;\r\n    const editingThemeType = editingThemeItem!.value;\r\n\r\n    const theme = themes[editingThemeType];\r\n    const currentValue = theme[variable] as string;\r\n\r\n    let canSetVariable = true;\r\n    if (ColorFunctions.isValid(currentValue)) {\r\n      canSetVariable = ColorFunctions.isValid(value);\r\n      themesErrors[editingThemeType][variable] = !canSetVariable;\r\n    }\r\n\r\n    const nextThemeErrors: ThemesErrors = { ...themesErrors };\r\n    nextThemeErrors[editingThemeType][variable] = !canSetVariable;\r\n    const stateUpdate = { themes, currentTheme, themesErrors: nextThemeErrors };\r\n\r\n    if (canSetVariable) {\r\n      const result = this.changeThemeVariable(theme, variable, value);\r\n      stateUpdate.themes[editingThemeType] = result;\r\n      if (this.state.currentThemeType === editingThemeType) {\r\n        stateUpdate.currentTheme = result;\r\n      }\r\n    }\r\n\r\n    this.setState(stateUpdate);\r\n  };\r\n\r\n  private getEditableThemesItems = (query: string) => {\r\n    return Promise.resolve(this.editableThemesItems.filter(i => i.label.toLowerCase().includes(query.toLowerCase())));\r\n  };\r\n\r\n  private handleEditingThemeSwitch = (item: EditingThemeItem) => {\r\n    this.setState({ editingThemeItem: item });\r\n  };\r\n\r\n  private changeThemeVariable = (theme: Theme, variableName: keyof Theme, variableValue: string): Theme => {\r\n    const result: ThemeIn = {};\r\n    ThemeFactory.getKeys(theme).forEach(key => {\r\n      const descriptor = findPropertyDescriptor(theme, key);\r\n      descriptor.enumerable = true;\r\n      descriptor.configurable = true;\r\n      if (key === variableName) {\r\n        delete descriptor.get;\r\n        delete descriptor.set;\r\n        descriptor.value = variableValue;\r\n      }\r\n      Object.defineProperty(result, key, descriptor);\r\n    });\r\n\r\n    return ThemeFactory.create<ThemeIn>(result);\r\n  };\r\n}\r\n\r\nfunction findPropertyDescriptor(theme: Theme, propName: keyof Theme) {\r\n  for (; theme != null; theme = Object.getPrototypeOf(theme)) {\r\n    if (Object.prototype.hasOwnProperty.call(theme, propName)) {\r\n      return Object.getOwnPropertyDescriptor(theme, propName) || {};\r\n    }\r\n  }\r\n  return {};\r\n}\r\n"]}