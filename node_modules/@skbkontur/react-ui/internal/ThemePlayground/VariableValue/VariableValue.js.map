{"version":3,"sources":["VariableValue.tsx"],"names":["React","EditIcon","DeleteIcon","EventEmitter","Input","Gapped","Link","Hint","isFunction","jsStyles","emitter","VariableValue","state","value","props","editing","subscription","inputInstance","debounceTimeout","debounceInterval","undefined","renderBaseVariableLink","baseVariables","baseVariableRoot","colorIcon","baseLinkWrapper","textAlign","map","v","emitClickEvent","handleEditLinkClick","renderInputWrapper","renderInput","renderRollbackIcon","inputRef","instance","background","setState","rollbackToBaseVariable","variable","emit","handleChange","window","setInterval","debounceHandler","onChange","clearInterval","handleBlur","emitterEventHandler","name","focus","render","theme","variableName","length","componentDidMount","remove","removeListener","componentDidUpdate","prevProps","componentWillUnmount","isColor","isError","linkRoot","Component","BaseVariableLink","baseVariable","color","style","Option","startsWith"],"mappings":"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","sourcesContent":["import React from 'react';\r\nimport EditIcon from '@skbkontur/react-icons/Edit';\r\nimport DeleteIcon from '@skbkontur/react-icons/Delete';\r\nimport EventEmitter from 'eventemitter3';\r\n\r\nimport { Input } from '../../components/Input';\r\nimport { Gapped } from '../../components/Gapped';\r\nimport { Theme } from '../../lib/theming/Theme';\r\nimport { Link } from '../../components/Link';\r\nimport { Hint } from '../../components/Hint';\r\nimport { isFunction } from '../../lib/utils';\r\n\r\nimport { jsStyles } from './Playground.styles';\r\n\r\nconst emitter = new EventEmitter();\r\n\r\nexport interface VariableValueProps {\r\n  onChange: (variable: keyof Theme, value: string) => void;\r\n  value: string;\r\n  isError: boolean;\r\n  variable: string;\r\n  theme: Theme;\r\n  baseVariables: Array<keyof Theme>;\r\n}\r\n\r\nexport interface VariableValueState {\r\n  value: string;\r\n  editing: boolean;\r\n}\r\n\r\nexport class VariableValue extends React.Component<VariableValueProps, VariableValueState> {\r\n  public state = {\r\n    value: this.props.value,\r\n    editing: false,\r\n  };\r\n  private subscription: { remove: () => void } | null = null;\r\n  private inputInstance: Input | null = null;\r\n  private readonly debounceTimeout = 500;\r\n  private debounceInterval: number | undefined = undefined;\r\n\r\n  public render() {\r\n    const { variable, theme, baseVariables } = this.props;\r\n    return (\r\n      <Gapped gap={30}>\r\n        <div className={jsStyles.variableName(theme)} title={variable}>{`${variable}: `}</div>\r\n        {baseVariables.length > 0 && !this.state.editing ? this.renderBaseVariableLink() : this.renderInputWrapper()}\r\n      </Gapped>\r\n    );\r\n  }\r\n\r\n  public componentDidMount(): void {\r\n    if (!this.subscription) {\r\n      this.subscription = {\r\n        remove: () => {\r\n          emitter.removeListener('clicked', this.emitterEventHandler);\r\n        },\r\n      };\r\n    }\r\n  }\r\n\r\n  public componentDidUpdate(prevProps: VariableValueProps) {\r\n    if (prevProps.value !== this.props.value) {\r\n      this.setState({ value: this.props.value });\r\n    }\r\n  }\r\n\r\n  public componentWillUnmount(): void {\r\n    if (this.subscription) {\r\n      this.subscription.remove();\r\n    }\r\n    if (this.debounceInterval !== undefined) {\r\n      clearInterval(this.debounceInterval);\r\n    }\r\n  }\r\n\r\n  private renderBaseVariableLink = () => {\r\n    const baseVariables = this.props.baseVariables;\r\n    return (\r\n      <div className={jsStyles.baseVariableRoot()}>\r\n        {this.colorIcon()}\r\n        <div className={jsStyles.baseLinkWrapper()}>\r\n          <Gapped>\r\n            <div style={{ textAlign: 'right' }}>\r\n              <Gapped vertical>\r\n                {baseVariables.map(v => (\r\n                  <BaseVariableLink key={v} baseVariable={v} emitClickEvent={this.emitClickEvent} />\r\n                ))}\r\n              </Gapped>\r\n            </div>\r\n            <Hint text={'Изменить значение'}>\r\n              <Link icon={<EditIcon />} onClick={this.handleEditLinkClick} />\r\n            </Hint>\r\n          </Gapped>\r\n        </div>\r\n      </div>\r\n    );\r\n  };\r\n\r\n  private renderInputWrapper = () => {\r\n    return this.state.editing ? (\r\n      <Gapped>\r\n        {this.renderInput()}\r\n        {this.renderRollbackIcon()}\r\n      </Gapped>\r\n    ) : (\r\n      this.renderInput()\r\n    );\r\n  };\r\n\r\n  private renderInput() {\r\n    return (\r\n      <Input\r\n        leftIcon={isColor(this.state.value) && this.colorIcon()}\r\n        value={this.state.value}\r\n        onValueChange={this.handleChange}\r\n        onBlur={this.handleBlur}\r\n        align={'right'}\r\n        width={this.state.editing ? 225 : undefined}\r\n        ref={this.inputRef}\r\n        error={this.props.isError}\r\n      />\r\n    );\r\n  }\r\n\r\n  private renderRollbackIcon() {\r\n    return (\r\n      <Hint text={'Вернуться к базовой переменной'} pos={'left'}>\r\n        <div className={jsStyles.linkRoot()}>\r\n          <Link icon={<DeleteIcon />} onClick={this.rollbackToBaseVariable} />\r\n        </div>\r\n      </Hint>\r\n    );\r\n  }\r\n\r\n  private inputRef = (instance: Input) => {\r\n    this.inputInstance = instance;\r\n  };\r\n\r\n  private colorIcon = () => {\r\n    return <div className={jsStyles.colorIcon()} style={{ background: this.state.value }} />;\r\n  };\r\n\r\n  private handleEditLinkClick = () => {\r\n    this.setState({\r\n      editing: true,\r\n    });\r\n  };\r\n\r\n  private rollbackToBaseVariable = () => {\r\n    this.setState({\r\n      editing: false,\r\n      value: this.props.value,\r\n    });\r\n  };\r\n\r\n  private emitClickEvent = (variable: string | number) => {\r\n    emitter.emit('clicked', variable);\r\n  };\r\n\r\n  private handleChange = (value: string) => {\r\n    this.setState({\r\n      value,\r\n    });\r\n\r\n    if (this.debounceInterval === undefined) {\r\n      this.debounceInterval = window.setInterval(this.debounceHandler, this.debounceTimeout);\r\n    }\r\n  };\r\n\r\n  private debounceHandler = () => {\r\n    const { variable, onChange } = this.props;\r\n\r\n    onChange(variable as keyof Theme, this.state.value);\r\n    clearInterval(this.debounceInterval);\r\n    this.debounceInterval = undefined;\r\n  };\r\n\r\n  private handleBlur = () => {\r\n    this.setState({\r\n      editing: false,\r\n    });\r\n  };\r\n\r\n  private emitterEventHandler = (name: keyof Theme) => {\r\n    if (name === this.props.variable && this.inputInstance) {\r\n      this.inputInstance.focus();\r\n    }\r\n  };\r\n}\r\n\r\ninterface BaseVariableLinkProps {\r\n  baseVariable: string | number;\r\n  emitClickEvent: (baseVariable: string | number) => void;\r\n}\r\nclass BaseVariableLink extends React.Component<BaseVariableLinkProps> {\r\n  public render() {\r\n    return <Link onClick={this.emitClickEvent}>{this.props.baseVariable}</Link>;\r\n  }\r\n  private emitClickEvent = () => {\r\n    this.props.emitClickEvent(this.props.baseVariable);\r\n  };\r\n}\r\n\r\nfunction isColor(color: string | (() => string)) {\r\n  if (isFunction(color)) {\r\n    color = color();\r\n  }\r\n  const style = new Option().style;\r\n  style.color = color;\r\n\r\n  return (\r\n    !!color && (color.startsWith('#') || color.startsWith('rgb') || color.startsWith('hsl') || style.color === color)\r\n  );\r\n}\r\n"]}