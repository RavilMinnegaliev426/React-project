{"version":3,"sources":["VariablesCollector.ts"],"names":["DEFAULT_THEME","FLAT_THEME","IS_PROXY_SUPPORTED","callsCount","executionTime","ALL_USED_VARIABLES_SET","Set","COMPONENT_DESCRIPTIONS","COMPONENT_DESCRIPTIONS_BY_VARIABLE","baseThemes","push","componentsContext","require","context","keys","forEach","fileName","fileNameStart","lastIndexOf","componentName","substring","replace","componentDescription","jsStyles","Object","elementName","jsStyle","variablesAccumulator","dependencies","elementProxyHandler","getProxyHandler","themes","map","t","Proxy","variables","Array","from","length","variableName","variableNode","componentNode","includes","dependenciesList","dependencyName","dependencyNode","accumulator","accessLevel","rootProp","get","target","prop","receiver","propName","add","start","performance","now","result","Reflect","ALL_USED_VARIABLES","CALLS_COUNT","EXECUTION_TIME"],"mappings":"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","sourcesContent":["import { Theme } from '../../lib/theming/Theme';\r\nimport { DEFAULT_THEME } from '../../lib/theming/themes/DefaultTheme';\r\nimport { FLAT_THEME } from '../../lib/theming/themes/FlatTheme';\r\nimport { IS_PROXY_SUPPORTED } from '../../lib/Supports';\r\n\r\nexport interface DescriptionsType {\r\n  [componentName: string]: ComponentDescriptionType;\r\n}\r\n\r\nexport interface ComponentDescriptionType {\r\n  [elementName: string]: ComponentRowDescriptionType;\r\n}\r\n\r\nexport interface ComponentRowDescriptionType {\r\n  variables: Array<keyof Theme>;\r\n  dependencies: VariableDependencies;\r\n}\r\n\r\nexport interface VariableNameToComponentsMap {\r\n  [variableName: string]: DescriptionsType;\r\n}\r\n\r\nexport interface VariableDependencies {\r\n  [variableName: string]: Array<keyof Theme>;\r\n}\r\n\r\nlet callsCount = 0;\r\nlet executionTime = 0;\r\nconst ALL_USED_VARIABLES_SET = new Set<keyof Theme>();\r\n\r\nexport const COMPONENT_DESCRIPTIONS: DescriptionsType = {};\r\nexport const COMPONENT_DESCRIPTIONS_BY_VARIABLE: VariableNameToComponentsMap = {};\r\n\r\nif (IS_PROXY_SUPPORTED) {\r\n  const baseThemes: Theme[] = [];\r\n  baseThemes.push(DEFAULT_THEME);\r\n  baseThemes.push(FLAT_THEME);\r\n\r\n  const componentsContext = require.context('../../../', true, /\\.styles.ts$/);\r\n  componentsContext.keys().forEach(fileName => {\r\n    const fileNameStart = fileName.lastIndexOf('/') + 1;\r\n    const componentName = fileName.substring(fileNameStart).replace('.styles.ts', '');\r\n    const componentDescription: ComponentDescriptionType = {};\r\n    const jsStyles = componentsContext(fileName).jsStyles;\r\n\r\n    Object.keys(jsStyles).forEach(elementName => {\r\n      const jsStyle = jsStyles[elementName];\r\n      const variablesAccumulator = new Set<keyof Theme>();\r\n      const dependencies: VariableDependencies = {};\r\n      const elementProxyHandler = getProxyHandler(variablesAccumulator, dependencies);\r\n      const themes = baseThemes.map(t => new Proxy(t, elementProxyHandler));\r\n      themes.forEach(t => jsStyle(t));\r\n\r\n      const variables = Array.from(variablesAccumulator);\r\n\r\n      if (variables.length > 0) {\r\n        componentDescription[elementName] = { variables, dependencies };\r\n\r\n        variables.forEach(variableName => {\r\n          if (!COMPONENT_DESCRIPTIONS_BY_VARIABLE[variableName]) {\r\n            COMPONENT_DESCRIPTIONS_BY_VARIABLE[variableName] = {};\r\n          }\r\n\r\n          const variableNode = COMPONENT_DESCRIPTIONS_BY_VARIABLE[variableName];\r\n          if (!variableNode[componentName]) {\r\n            variableNode[componentName] = {};\r\n          }\r\n\r\n          const componentNode = variableNode[componentName];\r\n          if (!componentNode[elementName]) {\r\n            componentNode[elementName] = {\r\n              dependencies,\r\n              variables: [variableName],\r\n            };\r\n          } else if (!componentNode[elementName].variables.includes(variableName)) {\r\n            componentNode[elementName].dependencies = dependencies;\r\n            componentNode[elementName].variables.push(variableName);\r\n          }\r\n\r\n          const dependenciesList = dependencies[variableName];\r\n          if (dependenciesList) {\r\n            dependenciesList.forEach(dependencyName => {\r\n              if (!COMPONENT_DESCRIPTIONS_BY_VARIABLE[dependencyName]) {\r\n                COMPONENT_DESCRIPTIONS_BY_VARIABLE[dependencyName] = {};\r\n              }\r\n\r\n              const dependencyNode = COMPONENT_DESCRIPTIONS_BY_VARIABLE[dependencyName];\r\n              if (!dependencyNode[componentName]) {\r\n                dependencyNode[componentName] = COMPONENT_DESCRIPTIONS_BY_VARIABLE[variableName][componentName];\r\n              }\r\n            });\r\n          }\r\n        });\r\n      }\r\n    });\r\n\r\n    COMPONENT_DESCRIPTIONS[componentName] = componentDescription;\r\n  });\r\n}\r\n\r\nfunction getProxyHandler(accumulator: Set<keyof Theme>, dependencies: VariableDependencies): ProxyHandler<Theme> {\r\n  let accessLevel = 0;\r\n  let rootProp = '';\r\n  return {\r\n    get(target, prop, receiver) {\r\n      const propName = prop as keyof Theme;\r\n      ALL_USED_VARIABLES_SET.add(propName);\r\n      if (accessLevel === 0) {\r\n        rootProp = propName;\r\n        accumulator.add(propName);\r\n      } else {\r\n        if (!dependencies[rootProp]) {\r\n          dependencies[rootProp] = [propName];\r\n        } else if (!dependencies[rootProp].includes(propName)) {\r\n          dependencies[rootProp].push(propName);\r\n        }\r\n      }\r\n      accessLevel++;\r\n      const start = performance.now();\r\n      const result = Reflect.get(target, prop, receiver);\r\n      executionTime += performance.now() - start;\r\n      callsCount++;\r\n      accessLevel--;\r\n      return result;\r\n    },\r\n  };\r\n}\r\n\r\nexport const ALL_USED_VARIABLES = Array.from(ALL_USED_VARIABLES_SET);\r\nexport const CALLS_COUNT = callsCount;\r\nexport const EXECUTION_TIME = executionTime;\r\n"]}