{"version":3,"sources":["Popup.tsx"],"names":["React","findDOMNode","PropTypes","Transition","raf","warning","cn","LayoutEvents","ZIndex","RenderContainer","isFunction","isIE11","isEdge","ThemeContext","safePropTypesInstanceOf","PopupPin","PopupHelper","jsStyles","POPUP_BORDER_DEFAULT_COLOR","TRANSITION_TIMEOUT","enter","exit","DUMMY_LOCATION","position","coordinates","top","left","PopupPositions","Popup","state","location","props","opened","theme","layoutEventsToken","locationUpdateId","lastPopupElement","anchorElement","anchorInstance","refAnchorElement","instance","element","extractElement","updateAnchorElement","handleMouseEnter","event","onMouseEnter","handleMouseLeave","onMouseLeave","handleClick","onClick","handleFocus","onFocus","handleBlur","onBlur","resetLocation","cancelDelayedUpdateLocation","setState","refPopupElement","zIndex","handleLayoutEvent","updateLocation","popupElement","getLocation","locationEquals","componentDidMount","addListener","UNSAFE_componentWillReceiveProps","nextProps","delayUpdateLocation","componentDidUpdate","prevProps","prevState","hadNoLocation","hasLocation","onOpen","componentWillUnmount","removeEventListeners","remove","render","renderMain","useWrapper","child","HTMLElement","isValidElement","undefined","renderContent","addEventListeners","addEventListener","removeEventListener","backgroundColor","disableAnimations","maxWidth","hasShadow","ignoreHover","children","renderChildren","getPositionObject","direction","rootStyle","Boolean","popup","shadow","shadowFallback","popupIgnoreHover","transitionEnter","transitionEnterActive","transitionExit","content","contentInner","renderPin","isDefaultBorderColor","popupBorderColor","pinBorder","pinSize","pinOffset","borderColor","hasPin","popupBackground","cancel","x","y","positions","anchorRect","getElementAbsoluteRect","popupRect","getCoordinates","isFullyVisible","canBecomeVisible","canBecomeFullyVisible","getPinnedPopupOffset","test","align","anchorSize","width","height","Math","max","positionName","margin","popupOffset","getHorizontalPosition","getVerticalPosition","Error","Component","__KONTUR_REACT_UI__","propTypes","oneOfType","node","isRequired","string","func","bool","number","array","defaultProps","process","env","enableReactTesting"],"mappings":"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","sourcesContent":["import React from 'react';\r\nimport { findDOMNode } from 'react-dom';\r\nimport PropTypes from 'prop-types';\r\nimport { Transition } from 'react-transition-group';\r\nimport raf from 'raf';\r\nimport warning from 'warning';\r\nimport cn from 'classnames';\r\n\r\nimport { Nullable } from '../../typings/utility-types';\r\nimport * as LayoutEvents from '../../lib/LayoutEvents';\r\nimport { ZIndex } from '../ZIndex';\r\nimport { RenderContainer } from '../RenderContainer';\r\nimport { FocusEventType, MouseEventType } from '../../typings/event-types';\r\nimport { isFunction, isIE11, isEdge } from '../../lib/utils';\r\nimport { ThemeContext } from '../../lib/theming/ThemeContext';\r\nimport { Theme } from '../../lib/theming/Theme';\r\nimport { safePropTypesInstanceOf } from \"../../lib/SSRSafe\";\r\n\r\nimport { PopupPin } from './PopupPin';\r\nimport { Offset, PopupHelper, PositionObject, Rect } from './PopupHelper';\r\nimport { jsStyles } from './Popup.styles';\r\n\r\nconst POPUP_BORDER_DEFAULT_COLOR = 'transparent';\r\nconst TRANSITION_TIMEOUT = { enter: 0, exit: 200 };\r\n\r\nconst DUMMY_LOCATION: PopupLocation = {\r\n  position: 'top left',\r\n  coordinates: {\r\n    top: -9999,\r\n    left: -9999,\r\n  },\r\n};\r\n\r\nexport type PopupPosition =\r\n  | 'top left'\r\n  | 'top center'\r\n  | 'top right'\r\n  | 'right top'\r\n  | 'right middle'\r\n  | 'right bottom'\r\n  | 'bottom left'\r\n  | 'bottom center'\r\n  | 'bottom right'\r\n  | 'left top'\r\n  | 'left middle'\r\n  | 'left bottom';\r\n\r\nexport const PopupPositions: PopupPosition[] = [\r\n  'top left',\r\n  'top center',\r\n  'top right',\r\n  'right top',\r\n  'right middle',\r\n  'right bottom',\r\n  'bottom right',\r\n  'bottom center',\r\n  'bottom left',\r\n  'left bottom',\r\n  'left middle',\r\n  'left top',\r\n];\r\n\r\nexport interface PopupHandlerProps {\r\n  onMouseEnter?: (event: MouseEventType) => void;\r\n  onMouseLeave?: (event: MouseEventType) => void;\r\n  onClick?: (event: MouseEventType) => void;\r\n  onFocus?: (event: FocusEventType) => void;\r\n  onBlur?: (event: FocusEventType) => void;\r\n  onOpen?: () => void;\r\n}\r\n\r\nexport interface PopupProps extends PopupHandlerProps {\r\n  anchorElement: React.ReactNode | HTMLElement;\r\n  backgroundColor?: React.CSSProperties['backgroundColor'];\r\n  borderColor?: React.CSSProperties['borderColor'];\r\n  children: React.ReactNode | (() => React.ReactNode);\r\n  hasPin: boolean;\r\n  hasShadow: boolean;\r\n  disableAnimations: boolean;\r\n  margin: number;\r\n  maxWidth?: number | string;\r\n  opened: boolean;\r\n  pinOffset: number;\r\n  pinSize: number;\r\n  popupOffset: number;\r\n  positions: PopupPosition[];\r\n  useWrapper: boolean;\r\n  ignoreHover: boolean;\r\n}\r\n\r\ninterface PopupLocation {\r\n  coordinates: {\r\n    left: number;\r\n    top: number;\r\n  };\r\n  position: PopupPosition;\r\n}\r\n\r\nexport interface PopupState {\r\n  location: Nullable<PopupLocation>;\r\n}\r\n\r\nexport class Popup extends React.Component<PopupProps, PopupState> {\r\n  public static __KONTUR_REACT_UI__ = 'Popup';\r\n\r\n  public static propTypes = {\r\n    /**\r\n     * Ссылка (ref) на элемент или React компонент, для которого рисуется попап\r\n     */\r\n    anchorElement: PropTypes.oneOfType([safePropTypesInstanceOf(() => HTMLElement), PropTypes.node]).isRequired,\r\n\r\n    /**\r\n     * Фон попапа и пина\r\n     */\r\n    backgroundColor: PropTypes.string,\r\n\r\n    children: PropTypes.oneOfType([PropTypes.node, PropTypes.func]),\r\n\r\n    /**\r\n     * Показывать ли пин\r\n     */\r\n    hasPin: PropTypes.bool,\r\n\r\n    /**\r\n     * Применять ли box-shadow на попапе. При false отключает границу на пине\r\n     */\r\n    hasShadow: PropTypes.bool,\r\n\r\n    /**\r\n     * Отступ попапа от элемента\r\n     */\r\n    margin: PropTypes.number,\r\n\r\n    /**\r\n     * Показан или скрыт попап\r\n     */\r\n    opened: PropTypes.bool,\r\n\r\n    /**\r\n     * Смещение пина от края попапа. Край задаётся в пропе position вторым словом\r\n     */\r\n    pinOffset: PropTypes.number,\r\n\r\n    /**\r\n     * Сторона пина без учёта границы.\r\n     * Пин представляет собой равносторонний треугольник, высота от попапа\r\n     * до \"носика\" пина будет соответствовать формуле (size* √3)/2\r\n     */\r\n    pinSize: PropTypes.number,\r\n\r\n    /**\r\n     * смещение попапа относительно родительского элемента\r\n     */\r\n    popupOffset: PropTypes.number,\r\n\r\n    /**\r\n     * С какой стороны показывать попап и край попапа,\r\n     * на котором будет отображаться пин\r\n     */\r\n    positions: PropTypes.array,\r\n\r\n    /**\r\n     * Игнорировать ли события hover/click\r\n     */\r\n    ignoreHover: PropTypes.bool,\r\n  };\r\n\r\n  public static defaultProps = {\r\n    margin: 10,\r\n    popupOffset: 0,\r\n    pinSize: 8,\r\n    pinOffset: 16,\r\n    hasPin: false,\r\n    hasShadow: false,\r\n    disableAnimations: Boolean(process.env.enableReactTesting),\r\n    useWrapper: false,\r\n    ignoreHover: false,\r\n  };\r\n\r\n  public state: PopupState = { location: this.props.opened ? DUMMY_LOCATION : null };\r\n  private theme!: Theme;\r\n  private layoutEventsToken: Nullable<ReturnType<typeof LayoutEvents.addListener>>;\r\n  private locationUpdateId: Nullable<number> = null;\r\n  private lastPopupElement: Nullable<HTMLElement>;\r\n  private anchorElement: Nullable<HTMLElement> = null;\r\n  private anchorInstance: Nullable<React.ReactInstance>;\r\n\r\n  public componentDidMount() {\r\n    this.updateLocation();\r\n    this.layoutEventsToken = LayoutEvents.addListener(this.handleLayoutEvent);\r\n  }\r\n\r\n  public UNSAFE_componentWillReceiveProps(nextProps: Readonly<PopupProps>) {\r\n    /**\r\n     * Delaying updateLocation to ensure it happens after props update\r\n     */\r\n    if (nextProps.opened) {\r\n      if (!this.state.location) {\r\n        this.setState({ location: DUMMY_LOCATION });\r\n      }\r\n      this.delayUpdateLocation();\r\n    }\r\n  }\r\n\r\n  public componentDidUpdate(prevProps: PopupProps, prevState: PopupState) {\r\n    const hadNoLocation = prevState.location === DUMMY_LOCATION;\r\n    const hasLocation = this.state.location !== DUMMY_LOCATION;\r\n    if (hadNoLocation && hasLocation && this.props.onOpen) {\r\n      this.props.onOpen();\r\n    }\r\n  }\r\n\r\n  public componentWillUnmount() {\r\n    this.cancelDelayedUpdateLocation();\r\n    this.removeEventListeners(this.anchorElement);\r\n    if (this.layoutEventsToken) {\r\n      this.layoutEventsToken.remove();\r\n      this.layoutEventsToken = null;\r\n    }\r\n  }\r\n\r\n  public render() {\r\n    return (\r\n      <ThemeContext.Consumer>\r\n        {theme => {\r\n          this.theme = theme;\r\n          return this.renderMain();\r\n        }}\r\n      </ThemeContext.Consumer>\r\n    );\r\n  }\r\n\r\n  private renderMain() {\r\n    const { location } = this.state;\r\n    const { anchorElement, useWrapper } = this.props;\r\n\r\n    let child: Nullable<React.ReactNode> = null;\r\n    if (anchorElement instanceof HTMLElement) {\r\n      this.updateAnchorElement(anchorElement);\r\n    } else if (React.isValidElement(anchorElement)) {\r\n      child = useWrapper ? <span>{anchorElement}</span> : anchorElement;\r\n    } else {\r\n      child = <span>{anchorElement}</span>;\r\n    }\r\n\r\n    return (\r\n      <RenderContainer anchor={child} ref={child ? this.refAnchorElement : undefined}>\r\n        {location && this.renderContent(location)}\r\n      </RenderContainer>\r\n    );\r\n  }\r\n\r\n  private refAnchorElement = (instance: React.ReactInstance | null) => {\r\n    this.anchorInstance = instance;\r\n    const element = this.extractElement(instance);\r\n    this.updateAnchorElement(element);\r\n    this.anchorElement = element;\r\n  };\r\n\r\n  private extractElement(instance: React.ReactInstance | null) {\r\n    if (!instance) {\r\n      return null;\r\n    }\r\n    const element = findDOMNode(instance);\r\n    return element instanceof HTMLElement ? element : null;\r\n  }\r\n\r\n  private updateAnchorElement(element: HTMLElement | null) {\r\n    const anchorElement = this.anchorElement;\r\n\r\n    if (element !== anchorElement) {\r\n      this.removeEventListeners(anchorElement);\r\n      this.anchorElement = element;\r\n      this.addEventListeners(element);\r\n    }\r\n  }\r\n\r\n  private addEventListeners(element: Nullable<HTMLElement>) {\r\n    if (element && element instanceof HTMLElement) {\r\n      element.addEventListener('mouseenter', this.handleMouseEnter);\r\n      element.addEventListener('mouseleave', this.handleMouseLeave);\r\n      element.addEventListener('click', this.handleClick);\r\n      element.addEventListener('focusin', this.handleFocus as EventListener);\r\n      element.addEventListener('focusout', this.handleBlur as EventListener);\r\n    }\r\n  }\r\n\r\n  private removeEventListeners(element: Nullable<HTMLElement>) {\r\n    if (element && element instanceof HTMLElement) {\r\n      element.removeEventListener('mouseenter', this.handleMouseEnter);\r\n      element.removeEventListener('mouseleave', this.handleMouseLeave);\r\n      element.removeEventListener('click', this.handleClick);\r\n      element.removeEventListener('focusin', this.handleFocus as EventListener);\r\n      element.removeEventListener('focusout', this.handleBlur as EventListener);\r\n    }\r\n  }\r\n\r\n  private handleMouseEnter = (event: MouseEventType) => {\r\n    if (this.props.onMouseEnter) {\r\n      this.props.onMouseEnter(event);\r\n    }\r\n  };\r\n\r\n  private handleMouseLeave = (event: MouseEventType) => {\r\n    if (this.props.onMouseLeave) {\r\n      this.props.onMouseLeave(event);\r\n    }\r\n  };\r\n\r\n  private handleClick = (event: MouseEventType) => {\r\n    if (this.props.onClick) {\r\n      this.props.onClick(event);\r\n    }\r\n  };\r\n\r\n  private handleFocus = (event: FocusEventType) => {\r\n    if (this.props.onFocus) {\r\n      this.props.onFocus(event);\r\n    }\r\n  };\r\n\r\n  private handleBlur = (event: FocusEventType) => {\r\n    if (this.props.onBlur) {\r\n      this.props.onBlur(event);\r\n    }\r\n  };\r\n\r\n  private renderContent(location: PopupLocation) {\r\n    const { backgroundColor, disableAnimations, maxWidth, hasShadow, ignoreHover, opened } = this.props;\r\n    const children = this.renderChildren();\r\n\r\n    const { direction } = PopupHelper.getPositionObject(location.position);\r\n    const rootStyle: React.CSSProperties = { ...location.coordinates, maxWidth };\r\n\r\n    return (\r\n      <Transition\r\n        timeout={TRANSITION_TIMEOUT}\r\n        appear={!disableAnimations}\r\n        in={Boolean(opened && children)}\r\n        mountOnEnter\r\n        unmountOnExit\r\n        enter={!disableAnimations}\r\n        exit={!disableAnimations}\r\n        onExited={this.resetLocation}\r\n      >\r\n        {(state: string) => (\r\n          <ZIndex\r\n            ref={this.refPopupElement}\r\n            priority={'Popup'}\r\n            className={cn({\r\n              [jsStyles.popup(this.theme)]: true,\r\n              [jsStyles.shadow(this.theme)]: hasShadow,\r\n              [jsStyles.shadowFallback(this.theme)]: hasShadow && (isIE11 || isEdge),\r\n              [jsStyles.popupIgnoreHover()]: ignoreHover,\r\n              ...(disableAnimations\r\n                ? {}\r\n                : {\r\n                    [jsStyles[`transition-enter-${direction}` as keyof typeof jsStyles](this.theme)]: true,\r\n                    [jsStyles.transitionEnter()]: state === 'entering',\r\n                    [jsStyles.transitionEnterActive()]: state === 'entered',\r\n                    [jsStyles.transitionExit()]: state === 'exiting',\r\n                  }),\r\n            })}\r\n            style={rootStyle}\r\n            onMouseEnter={this.handleMouseEnter}\r\n            onMouseLeave={this.handleMouseLeave}\r\n          >\r\n            <div className={jsStyles.content(this.theme)} data-tid={'PopupContent'}>\r\n              <div\r\n                className={jsStyles.contentInner(this.theme)}\r\n                style={{ backgroundColor }}\r\n                data-tid={'PopupContentInner'}\r\n              >\r\n                {children}\r\n              </div>\r\n            </div>\r\n            {this.renderPin(location.position)}\r\n          </ZIndex>\r\n        )}\r\n      </Transition>\r\n    );\r\n  }\r\n\r\n  private resetLocation = () => {\r\n    this.cancelDelayedUpdateLocation();\r\n    this.setState({ location: null });\r\n  };\r\n\r\n  private renderChildren() {\r\n    return isFunction(this.props.children) ? this.props.children() : this.props.children;\r\n  }\r\n\r\n  private refPopupElement = (zIndex: ZIndex | null) => {\r\n    if (zIndex) {\r\n      this.lastPopupElement = zIndex && (findDOMNode(zIndex) as HTMLElement);\r\n    }\r\n  };\r\n\r\n  private renderPin(position: string): React.ReactNode {\r\n    /**\r\n     * Box-shadow does not appear under the pin. Borders are used instead.\r\n     * In non-ie browsers drop-shadow filter is used. It is applying\r\n     * shadow to the pin too.\r\n     */\r\n    const isDefaultBorderColor = this.theme.popupBorderColor === POPUP_BORDER_DEFAULT_COLOR;\r\n    const pinBorder = isIE11 && isDefaultBorderColor ? 'rgba(0, 0, 0, 0.09)' : this.theme.popupBorderColor;\r\n\r\n    const { pinSize, pinOffset, hasShadow, backgroundColor, borderColor } = this.props;\r\n\r\n    return (\r\n      this.props.hasPin && (\r\n        <PopupPin\r\n          popupElement={this.lastPopupElement}\r\n          popupPosition={position}\r\n          size={pinSize}\r\n          offset={pinOffset}\r\n          borderWidth={hasShadow ? 1 : 0}\r\n          backgroundColor={backgroundColor || this.theme.popupBackground}\r\n          borderColor={borderColor || pinBorder}\r\n        />\r\n      )\r\n    );\r\n  }\r\n\r\n  private handleLayoutEvent = () => {\r\n    if (!this.state.location) {\r\n      return;\r\n    }\r\n    if (this.anchorInstance) {\r\n      this.updateAnchorElement(this.extractElement(this.anchorInstance));\r\n    }\r\n    this.updateLocation();\r\n  };\r\n\r\n  private delayUpdateLocation() {\r\n    this.cancelDelayedUpdateLocation();\r\n    this.locationUpdateId = raf(this.updateLocation);\r\n  }\r\n\r\n  private cancelDelayedUpdateLocation() {\r\n    if (this.locationUpdateId) {\r\n      raf.cancel(this.locationUpdateId);\r\n      this.locationUpdateId = null;\r\n    }\r\n  }\r\n\r\n  private updateLocation = () => {\r\n    const popupElement = this.lastPopupElement;\r\n\r\n    if (!popupElement) {\r\n      return;\r\n    }\r\n\r\n    const location = this.getLocation(popupElement, this.state.location);\r\n    if (!this.locationEquals(this.state.location, location)) {\r\n      this.setState({ location });\r\n    }\r\n  };\r\n\r\n  private locationEquals(x: Nullable<PopupLocation>, y: Nullable<PopupLocation>) {\r\n    if (x === y) {\r\n      return true;\r\n    }\r\n\r\n    if (x == null || y == null) {\r\n      return false;\r\n    }\r\n\r\n    return (\r\n      x.coordinates.left === y.coordinates.left && x.coordinates.top === y.coordinates.top && x.position === y.position\r\n    );\r\n  }\r\n\r\n  private getLocation(popupElement: HTMLElement, location?: Nullable<PopupLocation>) {\r\n    const positions = this.props.positions;\r\n    const anchorElement = this.anchorElement;\r\n\r\n    warning(\r\n      anchorElement && anchorElement instanceof HTMLElement,\r\n      'Anchor element is not defined or not instance of HTMLElement',\r\n    );\r\n\r\n    if (!(anchorElement && anchorElement instanceof HTMLElement)) {\r\n      return location;\r\n    }\r\n\r\n    const anchorRect = PopupHelper.getElementAbsoluteRect(anchorElement);\r\n    const popupRect = PopupHelper.getElementAbsoluteRect(popupElement);\r\n\r\n    let position: PopupPosition;\r\n    let coordinates: Offset;\r\n\r\n    if (location && location !== DUMMY_LOCATION && location.position) {\r\n      position = location.position;\r\n      coordinates = this.getCoordinates(anchorRect, popupRect, position);\r\n\r\n      const isFullyVisible = PopupHelper.isFullyVisible(coordinates, popupRect);\r\n      const canBecomeVisible = !isFullyVisible && PopupHelper.canBecomeFullyVisible(position, coordinates);\r\n      if (isFullyVisible || canBecomeVisible) {\r\n        return { coordinates, position };\r\n      }\r\n    }\r\n\r\n    for (position of positions) {\r\n      coordinates = this.getCoordinates(anchorRect, popupRect, position);\r\n      if (PopupHelper.isFullyVisible(coordinates, popupRect)) {\r\n        return { coordinates, position };\r\n      }\r\n    }\r\n\r\n    position = positions[0];\r\n    coordinates = this.getCoordinates(anchorRect, popupRect, position);\r\n    return { coordinates, position };\r\n  }\r\n\r\n  private getPinnedPopupOffset(anchorRect: Rect, position: PositionObject) {\r\n    if (!this.props.hasPin || /center|middle/.test(position.align)) {\r\n      return 0;\r\n    }\r\n\r\n    const anchorSize = /top|bottom/.test(position.direction) ? anchorRect.width : anchorRect.height;\r\n\r\n    const { pinOffset, pinSize } = this.props;\r\n    return Math.max(0, pinOffset + pinSize - anchorSize / 2);\r\n  }\r\n\r\n  private getCoordinates(anchorRect: Rect, popupRect: Rect, positionName: string) {\r\n    const margin = this.props.margin;\r\n    const position = PopupHelper.getPositionObject(positionName);\r\n    const popupOffset = this.props.popupOffset + this.getPinnedPopupOffset(anchorRect, position);\r\n\r\n    switch (position.direction) {\r\n      case 'top':\r\n        return {\r\n          top: anchorRect.top - popupRect.height - margin,\r\n          left: this.getHorizontalPosition(anchorRect, popupRect, position.align, popupOffset),\r\n        };\r\n      case 'bottom':\r\n        return {\r\n          top: anchorRect.top + anchorRect.height + margin,\r\n          left: this.getHorizontalPosition(anchorRect, popupRect, position.align, popupOffset),\r\n        };\r\n      case 'left':\r\n        return {\r\n          top: this.getVerticalPosition(anchorRect, popupRect, position.align, popupOffset),\r\n          left: anchorRect.left - popupRect.width - margin,\r\n        };\r\n      case 'right':\r\n        return {\r\n          top: this.getVerticalPosition(anchorRect, popupRect, position.align, popupOffset),\r\n          left: anchorRect.left + anchorRect.width + margin,\r\n        };\r\n      default:\r\n        throw new Error(`Unexpected direction '${position.direction}'`);\r\n    }\r\n  }\r\n\r\n  private getHorizontalPosition(anchorRect: Rect, popupRect: Rect, align: string, popupOffset: number) {\r\n    switch (align) {\r\n      case 'left':\r\n        return anchorRect.left - popupOffset;\r\n      case 'center':\r\n        return anchorRect.left - (popupRect.width - anchorRect.width) / 2;\r\n      case 'right':\r\n        return anchorRect.left - (popupRect.width - anchorRect.width) + popupOffset;\r\n      default:\r\n        throw new Error(`Unexpected align '${align}'`);\r\n    }\r\n  }\r\n\r\n  private getVerticalPosition(anchorRect: Rect, popupRect: Rect, align: string, popupOffset: number) {\r\n    switch (align) {\r\n      case 'top':\r\n        return anchorRect.top - popupOffset;\r\n      case 'middle':\r\n        return anchorRect.top - (popupRect.height - anchorRect.height) / 2;\r\n      case 'bottom':\r\n        return anchorRect.top - (popupRect.height - anchorRect.height) + popupOffset;\r\n      default:\r\n        throw new Error(`Unexpected align '${align}'`);\r\n    }\r\n  }\r\n}\r\n"]}