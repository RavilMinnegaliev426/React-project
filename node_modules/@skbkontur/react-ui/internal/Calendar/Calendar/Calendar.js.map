{"version":3,"sources":["Calendar.tsx"],"names":["React","normalizeWheel","MAX_DATE","MAX_MONTH","MAX_YEAR","MIN_DATE","MIN_MONTH","MIN_YEAR","ThemeContext","Animation","config","CalendarUtils","MonthViewModel","CalendarScrollEvents","Month","jsStyles","create","isGreater","isLess","getTodayDate","date","Date","getDate","month","getMonth","year","getFullYear","wrapperStyle","height","WRAPPER_HEIGHT","Calendar","props","theme","wheelEndTimeout","root","animation","scrollToMonth","inProgress","finish","Promise","r","setTimeout","minDate","maxDate","currentMonth","state","months","diffInMonths","scrollTo","maxMonthsToAdd","MAX_MONTHS_TO_APPEND_ON_SCROLL","onEnd","setState","getMonths","scrollPosition","isYearChanges","Math","abs","monthsToPrependCount","min","monthsToPrepend","Array","from","length","_","index","yearChanges","isFirstInYear","isLastInYear","concat","getMonthsHeight","targetPosition","monthsToAppendCount","monthsToAppend","slice","renderMain","positions","getMonthPositions","refRoot","wrapper","map","x","i","filter","top","isMonthVisible","renderMonth","element","addEventListener","handleWheel","passive","removeEventListener","handleMonthYearChange","event","WheelEvent","preventDefault","pixelY","scrollTarget","calculateScrollPosition","handleWheelEnd","animate","deltaY","applyDelta","emit","clearTimeout","window","scrollToNearestWeek","scrollDirection","trasholdHeight","MONTH_TITLE_OFFSET_HEIGHT","DAY_HEIGHT","amount","pos","scrollAmmount","scrollAmount","today","initialMonth","initialYear","componentWillUnmount","cancel","render","value","onSelect","isHoliday","position","push","Component","__KONTUR_REACT_UI__","defaultProps","holidays"],"mappings":"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","sourcesContent":["import React from 'react';\r\nimport normalizeWheel from 'normalize-wheel';\r\n\r\nimport { MAX_DATE, MAX_MONTH, MAX_YEAR, MIN_DATE, MIN_MONTH, MIN_YEAR } from '../../lib/date/constants';\r\nimport { Nullable } from '../../typings/utility-types';\r\nimport { Theme } from '../../lib/theming/Theme';\r\nimport { ThemeContext } from '../../lib/theming/ThemeContext';\r\nimport { Animation } from '../../lib/animation';\r\n\r\nimport { config } from './config';\r\nimport * as CalendarUtils from './CalendarUtils';\r\nimport { MonthViewModel } from './MonthViewModel';\r\nimport * as CalendarScrollEvents from './CalendarScrollEvents';\r\nimport { Month } from './Month';\r\nimport { jsStyles } from './Calendar.styles';\r\nimport { CalendarDateShape, create, isGreater, isLess } from './CalendarDateShape';\r\n\r\nexport interface CalendarProps {\r\n  initialMonth?: number;\r\n  initialYear?: number;\r\n  onSelect?: (date: CalendarDateShape) => void;\r\n  value?: Nullable<CalendarDateShape>;\r\n  maxDate?: CalendarDateShape;\r\n  minDate?: CalendarDateShape;\r\n  isHoliday?: (day: CalendarDateShape & { isWeekend: boolean }) => boolean;\r\n}\r\n\r\nexport interface CalendarState {\r\n  scrollPosition: number;\r\n  months: MonthViewModel[];\r\n  today: CalendarDateShape;\r\n  scrollDirection: number;\r\n  scrollTarget: number;\r\n}\r\n\r\nconst getTodayDate = () => {\r\n  const date = new Date();\r\n  return {\r\n    date: date.getDate(),\r\n    month: date.getMonth(),\r\n    year: date.getFullYear(),\r\n  };\r\n};\r\n\r\nconst wrapperStyle = { height: config.WRAPPER_HEIGHT };\r\n\r\nexport class Calendar extends React.Component<CalendarProps, CalendarState> {\r\n  public static __KONTUR_REACT_UI__ = 'Calendar';\r\n\r\n  public static defaultProps = {\r\n    holidays: [],\r\n    minDate: {\r\n      year: MIN_YEAR,\r\n      month: MIN_MONTH,\r\n      date: MIN_DATE,\r\n    },\r\n    maxDate: {\r\n      year: MAX_YEAR,\r\n      month: MAX_MONTH,\r\n      date: MAX_DATE,\r\n    },\r\n  };\r\n\r\n  private theme!: Theme;\r\n  private wheelEndTimeout: Nullable<number>;\r\n  private root: Nullable<HTMLElement>;\r\n  private animation = Animation();\r\n\r\n  constructor(props: CalendarProps) {\r\n    super(props);\r\n\r\n    const today = getTodayDate();\r\n\r\n    const initialMonth = props.initialMonth == null ? today.month : props.initialMonth;\r\n    const initialYear = props.initialYear == null ? today.year : props.initialYear;\r\n\r\n    this.state = {\r\n      scrollPosition: 0,\r\n      months: CalendarUtils.getMonths(initialMonth, initialYear),\r\n      today,\r\n      scrollDirection: 1,\r\n      scrollTarget: 0,\r\n    };\r\n  }\r\n\r\n  public componentWillUnmount() {\r\n    if (this.animation.inProgress()) {\r\n      this.animation.cancel();\r\n    }\r\n  }\r\n\r\n  public render() {\r\n    return (\r\n      <ThemeContext.Consumer>\r\n        {theme => {\r\n          this.theme = theme;\r\n          return this.renderMain();\r\n        }}\r\n      </ThemeContext.Consumer>\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Scrolls calendar to given date\r\n   * @public\r\n   */\r\n  public scrollToMonth = async (month: number, year: number) => {\r\n    if (this.animation.inProgress()) {\r\n      this.animation.finish();\r\n      // FIXME: Dirty hack to await batched updates\r\n      await new Promise(r => setTimeout(r));\r\n    }\r\n\r\n    const { minDate, maxDate } = this.props;\r\n\r\n    if (minDate && isGreater(minDate, create(32, month, year))) {\r\n      this.scrollToMonth(minDate.month, minDate.year);\r\n      return;\r\n    }\r\n\r\n    if (maxDate && isLess(maxDate, create(0, month, year))) {\r\n      this.scrollToMonth(maxDate.month, maxDate.year);\r\n      return;\r\n    }\r\n\r\n    const currentMonth = this.state.months[1];\r\n    const diffInMonths = currentMonth.month + currentMonth.year * 12 - month - year * 12;\r\n\r\n    if (diffInMonths === 0) {\r\n      this.scrollTo(0);\r\n      return;\r\n    }\r\n\r\n    const maxMonthsToAdd = config.MAX_MONTHS_TO_APPEND_ON_SCROLL;\r\n\r\n    const onEnd = () =>\r\n      this.setState({\r\n        months: CalendarUtils.getMonths(month, year),\r\n        scrollPosition: 0,\r\n      });\r\n\r\n    const isYearChanges = (state: CalendarState) =>\r\n      state.months[1].year !== year &&\r\n      // if diff in months is 2 or less,\r\n      // either year is not changing either months already\r\n      // have right isFirstInYear/isLastInYear flags\r\n      Math.abs(diffInMonths) > 2;\r\n\r\n    // If scrolling upwards, prepend maximum maxMonthsToAdd months\r\n    // and scroll to the first month\r\n    if (diffInMonths > 0) {\r\n      const monthsToPrependCount = Math.min(Math.abs(diffInMonths) - 1, maxMonthsToAdd);\r\n      const monthsToPrepend = Array.from({ length: monthsToPrependCount }, (_, index) =>\r\n        MonthViewModel.create(month + index, year),\r\n      );\r\n      this.setState(\r\n        state => {\r\n          const yearChanges = isYearChanges(state);\r\n          if (yearChanges) {\r\n            // Mutating here can lead to some unexpected bugs\r\n            // but we couldn't find any yet\r\n            state.months[0].isFirstInYear = true;\r\n            if (monthsToPrepend.length) {\r\n              // Mutating item here is safe as it was just created\r\n              monthsToPrepend[monthsToPrepend.length - 1].isLastInYear = true;\r\n            }\r\n          }\r\n          return {\r\n            months: monthsToPrepend.concat(state.months),\r\n            scrollPosition: -CalendarUtils.getMonthsHeight(monthsToPrepend),\r\n          };\r\n        },\r\n        () => {\r\n          const targetPosition = this.state.months[0].height;\r\n          this.scrollTo(targetPosition, onEnd);\r\n        },\r\n      );\r\n    }\r\n\r\n    // If scrolling downwards, append maximum maxMonthsToAdd months\r\n    // and scroll to the last but one month\r\n    if (diffInMonths < 0) {\r\n      const monthsToAppendCount = Math.min(Math.abs(diffInMonths), maxMonthsToAdd);\r\n      const monthsToAppend = Array.from({ length: monthsToAppendCount }, (_, index) =>\r\n        MonthViewModel.create(month + index - monthsToAppendCount + 2, year),\r\n      );\r\n      this.setState(\r\n        state => {\r\n          if (isYearChanges(state)) {\r\n            // Mutating here can lead to some unexpected bugs\r\n            // but we couldn't find any yet\r\n            state.months[state.months.length - 1].isLastInYear = true;\r\n            // Mutating item here is safe as it was just created\r\n            if (monthsToAppend[0]) {\r\n              monthsToAppend[0].isFirstInYear = true;\r\n            }\r\n          }\r\n          return { months: state.months.concat(monthsToAppend) };\r\n        },\r\n        () => {\r\n          const targetPosition = -1 * CalendarUtils.getMonthsHeight(this.state.months.slice(1, -2));\r\n          this.scrollTo(targetPosition, onEnd);\r\n        },\r\n      );\r\n    }\r\n  };\r\n\r\n  private renderMain = () => {\r\n    const positions = this.getMonthPositions();\r\n    return (\r\n      <div ref={this.refRoot} className={jsStyles.root(this.theme)}>\r\n        <div style={wrapperStyle} className={jsStyles.wrapper()}>\r\n          {this.state.months\r\n            .map<[number, MonthViewModel]>((x, i) => [positions[i], x])\r\n            .filter(([top, month]) => CalendarUtils.isMonthVisible(top, month))\r\n            .map(this.renderMonth, this)}\r\n        </div>\r\n      </div>\r\n    );\r\n  };\r\n\r\n  private refRoot = (element: HTMLElement | null) => {\r\n    if (!this.root && element) {\r\n      element.addEventListener('wheel', this.handleWheel, { passive: false });\r\n    }\r\n    if (this.root && !element) {\r\n      this.root.removeEventListener('wheel', this.handleWheel);\r\n    }\r\n    this.root = element;\r\n  };\r\n\r\n  private renderMonth([top, month]: [number, MonthViewModel]) {\r\n    return (\r\n      <Month\r\n        key={month.month + '-' + month.year}\r\n        top={top}\r\n        month={month}\r\n        maxDate={this.props.maxDate}\r\n        minDate={this.props.minDate}\r\n        today={this.state.today}\r\n        value={this.props.value}\r\n        onDateClick={this.props.onSelect}\r\n        onMonthYearChange={this.handleMonthYearChange}\r\n        isHoliday={this.props.isHoliday}\r\n      />\r\n    );\r\n  }\r\n\r\n  private getMonthPositions() {\r\n    const { scrollPosition, months } = this.state;\r\n    const positions = [scrollPosition - months[0].height];\r\n    for (let i = 1; i < months.length; i++) {\r\n      const position = positions[i - 1] + months[i - 1].height;\r\n      positions.push(position);\r\n    }\r\n    return positions;\r\n  }\r\n\r\n  private handleMonthYearChange = (month: number, year: number) => {\r\n    this.scrollToMonth(month, year);\r\n  };\r\n\r\n  private handleWheel = (event: Event) => {\r\n    if (!(event instanceof WheelEvent)) {\r\n      return;\r\n    }\r\n    event.preventDefault();\r\n    const { pixelY } = normalizeWheel(event);\r\n\r\n    this.setState(({ months, scrollPosition, scrollTarget }) => {\r\n      const targetPosition = CalendarUtils.calculateScrollPosition(months, scrollPosition, pixelY).scrollPosition;\r\n      return { scrollTarget: targetPosition };\r\n    }, this.handleWheelEnd);\r\n\r\n    this.animation.animate(pixelY, deltaY =>\r\n      // FIXME: Typescript not resolving setState cb type\r\n      this.setState(CalendarUtils.applyDelta(deltaY) as any),\r\n    );\r\n\r\n    CalendarScrollEvents.emit();\r\n  };\r\n\r\n  private handleWheelEnd = () => {\r\n    if (this.wheelEndTimeout) {\r\n      clearTimeout(this.wheelEndTimeout);\r\n    }\r\n    this.wheelEndTimeout = window.setTimeout(this.scrollToNearestWeek, 300);\r\n  };\r\n\r\n  private scrollToNearestWeek = () => {\r\n    const { scrollTarget, scrollDirection } = this.state;\r\n\r\n    const trasholdHeight = config.MONTH_TITLE_OFFSET_HEIGHT + config.DAY_HEIGHT;\r\n\r\n    if (scrollTarget < trasholdHeight) {\r\n      let targetPosition = 0;\r\n      if (scrollDirection < 0) {\r\n        targetPosition = trasholdHeight;\r\n      }\r\n\r\n      this.setState({ scrollTarget: targetPosition }, () => {\r\n        const amount = scrollTarget - targetPosition;\r\n        this.animation.animate(amount, deltaY =>\r\n          // FIXME: Typescript not resolving setState cb type\r\n          this.setState(CalendarUtils.applyDelta(deltaY) as any),\r\n        );\r\n      });\r\n    }\r\n  };\r\n\r\n  private scrollTo = (pos: number, onEnd?: () => void) => {\r\n    const scrollAmmount = pos - this.state.scrollPosition;\r\n    return this.scrollAmount(scrollAmmount, onEnd);\r\n  };\r\n\r\n  private scrollAmount = (scrollAmmount: number, onEnd?: () => void) => {\r\n    return this.animation.animate(\r\n      scrollAmmount,\r\n      deltaY =>\r\n        this.setState(({ scrollPosition }) => ({\r\n          scrollPosition: scrollPosition + deltaY,\r\n        })),\r\n      onEnd,\r\n    );\r\n  };\r\n}\r\n"]}