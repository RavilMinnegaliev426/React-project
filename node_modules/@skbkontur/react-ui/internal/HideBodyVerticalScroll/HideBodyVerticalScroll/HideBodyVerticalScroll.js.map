{"version":3,"sources":["HideBodyVerticalScroll.tsx"],"names":["React","getScrollWidth","HideBodyVerticalScroll","disposeDocumentStyle","initialScroll","master","updateScrollVisibility","document","documentElement","restoreStyles","clientHeight","scrollHeight","shouldRestore","VerticalScrollCounter","get","shouldHide","makeSomeMagicWithScroll","scrollTop","documentComputedStyle","getComputedStyle","scrollWidth","documentMargin","parseFloat","marginRight","documentStyle","generateDocumentStyle","attachStyle","element","style","classList","add","className","removeStyleNode","attachStylesheet","css","remove","componentDidMount","counter","increment","window","addEventListener","componentDidUpdate","componentWillUnmount","decrement","removeEventListener","render","Component","__KONTUR_REACT_UI__","hash","Math","random","toString","slice","RetailUIVerticalScrollCounter","generateClassName","name","sheet","createElement","setAttribute","styleSheet","cssText","textnode","createTextNode","appendChild","head","getElementsByTagName","contains","removeChild"],"mappings":"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","sourcesContent":["import React from 'react';\r\n\r\nimport { getScrollWidth } from '../../lib/dom/getScrollWidth';\r\n\r\nexport class HideBodyVerticalScroll extends React.Component {\r\n  public static __KONTUR_REACT_UI__ = 'HideBodyVerticalScroll';\r\n\r\n  public static hash = Math.random()\r\n    .toString(16)\r\n    .slice(2, 6);\r\n  private disposeDocumentStyle: (() => void) | null = null;\r\n  private initialScroll = 0;\r\n  private master = false;\r\n\r\n  public componentDidMount() {\r\n    const counter = VerticalScrollCounter.increment();\r\n    if (counter === 1) {\r\n      this.master = true;\r\n      this.initialScroll = document.documentElement ? document.documentElement.scrollTop : 0;\r\n      this.updateScrollVisibility();\r\n      window.addEventListener('resize', this.updateScrollVisibility);\r\n    }\r\n  }\r\n\r\n  public componentDidUpdate() {\r\n    if (this.master) {\r\n      this.updateScrollVisibility();\r\n    }\r\n  }\r\n\r\n  public componentWillUnmount() {\r\n    this.restoreStyles();\r\n\r\n    const counter = VerticalScrollCounter.decrement();\r\n    if (counter === 0) {\r\n      this.updateScrollVisibility();\r\n      window.removeEventListener('resize', this.updateScrollVisibility);\r\n    }\r\n  }\r\n\r\n  public render() {\r\n    return null;\r\n  }\r\n\r\n  private updateScrollVisibility = () => {\r\n    const { documentElement } = document;\r\n\r\n    this.restoreStyles();\r\n\r\n    if (!documentElement) {\r\n      return;\r\n    }\r\n\r\n    const { clientHeight, scrollHeight } = documentElement;\r\n    const shouldRestore = VerticalScrollCounter.get() === 0;\r\n    const shouldHide = !shouldRestore && clientHeight < scrollHeight;\r\n\r\n    if (shouldHide) {\r\n      this.makeSomeMagicWithScroll(documentElement);\r\n    }\r\n\r\n    if (shouldRestore) {\r\n      documentElement.scrollTop = this.initialScroll;\r\n    }\r\n  };\r\n\r\n  private makeSomeMagicWithScroll = (document: HTMLElement) => {\r\n    const documentComputedStyle = getComputedStyle(document);\r\n    const scrollWidth = getScrollWidth();\r\n    const documentMargin = parseFloat(documentComputedStyle.marginRight || '');\r\n    const documentStyle = generateDocumentStyle(documentMargin + scrollWidth);\r\n\r\n    this.disposeDocumentStyle = this.attachStyle(document, documentStyle);\r\n  };\r\n\r\n  private attachStyle = (element: HTMLElement, style: { css: string; className: string }) => {\r\n    element.classList.add(style.className);\r\n    const removeStyleNode = attachStylesheet(style.css);\r\n    return () => {\r\n      removeStyleNode();\r\n      element.classList.remove(style.className);\r\n    };\r\n  };\r\n\r\n  private restoreStyles = () => {\r\n    if (this.disposeDocumentStyle) {\r\n      this.disposeDocumentStyle();\r\n      this.disposeDocumentStyle = null;\r\n    }\r\n\r\n    // Forcing reflow for Firefix\r\n    attachStylesheet('html, body { height: auto; }')();\r\n  };\r\n}\r\n\r\nclass VerticalScrollCounter {\r\n  public static increment = (): number => {\r\n    const counter = window.RetailUIVerticalScrollCounter || 0;\r\n    return (window.RetailUIVerticalScrollCounter = counter + 1);\r\n  };\r\n\r\n  public static decrement = (): number => {\r\n    const counter = window.RetailUIVerticalScrollCounter || 0;\r\n    return (window.RetailUIVerticalScrollCounter = counter - 1);\r\n  };\r\n\r\n  public static get = (): number => {\r\n    return window.RetailUIVerticalScrollCounter || 0;\r\n  };\r\n}\r\n\r\nfunction generateClassName(className: string) {\r\n  const { name, hash } = HideBodyVerticalScroll;\r\n  return `${name}-${className}-${hash}`;\r\n}\r\n\r\nfunction generateDocumentStyle(documentMargin: number) {\r\n  const className = generateClassName('document');\r\n  const css = `\\\r\n.${className} {\r\n  overflow: hidden !important;\r\n  margin-right: ${documentMargin}px !important;\r\n  height: 100%;\r\n}\r\n`;\r\n  return { className, css };\r\n}\r\n\r\nfunction attachStylesheet(sheet: string) {\r\n  const style = document.createElement('style');\r\n  style.setAttribute('type', 'text/css');\r\n  // @ts-ignore IE specific api\r\n  if (style.styleSheet) {\r\n    // @ts-ignore IE specific api\r\n    style.styleSheet.cssText = sheet;\r\n  } else {\r\n    const textnode = document.createTextNode(sheet);\r\n    style.appendChild(textnode);\r\n  }\r\n  const head = document.getElementsByTagName('head')[0];\r\n  head.appendChild(style);\r\n  return () => {\r\n    if (head.contains(style)) {\r\n      head.removeChild(style);\r\n    }\r\n  };\r\n}\r\n"]}