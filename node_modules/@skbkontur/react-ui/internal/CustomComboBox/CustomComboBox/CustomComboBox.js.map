{"version":3,"sources":["CustomComboBox.tsx"],"names":["React","CancelationError","taskWithDelay","fixClickFocusIE","ComboBoxRequestStatus","reducer","ComboBoxView","DELAY_BEFORE_SHOW_LOADER","LOADER_SHOW_TIME","DefaultState","inputChanged","editing","items","loading","opened","focused","textValue","repeatRequest","undefined","requestStatus","Unknown","CustomComboBox","state","input","menu","inputLikeText","requestId","loaderShowDelay","cancelationToken","cancelLoaderDelay","focus","props","disabled","handleFocus","selectInputText","selectAll","blur","handleBlur","dispatch","action","effects","nextState","setState","stateAndEffect","Array","forEach","handleEffect","effect","getState","getProps","handleValueChange","value","type","keepFocus","handleClickOutside","e","close","handleInputBlur","handleInputClick","search","query","getItems","cancelPromise","Promise","_","reject","expectingId","resolve","cancelLoader","setTimeout","race","code","cancelSearch","open","render","viewProps","align","borderless","disablePortal","error","menuAlign","drawArrow","placeholder","size","totalCount","warning","width","maxLength","maxMenuHeight","onValueChange","onClickOutside","onFocus","onFocusOutside","onInputBlur","onInputValueChange","onInputFocus","onInputClick","onInputKeyDown","event","persist","onMouseEnter","onMouseOver","onMouseLeave","renderItem","renderNotFound","renderValue","renderTotalCount","renderAddButton","refInput","refMenu","refInputLikeText","componentDidMount","autoFocus","componentDidUpdate","prevProps","prevState","reset","PureComponent","__KONTUR_REACT_UI__"],"mappings":"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","sourcesContent":["import React from 'react';\r\n\r\nimport { Nullable } from '../../typings/utility-types';\r\nimport { Input } from '../../components/Input';\r\nimport { Menu } from '../Menu';\r\nimport { InputLikeText } from '../InputLikeText';\r\nimport { MenuItemState } from '../../components/MenuItem';\r\nimport { CancelationError, taskWithDelay } from '../../lib/utils';\r\nimport { fixClickFocusIE } from '../../lib/events/fixClickFocusIE';\r\n\r\nimport { ComboBoxRequestStatus } from './CustomComboBoxTypes';\r\nimport { CustomComboBoxAction, CustomComboBoxEffect, reducer } from './CustomComboBoxReducer';\r\nimport { ComboBoxView } from './ComboBoxView';\r\n\r\nexport interface CustomComboBoxProps<T> {\r\n  align?: 'left' | 'center' | 'right';\r\n  autoFocus?: boolean;\r\n  borderless?: boolean;\r\n  disablePortal?: boolean;\r\n  disabled?: boolean;\r\n  error?: boolean;\r\n  maxLength?: number;\r\n  menuAlign?: 'left' | 'right';\r\n  drawArrow?: boolean;\r\n  searchOnFocus?: boolean;\r\n  onValueChange?: (value: T) => void;\r\n  onInputValueChange?: (value: string) => Nullable<string> | void;\r\n  onUnexpectedInput?: (value: string) => void | null | T;\r\n  onFocus?: () => void;\r\n  onBlur?: () => void;\r\n  onMouseEnter?: (e: React.MouseEvent) => void;\r\n  onMouseOver?: (e: React.MouseEvent) => void;\r\n  onMouseLeave?: (e: React.MouseEvent) => void;\r\n  onInputKeyDown?: (e: React.KeyboardEvent<HTMLElement>) => void;\r\n  placeholder?: string;\r\n  size?: 'small' | 'medium' | 'large';\r\n  totalCount?: number;\r\n  value?: Nullable<T>;\r\n  warning?: boolean;\r\n  width?: string | number;\r\n  maxMenuHeight?: number | string;\r\n  renderNotFound?: () => React.ReactNode;\r\n  renderTotalCount?: (found: number, total: number) => React.ReactNode;\r\n  renderItem: (item: T, state?: MenuItemState) => React.ReactNode;\r\n  renderValue: (value: T) => React.ReactNode;\r\n  renderAddButton?: (query?: string) => React.ReactNode;\r\n  valueToString: (value: T) => string;\r\n  itemToValue: (item: T) => string | number;\r\n  getItems: (query: string) => Promise<T[]>;\r\n}\r\n\r\nexport interface CustomComboBoxState<T> {\r\n  editing: boolean;\r\n  loading: boolean;\r\n  opened: boolean;\r\n  textValue: string;\r\n  items: Nullable<T[]>;\r\n  inputChanged: boolean;\r\n  focused: boolean;\r\n  repeatRequest: () => void;\r\n  requestStatus: ComboBoxRequestStatus;\r\n}\r\n\r\nexport const DELAY_BEFORE_SHOW_LOADER = 300;\r\nexport const LOADER_SHOW_TIME = 1000;\r\n\r\nexport const DefaultState = {\r\n  inputChanged: false,\r\n  editing: false,\r\n  items: null,\r\n  loading: false,\r\n  opened: false,\r\n  focused: false,\r\n  textValue: '',\r\n  repeatRequest: () => undefined,\r\n  requestStatus: ComboBoxRequestStatus.Unknown,\r\n};\r\n\r\nexport class CustomComboBox<T> extends React.PureComponent<CustomComboBoxProps<T>, CustomComboBoxState<T>> {\r\n  public static __KONTUR_REACT_UI__ = 'CustomComboBox';\r\n\r\n  public state: CustomComboBoxState<T> = DefaultState;\r\n  public input: Nullable<Input>;\r\n  public menu: Nullable<Menu>;\r\n  public inputLikeText: Nullable<InputLikeText>;\r\n  public requestId = 0;\r\n  public loaderShowDelay: Nullable<Promise<never>>;\r\n  private focused = false;\r\n  private cancelationToken: Nullable<(reason?: Error) => void> = null;\r\n\r\n  private reducer = reducer;\r\n  public cancelLoaderDelay: () => void = () => null;\r\n\r\n  /**\r\n   * @public\r\n   */\r\n  public focus = () => {\r\n    if (this.props.disabled) {\r\n      return;\r\n    }\r\n\r\n    this.handleFocus();\r\n  };\r\n\r\n  /**\r\n   * @public\r\n   */\r\n  public selectInputText = () => {\r\n    if (this.props.disabled) {\r\n      return;\r\n    }\r\n    if (this.input) {\r\n      this.input.selectAll();\r\n    }\r\n  };\r\n\r\n  /**\r\n   * @public\r\n   */\r\n  public blur = () => {\r\n    if (this.props.disabled) {\r\n      return;\r\n    }\r\n\r\n    this.handleBlur();\r\n  };\r\n\r\n  /**\r\n   * @public\r\n   */\r\n  public async search(query: string = this.state.textValue) {\r\n    const { getItems } = this.props;\r\n\r\n    const cancelPromise: Promise<never> = new Promise((_, reject) => (this.cancelationToken = reject));\r\n    const expectingId = (this.requestId += 1);\r\n\r\n    if (!this.loaderShowDelay) {\r\n      this.loaderShowDelay = new Promise(resolve => {\r\n        const cancelLoader = taskWithDelay(() => {\r\n          this.dispatch({ type: 'RequestItems' });\r\n          setTimeout(resolve, LOADER_SHOW_TIME);\r\n        }, DELAY_BEFORE_SHOW_LOADER);\r\n\r\n        cancelPromise.catch(() => cancelLoader());\r\n\r\n        this.cancelLoaderDelay = () => {\r\n          cancelLoader();\r\n          resolve();\r\n        };\r\n      });\r\n    }\r\n\r\n    try {\r\n      const items = await Promise.race([getItems(query), cancelPromise]);\r\n      if (this.state.loading) {\r\n        await Promise.race([this.loaderShowDelay, cancelPromise]);\r\n      }\r\n      if (expectingId === this.requestId) {\r\n        this.dispatch({\r\n          type: 'ReceiveItems',\r\n          items,\r\n        });\r\n      }\r\n    } catch (error) {\r\n      if (error && error.code === 'CancelationError') {\r\n        this.dispatch({ type: 'CancelRequest' });\r\n      } else if (expectingId === this.requestId) {\r\n        this.dispatch({\r\n          type: 'RequestFailure',\r\n          repeatRequest: () => {\r\n            this.search(query);\r\n            if (this.input) {\r\n              this.input.focus();\r\n            }\r\n          },\r\n        });\r\n      }\r\n    } finally {\r\n      if (expectingId === this.requestId) {\r\n        if (!this.state.loading) {\r\n          this.cancelLoaderDelay();\r\n        }\r\n        this.cancelationToken = null;\r\n        this.loaderShowDelay = null;\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @public\r\n   */\r\n  public cancelSearch() {\r\n    if (this.cancelationToken) {\r\n      this.cancelationToken(new CancelationError());\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @public\r\n   */\r\n  public open() {\r\n    this.dispatch({ type: 'Open' });\r\n  }\r\n\r\n  /**\r\n   * @public\r\n   */\r\n  public close() {\r\n    this.dispatch({ type: 'Close' });\r\n  }\r\n\r\n  public render() {\r\n    const viewProps = {\r\n      align: this.props.align,\r\n      borderless: this.props.borderless,\r\n      disabled: this.props.disabled,\r\n      disablePortal: this.props.disablePortal,\r\n      editing: this.state.editing,\r\n      error: this.props.error,\r\n      items: this.state.items,\r\n      loading: this.state.loading,\r\n      menuAlign: this.props.menuAlign,\r\n      opened: this.state.opened,\r\n      drawArrow: this.props.drawArrow,\r\n      placeholder: this.props.placeholder,\r\n      size: this.props.size,\r\n      textValue: this.state.textValue,\r\n      totalCount: this.props.totalCount,\r\n      value: this.props.value,\r\n      warning: this.props.warning,\r\n      width: this.props.width,\r\n      maxLength: this.props.maxLength,\r\n      maxMenuHeight: this.props.maxMenuHeight,\r\n\r\n      onValueChange: this.handleValueChange,\r\n      onClickOutside: this.handleClickOutside,\r\n      onFocus: this.handleFocus,\r\n      onFocusOutside: this.handleBlur,\r\n      onInputBlur: this.handleInputBlur,\r\n      onInputValueChange: (value: string) => this.dispatch({ type: 'TextChange', value }),\r\n      onInputFocus: this.handleFocus,\r\n      onInputClick: this.handleInputClick,\r\n      onInputKeyDown: (event: React.KeyboardEvent) => {\r\n        event.persist();\r\n        this.dispatch({ type: 'KeyPress', event });\r\n      },\r\n      onMouseEnter: this.props.onMouseEnter,\r\n      onMouseOver: this.props.onMouseOver,\r\n      onMouseLeave: this.props.onMouseLeave,\r\n      renderItem: this.props.renderItem,\r\n      renderNotFound: this.props.renderNotFound,\r\n      renderValue: this.props.renderValue,\r\n      renderTotalCount: this.props.renderTotalCount,\r\n      renderAddButton: this.props.renderAddButton,\r\n      repeatRequest: this.state.repeatRequest,\r\n      requestStatus: this.state.requestStatus,\r\n\r\n      refInput: (input: Nullable<Input>) => {\r\n        this.input = input;\r\n      },\r\n      refMenu: (menu: Nullable<Menu>) => {\r\n        this.menu = menu;\r\n      },\r\n      refInputLikeText: (inputLikeText: Nullable<InputLikeText>) => {\r\n        this.inputLikeText = inputLikeText;\r\n      },\r\n    };\r\n\r\n    return <ComboBoxView {...viewProps} />;\r\n  }\r\n\r\n  public componentDidMount() {\r\n    this.dispatch({ type: 'Mount' });\r\n    if (this.props.autoFocus) {\r\n      this.focus();\r\n    }\r\n  }\r\n\r\n  public componentDidUpdate(prevProps: CustomComboBoxProps<T>, prevState: CustomComboBoxState<T>) {\r\n    if (prevState.editing && !this.state.editing) {\r\n      this.handleBlur();\r\n    }\r\n    this.dispatch({ type: 'DidUpdate', prevProps, prevState });\r\n  }\r\n\r\n  /**\r\n   * @public\r\n   */\r\n  public reset() {\r\n    this.dispatch({ type: 'Reset' });\r\n  }\r\n\r\n  private dispatch = (action: CustomComboBoxAction<T>) => {\r\n    let effects: Array<CustomComboBoxEffect<T>>;\r\n    let nextState: Pick<CustomComboBoxState<T>, never>;\r\n\r\n    this.setState(\r\n      state => {\r\n        const stateAndEffect = this.reducer(state, this.props, action);\r\n\r\n        [nextState, effects] = stateAndEffect instanceof Array ? stateAndEffect : [stateAndEffect, []];\r\n\r\n        return nextState;\r\n      },\r\n      () => {\r\n        effects.forEach(this.handleEffect);\r\n      },\r\n    );\r\n  };\r\n\r\n  private handleEffect = (effect: CustomComboBoxEffect<T>) => {\r\n    effect(this.dispatch, this.getState, this.getProps, () => this);\r\n  };\r\n\r\n  private getProps = () => this.props;\r\n\r\n  private getState = () => this.state;\r\n\r\n  private handleValueChange = (value: T) => {\r\n    this.dispatch({\r\n      type: 'ValueChange',\r\n      value,\r\n      keepFocus: true,\r\n    });\r\n  };\r\n\r\n  private handleFocus = () => {\r\n    if (this.focused) {\r\n      return;\r\n    }\r\n    this.focused = true;\r\n    this.dispatch({ type: 'Focus' });\r\n  };\r\n\r\n  private handleClickOutside = (e: Event) => {\r\n    fixClickFocusIE(e);\r\n    this.handleBlur();\r\n  };\r\n\r\n  private handleBlur = () => {\r\n    if (!this.focused) {\r\n      if (this.state.opened) {\r\n        this.close();\r\n      }\r\n      return;\r\n    }\r\n    this.focused = false;\r\n    this.dispatch({ type: 'Blur' });\r\n  };\r\n\r\n  private handleInputBlur = () => {\r\n    // If menu opened, RenderLayer is active and\r\n    // it would call handleFocusOutside\r\n    // In that way handleBlur would be called\r\n    if (this.state.opened) {\r\n      return;\r\n    }\r\n    this.handleBlur();\r\n  };\r\n\r\n  private handleInputClick = () => {\r\n    if (!this.cancelationToken) {\r\n      this.dispatch({ type: 'InputClick' });\r\n    }\r\n  };\r\n}\r\n"]}